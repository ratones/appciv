function bkClass(){}function $BK(e){return"string"==typeof e&&(e=document.getElementById(e)),e&&!e.appendTo?bkExtend(e,bkElement.prototype):e}function __(e){return e}!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function i(e,t){t=t||te;var i=t.createElement("script");i.text=e,t.head.appendChild(i).parentNode.removeChild(i)}function n(e){var t=!!e&&"length"in e&&e.length,i=fe.type(e);return"function"!==i&&!fe.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}function s(e,t,i){return fe.isFunction(t)?fe.grep(e,function(e,n){return!!t.call(e,n,e)!==i}):t.nodeType?fe.grep(e,function(e){return e===t!==i}):"string"!=typeof t?fe.grep(e,function(e){return oe.call(t,e)>-1!==i}):ke.test(t)?fe.filter(t,e,i):(t=fe.filter(t,e),fe.grep(e,function(e){return oe.call(t,e)>-1!==i&&1===e.nodeType}))}function r(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t={};return fe.each(e.match(ze)||[],function(e,i){t[i]=!0}),t}function a(e){return e}function l(e){throw e}function c(e,t,i){var n;try{e&&fe.isFunction(n=e.promise)?n.call(e).done(t).fail(i):e&&fe.isFunction(n=e.then)?n.call(e,t,i):t.call(void 0,e)}catch(e){i.call(void 0,e)}}function d(){te.removeEventListener("DOMContentLoaded",d),e.removeEventListener("load",d),fe.ready()}function u(){this.expando=fe.expando+u.uid++}function h(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Fe.test(e)?JSON.parse(e):e)}function p(e,t,i){var n;if(void 0===i&&1===e.nodeType)if(n="data-"+t.replace(Me,"-$&").toLowerCase(),i=e.getAttribute(n),"string"==typeof i){try{i=h(i)}catch(e){}Ae.set(e,t,i)}else i=void 0;return i}function f(e,t,i,n){var s,r=1,o=20,a=n?function(){return n.cur()}:function(){return fe.css(e,t,"")},l=a(),c=i&&i[3]||(fe.cssNumber[t]?"":"px"),d=(fe.cssNumber[t]||"px"!==c&&+l)&&Le.exec(fe.css(e,t));if(d&&d[3]!==c){c=c||d[3],i=i||[],d=+l||1;do r=r||".5",d/=r,fe.style(e,t,d+c);while(r!==(r=a()/l)&&1!==r&&--o)}return i&&(d=+d||+l||0,s=i[1]?d+(i[1]+1)*i[2]:+i[2],n&&(n.unit=c,n.start=d,n.end=s)),s}function g(e){var t,i=e.ownerDocument,n=e.nodeName,s=Ue[n];return s?s:(t=i.body.appendChild(i.createElement(n)),s=fe.css(t,"display"),t.parentNode.removeChild(t),"none"===s&&(s="block"),Ue[n]=s,s)}function m(e,t){for(var i,n,s=[],r=0,o=e.length;r<o;r++)n=e[r],n.style&&(i=n.style.display,t?("none"===i&&(s[r]=Re.get(n,"display")||null,s[r]||(n.style.display="")),""===n.style.display&&Be(n)&&(s[r]=g(n))):"none"!==i&&(s[r]="none",Re.set(n,"display",i)));for(r=0;r<o;r++)null!=s[r]&&(e[r].style.display=s[r]);return e}function v(e,t){var i;return i="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&fe.nodeName(e,t)?fe.merge([e],i):i}function w(e,t){for(var i=0,n=e.length;i<n;i++)Re.set(e[i],"globalEval",!t||Re.get(t[i],"globalEval"))}function y(e,t,i,n,s){for(var r,o,a,l,c,d,u=t.createDocumentFragment(),h=[],p=0,f=e.length;p<f;p++)if(r=e[p],r||0===r)if("object"===fe.type(r))fe.merge(h,r.nodeType?[r]:r);else if(Xe.test(r)){for(o=o||u.appendChild(t.createElement("div")),a=(We.exec(r)||["",""])[1].toLowerCase(),l=Ge[a]||Ge._default,o.innerHTML=l[1]+fe.htmlPrefilter(r)+l[2],d=l[0];d--;)o=o.lastChild;fe.merge(h,o.childNodes),o=u.firstChild,o.textContent=""}else h.push(t.createTextNode(r));for(u.textContent="",p=0;r=h[p++];)if(n&&fe.inArray(r,n)>-1)s&&s.push(r);else if(c=fe.contains(r.ownerDocument,r),o=v(u.appendChild(r),"script"),c&&w(o),i)for(d=0;r=o[d++];)Ye.test(r.type||"")&&i.push(r);return u}function b(){return!0}function x(){return!1}function _(){try{return te.activeElement}catch(e){}}function C(e,t,i,n,s,r){var o,a;if("object"==typeof t){"string"!=typeof i&&(n=n||i,i=void 0);for(a in t)C(e,a,i,n,t[a],r);return e}if(null==n&&null==s?(s=i,n=i=void 0):null==s&&("string"==typeof i?(s=n,n=void 0):(s=n,n=i,i=void 0)),s===!1)s=x;else if(!s)return e;return 1===r&&(o=s,s=function(e){return fe().off(e),o.apply(this,arguments)},s.guid=o.guid||(o.guid=fe.guid++)),e.each(function(){fe.event.add(this,t,s,n,i)})}function k(e,t){return fe.nodeName(e,"table")&&fe.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e:e}function T(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function S(e){var t=nt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function E(e,t){var i,n,s,r,o,a,l,c;if(1===t.nodeType){if(Re.hasData(e)&&(r=Re.access(e),o=Re.set(t,r),c=r.events)){delete o.handle,o.events={};for(s in c)for(i=0,n=c[s].length;i<n;i++)fe.event.add(t,s,c[s][i])}Ae.hasData(e)&&(a=Ae.access(e),l=fe.extend({},a),Ae.set(t,l))}}function $(e,t){var i=t.nodeName.toLowerCase();"input"===i&&qe.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function j(e,t,n,s){t=se.apply([],t);var r,o,a,l,c,d,u=0,h=e.length,p=h-1,f=t[0],g=fe.isFunction(f);if(g||h>1&&"string"==typeof f&&!he.checkClone&&it.test(f))return e.each(function(i){var r=e.eq(i);g&&(t[0]=f.call(this,i,r.html())),j(r,t,n,s)});if(h&&(r=y(t,e[0].ownerDocument,!1,e,s),o=r.firstChild,1===r.childNodes.length&&(r=o),o||s)){for(a=fe.map(v(r,"script"),T),l=a.length;u<h;u++)c=r,u!==p&&(c=fe.clone(c,!0,!0),l&&fe.merge(a,v(c,"script"))),n.call(e[u],c,u);if(l)for(d=a[a.length-1].ownerDocument,fe.map(a,S),u=0;u<l;u++)c=a[u],Ye.test(c.type||"")&&!Re.access(c,"globalEval")&&fe.contains(d,c)&&(c.src?fe._evalUrl&&fe._evalUrl(c.src):i(c.textContent.replace(st,""),d))}return e}function z(e,t,i){for(var n,s=t?fe.filter(t,e):e,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||fe.cleanData(v(n)),n.parentNode&&(i&&fe.contains(n.ownerDocument,n)&&w(v(n,"script")),n.parentNode.removeChild(n));return e}function D(e,t,i){var n,s,r,o,a=e.style;return i=i||at(e),i&&(o=i.getPropertyValue(t)||i[t],""!==o||fe.contains(e.ownerDocument,e)||(o=fe.style(e,t)),!he.pixelMarginRight()&&ot.test(o)&&rt.test(t)&&(n=a.width,s=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=n,a.minWidth=s,a.maxWidth=r)),void 0!==o?o+"":o}function P(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function I(e){if(e in ht)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=ut.length;i--;)if(e=ut[i]+t,e in ht)return e}function O(e,t,i){var n=Le.exec(t);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):t}function R(e,t,i,n,s){var r,o=0;for(r=i===(n?"border":"content")?4:"width"===t?1:0;r<4;r+=2)"margin"===i&&(o+=fe.css(e,i+He[r],!0,s)),n?("content"===i&&(o-=fe.css(e,"padding"+He[r],!0,s)),"margin"!==i&&(o-=fe.css(e,"border"+He[r]+"Width",!0,s))):(o+=fe.css(e,"padding"+He[r],!0,s),"padding"!==i&&(o+=fe.css(e,"border"+He[r]+"Width",!0,s)));return o}function A(e,t,i){var n,s=!0,r=at(e),o="border-box"===fe.css(e,"boxSizing",!1,r);if(e.getClientRects().length&&(n=e.getBoundingClientRect()[t]),n<=0||null==n){if(n=D(e,t,r),(n<0||null==n)&&(n=e.style[t]),ot.test(n))return n;s=o&&(he.boxSizingReliable()||n===e.style[t]),n=parseFloat(n)||0}return n+R(e,t,i||(o?"border":"content"),s,r)+"px"}function F(e,t,i,n,s){return new F.prototype.init(e,t,i,n,s)}function M(){ft&&(e.requestAnimationFrame(M),fe.fx.tick())}function N(){return e.setTimeout(function(){pt=void 0}),pt=fe.now()}function L(e,t){var i,n=0,s={height:e};for(t=t?1:0;n<4;n+=2-t)i=He[n],s["margin"+i]=s["padding"+i]=e;return t&&(s.opacity=s.width=e),s}function H(e,t,i){for(var n,s=(U.tweeners[t]||[]).concat(U.tweeners["*"]),r=0,o=s.length;r<o;r++)if(n=s[r].call(i,t,e))return n}function B(e,t,i){var n,s,r,o,a,l,c,d,u="width"in t||"height"in t,h=this,p={},f=e.style,g=e.nodeType&&Be(e),v=Re.get(e,"fxshow");i.queue||(o=fe._queueHooks(e,"fx"),null==o.unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,h.always(function(){h.always(function(){o.unqueued--,fe.queue(e,"fx").length||o.empty.fire()})}));for(n in t)if(s=t[n],gt.test(s)){if(delete t[n],r=r||"toggle"===s,s===(g?"hide":"show")){if("show"!==s||!v||void 0===v[n])continue;g=!0}p[n]=v&&v[n]||fe.style(e,n)}if(l=!fe.isEmptyObject(t),l||!fe.isEmptyObject(p)){u&&1===e.nodeType&&(i.overflow=[f.overflow,f.overflowX,f.overflowY],c=v&&v.display,null==c&&(c=Re.get(e,"display")),d=fe.css(e,"display"),"none"===d&&(c?d=c:(m([e],!0),c=e.style.display||c,d=fe.css(e,"display"),m([e]))),("inline"===d||"inline-block"===d&&null!=c)&&"none"===fe.css(e,"float")&&(l||(h.done(function(){f.display=c}),null==c&&(d=f.display,c="none"===d?"":d)),f.display="inline-block")),i.overflow&&(f.overflow="hidden",h.always(function(){f.overflow=i.overflow[0],f.overflowX=i.overflow[1],f.overflowY=i.overflow[2]})),l=!1;for(n in p)l||(v?"hidden"in v&&(g=v.hidden):v=Re.access(e,"fxshow",{display:c}),r&&(v.hidden=!g),g&&m([e],!0),h.done(function(){g||m([e]),Re.remove(e,"fxshow");for(n in p)fe.style(e,n,p[n])})),l=H(g?v[n]:0,n,h),n in v||(v[n]=l.start,g&&(l.end=l.start,l.start=0))}}function V(e,t){var i,n,s,r,o;for(i in e)if(n=fe.camelCase(i),s=t[n],r=e[i],fe.isArray(r)&&(s=r[1],r=e[i]=r[0]),i!==n&&(e[n]=r,delete e[i]),o=fe.cssHooks[n],o&&"expand"in o){r=o.expand(r),delete e[n];for(i in r)i in e||(e[i]=r[i],t[i]=s)}else t[n]=s}function U(e,t,i){var n,s,r=0,o=U.prefilters.length,a=fe.Deferred().always(function(){delete l.elem}),l=function(){if(s)return!1;for(var t=pt||N(),i=Math.max(0,c.startTime+c.duration-t),n=i/c.duration||0,r=1-n,o=0,l=c.tweens.length;o<l;o++)c.tweens[o].run(r);return a.notifyWith(e,[c,r,i]),r<1&&l?i:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:fe.extend({},t),opts:fe.extend(!0,{specialEasing:{},easing:fe.easing._default},i),originalProperties:t,originalOptions:i,startTime:pt||N(),duration:i.duration,tweens:[],createTween:function(t,i){var n=fe.Tween(e,c.opts,t,i,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(n),n},stop:function(t){var i=0,n=t?c.tweens.length:0;if(s)return this;for(s=!0;i<n;i++)c.tweens[i].run(1);return t?(a.notifyWith(e,[c,1,0]),a.resolveWith(e,[c,t])):a.rejectWith(e,[c,t]),this}}),d=c.props;for(V(d,c.opts.specialEasing);r<o;r++)if(n=U.prefilters[r].call(c,e,d,c.opts))return fe.isFunction(n.stop)&&(fe._queueHooks(c.elem,c.opts.queue).stop=fe.proxy(n.stop,n)),n;return fe.map(d,H,c),fe.isFunction(c.opts.start)&&c.opts.start.call(e,c),fe.fx.timer(fe.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function q(e){var t=e.match(ze)||[];return t.join(" ")}function W(e){return e.getAttribute&&e.getAttribute("class")||""}function Y(e,t,i,n){var s;if(fe.isArray(t))fe.each(t,function(t,s){i||St.test(e)?n(e,s):Y(e+"["+("object"==typeof s&&null!=s?t:"")+"]",s,i,n)});else if(i||"object"!==fe.type(t))n(e,t);else for(s in t)Y(e+"["+s+"]",t[s],i,n)}function G(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,s=0,r=t.toLowerCase().match(ze)||[];if(fe.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function X(e,t,i,n){function s(a){var l;return r[a]=!0,fe.each(e[a]||[],function(e,a){var c=a(t,i,n);return"string"!=typeof c||o||r[c]?o?!(l=c):void 0:(t.dataTypes.unshift(c),s(c),!1)}),l}var r={},o=e===Mt;return s(t.dataTypes[0])||!r["*"]&&s("*")}function K(e,t){var i,n,s=fe.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((s[i]?e:n||(n={}))[i]=t[i]);return n&&fe.extend(!0,e,n),e}function J(e,t,i){for(var n,s,r,o,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(s in a)if(a[s]&&a[s].test(n)){l.unshift(s);break}if(l[0]in i)r=l[0];else{for(s in i){if(!l[0]||e.converters[s+" "+l[0]]){r=s;break}o||(o=s)}r=r||o}if(r)return r!==l[0]&&l.unshift(r),i[r]}function Q(e,t,i,n){var s,r,o,a,l,c={},d=e.dataTypes.slice();if(d[1])for(o in e.converters)c[o.toLowerCase()]=e.converters[o];for(r=d.shift();r;)if(e.responseFields[r]&&(i[e.responseFields[r]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=d.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(o=c[l+" "+r]||c["* "+r],!o)for(s in c)if(a=s.split(" "),a[1]===r&&(o=c[l+" "+a[0]]||c["* "+a[0]])){o===!0?o=c[s]:c[s]!==!0&&(r=a[0],d.unshift(a[1]));break}if(o!==!0)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}function Z(e){return fe.isWindow(e)?e:9===e.nodeType&&e.defaultView}var ee=[],te=e.document,ie=Object.getPrototypeOf,ne=ee.slice,se=ee.concat,re=ee.push,oe=ee.indexOf,ae={},le=ae.toString,ce=ae.hasOwnProperty,de=ce.toString,ue=de.call(Object),he={},pe="3.1.1",fe=function(e,t){return new fe.fn.init(e,t)},ge=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,me=/^-ms-/,ve=/-([a-z])/g,we=function(e,t){return t.toUpperCase()};fe.fn=fe.prototype={jquery:pe,constructor:fe,length:0,toArray:function(){return ne.call(this)},get:function(e){return null==e?ne.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=fe.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return fe.each(this,e)},map:function(e){return this.pushStack(fe.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(ne.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:re,sort:ee.sort,splice:ee.splice},fe.extend=fe.fn.extend=function(){var e,t,i,n,s,r,o=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof o&&(c=o,o=arguments[a]||{},a++),"object"==typeof o||fe.isFunction(o)||(o={}),a===l&&(o=this,a--);a<l;a++)if(null!=(e=arguments[a]))for(t in e)i=o[t],n=e[t],o!==n&&(c&&n&&(fe.isPlainObject(n)||(s=fe.isArray(n)))?(s?(s=!1,r=i&&fe.isArray(i)?i:[]):r=i&&fe.isPlainObject(i)?i:{},o[t]=fe.extend(c,r,n)):void 0!==n&&(o[t]=n));return o},fe.extend({expando:"jQuery"+(pe+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===fe.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=fe.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==le.call(e))&&(!(t=ie(e))||(i=ce.call(t,"constructor")&&t.constructor,"function"==typeof i&&de.call(i)===ue))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ae[le.call(e)]||"object":typeof e},globalEval:function(e){i(e)},camelCase:function(e){return e.replace(me,"ms-").replace(ve,we)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var i,s=0;if(n(e))for(i=e.length;s<i&&t.call(e[s],s,e[s])!==!1;s++);else for(s in e)if(t.call(e[s],s,e[s])===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ge,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?fe.merge(i,"string"==typeof e?[e]:e):re.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:oe.call(t,e,i)},merge:function(e,t){for(var i=+t.length,n=0,s=e.length;n<i;n++)e[s++]=t[n];return e.length=s,e},grep:function(e,t,i){for(var n,s=[],r=0,o=e.length,a=!i;r<o;r++)n=!t(e[r],r),n!==a&&s.push(e[r]);return s},map:function(e,t,i){var s,r,o=0,a=[];if(n(e))for(s=e.length;o<s;o++)r=t(e[o],o,i),null!=r&&a.push(r);else for(o in e)r=t(e[o],o,i),null!=r&&a.push(r);return se.apply([],a)},guid:1,proxy:function(e,t){var i,n,s;if("string"==typeof t&&(i=e[t],t=e,e=i),fe.isFunction(e))return n=ne.call(arguments,2),s=function(){return e.apply(t||this,n.concat(ne.call(arguments)))},s.guid=e.guid=e.guid||fe.guid++,s},now:Date.now,support:he}),"function"==typeof Symbol&&(fe.fn[Symbol.iterator]=ee[Symbol.iterator]),fe.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ae["[object "+t+"]"]=t.toLowerCase()});var ye=function(e){function t(e,t,i,n){var s,r,o,a,l,c,d,h=t&&t.ownerDocument,f=t?t.nodeType:9;if(i=i||[],"string"!=typeof e||!e||1!==f&&9!==f&&11!==f)return i;if(!n&&((t?t.ownerDocument||t:H)!==I&&P(t),t=t||I,R)){if(11!==f&&(l=ve.exec(e)))if(s=l[1]){if(9===f){if(!(o=t.getElementById(s)))return i;if(o.id===s)return i.push(o),i}else if(h&&(o=h.getElementById(s))&&N(t,o)&&o.id===s)return i.push(o),i}else{if(l[2])return Q.apply(i,t.getElementsByTagName(e)),i;if((s=l[3])&&_.getElementsByClassName&&t.getElementsByClassName)return Q.apply(i,t.getElementsByClassName(s)),i}if(_.qsa&&!W[e+" "]&&(!A||!A.test(e))){if(1!==f)h=t,d=e;else if("object"!==t.nodeName.toLowerCase()){for((a=t.getAttribute("id"))?a=a.replace(xe,_e):t.setAttribute("id",a=L),c=S(e),r=c.length;r--;)c[r]="#"+a+" "+p(c[r]);d=c.join(","),h=we.test(e)&&u(t.parentNode)||t}if(d)try{return Q.apply(i,h.querySelectorAll(d)),i}catch(e){}finally{a===L&&t.removeAttribute("id")}}}return $(e.replace(ae,"$1"),t,i,n)}function i(){function e(i,n){return t.push(i+" ")>C.cacheLength&&delete e[t.shift()],e[i+" "]=n}var t=[];return e}function n(e){return e[L]=!0,e}function s(e){var t=I.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var i=e.split("|"),n=i.length;n--;)C.attrHandle[i[n]]=t}function o(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function a(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function l(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return function(t){return"form"in t?t.parentNode&&t.disabled===!1?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ke(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function d(e){return n(function(t){return t=+t,n(function(i,n){for(var s,r=e([],i.length,t),o=r.length;o--;)i[s=r[o]]&&(i[s]=!(n[s]=i[s]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function h(){}function p(e){for(var t=0,i=e.length,n="";t<i;t++)n+=e[t].value;return n}function f(e,t,i){var n=t.dir,s=t.next,r=s||n,o=i&&"parentNode"===r,a=V++;return t.first?function(t,i,s){for(;t=t[n];)if(1===t.nodeType||o)return e(t,i,s);return!1}:function(t,i,l){var c,d,u,h=[B,a];if(l){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,i,l))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(u=t[L]||(t[L]={}),d=u[t.uniqueID]||(u[t.uniqueID]={}),s&&s===t.nodeName.toLowerCase())t=t[n]||t;else{if((c=d[r])&&c[0]===B&&c[1]===a)return h[2]=c[2];if(d[r]=h,h[2]=e(t,i,l))return!0}return!1}}function g(e){return e.length>1?function(t,i,n){for(var s=e.length;s--;)if(!e[s](t,i,n))return!1;return!0}:e[0]}function m(e,i,n){for(var s=0,r=i.length;s<r;s++)t(e,i[s],n);return n}function v(e,t,i,n,s){for(var r,o=[],a=0,l=e.length,c=null!=t;a<l;a++)(r=e[a])&&(i&&!i(r,n,s)||(o.push(r),c&&t.push(a)));return o}function w(e,t,i,s,r,o){return s&&!s[L]&&(s=w(s)),r&&!r[L]&&(r=w(r,o)),n(function(n,o,a,l){var c,d,u,h=[],p=[],f=o.length,g=n||m(t||"*",a.nodeType?[a]:a,[]),w=!e||!n&&t?g:v(g,h,e,a,l),y=i?r||(n?e:f||s)?[]:o:w;if(i&&i(w,y,a,l),s)for(c=v(y,p),s(c,[],a,l),d=c.length;d--;)(u=c[d])&&(y[p[d]]=!(w[p[d]]=u));if(n){if(r||e){if(r){for(c=[],d=y.length;d--;)(u=y[d])&&c.push(w[d]=u);r(null,y=[],c,l)}for(d=y.length;d--;)(u=y[d])&&(c=r?ee(n,u):h[d])>-1&&(n[c]=!(o[c]=u))}}else y=v(y===o?y.splice(f,y.length):y),r?r(null,o,y,l):Q.apply(o,y)})}function y(e){for(var t,i,n,s=e.length,r=C.relative[e[0].type],o=r||C.relative[" "],a=r?1:0,l=f(function(e){return e===t},o,!0),c=f(function(e){return ee(t,e)>-1},o,!0),d=[function(e,i,n){var s=!r&&(n||i!==j)||((t=i).nodeType?l(e,i,n):c(e,i,n));return t=null,s}];a<s;a++)if(i=C.relative[e[a].type])d=[f(g(d),i)];else{if(i=C.filter[e[a].type].apply(null,e[a].matches),i[L]){for(n=++a;n<s&&!C.relative[e[n].type];n++);return w(a>1&&g(d),a>1&&p(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(ae,"$1"),i,a<n&&y(e.slice(a,n)),n<s&&y(e=e.slice(n)),n<s&&p(e))}d.push(i)}return g(d)}function b(e,i){var s=i.length>0,r=e.length>0,o=function(n,o,a,l,c){var d,u,h,p=0,f="0",g=n&&[],m=[],w=j,y=n||r&&C.find.TAG("*",c),b=B+=null==w?1:Math.random()||.1,x=y.length;for(c&&(j=o===I||o||c);f!==x&&null!=(d=y[f]);f++){if(r&&d){for(u=0,o||d.ownerDocument===I||(P(d),a=!R);h=e[u++];)if(h(d,o||I,a)){l.push(d);break}c&&(B=b)}s&&((d=!h&&d)&&p--,n&&g.push(d))}if(p+=f,s&&f!==p){for(u=0;h=i[u++];)h(g,m,o,a);if(n){if(p>0)for(;f--;)g[f]||m[f]||(m[f]=K.call(l));m=v(m)}Q.apply(l,m),c&&!n&&m.length>0&&p+i.length>1&&t.uniqueSort(l)}return c&&(B=b,j=w),g};return s?n(o):o}var x,_,C,k,T,S,E,$,j,z,D,P,I,O,R,A,F,M,N,L="sizzle"+1*new Date,H=e.document,B=0,V=0,U=i(),q=i(),W=i(),Y=function(e,t){return e===t&&(D=!0),0},G={}.hasOwnProperty,X=[],K=X.pop,J=X.push,Q=X.push,Z=X.slice,ee=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ne="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",se="\\["+ie+"*("+ne+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ne+"))|)"+ie+"*\\]",re=":("+ne+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+se+")*)|.*)\\)|)",oe=new RegExp(ie+"+","g"),ae=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),le=new RegExp("^"+ie+"*,"+ie+"*"),ce=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),de=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),ue=new RegExp(re),he=new RegExp("^"+ne+"$"),pe={ID:new RegExp("^#("+ne+")"),CLASS:new RegExp("^\\.("+ne+")"),TAG:new RegExp("^("+ne+"|[*])"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+re),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},fe=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,me=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,we=/[+~]/,ye=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),be=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},xe=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,_e=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},Ce=function(){P()},ke=f(function(e){return e.disabled===!0&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{Q.apply(X=Z.call(H.childNodes),H.childNodes),X[H.childNodes.length].nodeType}catch(e){Q={apply:X.length?function(e,t){J.apply(e,Z.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}_=t.support={},T=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},P=t.setDocument=function(e){var t,i,n=e?e.ownerDocument||e:H;return n!==I&&9===n.nodeType&&n.documentElement?(I=n,O=I.documentElement,R=!T(I),H!==I&&(i=I.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",Ce,!1):i.attachEvent&&i.attachEvent("onunload",Ce)),_.attributes=s(function(e){return e.className="i",!e.getAttribute("className")}),_.getElementsByTagName=s(function(e){return e.appendChild(I.createComment("")),!e.getElementsByTagName("*").length}),_.getElementsByClassName=me.test(I.getElementsByClassName),_.getById=s(function(e){return O.appendChild(e).id=L,!I.getElementsByName||!I.getElementsByName(L).length}),_.getById?(C.filter.ID=function(e){var t=e.replace(ye,be);return function(e){return e.getAttribute("id")===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&R){var i=t.getElementById(e);return i?[i]:[]}}):(C.filter.ID=function(e){var t=e.replace(ye,be);return function(e){var i="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},C.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&R){var i,n,s,r=t.getElementById(e);if(r){if(i=r.getAttributeNode("id"),i&&i.value===e)return[r];for(s=t.getElementsByName(e),n=0;r=s[n++];)if(i=r.getAttributeNode("id"),i&&i.value===e)return[r]}return[]}}),C.find.TAG=_.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):_.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,n=[],s=0,r=t.getElementsByTagName(e);if("*"===e){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},C.find.CLASS=_.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&R)return t.getElementsByClassName(e)},F=[],A=[],(_.qsa=me.test(I.querySelectorAll))&&(s(function(e){O.appendChild(e).innerHTML="<a id='"+L+"'></a><select id='"+L+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&A.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||A.push("\\["+ie+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+L+"-]").length||A.push("~="),e.querySelectorAll(":checked").length||A.push(":checked"),e.querySelectorAll("a#"+L+"+*").length||A.push(".#.+[+~]")}),s(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=I.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&A.push("name"+ie+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&A.push(":enabled",":disabled"),O.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&A.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),A.push(",.*:")})),(_.matchesSelector=me.test(M=O.matches||O.webkitMatchesSelector||O.mozMatchesSelector||O.oMatchesSelector||O.msMatchesSelector))&&s(function(e){_.disconnectedMatch=M.call(e,"*"),M.call(e,"[s!='']:x"),F.push("!=",re)}),A=A.length&&new RegExp(A.join("|")),F=F.length&&new RegExp(F.join("|")),t=me.test(O.compareDocumentPosition),N=t||me.test(O.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},Y=t?function(e,t){if(e===t)return D=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!_.sortDetached&&t.compareDocumentPosition(e)===i?e===I||e.ownerDocument===H&&N(H,e)?-1:t===I||t.ownerDocument===H&&N(H,t)?1:z?ee(z,e)-ee(z,t):0:4&i?-1:1)}:function(e,t){if(e===t)return D=!0,0;var i,n=0,s=e.parentNode,r=t.parentNode,a=[e],l=[t];if(!s||!r)return e===I?-1:t===I?1:s?-1:r?1:z?ee(z,e)-ee(z,t):0;if(s===r)return o(e,t);for(i=e;i=i.parentNode;)a.unshift(i);for(i=t;i=i.parentNode;)l.unshift(i);for(;a[n]===l[n];)n++;return n?o(a[n],l[n]):a[n]===H?-1:l[n]===H?1:0},I):I},t.matches=function(e,i){return t(e,null,null,i)},t.matchesSelector=function(e,i){if((e.ownerDocument||e)!==I&&P(e),i=i.replace(de,"='$1']"),_.matchesSelector&&R&&!W[i+" "]&&(!F||!F.test(i))&&(!A||!A.test(i)))try{var n=M.call(e,i);if(n||_.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){}return t(i,I,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==I&&P(e),N(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==I&&P(e);var i=C.attrHandle[t.toLowerCase()],n=i&&G.call(C.attrHandle,t.toLowerCase())?i(e,t,!R):void 0;return void 0!==n?n:_.attributes||!R?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},t.escape=function(e){return(e+"").replace(xe,_e)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,i=[],n=0,s=0;if(D=!_.detectDuplicates,z=!_.sortStable&&e.slice(0),e.sort(Y),D){for(;t=e[s++];)t===e[s]&&(n=i.push(s));for(;n--;)e.splice(i[n],1)}return z=null,e},k=t.getText=function(e){var t,i="",n=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=k(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[n++];)i+=k(t);return i},C=t.selectors={cacheLength:50,createPseudo:n,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ye,be),e[3]=(e[3]||e[4]||e[5]||"").replace(ye,be),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return pe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&ue.test(i)&&(t=S(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ye,be).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=U[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&U(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,i,n){return function(s){var r=t.attr(s,e);return null==r?"!="===i:!i||(r+="","="===i?r===n:"!="===i?r!==n:"^="===i?n&&0===r.indexOf(n):"*="===i?n&&r.indexOf(n)>-1:"$="===i?n&&r.slice(-n.length)===n:"~="===i?(" "+r.replace(oe," ")+" ").indexOf(n)>-1:"|="===i&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,i,n,s){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===s?function(e){return!!e.parentNode}:function(t,i,l){var c,d,u,h,p,f,g=r!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),w=!l&&!a,y=!1;if(m){if(r){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&w){for(h=m,u=h[L]||(h[L]={}),d=u[h.uniqueID]||(u[h.uniqueID]={}),c=d[e]||[],p=c[0]===B&&c[1],y=p&&c[2],h=p&&m.childNodes[p];h=++p&&h&&h[g]||(y=p=0)||f.pop();)if(1===h.nodeType&&++y&&h===t){d[e]=[B,p,y];break}}else if(w&&(h=t,u=h[L]||(h[L]={}),d=u[h.uniqueID]||(u[h.uniqueID]={}),c=d[e]||[],p=c[0]===B&&c[1],y=p),y===!1)for(;(h=++p&&h&&h[g]||(y=p=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++y||(w&&(u=h[L]||(h[L]={}),d=u[h.uniqueID]||(u[h.uniqueID]={}),d[e]=[B,y]),h!==t)););return y-=s,y===n||y%n===0&&y/n>=0}}},PSEUDO:function(e,i){var s,r=C.pseudos[e]||C.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[L]?r(i):r.length>1?(s=[e,e,"",i],C.setFilters.hasOwnProperty(e.toLowerCase())?n(function(e,t){for(var n,s=r(e,i),o=s.length;o--;)n=ee(e,s[o]),e[n]=!(t[n]=s[o])}):function(e){return r(e,0,s)}):r}},pseudos:{not:n(function(e){var t=[],i=[],s=E(e.replace(ae,"$1"));return s[L]?n(function(e,t,i,n){for(var r,o=s(e,null,n,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))}):function(e,n,r){return t[0]=e,s(t,null,r,i),t[0]=null,!i.pop()}}),has:n(function(e){return function(i){return t(e,i).length>0}}),contains:n(function(e){return e=e.replace(ye,be),function(t){return(t.textContent||t.innerText||k(t)).indexOf(e)>-1}}),lang:n(function(e){return he.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ye,be).toLowerCase(),function(t){var i;
do if(i=R?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===O},focus:function(e){return e===I.activeElement&&(!I.hasFocus||I.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:c(!1),disabled:c(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!C.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return fe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:d(function(){return[0]}),last:d(function(e,t){return[t-1]}),eq:d(function(e,t,i){return[i<0?i+t:i]}),even:d(function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e}),odd:d(function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e}),lt:d(function(e,t,i){for(var n=i<0?i+t:i;--n>=0;)e.push(n);return e}),gt:d(function(e,t,i){for(var n=i<0?i+t:i;++n<t;)e.push(n);return e})}},C.pseudos.nth=C.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[x]=a(x);for(x in{submit:!0,reset:!0})C.pseudos[x]=l(x);return h.prototype=C.filters=C.pseudos,C.setFilters=new h,S=t.tokenize=function(e,i){var n,s,r,o,a,l,c,d=q[e+" "];if(d)return i?0:d.slice(0);for(a=e,l=[],c=C.preFilter;a;){n&&!(s=le.exec(a))||(s&&(a=a.slice(s[0].length)||a),l.push(r=[])),n=!1,(s=ce.exec(a))&&(n=s.shift(),r.push({value:n,type:s[0].replace(ae," ")}),a=a.slice(n.length));for(o in C.filter)!(s=pe[o].exec(a))||c[o]&&!(s=c[o](s))||(n=s.shift(),r.push({value:n,type:o,matches:s}),a=a.slice(n.length));if(!n)break}return i?a.length:a?t.error(e):q(e,l).slice(0)},E=t.compile=function(e,t){var i,n=[],s=[],r=W[e+" "];if(!r){for(t||(t=S(e)),i=t.length;i--;)r=y(t[i]),r[L]?n.push(r):s.push(r);r=W(e,b(s,n)),r.selector=e}return r},$=t.select=function(e,t,i,n){var s,r,o,a,l,c="function"==typeof e&&e,d=!n&&S(e=c.selector||e);if(i=i||[],1===d.length){if(r=d[0]=d[0].slice(0),r.length>2&&"ID"===(o=r[0]).type&&9===t.nodeType&&R&&C.relative[r[1].type]){if(t=(C.find.ID(o.matches[0].replace(ye,be),t)||[])[0],!t)return i;c&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(s=pe.needsContext.test(e)?0:r.length;s--&&(o=r[s],!C.relative[a=o.type]);)if((l=C.find[a])&&(n=l(o.matches[0].replace(ye,be),we.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(s,1),e=n.length&&p(r),!e)return Q.apply(i,n),i;break}}return(c||E(e,d))(n,t,!R,i,!t||we.test(e)&&u(t.parentNode)||t),i},_.sortStable=L.split("").sort(Y).join("")===L,_.detectDuplicates=!!D,P(),_.sortDetached=s(function(e){return 1&e.compareDocumentPosition(I.createElement("fieldset"))}),s(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),_.attributes&&s(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),s(function(e){return null==e.getAttribute("disabled")})||r(te,function(e,t,i){var n;if(!i)return e[t]===!0?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}),t}(e);fe.find=ye,fe.expr=ye.selectors,fe.expr[":"]=fe.expr.pseudos,fe.uniqueSort=fe.unique=ye.uniqueSort,fe.text=ye.getText,fe.isXMLDoc=ye.isXML,fe.contains=ye.contains,fe.escapeSelector=ye.escape;var be=function(e,t,i){for(var n=[],s=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(s&&fe(e).is(i))break;n.push(e)}return n},xe=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},_e=fe.expr.match.needsContext,Ce=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,ke=/^.[^:#\[\.,]*$/;fe.filter=function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?fe.find.matchesSelector(n,e)?[n]:[]:fe.find.matches(e,fe.grep(t,function(e){return 1===e.nodeType}))},fe.fn.extend({find:function(e){var t,i,n=this.length,s=this;if("string"!=typeof e)return this.pushStack(fe(e).filter(function(){for(t=0;t<n;t++)if(fe.contains(s[t],this))return!0}));for(i=this.pushStack([]),t=0;t<n;t++)fe.find(e,s[t],i);return n>1?fe.uniqueSort(i):i},filter:function(e){return this.pushStack(s(this,e||[],!1))},not:function(e){return this.pushStack(s(this,e||[],!0))},is:function(e){return!!s(this,"string"==typeof e&&_e.test(e)?fe(e):e||[],!1).length}});var Te,Se=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Ee=fe.fn.init=function(e,t,i){var n,s;if(!e)return this;if(i=i||Te,"string"==typeof e){if(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Se.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof fe?t[0]:t,fe.merge(this,fe.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:te,!0)),Ce.test(n[1])&&fe.isPlainObject(t))for(n in t)fe.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return s=te.getElementById(n[2]),s&&(this[0]=s,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):fe.isFunction(e)?void 0!==i.ready?i.ready(e):e(fe):fe.makeArray(e,this)};Ee.prototype=fe.fn,Te=fe(te);var $e=/^(?:parents|prev(?:Until|All))/,je={children:!0,contents:!0,next:!0,prev:!0};fe.fn.extend({has:function(e){var t=fe(e,this),i=t.length;return this.filter(function(){for(var e=0;e<i;e++)if(fe.contains(this,t[e]))return!0})},closest:function(e,t){var i,n=0,s=this.length,r=[],o="string"!=typeof e&&fe(e);if(!_e.test(e))for(;n<s;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&fe.find.matchesSelector(i,e))){r.push(i);break}return this.pushStack(r.length>1?fe.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?oe.call(fe(e),this[0]):oe.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(fe.uniqueSort(fe.merge(this.get(),fe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),fe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return be(e,"parentNode")},parentsUntil:function(e,t,i){return be(e,"parentNode",i)},next:function(e){return r(e,"nextSibling")},prev:function(e){return r(e,"previousSibling")},nextAll:function(e){return be(e,"nextSibling")},prevAll:function(e){return be(e,"previousSibling")},nextUntil:function(e,t,i){return be(e,"nextSibling",i)},prevUntil:function(e,t,i){return be(e,"previousSibling",i)},siblings:function(e){return xe((e.parentNode||{}).firstChild,e)},children:function(e){return xe(e.firstChild)},contents:function(e){return e.contentDocument||fe.merge([],e.childNodes)}},function(e,t){fe.fn[e]=function(i,n){var s=fe.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=fe.filter(n,s)),this.length>1&&(je[e]||fe.uniqueSort(s),$e.test(e)&&s.reverse()),this.pushStack(s)}});var ze=/[^\x20\t\r\n\f]+/g;fe.Callbacks=function(e){e="string"==typeof e?o(e):fe.extend({},e);var t,i,n,s,r=[],a=[],l=-1,c=function(){for(s=e.once,n=t=!0;a.length;l=-1)for(i=a.shift();++l<r.length;)r[l].apply(i[0],i[1])===!1&&e.stopOnFalse&&(l=r.length,i=!1);e.memory||(i=!1),t=!1,s&&(r=i?[]:"")},d={add:function(){return r&&(i&&!t&&(l=r.length-1,a.push(i)),function t(i){fe.each(i,function(i,n){fe.isFunction(n)?e.unique&&d.has(n)||r.push(n):n&&n.length&&"string"!==fe.type(n)&&t(n)})}(arguments),i&&!t&&c()),this},remove:function(){return fe.each(arguments,function(e,t){for(var i;(i=fe.inArray(t,r,i))>-1;)r.splice(i,1),i<=l&&l--}),this},has:function(e){return e?fe.inArray(e,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return s=a=[],r=i="",this},disabled:function(){return!r},lock:function(){return s=a=[],i||t||(r=i=""),this},locked:function(){return!!s},fireWith:function(e,i){return s||(i=i||[],i=[e,i.slice?i.slice():i],a.push(i),t||c()),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!n}};return d},fe.extend({Deferred:function(t){var i=[["notify","progress",fe.Callbacks("memory"),fe.Callbacks("memory"),2],["resolve","done",fe.Callbacks("once memory"),fe.Callbacks("once memory"),0,"resolved"],["reject","fail",fe.Callbacks("once memory"),fe.Callbacks("once memory"),1,"rejected"]],n="pending",s={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return s.then(null,e)},pipe:function(){var e=arguments;return fe.Deferred(function(t){fe.each(i,function(i,n){var s=fe.isFunction(e[n[4]])&&e[n[4]];r[n[1]](function(){var e=s&&s.apply(this,arguments);e&&fe.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[n[0]+"With"](this,s?[e]:arguments)})}),e=null}).promise()},then:function(t,n,s){function r(t,i,n,s){return function(){var c=this,d=arguments,u=function(){var e,u;if(!(t<o)){if(e=n.apply(c,d),e===i.promise())throw new TypeError("Thenable self-resolution");u=e&&("object"==typeof e||"function"==typeof e)&&e.then,fe.isFunction(u)?s?u.call(e,r(o,i,a,s),r(o,i,l,s)):(o++,u.call(e,r(o,i,a,s),r(o,i,l,s),r(o,i,a,i.notifyWith))):(n!==a&&(c=void 0,d=[e]),(s||i.resolveWith)(c,d))}},h=s?u:function(){try{u()}catch(e){fe.Deferred.exceptionHook&&fe.Deferred.exceptionHook(e,h.stackTrace),t+1>=o&&(n!==l&&(c=void 0,d=[e]),i.rejectWith(c,d))}};t?h():(fe.Deferred.getStackHook&&(h.stackTrace=fe.Deferred.getStackHook()),e.setTimeout(h))}}var o=0;return fe.Deferred(function(e){i[0][3].add(r(0,e,fe.isFunction(s)?s:a,e.notifyWith)),i[1][3].add(r(0,e,fe.isFunction(t)?t:a)),i[2][3].add(r(0,e,fe.isFunction(n)?n:l))}).promise()},promise:function(e){return null!=e?fe.extend(e,s):s}},r={};return fe.each(i,function(e,t){var o=t[2],a=t[5];s[t[1]]=o.add,a&&o.add(function(){n=a},i[3-e][2].disable,i[0][2].lock),o.add(t[3].fire),r[t[0]]=function(){return r[t[0]+"With"](this===r?void 0:this,arguments),this},r[t[0]+"With"]=o.fireWith}),s.promise(r),t&&t.call(r,r),r},when:function(e){var t=arguments.length,i=t,n=Array(i),s=ne.call(arguments),r=fe.Deferred(),o=function(e){return function(i){n[e]=this,s[e]=arguments.length>1?ne.call(arguments):i,--t||r.resolveWith(n,s)}};if(t<=1&&(c(e,r.done(o(i)).resolve,r.reject),"pending"===r.state()||fe.isFunction(s[i]&&s[i].then)))return r.then();for(;i--;)c(s[i],o(i),r.reject);return r.promise()}});var De=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;fe.Deferred.exceptionHook=function(t,i){e.console&&e.console.warn&&t&&De.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,i)},fe.readyException=function(t){e.setTimeout(function(){throw t})};var Pe=fe.Deferred();fe.fn.ready=function(e){return Pe.then(e).catch(function(e){fe.readyException(e)}),this},fe.extend({isReady:!1,readyWait:1,holdReady:function(e){e?fe.readyWait++:fe.ready(!0)},ready:function(e){(e===!0?--fe.readyWait:fe.isReady)||(fe.isReady=!0,e!==!0&&--fe.readyWait>0||Pe.resolveWith(te,[fe]))}}),fe.ready.then=Pe.then,"complete"===te.readyState||"loading"!==te.readyState&&!te.documentElement.doScroll?e.setTimeout(fe.ready):(te.addEventListener("DOMContentLoaded",d),e.addEventListener("load",d));var Ie=function(e,t,i,n,s,r,o){var a=0,l=e.length,c=null==i;if("object"===fe.type(i)){s=!0;for(a in i)Ie(e,t,a,i[a],!0,r,o)}else if(void 0!==n&&(s=!0,fe.isFunction(n)||(o=!0),c&&(o?(t.call(e,n),t=null):(c=t,t=function(e,t,i){return c.call(fe(e),i)})),t))for(;a<l;a++)t(e[a],i,o?n:n.call(e[a],a,t(e[a],i)));return s?e:c?t.call(e):l?t(e[0],i):r},Oe=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};u.uid=1,u.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Oe(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var n,s=this.cache(e);if("string"==typeof t)s[fe.camelCase(t)]=i;else for(n in t)s[fe.camelCase(n)]=t[n];return s},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][fe.camelCase(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,n=e[this.expando];if(void 0!==n){if(void 0!==t){fe.isArray(t)?t=t.map(fe.camelCase):(t=fe.camelCase(t),t=t in n?[t]:t.match(ze)||[]),i=t.length;for(;i--;)delete n[t[i]]}(void 0===t||fe.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!fe.isEmptyObject(t)}};var Re=new u,Ae=new u,Fe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Me=/[A-Z]/g;fe.extend({hasData:function(e){return Ae.hasData(e)||Re.hasData(e)},data:function(e,t,i){return Ae.access(e,t,i)},removeData:function(e,t){Ae.remove(e,t)},_data:function(e,t,i){return Re.access(e,t,i)},_removeData:function(e,t){Re.remove(e,t)}}),fe.fn.extend({data:function(e,t){var i,n,s,r=this[0],o=r&&r.attributes;if(void 0===e){if(this.length&&(s=Ae.get(r),1===r.nodeType&&!Re.get(r,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(n=o[i].name,0===n.indexOf("data-")&&(n=fe.camelCase(n.slice(5)),p(r,n,s[n])));Re.set(r,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){Ae.set(this,e)}):Ie(this,function(t){var i;if(r&&void 0===t){if(i=Ae.get(r,e),void 0!==i)return i;if(i=p(r,e),void 0!==i)return i}else this.each(function(){Ae.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Ae.remove(this,e)})}}),fe.extend({queue:function(e,t,i){var n;if(e)return t=(t||"fx")+"queue",n=Re.get(e,t),i&&(!n||fe.isArray(i)?n=Re.access(e,t,fe.makeArray(i)):n.push(i)),n||[]},dequeue:function(e,t){t=t||"fx";var i=fe.queue(e,t),n=i.length,s=i.shift(),r=fe._queueHooks(e,t),o=function(){fe.dequeue(e,t)};"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===t&&i.unshift("inprogress"),delete r.stop,s.call(e,o,r)),!n&&r&&r.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return Re.get(e,i)||Re.access(e,i,{empty:fe.Callbacks("once memory").add(function(){Re.remove(e,[t+"queue",i])})})}}),fe.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?fe.queue(this[0],e):void 0===t?this:this.each(function(){var i=fe.queue(this,e,t);fe._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&fe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){fe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,n=1,s=fe.Deferred(),r=this,o=this.length,a=function(){--n||s.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)i=Re.get(r[o],e+"queueHooks"),i&&i.empty&&(n++,i.empty.add(a));return a(),s.promise(t)}});var Ne=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Le=new RegExp("^(?:([+-])=|)("+Ne+")([a-z%]*)$","i"),He=["Top","Right","Bottom","Left"],Be=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&fe.contains(e.ownerDocument,e)&&"none"===fe.css(e,"display")},Ve=function(e,t,i,n){var s,r,o={};for(r in t)o[r]=e.style[r],e.style[r]=t[r];s=i.apply(e,n||[]);for(r in t)e.style[r]=o[r];return s},Ue={};fe.fn.extend({show:function(){return m(this,!0)},hide:function(){return m(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Be(this)?fe(this).show():fe(this).hide()})}});var qe=/^(?:checkbox|radio)$/i,We=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Ye=/^$|\/(?:java|ecma)script/i,Ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ge.optgroup=Ge.option,Ge.tbody=Ge.tfoot=Ge.colgroup=Ge.caption=Ge.thead,Ge.th=Ge.td;var Xe=/<|&#?\w+;/;!function(){var e=te.createDocumentFragment(),t=e.appendChild(te.createElement("div")),i=te.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),t.appendChild(i),he.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",he.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Ke=te.documentElement,Je=/^key/,Qe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ze=/^([^.]*)(?:\.(.+)|)/;fe.event={global:{},add:function(e,t,i,n,s){var r,o,a,l,c,d,u,h,p,f,g,m=Re.get(e);if(m)for(i.handler&&(r=i,i=r.handler,s=r.selector),s&&fe.find.matchesSelector(Ke,s),i.guid||(i.guid=fe.guid++),(l=m.events)||(l=m.events={}),(o=m.handle)||(o=m.handle=function(t){return"undefined"!=typeof fe&&fe.event.triggered!==t.type?fe.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(ze)||[""],c=t.length;c--;)a=Ze.exec(t[c])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p&&(u=fe.event.special[p]||{},p=(s?u.delegateType:u.bindType)||p,u=fe.event.special[p]||{},d=fe.extend({type:p,origType:g,data:n,handler:i,guid:i.guid,selector:s,needsContext:s&&fe.expr.match.needsContext.test(s),namespace:f.join(".")},r),(h=l[p])||(h=l[p]=[],h.delegateCount=0,u.setup&&u.setup.call(e,n,f,o)!==!1||e.addEventListener&&e.addEventListener(p,o)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=i.guid)),s?h.splice(h.delegateCount++,0,d):h.push(d),fe.event.global[p]=!0)},remove:function(e,t,i,n,s){var r,o,a,l,c,d,u,h,p,f,g,m=Re.hasData(e)&&Re.get(e);if(m&&(l=m.events)){for(t=(t||"").match(ze)||[""],c=t.length;c--;)if(a=Ze.exec(t[c])||[],p=g=a[1],f=(a[2]||"").split(".").sort(),p){for(u=fe.event.special[p]||{},p=(n?u.delegateType:u.bindType)||p,h=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=h.length;r--;)d=h[r],!s&&g!==d.origType||i&&i.guid!==d.guid||a&&!a.test(d.namespace)||n&&n!==d.selector&&("**"!==n||!d.selector)||(h.splice(r,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));o&&!h.length&&(u.teardown&&u.teardown.call(e,f,m.handle)!==!1||fe.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)fe.event.remove(e,p+t[c],i,n,!0);fe.isEmptyObject(l)&&Re.remove(e,"handle events")}},dispatch:function(e){var t,i,n,s,r,o,a=fe.event.fix(e),l=new Array(arguments.length),c=(Re.get(this,"events")||{})[a.type]||[],d=fe.event.special[a.type]||{};for(l[0]=a,t=1;t<arguments.length;t++)l[t]=arguments[t];if(a.delegateTarget=this,!d.preDispatch||d.preDispatch.call(this,a)!==!1){for(o=fe.event.handlers.call(this,a,c),t=0;(s=o[t++])&&!a.isPropagationStopped();)for(a.currentTarget=s.elem,i=0;(r=s.handlers[i++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(r.namespace)||(a.handleObj=r,a.data=r.data,n=((fe.event.special[r.origType]||{}).handle||r.handler).apply(s.elem,l),void 0!==n&&(a.result=n)===!1&&(a.preventDefault(),a.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,a),a.result}},handlers:function(e,t){var i,n,s,r,o,a=[],l=t.delegateCount,c=e.target;if(l&&c.nodeType&&!("click"===e.type&&e.button>=1))for(;c!==this;c=c.parentNode||this)if(1===c.nodeType&&("click"!==e.type||c.disabled!==!0)){for(r=[],o={},i=0;i<l;i++)n=t[i],s=n.selector+" ",void 0===o[s]&&(o[s]=n.needsContext?fe(s,this).index(c)>-1:fe.find(s,this,null,[c]).length),o[s]&&r.push(n);r.length&&a.push({elem:c,handlers:r})}return c=this,l<t.length&&a.push({elem:c,handlers:t.slice(l)}),a},addProp:function(e,t){Object.defineProperty(fe.Event.prototype,e,{enumerable:!0,configurable:!0,get:fe.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[fe.expando]?e:new fe.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==_()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===_()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&fe.nodeName(this,"input"))return this.click(),!1},_default:function(e){return fe.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},fe.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},fe.Event=function(e,t){return this instanceof fe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?b:x,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&fe.extend(this,t),this.timeStamp=e&&e.timeStamp||fe.now(),void(this[fe.expando]=!0)):new fe.Event(e,t)},fe.Event.prototype={constructor:fe.Event,isDefaultPrevented:x,isPropagationStopped:x,isImmediatePropagationStopped:x,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=b,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=b,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=b,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},fe.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Je.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Qe.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},fe.event.addProp),fe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){fe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,s=e.relatedTarget,r=e.handleObj;return s&&(s===n||fe.contains(n,s))||(e.type=r.origType,i=r.handler.apply(this,arguments),e.type=t),i}}}),fe.fn.extend({on:function(e,t,i,n){return C(this,e,t,i,n)},one:function(e,t,i,n){return C(this,e,t,i,n,1)},off:function(e,t,i){var n,s;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,fe(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return t!==!1&&"function"!=typeof t||(i=t,t=void 0),i===!1&&(i=x),this.each(function(){fe.event.remove(this,e,i,t)})}});var et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,tt=/<script|<style|<link/i,it=/checked\s*(?:[^=]|=\s*.checked.)/i,nt=/^true\/(.*)/,st=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;fe.extend({htmlPrefilter:function(e){return e.replace(et,"<$1></$2>")},clone:function(e,t,i){var n,s,r,o,a=e.cloneNode(!0),l=fe.contains(e.ownerDocument,e);if(!(he.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||fe.isXMLDoc(e)))for(o=v(a),r=v(e),n=0,s=r.length;n<s;n++)$(r[n],o[n]);if(t)if(i)for(r=r||v(e),o=o||v(a),n=0,s=r.length;n<s;n++)E(r[n],o[n]);else E(e,a);return o=v(a,"script"),o.length>0&&w(o,!l&&v(e,"script")),a},cleanData:function(e){for(var t,i,n,s=fe.event.special,r=0;void 0!==(i=e[r]);r++)if(Oe(i)){if(t=i[Re.expando]){if(t.events)for(n in t.events)s[n]?fe.event.remove(i,n):fe.removeEvent(i,n,t.handle);i[Re.expando]=void 0}i[Ae.expando]&&(i[Ae.expando]=void 0)}}}),fe.fn.extend({detach:function(e){return z(this,e,!0)},remove:function(e){return z(this,e)},text:function(e){return Ie(this,function(e){return void 0===e?fe.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return j(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=k(this,e);t.appendChild(e)}})},prepend:function(){return j(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=k(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return j(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return j(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(fe.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return fe.clone(this,e,t)})},html:function(e){return Ie(this,function(e){var t=this[0]||{},i=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!tt.test(e)&&!Ge[(We.exec(e)||["",""])[1].toLowerCase()]){e=fe.htmlPrefilter(e);try{for(;i<n;i++)t=this[i]||{},1===t.nodeType&&(fe.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return j(this,arguments,function(t){var i=this.parentNode;fe.inArray(this,e)<0&&(fe.cleanData(v(this)),i&&i.replaceChild(t,this))},e)}}),fe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){fe.fn[e]=function(e){for(var i,n=[],s=fe(e),r=s.length-1,o=0;o<=r;o++)i=o===r?this:this.clone(!0),fe(s[o])[t](i),re.apply(n,i.get());return this.pushStack(n)}});var rt=/^margin/,ot=new RegExp("^("+Ne+")(?!px)[a-z%]+$","i"),at=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)};!function(){function t(){if(a){a.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Ke.appendChild(o);var t=e.getComputedStyle(a);i="1%"!==t.top,r="2px"===t.marginLeft,n="4px"===t.width,a.style.marginRight="50%",s="4px"===t.marginRight,Ke.removeChild(o),a=null}}var i,n,s,r,o=te.createElement("div"),a=te.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",he.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(a),fe.extend(he,{pixelPosition:function(){return t(),i},boxSizingReliable:function(){return t(),n},pixelMarginRight:function(){return t(),s},reliableMarginLeft:function(){return t(),r}}))}();var lt=/^(none|table(?!-c[ea]).+)/,ct={position:"absolute",visibility:"hidden",display:"block"},dt={letterSpacing:"0",fontWeight:"400"},ut=["Webkit","Moz","ms"],ht=te.createElement("div").style;fe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=D(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,r,o,a=fe.camelCase(t),l=e.style;return t=fe.cssProps[a]||(fe.cssProps[a]=I(a)||a),o=fe.cssHooks[t]||fe.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(s=o.get(e,!1,n))?s:l[t]:(r=typeof i,"string"===r&&(s=Le.exec(i))&&s[1]&&(i=f(e,t,s),r="number"),null!=i&&i===i&&("number"===r&&(i+=s&&s[3]||(fe.cssNumber[a]?"":"px")),he.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),o&&"set"in o&&void 0===(i=o.set(e,i,n))||(l[t]=i)),void 0)}},css:function(e,t,i,n){var s,r,o,a=fe.camelCase(t);return t=fe.cssProps[a]||(fe.cssProps[a]=I(a)||a),o=fe.cssHooks[t]||fe.cssHooks[a],o&&"get"in o&&(s=o.get(e,!0,i)),void 0===s&&(s=D(e,t,n)),"normal"===s&&t in dt&&(s=dt[t]),""===i||i?(r=parseFloat(s),i===!0||isFinite(r)?r||0:s):s}}),fe.each(["height","width"],function(e,t){fe.cssHooks[t]={get:function(e,i,n){if(i)return!lt.test(fe.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?A(e,t,n):Ve(e,ct,function(){return A(e,t,n)})},set:function(e,i,n){var s,r=n&&at(e),o=n&&R(e,t,n,"border-box"===fe.css(e,"boxSizing",!1,r),r);return o&&(s=Le.exec(i))&&"px"!==(s[3]||"px")&&(e.style[t]=i,i=fe.css(e,t)),O(e,i,o)}}}),fe.cssHooks.marginLeft=P(he.reliableMarginLeft,function(e,t){if(t)return(parseFloat(D(e,"marginLeft"))||e.getBoundingClientRect().left-Ve(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),fe.each({margin:"",padding:"",border:"Width"},function(e,t){fe.cssHooks[e+t]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];n<4;n++)s[e+He[n]+t]=r[n]||r[n-2]||r[0];return s}},rt.test(e)||(fe.cssHooks[e+t].set=O)}),fe.fn.extend({css:function(e,t){return Ie(this,function(e,t,i){var n,s,r={},o=0;if(fe.isArray(t)){for(n=at(e),s=t.length;o<s;o++)r[t[o]]=fe.css(e,t[o],!1,n);return r}return void 0!==i?fe.style(e,t,i):fe.css(e,t)},e,t,arguments.length>1)}}),fe.Tween=F,F.prototype={constructor:F,init:function(e,t,i,n,s,r){this.elem=e,this.prop=i,this.easing=s||fe.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=r||(fe.cssNumber[i]?"":"px")},cur:function(){var e=F.propHooks[this.prop];return e&&e.get?e.get(this):F.propHooks._default.get(this)},run:function(e){var t,i=F.propHooks[this.prop];return this.options.duration?this.pos=t=fe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):F.propHooks._default.set(this),this}},F.prototype.init.prototype=F.prototype,F.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=fe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){fe.fx.step[e.prop]?fe.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[fe.cssProps[e.prop]]&&!fe.cssHooks[e.prop]?e.elem[e.prop]=e.now:fe.style(e.elem,e.prop,e.now+e.unit)}}},F.propHooks.scrollTop=F.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},fe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},fe.fx=F.prototype.init,fe.fx.step={};var pt,ft,gt=/^(?:toggle|show|hide)$/,mt=/queueHooks$/;fe.Animation=fe.extend(U,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return f(i.elem,e,Le.exec(t),i),i}]},tweener:function(e,t){fe.isFunction(e)?(t=e,e=["*"]):e=e.match(ze);for(var i,n=0,s=e.length;n<s;n++)i=e[n],U.tweeners[i]=U.tweeners[i]||[],U.tweeners[i].unshift(t)},prefilters:[B],prefilter:function(e,t){t?U.prefilters.unshift(e):U.prefilters.push(e)}}),fe.speed=function(e,t,i){var n=e&&"object"==typeof e?fe.extend({},e):{complete:i||!i&&t||fe.isFunction(e)&&e,duration:e,easing:i&&t||t&&!fe.isFunction(t)&&t};return fe.fx.off||te.hidden?n.duration=0:"number"!=typeof n.duration&&(n.duration in fe.fx.speeds?n.duration=fe.fx.speeds[n.duration]:n.duration=fe.fx.speeds._default),null!=n.queue&&n.queue!==!0||(n.queue="fx"),n.old=n.complete,n.complete=function(){fe.isFunction(n.old)&&n.old.call(this),n.queue&&fe.dequeue(this,n.queue)},n},fe.fn.extend({fadeTo:function(e,t,i,n){return this.filter(Be).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var s=fe.isEmptyObject(e),r=fe.speed(t,i,n),o=function(){var t=U(this,fe.extend({},e),r);(s||Re.get(this,"finish"))&&t.stop(!0)};return o.finish=o,s||r.queue===!1?this.each(o):this.queue(r.queue,o)},stop:function(e,t,i){var n=function(e){var t=e.stop;
delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",r=fe.timers,o=Re.get(this);if(s)o[s]&&o[s].stop&&n(o[s]);else for(s in o)o[s]&&o[s].stop&&mt.test(s)&&n(o[s]);for(s=r.length;s--;)r[s].elem!==this||null!=e&&r[s].queue!==e||(r[s].anim.stop(i),t=!1,r.splice(s,1));!t&&i||fe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=Re.get(this),n=i[e+"queue"],s=i[e+"queueHooks"],r=fe.timers,o=n?n.length:0;for(i.finish=!0,fe.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<o;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),fe.each(["toggle","show","hide"],function(e,t){var i=fe.fn[t];fe.fn[t]=function(e,n,s){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(L(t,!0),e,n,s)}}),fe.each({slideDown:L("show"),slideUp:L("hide"),slideToggle:L("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){fe.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),fe.timers=[],fe.fx.tick=function(){var e,t=0,i=fe.timers;for(pt=fe.now();t<i.length;t++)e=i[t],e()||i[t]!==e||i.splice(t--,1);i.length||fe.fx.stop(),pt=void 0},fe.fx.timer=function(e){fe.timers.push(e),e()?fe.fx.start():fe.timers.pop()},fe.fx.interval=13,fe.fx.start=function(){ft||(ft=e.requestAnimationFrame?e.requestAnimationFrame(M):e.setInterval(fe.fx.tick,fe.fx.interval))},fe.fx.stop=function(){e.cancelAnimationFrame?e.cancelAnimationFrame(ft):e.clearInterval(ft),ft=null},fe.fx.speeds={slow:600,fast:200,_default:400},fe.fn.delay=function(t,i){return t=fe.fx?fe.fx.speeds[t]||t:t,i=i||"fx",this.queue(i,function(i,n){var s=e.setTimeout(i,t);n.stop=function(){e.clearTimeout(s)}})},function(){var e=te.createElement("input"),t=te.createElement("select"),i=t.appendChild(te.createElement("option"));e.type="checkbox",he.checkOn=""!==e.value,he.optSelected=i.selected,e=te.createElement("input"),e.value="t",e.type="radio",he.radioValue="t"===e.value}();var vt,wt=fe.expr.attrHandle;fe.fn.extend({attr:function(e,t){return Ie(this,fe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){fe.removeAttr(this,e)})}}),fe.extend({attr:function(e,t,i){var n,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return"undefined"==typeof e.getAttribute?fe.prop(e,t,i):(1===r&&fe.isXMLDoc(e)||(s=fe.attrHooks[t.toLowerCase()]||(fe.expr.match.bool.test(t)?vt:void 0)),void 0!==i?null===i?void fe.removeAttr(e,t):s&&"set"in s&&void 0!==(n=s.set(e,i,t))?n:(e.setAttribute(t,i+""),i):s&&"get"in s&&null!==(n=s.get(e,t))?n:(n=fe.find.attr(e,t),null==n?void 0:n))},attrHooks:{type:{set:function(e,t){if(!he.radioValue&&"radio"===t&&fe.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,n=0,s=t&&t.match(ze);if(s&&1===e.nodeType)for(;i=s[n++];)e.removeAttribute(i)}}),vt={set:function(e,t,i){return t===!1?fe.removeAttr(e,i):e.setAttribute(i,i),i}},fe.each(fe.expr.match.bool.source.match(/\w+/g),function(e,t){var i=wt[t]||fe.find.attr;wt[t]=function(e,t,n){var s,r,o=t.toLowerCase();return n||(r=wt[o],wt[o]=s,s=null!=i(e,t,n)?o:null,wt[o]=r),s}});var yt=/^(?:input|select|textarea|button)$/i,bt=/^(?:a|area)$/i;fe.fn.extend({prop:function(e,t){return Ie(this,fe.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[fe.propFix[e]||e]})}}),fe.extend({prop:function(e,t,i){var n,s,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&fe.isXMLDoc(e)||(t=fe.propFix[t]||t,s=fe.propHooks[t]),void 0!==i?s&&"set"in s&&void 0!==(n=s.set(e,i,t))?n:e[t]=i:s&&"get"in s&&null!==(n=s.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=fe.find.attr(e,"tabindex");return t?parseInt(t,10):yt.test(e.nodeName)||bt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),he.optSelected||(fe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),fe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){fe.propFix[this.toLowerCase()]=this}),fe.fn.extend({addClass:function(e){var t,i,n,s,r,o,a,l=0;if(fe.isFunction(e))return this.each(function(t){fe(this).addClass(e.call(this,t,W(this)))});if("string"==typeof e&&e)for(t=e.match(ze)||[];i=this[l++];)if(s=W(i),n=1===i.nodeType&&" "+q(s)+" "){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");a=q(n),s!==a&&i.setAttribute("class",a)}return this},removeClass:function(e){var t,i,n,s,r,o,a,l=0;if(fe.isFunction(e))return this.each(function(t){fe(this).removeClass(e.call(this,t,W(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(ze)||[];i=this[l++];)if(s=W(i),n=1===i.nodeType&&" "+q(s)+" "){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");a=q(n),s!==a&&i.setAttribute("class",a)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):fe.isFunction(e)?this.each(function(i){fe(this).toggleClass(e.call(this,i,W(this),t),t)}):this.each(function(){var t,n,s,r;if("string"===i)for(n=0,s=fe(this),r=e.match(ze)||[];t=r[n++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else void 0!==e&&"boolean"!==i||(t=W(this),t&&Re.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||e===!1?"":Re.get(this,"__className__")||""))})},hasClass:function(e){var t,i,n=0;for(t=" "+e+" ";i=this[n++];)if(1===i.nodeType&&(" "+q(W(i))+" ").indexOf(t)>-1)return!0;return!1}});var xt=/\r/g;fe.fn.extend({val:function(e){var t,i,n,s=this[0];{if(arguments.length)return n=fe.isFunction(e),this.each(function(i){var s;1===this.nodeType&&(s=n?e.call(this,i,fe(this).val()):e,null==s?s="":"number"==typeof s?s+="":fe.isArray(s)&&(s=fe.map(s,function(e){return null==e?"":e+""})),t=fe.valHooks[this.type]||fe.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=fe.valHooks[s.type]||fe.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(i=t.get(s,"value"))?i:(i=s.value,"string"==typeof i?i.replace(xt,""):null==i?"":i)}}}),fe.extend({valHooks:{option:{get:function(e){var t=fe.find.attr(e,"value");return null!=t?t:q(fe.text(e))}},select:{get:function(e){var t,i,n,s=e.options,r=e.selectedIndex,o="select-one"===e.type,a=o?null:[],l=o?r+1:s.length;for(n=r<0?l:o?r:0;n<l;n++)if(i=s[n],(i.selected||n===r)&&!i.disabled&&(!i.parentNode.disabled||!fe.nodeName(i.parentNode,"optgroup"))){if(t=fe(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,n,s=e.options,r=fe.makeArray(t),o=s.length;o--;)n=s[o],(n.selected=fe.inArray(fe.valHooks.option.get(n),r)>-1)&&(i=!0);return i||(e.selectedIndex=-1),r}}}}),fe.each(["radio","checkbox"],function(){fe.valHooks[this]={set:function(e,t){if(fe.isArray(t))return e.checked=fe.inArray(fe(e).val(),t)>-1}},he.checkOn||(fe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var _t=/^(?:focusinfocus|focusoutblur)$/;fe.extend(fe.event,{trigger:function(t,i,n,s){var r,o,a,l,c,d,u,h=[n||te],p=ce.call(t,"type")?t.type:t,f=ce.call(t,"namespace")?t.namespace.split("."):[];if(o=a=n=n||te,3!==n.nodeType&&8!==n.nodeType&&!_t.test(p+fe.event.triggered)&&(p.indexOf(".")>-1&&(f=p.split("."),p=f.shift(),f.sort()),c=p.indexOf(":")<0&&"on"+p,t=t[fe.expando]?t:new fe.Event(p,"object"==typeof t&&t),t.isTrigger=s?2:3,t.namespace=f.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=n),i=null==i?[t]:fe.makeArray(i,[t]),u=fe.event.special[p]||{},s||!u.trigger||u.trigger.apply(n,i)!==!1)){if(!s&&!u.noBubble&&!fe.isWindow(n)){for(l=u.delegateType||p,_t.test(l+p)||(o=o.parentNode);o;o=o.parentNode)h.push(o),a=o;a===(n.ownerDocument||te)&&h.push(a.defaultView||a.parentWindow||e)}for(r=0;(o=h[r++])&&!t.isPropagationStopped();)t.type=r>1?l:u.bindType||p,d=(Re.get(o,"events")||{})[t.type]&&Re.get(o,"handle"),d&&d.apply(o,i),d=c&&o[c],d&&d.apply&&Oe(o)&&(t.result=d.apply(o,i),t.result===!1&&t.preventDefault());return t.type=p,s||t.isDefaultPrevented()||u._default&&u._default.apply(h.pop(),i)!==!1||!Oe(n)||c&&fe.isFunction(n[p])&&!fe.isWindow(n)&&(a=n[c],a&&(n[c]=null),fe.event.triggered=p,n[p](),fe.event.triggered=void 0,a&&(n[c]=a)),t.result}},simulate:function(e,t,i){var n=fe.extend(new fe.Event,i,{type:e,isSimulated:!0});fe.event.trigger(n,null,t)}}),fe.fn.extend({trigger:function(e,t){return this.each(function(){fe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];if(i)return fe.event.trigger(e,t,i,!0)}}),fe.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){fe.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),fe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),he.focusin="onfocusin"in e,he.focusin||fe.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){fe.event.simulate(t,e.target,fe.event.fix(e))};fe.event.special[t]={setup:function(){var n=this.ownerDocument||this,s=Re.access(n,t);s||n.addEventListener(e,i,!0),Re.access(n,t,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=Re.access(n,t)-1;s?Re.access(n,t,s):(n.removeEventListener(e,i,!0),Re.remove(n,t))}}});var Ct=e.location,kt=fe.now(),Tt=/\?/;fe.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||fe.error("Invalid XML: "+t),i};var St=/\[\]$/,Et=/\r?\n/g,$t=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;fe.param=function(e,t){var i,n=[],s=function(e,t){var i=fe.isFunction(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(fe.isArray(e)||e.jquery&&!fe.isPlainObject(e))fe.each(e,function(){s(this.name,this.value)});else for(i in e)Y(i,e[i],t,s);return n.join("&")},fe.fn.extend({serialize:function(){return fe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=fe.prop(this,"elements");return e?fe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!fe(this).is(":disabled")&&jt.test(this.nodeName)&&!$t.test(e)&&(this.checked||!qe.test(e))}).map(function(e,t){var i=fe(this).val();return null==i?null:fe.isArray(i)?fe.map(i,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:i.replace(Et,"\r\n")}}).get()}});var zt=/%20/g,Dt=/#.*$/,Pt=/([?&])_=[^&]*/,It=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ot=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Rt=/^(?:GET|HEAD)$/,At=/^\/\//,Ft={},Mt={},Nt="*/".concat("*"),Lt=te.createElement("a");Lt.href=Ct.href,fe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ct.href,type:"GET",isLocal:Ot.test(Ct.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Nt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":fe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?K(K(e,fe.ajaxSettings),t):K(fe.ajaxSettings,e)},ajaxPrefilter:G(Ft),ajaxTransport:G(Mt),ajax:function(t,i){function n(t,i,n,a){var c,h,p,b,x,_=i;d||(d=!0,l&&e.clearTimeout(l),s=void 0,o=a||"",C.readyState=t>0?4:0,c=t>=200&&t<300||304===t,n&&(b=J(f,C,n)),b=Q(f,b,C,c),c?(f.ifModified&&(x=C.getResponseHeader("Last-Modified"),x&&(fe.lastModified[r]=x),x=C.getResponseHeader("etag"),x&&(fe.etag[r]=x)),204===t||"HEAD"===f.type?_="nocontent":304===t?_="notmodified":(_=b.state,h=b.data,p=b.error,c=!p)):(p=_,!t&&_||(_="error",t<0&&(t=0))),C.status=t,C.statusText=(i||_)+"",c?v.resolveWith(g,[h,_,C]):v.rejectWith(g,[C,_,p]),C.statusCode(y),y=void 0,u&&m.trigger(c?"ajaxSuccess":"ajaxError",[C,f,c?h:p]),w.fireWith(g,[C,_]),u&&(m.trigger("ajaxComplete",[C,f]),--fe.active||fe.event.trigger("ajaxStop")))}"object"==typeof t&&(i=t,t=void 0),i=i||{};var s,r,o,a,l,c,d,u,h,p,f=fe.ajaxSetup({},i),g=f.context||f,m=f.context&&(g.nodeType||g.jquery)?fe(g):fe.event,v=fe.Deferred(),w=fe.Callbacks("once memory"),y=f.statusCode||{},b={},x={},_="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(d){if(!a)for(a={};t=It.exec(o);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return d?o:null},setRequestHeader:function(e,t){return null==d&&(e=x[e.toLowerCase()]=x[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==d&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(d)C.always(e[C.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||_;return s&&s.abort(t),n(0,t),this}};if(v.promise(C),f.url=((t||f.url||Ct.href)+"").replace(At,Ct.protocol+"//"),f.type=i.method||i.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(ze)||[""],null==f.crossDomain){c=te.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Lt.protocol+"//"+Lt.host!=c.protocol+"//"+c.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=fe.param(f.data,f.traditional)),X(Ft,f,i,C),d)return C;u=fe.event&&f.global,u&&0===fe.active++&&fe.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Rt.test(f.type),r=f.url.replace(Dt,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(zt,"+")):(p=f.url.slice(r.length),f.data&&(r+=(Tt.test(r)?"&":"?")+f.data,delete f.data),f.cache===!1&&(r=r.replace(Pt,"$1"),p=(Tt.test(r)?"&":"?")+"_="+kt++ +p),f.url=r+p),f.ifModified&&(fe.lastModified[r]&&C.setRequestHeader("If-Modified-Since",fe.lastModified[r]),fe.etag[r]&&C.setRequestHeader("If-None-Match",fe.etag[r])),(f.data&&f.hasContent&&f.contentType!==!1||i.contentType)&&C.setRequestHeader("Content-Type",f.contentType),C.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Nt+"; q=0.01":""):f.accepts["*"]);for(h in f.headers)C.setRequestHeader(h,f.headers[h]);if(f.beforeSend&&(f.beforeSend.call(g,C,f)===!1||d))return C.abort();if(_="abort",w.add(f.complete),C.done(f.success),C.fail(f.error),s=X(Mt,f,i,C)){if(C.readyState=1,u&&m.trigger("ajaxSend",[C,f]),d)return C;f.async&&f.timeout>0&&(l=e.setTimeout(function(){C.abort("timeout")},f.timeout));try{d=!1,s.send(b,n)}catch(e){if(d)throw e;n(-1,e)}}else n(-1,"No Transport");return C},getJSON:function(e,t,i){return fe.get(e,t,i,"json")},getScript:function(e,t){return fe.get(e,void 0,t,"script")}}),fe.each(["get","post"],function(e,t){fe[t]=function(e,i,n,s){return fe.isFunction(i)&&(s=s||n,n=i,i=void 0),fe.ajax(fe.extend({url:e,type:t,dataType:s,data:i,success:n},fe.isPlainObject(e)&&e))}}),fe._evalUrl=function(e){return fe.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},fe.fn.extend({wrapAll:function(e){var t;return this[0]&&(fe.isFunction(e)&&(e=e.call(this[0])),t=fe(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return fe.isFunction(e)?this.each(function(t){fe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=fe(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=fe.isFunction(e);return this.each(function(i){fe(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){fe(this).replaceWith(this.childNodes)}),this}}),fe.expr.pseudos.hidden=function(e){return!fe.expr.pseudos.visible(e)},fe.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},fe.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Ht={0:200,1223:204},Bt=fe.ajaxSettings.xhr();he.cors=!!Bt&&"withCredentials"in Bt,he.ajax=Bt=!!Bt,fe.ajaxTransport(function(t){var i,n;if(he.cors||Bt&&!t.crossDomain)return{send:function(s,r){var o,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(o in t.xhrFields)a[o]=t.xhrFields[o];t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest");for(o in s)a.setRequestHeader(o,s[o]);i=function(e){return function(){i&&(i=n=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?r(0,"error"):r(a.status,a.statusText):r(Ht[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),n=a.onerror=i("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&e.setTimeout(function(){i&&n()})},i=i("abort");try{a.send(t.hasContent&&t.data||null)}catch(e){if(i)throw e}},abort:function(){i&&i()}}}),fe.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),fe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return fe.globalEval(e),e}}}),fe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),fe.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,s){t=fe("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&s("error"===e.type?404:200,e.type)}),te.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Vt=[],Ut=/(=)\?(?=&|$)|\?\?/;fe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||fe.expando+"_"+kt++;return this[e]=!0,e}}),fe.ajaxPrefilter("json jsonp",function(t,i,n){var s,r,o,a=t.jsonp!==!1&&(Ut.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return s=t.jsonpCallback=fe.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Ut,"$1"+s):t.jsonp!==!1&&(t.url+=(Tt.test(t.url)?"&":"?")+t.jsonp+"="+s),t.converters["script json"]=function(){return o||fe.error(s+" was not called"),o[0]},t.dataTypes[0]="json",r=e[s],e[s]=function(){o=arguments},n.always(function(){void 0===r?fe(e).removeProp(s):e[s]=r,t[s]&&(t.jsonpCallback=i.jsonpCallback,Vt.push(s)),o&&fe.isFunction(r)&&r(o[0]),o=r=void 0}),"script"}),he.createHTMLDocument=function(){var e=te.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),fe.parseHTML=function(e,t,i){if("string"!=typeof e)return[];"boolean"==typeof t&&(i=t,t=!1);var n,s,r;return t||(he.createHTMLDocument?(t=te.implementation.createHTMLDocument(""),n=t.createElement("base"),n.href=te.location.href,t.head.appendChild(n)):t=te),s=Ce.exec(e),r=!i&&[],s?[t.createElement(s[1])]:(s=y([e],t,r),r&&r.length&&fe(r).remove(),fe.merge([],s.childNodes))},fe.fn.load=function(e,t,i){var n,s,r,o=this,a=e.indexOf(" ");return a>-1&&(n=q(e.slice(a)),e=e.slice(0,a)),fe.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(s="POST"),o.length>0&&fe.ajax({url:e,type:s||"GET",dataType:"html",data:t}).done(function(e){r=arguments,o.html(n?fe("<div>").append(fe.parseHTML(e)).find(n):e)}).always(i&&function(e,t){o.each(function(){i.apply(this,r||[e.responseText,t,e])})}),this},fe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){fe.fn[t]=function(e){return this.on(t,e)}}),fe.expr.pseudos.animated=function(e){return fe.grep(fe.timers,function(t){return e===t.elem}).length},fe.offset={setOffset:function(e,t,i){var n,s,r,o,a,l,c,d=fe.css(e,"position"),u=fe(e),h={};"static"===d&&(e.style.position="relative"),a=u.offset(),r=fe.css(e,"top"),l=fe.css(e,"left"),c=("absolute"===d||"fixed"===d)&&(r+l).indexOf("auto")>-1,c?(n=u.position(),o=n.top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(l)||0),fe.isFunction(t)&&(t=t.call(e,i,fe.extend({},a))),null!=t.top&&(h.top=t.top-a.top+o),null!=t.left&&(h.left=t.left-a.left+s),"using"in t?t.using.call(e,h):u.css(h)}},fe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){fe.offset.setOffset(this,e,t)});var t,i,n,s,r=this[0];if(r)return r.getClientRects().length?(n=r.getBoundingClientRect(),n.width||n.height?(s=r.ownerDocument,i=Z(s),t=s.documentElement,{top:n.top+i.pageYOffset-t.clientTop,left:n.left+i.pageXOffset-t.clientLeft}):n):{top:0,left:0}},position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===fe.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),fe.nodeName(e[0],"html")||(n=e.offset()),n={top:n.top+fe.css(e[0],"borderTopWidth",!0),left:n.left+fe.css(e[0],"borderLeftWidth",!0)}),{top:t.top-n.top-fe.css(i,"marginTop",!0),left:t.left-n.left-fe.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===fe.css(e,"position");)e=e.offsetParent;return e||Ke})}}),fe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;fe.fn[e]=function(n){return Ie(this,function(e,n,s){var r=Z(e);return void 0===s?r?r[t]:e[n]:void(r?r.scrollTo(i?r.pageXOffset:s,i?s:r.pageYOffset):e[n]=s)},e,n,arguments.length)}}),fe.each(["top","left"],function(e,t){fe.cssHooks[t]=P(he.pixelPosition,function(e,i){if(i)return i=D(e,t),ot.test(i)?fe(e).position()[t]+"px":i})}),fe.each({Height:"height",Width:"width"},function(e,t){fe.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,n){fe.fn[n]=function(s,r){var o=arguments.length&&(i||"boolean"!=typeof s),a=i||(s===!0||r===!0?"margin":"border");return Ie(this,function(t,i,s){var r;return fe.isWindow(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===s?fe.css(t,i,a):fe.style(t,i,s,a)},t,o?s:void 0,o)}})}),fe.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}}),fe.parseJSON=JSON.parse,"function"==typeof define&&define.amd&&define("jquery",[],function(){return fe});var qt=e.jQuery,Wt=e.$;return fe.noConflict=function(t){return e.$===fe&&(e.$=Wt),t&&e.jQuery===fe&&(e.jQuery=qt),fe},t||(e.jQuery=e.$=fe),fe}),function(){function e(e){function t(t,i,n,s,r,o){for(;r>=0&&r<o;r+=e){var a=s?s[r]:r;n=i(n,t[a],a,t)}return n}return function(i,n,s,r){n=y(n,r,4);var o=!S(i)&&w.keys(i),a=(o||i).length,l=e>0?0:a-1;return arguments.length<3&&(s=i[o?o[l]:l],l+=e),t(i,n,s,o,l,a)}}function t(e){return function(t,i,n){i=b(i,n);for(var s=T(t),r=e>0?0:s-1;r>=0&&r<s;r+=e)if(i(t[r],r,t))return r;return-1}}function i(e,t,i){return function(n,s,r){var o=0,a=T(n);if("number"==typeof r)e>0?o=r>=0?r:Math.max(r+a,o):a=r>=0?Math.min(r+1,a):r+a+1;else if(i&&r&&a)return r=i(n,s),n[r]===s?r:-1;if(s!==s)return r=t(d.call(n,o,a),w.isNaN),r>=0?r+o:-1;for(r=e>0?o:a-1;r>=0&&r<a;r+=e)if(n[r]===s)return r;return-1}}function n(e,t){var i=D.length,n=e.constructor,s=w.isFunction(n)&&n.prototype||a,r="constructor";for(w.has(e,r)&&!w.contains(t,r)&&t.push(r);i--;)r=D[i],r in e&&e[r]!==s[r]&&!w.contains(t,r)&&t.push(r)}var s=this||self,r=s._,o=Array.prototype,a=Object.prototype,l=Function.prototype,c=o.push,d=o.slice,u=a.toString,h=a.hasOwnProperty,p=Array.isArray,f=Object.keys,g=l.bind,m=Object.create,v=function(){},w=function(e){return e instanceof w?e:this instanceof w?void(this._wrapped=e):new w(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):s._=w,w.VERSION="1.8.3";var y=function(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,n){return e.call(t,i,n)};case 3:return function(i,n,s){return e.call(t,i,n,s)};case 4:return function(i,n,s,r){return e.call(t,i,n,s,r)}}return function(){return e.apply(t,arguments)}},b=function(e,t,i){return null==e?w.identity:w.isFunction(e)?y(e,t,i):w.isObject(e)?w.matcher(e):w.property(e)};w.iteratee=function(e,t){return b(e,t,1/0)};var x=function(e,t){return function(i){var n=arguments.length;if(n<2||null==i)return i;for(var s=1;s<n;s++)for(var r=arguments[s],o=e(r),a=o.length,l=0;l<a;l++){var c=o[l];t&&void 0!==i[c]||(i[c]=r[c])}return i}},_=function(e){if(!w.isObject(e))return{};if(m)return m(e);v.prototype=e;var t=new v;return v.prototype=null,t},C=function(e){return function(t){return null==t?void 0:t[e]}},k=Math.pow(2,53)-1,T=C("length"),S=function(e){var t=T(e);return"number"==typeof t&&t>=0&&t<=k};w.each=w.forEach=function(e,t,i){t=y(t,i);var n,s;if(S(e))for(n=0,s=e.length;n<s;n++)t(e[n],n,e);else{var r=w.keys(e);for(n=0,s=r.length;n<s;n++)t(e[r[n]],r[n],e)}return e},w.map=w.collect=function(e,t,i){t=b(t,i);for(var n=!S(e)&&w.keys(e),s=(n||e).length,r=Array(s),o=0;o<s;o++){var a=n?n[o]:o;r[o]=t(e[a],a,e)}return r},w.reduce=w.foldl=w.inject=e(1),w.reduceRight=w.foldr=e(-1),w.find=w.detect=function(e,t,i){var n;if(n=S(e)?w.findIndex(e,t,i):w.findKey(e,t,i),void 0!==n&&n!==-1)return e[n]},w.filter=w.select=function(e,t,i){var n=[];return t=b(t,i),w.each(e,function(e,i,s){t(e,i,s)&&n.push(e)}),n},w.reject=function(e,t,i){return w.filter(e,w.negate(b(t)),i)},w.every=w.all=function(e,t,i){t=b(t,i);for(var n=!S(e)&&w.keys(e),s=(n||e).length,r=0;r<s;r++){var o=n?n[r]:r;if(!t(e[o],o,e))return!1}return!0},w.some=w.any=function(e,t,i){t=b(t,i);for(var n=!S(e)&&w.keys(e),s=(n||e).length,r=0;r<s;r++){var o=n?n[r]:r;if(t(e[o],o,e))return!0}return!1},w.contains=w.includes=w.include=function(e,t,i,n){return S(e)||(e=w.values(e)),("number"!=typeof i||n)&&(i=0),w.indexOf(e,t,i)>=0},w.invoke=function(e,t){var i=d.call(arguments,2),n=w.isFunction(t);return w.map(e,function(e){var s=n?t:e[t];return null==s?s:s.apply(e,i)})},w.pluck=function(e,t){return w.map(e,w.property(t))},w.where=function(e,t){return w.filter(e,w.matcher(t))},w.findWhere=function(e,t){return w.find(e,w.matcher(t))},w.max=function(e,t,i){var n,s,r=-(1/0),o=-(1/0);if(null==t&&null!=e){e=S(e)?e:w.values(e);for(var a=0,l=e.length;a<l;a++)n=e[a],n>r&&(r=n)}else t=b(t,i),w.each(e,function(e,i,n){s=t(e,i,n),(s>o||s===-(1/0)&&r===-(1/0))&&(r=e,o=s)});return r},w.min=function(e,t,i){var n,s,r=1/0,o=1/0;if(null==t&&null!=e){e=S(e)?e:w.values(e);for(var a=0,l=e.length;a<l;a++)n=e[a],n<r&&(r=n)}else t=b(t,i),w.each(e,function(e,i,n){s=t(e,i,n),(s<o||s===1/0&&r===1/0)&&(r=e,o=s)});return r},w.shuffle=function(e){for(var t,i=S(e)?e:w.values(e),n=i.length,s=Array(n),r=0;r<n;r++)t=w.random(0,r),t!==r&&(s[r]=s[t]),s[t]=i[r];return s},w.sample=function(e,t,i){return null==t||i?(S(e)||(e=w.values(e)),e[w.random(e.length-1)]):w.shuffle(e).slice(0,Math.max(0,t))},w.sortBy=function(e,t,i){return t=b(t,i),w.pluck(w.map(e,function(e,i,n){return{value:e,index:i,criteria:t(e,i,n)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,i,n){var s={};return i=b(i,n),w.each(t,function(n,r){var o=i(n,r,t);e(s,n,o)}),s}};w.groupBy=E(function(e,t,i){w.has(e,i)?e[i].push(t):e[i]=[t]}),w.indexBy=E(function(e,t,i){e[i]=t}),w.countBy=E(function(e,t,i){w.has(e,i)?e[i]++:e[i]=1}),w.toArray=function(e){return e?w.isArray(e)?d.call(e):S(e)?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:S(e)?e.length:w.keys(e).length},w.partition=function(e,t,i){t=b(t,i);var n=[],s=[];return w.each(e,function(e,i,r){(t(e,i,r)?n:s).push(e)}),[n,s]},w.first=w.head=w.take=function(e,t,i){if(null!=e)return null==t||i?e[0]:w.initial(e,e.length-t)},w.initial=function(e,t,i){return d.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},w.last=function(e,t,i){if(null!=e)return null==t||i?e[e.length-1]:w.rest(e,Math.max(0,e.length-t))},w.rest=w.tail=w.drop=function(e,t,i){return d.call(e,null==t||i?1:t)},w.compact=function(e){return w.filter(e,w.identity)};var $=function(e,t,i,n){for(var s=[],r=0,o=n||0,a=T(e);o<a;o++){var l=e[o];if(S(l)&&(w.isArray(l)||w.isArguments(l))){t||(l=$(l,t,i));var c=0,d=l.length;for(s.length+=d;c<d;)s[r++]=l[c++]}else i||(s[r++]=l)}return s};w.flatten=function(e,t){return $(e,t,!1)},w.without=function(e){return w.difference(e,d.call(arguments,1))},w.uniq=w.unique=function(e,t,i,n){w.isBoolean(t)||(n=i,i=t,t=!1),null!=i&&(i=b(i,n));for(var s=[],r=[],o=0,a=T(e);o<a;o++){var l=e[o],c=i?i(l,o,e):l;t?(o&&r===c||s.push(l),r=c):i?w.contains(r,c)||(r.push(c),s.push(l)):w.contains(s,l)||s.push(l)}return s},w.union=function(){return w.uniq($(arguments,!0,!0))},w.intersection=function(e){for(var t=[],i=arguments.length,n=0,s=T(e);n<s;n++){var r=e[n];if(!w.contains(t,r)){for(var o=1;o<i&&w.contains(arguments[o],r);o++);o===i&&t.push(r)}}return t},w.difference=function(e){var t=$(arguments,!0,!0,1);return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(e){for(var t=e&&w.max(e,T).length||0,i=Array(t),n=0;n<t;n++)i[n]=w.pluck(e,n);return i},w.object=function(e,t){for(var i={},n=0,s=T(e);n<s;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},w.findIndex=t(1),w.findLastIndex=t(-1),w.sortedIndex=function(e,t,i,n){i=b(i,n,1);for(var s=i(t),r=0,o=T(e);r<o;){var a=Math.floor((r+o)/2);i(e[a])<s?r=a+1:o=a}return r},w.indexOf=i(1,w.findIndex,w.sortedIndex),w.lastIndexOf=i(-1,w.findLastIndex),w.range=function(e,t,i){null==t&&(t=e||0,e=0),i=i||1;for(var n=Math.max(Math.ceil((t-e)/i),0),s=Array(n),r=0;r<n;r++,e+=i)s[r]=e;return s};var j=function(e,t,i,n,s){if(!(n instanceof t))return e.apply(i,s);var r=_(e.prototype),o=e.apply(r,s);return w.isObject(o)?o:r};w.bind=function(e,t){if(g&&e.bind===g)return g.apply(e,d.call(arguments,1));if(!w.isFunction(e))throw new TypeError("Bind must be called on a function");var i=d.call(arguments,2),n=function(){return j(e,n,t,this,i.concat(d.call(arguments)))};return n},w.partial=function(e){var t=d.call(arguments,1),i=function(){for(var n=0,s=t.length,r=Array(s),o=0;o<s;o++)r[o]=t[o]===w?arguments[n++]:t[o];for(;n<arguments.length;)r.push(arguments[n++]);return j(e,i,this,this,r)};return i},w.bindAll=function(e){var t,i,n=arguments.length;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)i=arguments[t],e[i]=w.bind(e[i],e);return e},w.memoize=function(e,t){var i=function(n){var s=i.cache,r=""+(t?t.apply(this,arguments):n);return w.has(s,r)||(s[r]=e.apply(this,arguments)),s[r]};return i.cache={},i},w.delay=function(e,t){var i=d.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},w.defer=w.partial(w.delay,w,1),w.throttle=function(e,t,i){var n,s,r,o=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:w.now(),o=null,r=e.apply(n,s),o||(n=s=null)};return function(){var c=w.now();a||i.leading!==!1||(a=c);var d=t-(c-a);return n=this,s=arguments,d<=0||d>t?(o&&(clearTimeout(o),o=null),a=c,r=e.apply(n,s),o||(n=s=null)):o||i.trailing===!1||(o=setTimeout(l,d)),r}},w.debounce=function(e,t,i){
var n,s,r,o,a,l=function(){var c=w.now()-o;c<t&&c>=0?n=setTimeout(l,t-c):(n=null,i||(a=e.apply(r,s),n||(r=s=null)))};return function(){r=this,s=arguments,o=w.now();var c=i&&!n;return n||(n=setTimeout(l,t)),c&&(a=e.apply(r,s),r=s=null),a}},w.wrap=function(e,t){return w.partial(t,e)},w.negate=function(e){return function(){return!e.apply(this,arguments)}},w.compose=function(){var e=arguments,t=e.length-1;return function(){for(var i=t,n=e[t].apply(this,arguments);i--;)n=e[i].call(this,n);return n}},w.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},w.before=function(e,t){var i;return function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}},w.once=w.partial(w.before,2);var z=!{toString:null}.propertyIsEnumerable("toString"),D=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(e){if(!w.isObject(e))return[];if(f)return f(e);var t=[];for(var i in e)w.has(e,i)&&t.push(i);return z&&n(e,t),t},w.allKeys=function(e){if(!w.isObject(e))return[];var t=[];for(var i in e)t.push(i);return z&&n(e,t),t},w.values=function(e){for(var t=w.keys(e),i=t.length,n=Array(i),s=0;s<i;s++)n[s]=e[t[s]];return n},w.mapObject=function(e,t,i){t=b(t,i);for(var n,s=w.keys(e),r=s.length,o={},a=0;a<r;a++)n=s[a],o[n]=t(e[n],n,e);return o},w.pairs=function(e){for(var t=w.keys(e),i=t.length,n=Array(i),s=0;s<i;s++)n[s]=[t[s],e[t[s]]];return n},w.invert=function(e){for(var t={},i=w.keys(e),n=0,s=i.length;n<s;n++)t[e[i[n]]]=i[n];return t},w.functions=w.methods=function(e){var t=[];for(var i in e)w.isFunction(e[i])&&t.push(i);return t.sort()},w.extend=x(w.allKeys),w.extendOwn=w.assign=x(w.keys),w.findKey=function(e,t,i){t=b(t,i);for(var n,s=w.keys(e),r=0,o=s.length;r<o;r++)if(n=s[r],t(e[n],n,e))return n},w.pick=function(e,t,i){var n,s,r={},o=e;if(null==o)return r;w.isFunction(t)?(s=w.allKeys(o),n=y(t,i)):(s=$(arguments,!1,!1,1),n=function(e,t,i){return t in i},o=Object(o));for(var a=0,l=s.length;a<l;a++){var c=s[a],d=o[c];n(d,c,o)&&(r[c]=d)}return r},w.omit=function(e,t,i){if(w.isFunction(t))t=w.negate(t);else{var n=w.map($(arguments,!1,!1,1),String);t=function(e,t){return!w.contains(n,t)}}return w.pick(e,t,i)},w.defaults=x(w.allKeys,!0),w.create=function(e,t){var i=_(e);return t&&w.extendOwn(i,t),i},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isMatch=function(e,t){var i=w.keys(t),n=i.length;if(null==e)return!n;for(var s=Object(e),r=0;r<n;r++){var o=i[r];if(t[o]!==s[o]||!(o in s))return!1}return!0};var P=function(e,t,i,n){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof w&&(e=e._wrapped),t instanceof w&&(t=t._wrapped);var s=u.call(e);if(s!==u.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var r="[object Array]"===s;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(w.isFunction(o)&&o instanceof o&&w.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===e)return n[l]===t;if(i.push(e),n.push(t),r){if(l=e.length,l!==t.length)return!1;for(;l--;)if(!P(e[l],t[l],i,n))return!1}else{var c,d=w.keys(e);if(l=d.length,w.keys(t).length!==l)return!1;for(;l--;)if(c=d[l],!w.has(t,c)||!P(e[c],t[c],i,n))return!1}return i.pop(),n.pop(),!0};w.isEqual=function(e,t){return P(e,t)},w.isEmpty=function(e){return null==e||(S(e)&&(w.isArray(e)||w.isString(e)||w.isArguments(e))?0===e.length:0===w.keys(e).length)},w.isElement=function(e){return!(!e||1!==e.nodeType)},w.isArray=p||function(e){return"[object Array]"===u.call(e)},w.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){w["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return w.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(w.isFunction=function(e){return"function"==typeof e||!1}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!==+e},w.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===u.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return null!=e&&h.call(e,t)},w.noConflict=function(){return s._=r,this},w.identity=function(e){return e},w.constant=function(e){return function(){return e}},w.noop=function(){},w.property=C,w.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},w.matcher=w.matches=function(e){return e=w.extendOwn({},e),function(t){return w.isMatch(t,e)}},w.times=function(e,t,i){var n=Array(Math.max(0,e));t=y(t,i,1);for(var s=0;s<e;s++)n[s]=t(s);return n},w.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},w.now=Date.now||function(){return(new Date).getTime()};var I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},O=w.invert(I),R=function(e){var t=function(t){return e[t]},i="(?:"+w.keys(e).join("|")+")",n=RegExp(i),s=RegExp(i,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(s,t):e}};w.escape=R(I),w.unescape=R(O),w.result=function(e,t,i){var n=null==e?void 0:e[t];return void 0===n&&(n=i),w.isFunction(n)?n.call(e):n};var A=0;w.uniqueId=function(e){var t=++A+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,L=function(e){return"\\"+M[e]};w.template=function(e,t,i){!t&&i&&(t=i),t=w.defaults({},t,w.templateSettings);var n=RegExp([(t.escape||F).source,(t.interpolate||F).source,(t.evaluate||F).source].join("|")+"|$","g"),s=0,r="__p+='";e.replace(n,function(t,i,n,o,a){return r+=e.slice(s,a).replace(N,L),s=a+t.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":o&&(r+="';\n"+o+"\n__p+='"),t}),r+="';\n",t.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var o=new Function(t.variable||"obj","_",r)}catch(e){throw e.source=r,e}var a=function(e){return o.call(this,e,w)},l=t.variable||"obj";return a.source="function("+l+"){\n"+r+"}",a},w.chain=function(e){var t=w(e);return t._chain=!0,t};var H=function(e,t){return e._chain?w(t).chain():t};w.mixin=function(e){w.each(w.functions(e),function(t){var i=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),H(this,i.apply(w,e))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];w.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0],H(this,i)}}),w.each(["concat","join","slice"],function(e){var t=o[e];w.prototype[e]=function(){return H(this,t.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}.call(this),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,s){t.Backbone=e(t,s,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(e){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,i,n){var s=e.Backbone,r=Array.prototype.slice;t.VERSION="1.3.3",t.$=n,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,s){return i[t](this[n],l(e,this),s)};case 4:return function(e,s,r){return i[t](this[n],l(e,this),s,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},a=function(e,t,n){i.each(t,function(t,s){i[s]&&(e.prototype[s]=o(t,s,n))})},l=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?c(e):i.isString(e)?function(t){return t.get(e)}:e},c=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},d=t.Events={},u=/\s+/,h=function(e,t,n,s,r){var o,a=0;if(n&&"object"==typeof n){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(o=i.keys(n);a<o.length;a++)t=h(e,t,o[a],n[o[a]],r)}else if(n&&u.test(n))for(o=n.split(u);a<o.length;a++)t=e(t,o[a],s,r);else t=e(t,n,s,r);return t};d.on=function(e,t,i){return p(this,e,t,i)};var p=function(e,t,i,n,s){if(e._events=h(f,e._events||{},t,i,{context:n,ctx:e,listening:s}),s){var r=e._listeners||(e._listeners={});r[s.id]=s}return e};d.listenTo=function(e,t,n){if(!e)return this;var s=e._listenId||(e._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),o=r[s];if(!o){var a=this._listenId||(this._listenId=i.uniqueId("l"));o=r[s]={obj:e,objId:s,id:a,listeningTo:r,count:0}}return p(e,t,n,this,o),this};var f=function(e,t,i,n){if(i){var s=e[t]||(e[t]=[]),r=n.context,o=n.ctx,a=n.listening;a&&a.count++,s.push({callback:i,context:r,ctx:r||o,listening:a})}return e};d.off=function(e,t,i){return this._events?(this._events=h(g,this._events,e,t,{context:i,listeners:this._listeners}),this):this},d.stopListening=function(e,t,n){var s=this._listeningTo;if(!s)return this;for(var r=e?[e._listenId]:i.keys(s),o=0;o<r.length;o++){var a=s[r[o]];if(!a)break;a.obj.off(t,n,this)}return this};var g=function(e,t,n,s){if(e){var r,o=0,a=s.context,l=s.listeners;if(t||n||a){for(var c=t?[t]:i.keys(e);o<c.length;o++){t=c[o];var d=e[t];if(!d)break;for(var u=[],h=0;h<d.length;h++){var p=d[h];n&&n!==p.callback&&n!==p.callback._callback||a&&a!==p.context?u.push(p):(r=p.listening,r&&0===--r.count&&(delete l[r.id],delete r.listeningTo[r.objId]))}u.length?e[t]=u:delete e[t]}return e}for(var f=i.keys(l);o<f.length;o++)r=l[f[o]],delete l[r.id],delete r.listeningTo[r.objId]}};d.once=function(e,t,n){var s=h(m,{},e,t,i.bind(this.off,this));return"string"==typeof e&&null==n&&(t=void 0),this.on(s,t,n)},d.listenToOnce=function(e,t,n){var s=h(m,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,s)};var m=function(e,t,n,s){if(n){var r=e[t]=i.once(function(){s(t,r),n.apply(this,arguments)});r._callback=n}return e};d.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;n<t;n++)i[n]=arguments[n+1];return h(v,this._events,e,void 0,i),this};var v=function(e,t,i,n){if(e){var s=e[t],r=e.all;s&&r&&(r=r.slice()),s&&w(s,n),r&&w(r,[t].concat(n))}return e},w=function(e,t){var i,n=-1,s=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++n<s;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o);return;case 3:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o,a);return;default:for(;++n<s;)(i=e[n]).callback.apply(i.ctx,t);return}};d.bind=d.on,d.unbind=d.off,i.extend(t,d);var y=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var s=i.result(this,"defaults");n=i.defaults(i.extend({},s,n),s),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(y.prototype,d,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var s;if("object"==typeof e?(s=e,n=t):(s={})[e]=t,n||(n={}),!this._validate(s,n))return!1;var r=n.unset,o=n.silent,a=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var c=this.attributes,d=this.changed,u=this._previousAttributes;for(var h in s)t=s[h],i.isEqual(c[h],t)||a.push(h),i.isEqual(u[h],t)?delete d[h]:d[h]=t,r?delete c[h]:c[h]=t;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!o){a.length&&(this._pending=n);for(var p=0;p<a.length;p++)this.trigger("change:"+a[p],this,c[a[p]],n)}if(l)return this;if(!o)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&i.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,n={};for(var s in e){var r=e[s];i.isEqual(t[s],r)||(n[s]=r)}return!!i.size(n)&&n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var s=e.parse?t.parse(i,e):i;return!!t.set(s,e)&&(n&&n.call(e.context,t,i,e),void t.trigger("sync",t,i,e))},H(this,e),this.sync("read",this,e)},save:function(e,t,n){var s;null==e||"object"==typeof e?(s=e,n=t):(s={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var r=n.wait;if(s&&!r){if(!this.set(s,n))return!1}else if(!this._validate(s,n))return!1;var o=this,a=n.success,l=this.attributes;n.success=function(e){o.attributes=l;var t=n.parse?o.parse(e,n):e;return r&&(t=i.extend({},s,t)),!(t&&!o.set(t,n))&&(a&&a.call(n.context,o,e,n),void o.trigger("sync",o,e,n))},H(this,n),s&&r&&(this.attributes=i.extend({},l,s));var c=this.isNew()?"create":n.patch?"patch":"update";"patch"!==c||n.attrs||(n.attrs=s);var d=this.sync(c,this,n);return this.attributes=l,d},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,s=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){s&&r(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var o=!1;return this.isNew()?i.defer(e.success):(H(this,e),o=this.sync("delete",this,e)),s||r(),o},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||L();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return!n||(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1)}});var b={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};a(y,b,"attributes");var x=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},_={add:!0,remove:!0,merge:!0},C={add:!0,remove:!1},k=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,s=Array(e.length-i),r=t.length;for(n=0;n<s.length;n++)s[n]=e[n+i];for(n=0;n<r;n++)e[n+i]=t[n];for(n=0;n<s.length;n++)e[n+r+i]=s[n]};i.extend(x.prototype,d,{model:y,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,C))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var s=this._removeModels(e,t);return!t.silent&&s.length&&(t.changes={added:[],merged:[],removed:s},this.trigger("update",this,t)),n?s[0]:s},set:function(e,t){if(null!=e){t=i.extend({},_,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var s=t.at;null!=s&&(s=+s),s>this.length&&(s=this.length),s<0&&(s+=this.length+1);var r,o,a=[],l=[],c=[],d=[],u={},h=t.add,p=t.merge,f=t.remove,g=!1,m=this.comparator&&null==s&&t.sort!==!1,v=i.isString(this.comparator)?this.comparator:null;for(o=0;o<e.length;o++){r=e[o];var w=this.get(r);if(w){if(p&&r!==w){var y=this._isModel(r)?r.attributes:r;t.parse&&(y=w.parse(y,t)),w.set(y,t),c.push(w),m&&!g&&(g=w.hasChanged(v))}u[w.cid]||(u[w.cid]=!0,a.push(w)),e[o]=w}else h&&(r=e[o]=this._prepareModel(r,t),r&&(l.push(r),this._addReference(r,t),u[r.cid]=!0,a.push(r)))}if(f){for(o=0;o<this.length;o++)r=this.models[o],u[r.cid]||d.push(r);d.length&&this._removeModels(d,t)}var b=!1,x=!m&&h&&f;if(a.length&&x?(b=this.length!==a.length||i.some(this.models,function(e,t){return e!==a[t]}),this.models.length=0,k(this.models,a,0),this.length=this.models.length):l.length&&(m&&(g=!0),k(this.models,l,null==s?this.length:s),this.length=this.models.length),g&&this.sort({silent:!0}),!t.silent){for(o=0;o<l.length;o++)null!=s&&(t.index=s+o),r=l[o],r.trigger("add",r,this,t);(g||b)&&this.trigger("sort",this,t),(l.length||d.length||c.length)&&(t.changes={added:l,removed:d,merged:c},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var s=e.reset?"reset":"set";n[s](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},H(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(e=this._prepareModel(e,t),!e)return!1;n||this.add(e,t);var s=this,r=t.success;return t.success=function(e,t,i){n&&s.add(e,i),r&&r.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var s=this.get(e[n]);if(s){var r=this.indexOf(s);this.models.splice(r,1),this.length--,delete this._byId[s.cid];var o=this.modelId(s.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=r,s.trigger("remove",s,this,t)),i.push(s),this._removeReference(s,t)}}return i},_isModel:function(e){return e instanceof y},_addReference:function(e,t){this._byId[e.cid]=e;var i=this.modelId(e.attributes);null!=i&&(this._byId[i]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var i=this.modelId(e.attributes);null!=i&&delete this._byId[i],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){var s=this.modelId(t.previousAttributes()),r=this.modelId(t.attributes);s!==r&&(null!=s&&delete this._byId[s],null!=r&&(this._byId[r]=t))}}this.trigger.apply(this,arguments)}});var T={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};a(x,T,"models");var S=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,$)),this._ensureElement(),this.initialize.apply(this,arguments)},E=/^(\S+)\s*(.*)$/,$=["model","collection","el","id","attributes","className","tagName","events"];i.extend(S.prototype,d,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var s=t.match(E);this.delegate(s[1],s[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,s){var r=j[e];i.defaults(s||(s={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(s.url||(o.url=i.result(n,"url")||L()),null!=s.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(s.attrs||n.toJSON(s))),s.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",s.emulateJSON&&(o.data._method=r);var a=s.beforeSend;s.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===o.type||s.emulateJSON||(o.processData=!1);var l=s.error;s.error=function(e,t,i){s.textStatus=t,s.errorThrown=i,l&&l.call(s.context,e,t,i)};var c=s.xhr=t.ajax(i.extend(o,s));return n.trigger("request",n,c,s),c};var j={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var z=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},D=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,I=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(z.prototype,d,{initialize:function(){},route:function(e,n,s){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(s=n,n=""),s||(s=this[n]);var r=this;return t.history.route(e,function(i){var o=r._extractParameters(e,i);r.execute(s,o,n)!==!1&&(r.trigger.apply(r,["route:"+n].concat(o)),r.trigger("route",n,o),t.history.trigger("route",r,n,o))}),this},execute:function(e,t,i){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(D,"(?:$1)?").replace(P,function(e,t){return t?e:"([^/?]+)"}).replace(I,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var R=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,M=/#.*$/;R.started=!1,i.extend(R.prototype,d,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(A,"")},start:function(e){if(R.started)throw new Error("Backbone.history has already been started");if(R.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(F,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,s=n.insertBefore(this.iframe,n.firstChild).contentWindow;s.document.open(),s.document.close(),s.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),R.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();return t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t!==this.fragment&&(this.iframe&&this.navigate(t),void this.loadUrl())},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!R.started)return!1;t&&t!==!0||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;""!==e&&"?"!==e.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(M,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;t.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new R;var N=function(e,t){var n,s=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},i.extend(n,s,t),n.prototype=i.create(s.prototype,e),n.prototype.constructor=n,n.__super__=s.prototype,n};y.extend=x.extend=z.extend=S.extend=R.extend=N;var L=function(){throw new Error('A "url" property or function must be specified')},H=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):(e.Backbone=e.Backbone||{},e.Backbone.Radio=t(e._,e.Backbone))}(this,function(e,t){"use strict";function i(e,t,i,n){var s=e[t];if(!(i&&i!==s.callback&&i!==s.callback._callback||n&&n!==s.context))return delete e[t],!0}function n(t,n,s,r){t||(t={});for(var o=n?[n]:e.keys(t),a=!1,l=0,c=o.length;l<c;l++)n=o[l],t[n]&&i(t,n,s,r)&&(a=!0);return a}function s(t){return d[t]||(d[t]=e.bind(l.log,l,t))}function r(t){return e.isFunction(t)?t:function(){return t}}e="default"in e?e.default:e,t="default"in t?t.default:t;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=t.Radio,l=t.Radio={};l.VERSION="2.0.0",l.noConflict=function(){return t.Radio=a,this},l.DEBUG=!1,l._debugText=function(e,t,i){return e+(i?" on the "+i+" channel":"")+': "'+t+'"'},l.debugLog=function(e,t,i){l.DEBUG&&console&&console.warn&&console.warn(l._debugText(e,t,i))};var c=/\s+/;l._eventsApi=function(t,i,n,s){if(!n)return!1;var r={};if("object"===("undefined"==typeof n?"undefined":o(n))){for(var a in n){var l=t[i].apply(t,[a,n[a]].concat(s));c.test(a)?e.extend(r,l):r[a]=l}return r}if(c.test(n)){for(var d=n.split(c),u=0,h=d.length;u<h;u++)r[d[u]]=t[i].apply(t,[d[u]].concat(s));return r}return!1},l._callHandler=function(e,t,i){var n=i[0],s=i[1],r=i[2];switch(i.length){case 0:return e.call(t);case 1:return e.call(t,n);case 2:return e.call(t,n,s);case 3:return e.call(t,n,s,r);default:return e.apply(t,i)}};var d={};e.extend(l,{log:function(t,i){if("undefined"!=typeof console){var n=e.toArray(arguments).slice(2);console.log("["+t+'] "'+i+'"',n)}},tuneIn:function(e){var t=l.channel(e);return t._tunedIn=!0,t.on("all",s(e)),this},tuneOut:function(e){var t=l.channel(e);return t._tunedIn=!1,t.off("all",s(e)),
delete d[e],this}}),l.Requests={request:function(t){var i=e.toArray(arguments).slice(1),n=l._eventsApi(this,"request",t,i);if(n)return n;var s=this.channelName,r=this._requests;if(s&&this._tunedIn&&l.log.apply(this,[s,t].concat(i)),r&&(r[t]||r.default)){var o=r[t]||r.default;return i=r[t]?i:arguments,l._callHandler(o.callback,o.context,i)}l.debugLog("An unhandled request was fired",t,s)},reply:function(e,t,i){return l._eventsApi(this,"reply",e,[t,i])?this:(this._requests||(this._requests={}),this._requests[e]&&l.debugLog("A request was overwritten",e,this.channelName),this._requests[e]={callback:r(t),context:i||this},this)},replyOnce:function(t,i,n){if(l._eventsApi(this,"replyOnce",t,[i,n]))return this;var s=this,o=e.once(function(){return s.stopReplying(t),r(i).apply(this,arguments)});return this.reply(t,o,n)},stopReplying:function(e,t,i){return l._eventsApi(this,"stopReplying",e)?this:(e||t||i?n(this._requests,e,t,i)||l.debugLog("Attempted to remove the unregistered request",e,this.channelName):delete this._requests,this)}},l._channels={},l.channel=function(e){if(!e)throw new Error("You must provide a name for the channel.");return l._channels[e]?l._channels[e]:l._channels[e]=new l.Channel(e)},l.Channel=function(e){this.channelName=e},e.extend(l.Channel.prototype,t.Events,l.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var u,h,p=[t.Events,l.Requests];return e.each(p,function(t){e.each(t,function(t,i){l[i]=function(t){return h=e.toArray(arguments).slice(1),u=this.channel(t),u[i].apply(u,h)}})}),l.reset=function(t){var i=t?[this._channels[t]]:this._channels;e.each(i,function(e){e.reset()})},l}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("backbone"),require("underscore"),require("backbone.radio")):"function"==typeof define&&define.amd?define(["backbone","underscore","backbone.radio"],t):e.Marionette=e.Mn=t(e.Backbone,e._,e.Backbone.Radio)}(this,function(e,t,i){"use strict";function n(e,t,i){return i.toUpperCase()}function s(e){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=W(e),o=V.call(this,r),a=void 0;return t.isFunction(o)&&(a=o.apply(this,n)),this.trigger.apply(this,arguments),a}function r(e){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.isFunction(e.triggerMethod)?e.triggerMethod.apply(e,n):s.apply(e,n)}function o(e,i,n){e._getImmediateChildren&&t.each(e._getImmediateChildren(),function(e){n(e)&&r(e,i,e)})}function a(e){return!e._isAttached}function l(e){return!!a(e)&&(e._isAttached=!0,!0)}function c(e){return e._isAttached}function d(e){return!!c(e)&&(e._isAttached=!1,!0)}function u(e){e._isAttached&&e._isRendered&&r(e,"dom:refresh",e)}function h(){o(this,"before:attach",a)}function p(){o(this,"attach",l),u(this)}function f(){o(this,"before:detach",c)}function g(){o(this,"detach",d)}function m(){u(this)}function v(e){e._areViewEventsMonitored||(e._areViewEventsMonitored=!0,e.on({"before:attach":h,attach:p,"before:detach":f,detach:g,render:m}))}function w(e,i,n,s,r){var o=s.split(/\s+/);t.each(o,function(t){var s=e[t];if(!s)throw new G('Method "'+t+'" was configured as an event handler, but does not exist.');e[r](i,n,s)})}function y(e,i,n,s){if(i&&n){if(!t.isObject(n))throw new G({message:"Bindings must be an object.",url:"marionette.functions.html#marionettebindevents"});t.each(n,function(n,r){return t.isString(n)?void w(e,i,r,n,s):void e[s](i,r,n)})}}function b(e,t){return y(this,e,t,"listenTo"),this}function x(e,t){return y(this,e,t,"stopListening"),this}function _(e,i,n,s){if(i&&n){if(!t.isObject(n))throw new G({message:"Bindings must be an object.",url:"marionette.functions.html#marionettebindrequests"});var r=U.call(e,n);i[s](r,e)}}function C(e,t){return _(this,e,t,"reply"),this}function k(e,t){return _(this,e,t,"stopReplying"),this}function T(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function S(e,i){return e.behaviorClass?e.behaviorClass:t.isFunction(e)?e:t.isFunction(Oe.Behaviors.behaviorsLookup)?Oe.Behaviors.behaviorsLookup(e,i)[i]:Oe.Behaviors.behaviorsLookup[i]}function E(e,i){return t.chain(i).map(function(i,n){var s=S(i,n),r=i===s?{}:i,o=new s(r,e),a=E(e,t.result(o,"behaviors"));return[o].concat(a)}).flatten().value()}function $(e,i){return[e+t.uniqueId(".evt"),i].join(" ")}function j(e,i){t.isString(i)&&(i={event:i});var n=i.event,s=i.preventDefault!==!1,r=i.stopPropagation!==!1;return function(t){s&&t.preventDefault(),r&&t.stopPropagation(),e.triggerMethod(n,e)}}function z(e){e.supportsDestroyLifecycle||r(e,"before:destroy",e);var t=!!e._isAttached;t&&r(e,"before:detach",e),e.remove(),t&&(e._isAttached=!1,r(e,"detach",e)),e._isDestroyed=!0,e.supportsDestroyLifecycle||r(e,"destroy",e)}function D(e,t){return e instanceof pe?e:P(e,t)}function P(e,i){var n=t.extend({},i);if(t.isString(e))return t.extend(n,{el:e}),I(n);if(t.isFunction(e))return t.extend(n,{regionClass:e}),I(n);if(t.isObject(e))return e.selector&&L("The selector option on a Region definition object is deprecated. Use el to pass a selector string"),t.extend(n,{el:e.selector},e),I(n);throw new G({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})}function I(e){var i=e.regionClass,n=t.omit(e,"regionClass");return new i(n)}function O(){throw new G({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.md#behaviorslookup"})}function R(e){return!!Pe[e]}function A(e,t){return Pe[e]=t}e="default"in e?e.default:e,t="default"in t?t.default:t,i="default"in i?i.default:i;var F="3.1.0",M=function(e){return function(t){for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return e.apply(t,n)}},N=e.Model.extend,L=function e(i,n){t.isObject(i)&&(i=i.prev+" is going to be removed in the future. Please use "+i.next+" instead."+(i.url?" See: "+i.url:"")),Oe.DEV_MODE&&(void 0!==n&&n||e._cache[i]||(e._warn("Deprecation warning: "+i),e._cache[i]=!0))};L._console="undefined"!=typeof console?console:{},L._warn=function(){var e=L._console.warn||L._console.log||t.noop;return e.apply(L._console,arguments)},L._cache={};var H=function(t){return e.$.contains(document.documentElement,t)},B=function(e,i){var n=this;e&&t.each(i,function(t){var i=e[t];void 0!==i&&(n[t]=i)})},V=function(e){if(e)return this.options&&void 0!==this.options[e]?this.options[e]:this[e]},U=function(e){var i=this;return t.reduce(e,function(e,n,s){return t.isFunction(n)||(n=i[n]),n&&(e[s]=n),e},{})},q=/(^|:)(\w)/gi,W=t.memoize(function(e){return"on"+e.replace(q,n)}),Y=["description","fileName","lineNumber","name","message","number"],G=N.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+F+"/",constructor:function(e,i){t.isObject(e)?(i=e,e=i.message):i||(i={});var n=Error.call(this,e);t.extend(this,t.pick(n,Y),t.pick(i,Y)),this.captureStackTrace(),i.url&&(this.url=this.urlRoot+i.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,G)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}});G.extend=N;var X=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];this.options=t.extend.apply(t,[{},t.result(this,"options")].concat(i))},K={normalizeMethods:U,_setOptions:X,mergeOptions:B,getOption:V,bindEvents:b,unbindEvents:x},J={_initRadio:function(){var e=t.result(this,"channelName");if(e){if(!i)throw new G({name:"BackboneRadioMissing",message:'The dependency "backbone.radio" is missing.'});var n=this._channel=i.channel(e),s=t.result(this,"radioEvents");this.bindEvents(n,s);var r=t.result(this,"radioRequests");this.bindRequests(n,r),this.on("destroy",this._destroyRadio)}},_destroyRadio:function(){this._channel.stopReplying(null,null,this)},getChannel:function(){return this._channel},bindEvents:b,unbindEvents:x,bindRequests:C,unbindRequests:k},Q=["channelName","radioEvents","radioRequests"],Z=function(e){this._setOptions(e),this.mergeOptions(e,Q),this.cid=t.uniqueId(this.cidPrefix),this._initRadio(),this.initialize.apply(this,arguments)};Z.extend=N,t.extend(Z.prototype,e.Events,K,J,{cidPrefix:"mno",_isDestroyed:!1,isDestroyed:function(){return this._isDestroyed},initialize:function(){},destroy:function(){if(this._isDestroyed)return this;for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.triggerMethod.apply(this,["before:destroy",this].concat(t)),this._isDestroyed=!0,this.triggerMethod.apply(this,["destroy",this].concat(t)),this.stopListening(),this},triggerMethod:s});var ee=function(e){this.templateId=e};t.extend(ee,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new ee(e),this.templateCaches[e]=i),i.load(t)},clear:function(){for(var e=void 0,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=i.length;if(s>0)for(e=0;e<s;e++)delete this.templateCaches[i[e]];else this.templateCaches={}}}),t.extend(ee.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(t,i){var n=e.$(t);if(!n.length)throw new G({name:"NoTemplateError",message:'Could not find template: "'+t+'"'});return n.html()},compileTemplate:function(e,i){return t.template(e,i)}});var te=t.invokeMap||t.invoke,ie={_initBehaviors:function(){var e=t.result(this,"behaviors");this._behaviors=t.isObject(e)?E(this,e):{}},_getBehaviorTriggers:function(){var e=te(this._behaviors,"getTriggers");return t.extend.apply(t,[{}].concat(T(e)))},_getBehaviorEvents:function(){var e=te(this._behaviors,"getEvents");return t.extend.apply(t,[{}].concat(T(e)))},_proxyBehaviorViewProperties:function(){te(this._behaviors,"proxyViewProperties")},_delegateBehaviorEntityEvents:function(){te(this._behaviors,"delegateEntityEvents")},_undelegateBehaviorEntityEvents:function(){te(this._behaviors,"undelegateEntityEvents")},_destroyBehaviors:function(e){te.apply(void 0,[this._behaviors,"destroy"].concat(T(e)))},_bindBehaviorUIElements:function(){te(this._behaviors,"bindUIElements")},_unbindBehaviorUIElements:function(){te(this._behaviors,"unbindUIElements")},_triggerEventOnBehaviors:function(){for(var e=this._behaviors,t=0,i=e&&e.length;t<i;t++)s.apply(e[t],arguments)}},ne={_delegateEntityEvents:function(e,i){this._undelegateEntityEvents(e,i);var n=t.result(this,"modelEvents");b.call(this,e,n);var s=t.result(this,"collectionEvents");b.call(this,i,s)},_undelegateEntityEvents:function(e,i){var n=t.result(this,"modelEvents");x.call(this,e,n);var s=t.result(this,"collectionEvents");x.call(this,i,s)}},se=/^(\S+)\s*(.*)$/,re=function(e){var t=e.match(se);return $(t[1],t[2])},oe={_getViewTriggers:function(e,i){return t.reduce(i,function(t,i,n){return n=re(n),t[n]=j(e,i),t},{})}},ae=function(e,i){return t.reduce(e,function(e,t,n){var s=le(n,i);return e[s]=t,e},{})},le=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},ce=function e(i,n,s){return t.each(i,function(r,o){t.isString(r)?i[o]=le(r,n):t.isObject(r)&&t.isArray(s)&&(t.extend(r,e(t.pick(r,s),n)),t.each(s,function(e){var i=r[e];t.isString(i)&&(r[e]=le(i,n))}))}),i},de={normalizeUIKeys:function(e){var t=this._getUIBindings();return ae(e,t)},normalizeUIString:function(e){var t=this._getUIBindings();return le(e,t)},normalizeUIValues:function(e,t){var i=this._getUIBindings();return ce(e,i,t)},_getUIBindings:function(){var e=t.result(this,"_uiBindings"),i=t.result(this,"ui");return e||i},_bindUIElements:function(){var e=this;if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var i=t.result(this,"_uiBindings");this._ui={},t.each(i,function(t,i){e._ui[i]=e.$(t)}),this.ui=this._ui}},_unbindUIElements:function(){var e=this;this.ui&&this._uiBindings&&(t.each(this.ui,function(t,i){delete e.ui[i]}),this.ui=this._uiBindings,delete this._uiBindings,delete this._ui)},_getUI:function(e){return this._ui[e]}},ue={supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,_isDestroyed:!1,isDestroyed:function(){return!!this._isDestroyed},_isRendered:!1,isRendered:function(){return!!this._isRendered},_isAttached:!1,isAttached:function(){return!!this._isAttached},delegateEvents:function(i){this._proxyBehaviorViewProperties(),this._buildEventProxies();var n=this._getEvents(i);"undefined"==typeof i&&(this.events=n);var s=t.extend({},this._getBehaviorEvents(),n,this._getBehaviorTriggers(),this.getTriggers());return e.View.prototype.delegateEvents.call(this,s),this},_getEvents:function(e){var i=e||this.events;return t.isFunction(i)?this.normalizeUIKeys(i.call(this)):this.normalizeUIKeys(i)},getTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(t.result(this,"triggers"));return this._getViewTriggers(this,e)}},delegateEntityEvents:function(){return this._delegateEntityEvents(this.model,this.collection),this._delegateBehaviorEntityEvents(),this},undelegateEntityEvents:function(){return this._undelegateEntityEvents(this.model,this.collection),this._undelegateBehaviorEntityEvents(),this},_ensureViewIsIntact:function(){if(this._isDestroyed)throw new G({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this._isDestroyed)return this;for(var e=!!this._isAttached,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];return this.triggerMethod.apply(this,["before:destroy",this].concat(i)),e&&this.triggerMethod("before:detach",this),this.unbindUIElements(),this._removeElement(),e&&(this._isAttached=!1,this.triggerMethod("detach",this)),this._removeChildren(),this._destroyBehaviors(i),this._isDestroyed=!0,this._isRendered=!1,this.triggerMethod.apply(this,["destroy",this].concat(i)),this.stopListening(),this},bindUIElements:function(){return this._bindUIElements(),this._bindBehaviorUIElements(),this},unbindUIElements:function(){return this._unbindUIElements(),this._unbindBehaviorUIElements(),this},getUI:function(e){return this._ensureViewIsIntact(),this._getUI(e)},childViewEventPrefix:"childview",triggerMethod:function(){var e=s.apply(this,arguments);return this._triggerEventOnBehaviors.apply(this,arguments),this._triggerEventOnParentLayout.apply(this,arguments),e},_buildEventProxies:function(){this._childViewEvents=t.result(this,"childViewEvents"),this._childViewTriggers=t.result(this,"childViewTriggers")},_triggerEventOnParentLayout:function(){var e=this._parentView();e&&e._childViewEventHandler.apply(e,arguments)},_parentView:function(){for(var e=this._parent;e;){if(e instanceof ve)return e;e=e._parent}},_childViewEventHandler:function(e){for(var i=this.normalizeMethods(this._childViewEvents),n=arguments.length,s=Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];"undefined"!=typeof i&&t.isFunction(i[e])&&i[e].apply(this,s);var o=this._childViewTriggers;o&&t.isString(o[e])&&this.triggerMethod.apply(this,[o[e]].concat(s));var a=t.result(this,"childViewEventPrefix");if(a!==!1){var l=a+":"+e;this.triggerMethod.apply(this,[l].concat(s))}}};t.extend(ue,ie,K,ne,oe,de);var he=["allowMissingEl","parentEl","replaceElement"],pe=Z.extend({cidPrefix:"mnr",replaceElement:!1,_isReplaced:!1,constructor:function(t){if(this._setOptions(t),this.mergeOptions(t,he),this._initEl=this.el=this.getOption("el"),this.el=this.el instanceof e.$?this.el[0]:this.el,!this.el)throw new G({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),Z.call(this,t)},show:function(e,t){if(this._ensureElement(t))return this._ensureView(e),e===this.currentView?this:(this.triggerMethod("before:show",this,e,t),v(e),this.empty(t),e.on("destroy",this._empty,this),e._parent=this,this._renderView(e),this._attachView(e,t),this.triggerMethod("show",this,e,t),this)},_renderView:function(e){e._isRendered||(e.supportsRenderLifecycle||r(e,"before:render",e),e.render(),e.supportsRenderLifecycle||(e._isRendered=!0,r(e,"render",e)))},_attachView:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!e._isAttached&&H(this.el),s="undefined"==typeof i.replaceElement?!!t.result(this,"replaceElement"):!!i.replaceElement;n&&r(e,"before:attach",e),s?this._replaceEl(e):this.attachHtml(e),n&&(e._isAttached=!0,r(e,"attach",e)),this.currentView=e},_ensureElement:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){var i="undefined"==typeof e.allowMissingEl?!!t.result(this,"allowMissingEl"):!!e.allowMissingEl;if(i)return!1;throw new G('An "el" must exist in DOM for this region '+this.cid)}return!0},_ensureView:function(e){if(!e)throw new G({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e._isDestroyed)throw new G({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(i){return e.$(i,t.result(this,"parentEl"))},_replaceEl:function(e){this._restoreEl();var t=this.el.parentNode;t.replaceChild(e.el,this.el),this._isReplaced=!0},_restoreEl:function(){if(this._isReplaced){var e=this.currentView;if(e){var t=e.el.parentNode;t&&(t.replaceChild(this.el,e.el),this._isReplaced=!1)}}},isReplaced:function(){return!!this._isReplaced},attachHtml:function(e){this.el.appendChild(e.el)},empty:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{allowMissingEl:!0},t=this.currentView;if(!t)return this._ensureElement(e)&&this.detachHtml(),this;var i=!e.preventDestroy;return i||L("The preventDestroy option is deprecated. Use Region#detachView"),this._empty(t,i),this},_empty:function(e,t){e.off("destroy",this._empty,this),this.triggerMethod("before:empty",this,e),this._restoreEl(),delete this.currentView,e._isDestroyed||(this._removeView(e,t),delete e._parent),this.triggerMethod("empty",this,e)},_removeView:function(e,t){return t?void(e.destroy?e.destroy():z(e)):void this._detachView(e)},detachView:function(){var e=this.currentView;if(e)return this._empty(e),e},_detachView:function(e){var t=!!e._isAttached;t&&r(e,"before:detach",e),this.detachHtml(),t&&(e._isAttached=!1,r(e,"detach",e))},detachHtml:function(){this.$el.contents().detach()},hasView:function(){return!!this.currentView},reset:function(e){return this.empty(e),this.$el&&(this.el=this._initEl),delete this.$el,this},destroy:function(e){return this.reset(e),Z.prototype.destroy.apply(this,arguments)}}),fe={regionClass:pe,_initRegions:function(){this.regions=this.regions||{},this._regions={},this.addRegions(t.result(this,"regions"))},_reInitRegions:function(){te(this._regions,"reset")},addRegion:function(e,t){var i={};return i[e]=t,this.addRegions(i)[e]},addRegions:function(e){if(!t.isEmpty(e))return e=this.normalizeUIValues(e,["selector","el"]),this.regions=t.extend({},this.regions,e),this._addRegions(e)},_addRegions:function(e){var i=this,n={regionClass:this.regionClass,parentEl:t.partial(t.result,this,"el")};return t.reduce(e,function(e,t,s){return e[s]=D(t,n),i._addRegion(e[s],s),e},{})},_addRegion:function(e,t){this.triggerMethod("before:add:region",this,t,e),e._parent=this,this._regions[t]=e,this.triggerMethod("add:region",this,t,e)},removeRegion:function(e){var t=this._regions[e];return this._removeRegion(t,e),t},removeRegions:function(){var e=this.getRegions();return t.each(this._regions,t.bind(this._removeRegion,this)),e},_removeRegion:function(e,t){this.triggerMethod("before:remove:region",this,t,e),e.destroy(),delete this.regions[t],delete this._regions[t],this.triggerMethod("remove:region",this,t,e)},emptyRegions:function(){var e=this.getRegions();return te(e,"empty"),e},hasRegion:function(e){return!!this.getRegion(e)},getRegion:function(e){return this._regions[e]},getRegions:function(){return t.clone(this._regions)},showChildView:function(e,t){for(var i=this.getRegion(e),n=arguments.length,s=Array(n>2?n-2:0),r=2;r<n;r++)s[r-2]=arguments[r];return i.show.apply(i,[t].concat(s))},detachChildView:function(e){return this.getRegion(e).detachView()},getChildView:function(e){return this.getRegion(e).currentView}},ge={render:function(e,i){if(!e)throw new G({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=t.isFunction(e)?e:ee.get(e);return n(i)}},me=["behaviors","childViewEventPrefix","childViewEvents","childViewTriggers","collectionEvents","events","modelEvents","regionClass","regions","template","templateContext","triggers","ui"],ve=e.View.extend({constructor:function(i){this.render=t.bind(this.render,this),this._setOptions(i),this.mergeOptions(i,me),v(this),this._initBehaviors(),this._initRegions();var n=Array.prototype.slice.call(arguments);n[0]=this.options,e.View.prototype.constructor.apply(this,n),this.delegateEntityEvents()},serializeData:function(){return this.model||this.collection?this.model?this.serializeModel():{items:this.serializeCollection()}:{}},serializeModel:function(){return this.model?t.clone(this.model.attributes):{}},serializeCollection:function(){return this.collection?this.collection.map(function(e){return t.clone(e.attributes)}):{}},setElement:function(){var t=!!this.el;return e.View.prototype.setElement.apply(this,arguments),t&&(this._isRendered=!!this.$el.length,this._isAttached=H(this.el)),this._isRendered&&this.bindUIElements(),this},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._isRendered&&this._reInitRegions(),this._renderTemplate(),this.bindUIElements(),this._isRendered=!0,this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){var t=this.mixinTemplateContext(this.serializeData()),i=ge.render(e,t,this);this.attachElContent(i)}},getTemplate:function(){return this.template},mixinTemplateContext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.result(this,"templateContext");return t.extend(e,i)},attachElContent:function(e){return this.$el.html(e),this},_removeChildren:function(){this.removeRegions()},_getImmediateChildren:function(){return t.chain(this.getRegions()).map("currentView").compact().value()}});t.extend(ve.prototype,ue,fe);var we=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"],ye=function(e,i){t.each(we,function(n){e[n]=function(){var e=t.values(t.result(this,i)),s=[e].concat(t.toArray(arguments));return t[n].apply(t,s)}})},be=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,t.bind(this.add,this))};ye(be.prototype,"_views"),t.extend(be.prototype,{add:function(e,t){return this._add(e,t)._updateLength()},_add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){return this._remove(e)._updateLength()},_remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.some(this._indexByCustom,t.bind(function(e,t){if(e===i)return delete this._indexByCustom[t],!0},this)),delete this._views[i],this},_updateLength:function(){return this.length=t.size(this._views),this}});var xe=["behaviors","childView","childViewEventPrefix","childViewEvents","childViewOptions","childViewTriggers","collectionEvents","events","filter","emptyView","emptyViewOptions","modelEvents","reorderOnSort","sort","triggers","ui","viewComparator"],_e=e.View.extend({sort:!0,constructor:function(i){this.render=t.bind(this.render,this),this._setOptions(i),this.mergeOptions(i,xe),v(this),this._initBehaviors(),this.once("render",this._initialEvents),this._initChildViewStorage(),this._bufferedChildren=[];var n=Array.prototype.slice.call(arguments);n[0]=this.options,e.View.prototype.constructor.apply(this,n),this.delegateEntityEvents()},_startBuffering:function(){this._isBuffering=!0},_endBuffering:function(){var e=!!this._isAttached,i=e?this._getImmediateChildren():[];this._isBuffering=!1,t.each(i,function(e){r(e,"before:attach",e)}),this.attachBuffer(this,this._createBuffer()),t.each(i,function(e){e._isAttached=!0,r(e,"attach",e)}),this._bufferedChildren=[]},_getImmediateChildren:function(){return t.values(this.children._views)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"update",this._onCollectionUpdate),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,i,n){var s=void 0!==n.at&&(n.index||i.indexOf(e));(this.filter||s===!1)&&(s=t.indexOf(this._filteredSortedModels(s),e)),this._shouldAddChild(e,s)&&(this._destroyEmptyView(),this._addChild(e,s))},_onCollectionUpdate:function(e,t){var i=t.changes;this._removeChildModels(i.removed)},_removeChildModels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.checkEmpty,n=i!==!1,s=this._getRemovedViews(e);s.length&&(this.children._updateLength(),this._updateIndices(s,!1),n&&this._checkEmpty())},_getRemovedViews:function(e){var i=this;return t.reduce(e,function(e,t){var n=i.children.findByModel(t);return!n||n._isDestroyed?e:(i._removeChildView(n),e.push(n),e)},[])},_findGreatestIndexedView:function(e){return t.reduce(e,function(e,t){return!e||e._index<t._index?t:e},void 0)},_removeChildView:function(e){this.triggerMethod("before:remove:child",this,e),this.children._remove(e),e.destroy?e.destroy():z(e),delete e._parent,this.stopListening(e),this.triggerMethod("remove:child",this,e)},setElement:function(){var t=!!this.el;return e.View.prototype.setElement.apply(this,arguments),t&&(this._isAttached=H(this.el)),this},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this._isRendered=!0,this.triggerMethod("render",this),this},setFilter:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.preventRender,n=this._isRendered&&!this._isDestroyed,s=this.filter!==e,r=n&&s&&!i;if(r){var o=this._filteredSortedModels();this.filter=e;var a=this._filteredSortedModels();this._applyModelDeltas(a,o)}else this.filter=e;return this},removeFilter:function(e){return this.setFilter(null,e)},_applyModelDeltas:function(e,i){var n=this,s={};t.each(e,function(e,t){var i=!n.children.findByModel(e);i&&n._onCollectionAdd(e,n.collection,{at:t}),s[e.cid]=!0});var r=t.filter(i,function(e){return!s[e.cid]&&n.children.findByModel(e)});this._removeChildModels(r)},reorder:function(){var e=this,i=this.children,n=this._filteredSortedModels();if(!n.length&&this._showingEmptyView)return this;var s=t.some(n,function(e){return!i.findByModel(e)});return s?this.render():!function(){var s=[],r=i.reduce(function(e,i){var r=t.indexOf(n,i.model);return r===-1?(s.push(i.model),e):(i._index=r,e[r]=i.el,e)},new Array(n.length));e.triggerMethod("before:reorder",e),e._appendReorderedChildren(r),e._removeChildModels(s),e.triggerMethod("reorder",e)}(),this},resortView:function(){return this.reorderOnSort?this.reorder():this._renderChildren(),this},_sortViews:function(){var e=this,i=this._filteredSortedModels(),n=t.find(i,function(t,i){var n=e.children.findByModel(t);return!n||n._index!==i});n&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this._isRendered&&(this._destroyEmptyView(),this._destroyChildren({checkEmpty:!1}));var e=this._filteredSortedModels();this.isEmpty({processedModels:e})?this._showEmptyView():(this.triggerMethod("before:render:children",this),this._startBuffering(),this._showCollection(e),this._endBuffering(),this.triggerMethod("render:children",this))},_createView:function(e,t){var i=this._getChildView(e),n=this._getChildViewOptions(e,t),s=this.buildChildView(e,i,n);return s},_setupChildView:function(e,t){e._parent=this,v(e),this._proxyChildEvents(e),this.sort&&(e._index=t)},_showCollection:function(e){t.each(e,t.bind(this._addChild,this)),this.children._updateLength()},_filteredSortedModels:function(e){if(!this.collection||!this.collection.length)return[];var t=this.getViewComparator(),i=this.collection.models;if(e=Math.min(Math.max(e,0),i.length-1),t){var n=void 0;e&&(n=i[e],i=i.slice(0,e).concat(i.slice(e+1))),i=this._sortModelsBy(i,t),n&&i.splice(e,0,n)}return i=this._filterModels(i)},getViewComparator:function(){return this.viewComparator},_filterModels:function(e){var i=this;return this.filter&&(e=t.filter(e,function(e,t){return i._shouldAddChild(e,t)})),e},_sortModelsBy:function(e,i){return"string"==typeof i?t.sortBy(e,function(e){return e.get(i)}):1===i.length?t.sortBy(e,t.bind(i,this)):e.sort(t.bind(i,this))},_showEmptyView:function(){var i=this._getEmptyView();if(i&&!this._showingEmptyView){this._showingEmptyView=!0;var n=new e.Model,s=this.emptyViewOptions||this.childViewOptions;t.isFunction(s)&&(s=s.call(this,n,this._emptyViewIndex));var r=this.buildChildView(n,i,s);this.triggerMethod("before:render:empty",this,r),this.addChildView(r,0),this.triggerMethod("render:empty",this,r)}},_destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty",this),this._destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty",this))},_getEmptyView:function(){var e=this.emptyView;if(e)return this._getView(e)},_getChildView:function(e){var t=this.childView;if(!t)throw new G({name:"NoChildViewError",message:'A "childView" must be specified'});if(t=this._getView(t,e),!t)throw new G({name:"InvalidChildViewError",message:'"childView" must be a view class or a function that returns a view class'});return t},_getView:function(i,n){return i.prototype instanceof e.View||i===e.View?i:t.isFunction(i)?i.call(this,n):void 0},_addChild:function(e,t){var i=this._createView(e,t);return this.addChildView(i,t),i},_getChildViewOptions:function(e,i){return t.isFunction(this.childViewOptions)?this.childViewOptions(e,i):this.childViewOptions},addChildView:function(e,t){return this.triggerMethod("before:add:child",this,e),this._setupChildView(e,t),this._isBuffering?this.children._add(e):(this._updateIndices(e,!0),this.children.add(e)),this._renderView(e),this._attachView(e,t),this.triggerMethod("add:child",this,e),e},_updateIndices:function(e,i){if(this.sort){var n=t.isArray(e)?this._findGreatestIndexedView(e):e;this.children.each(function(e){e._index>=n._index&&(e._index+=i?1:-1)})}},_renderView:function(e){e._isRendered||(e.supportsRenderLifecycle||r(e,"before:render",e),e.render(),e.supportsRenderLifecycle||(e._isRendered=!0,r(e,"render",e)))},_attachView:function(e,t){var i=!e._isAttached&&!this._isBuffering&&this._isAttached;i&&r(e,"before:attach",e),this.attachHtml(this,e,t),i&&(e._isAttached=!0,r(e,"attach",e))},buildChildView:function(e,i,n){var s=t.extend({model:e},n);return new i(s)},removeChildView:function(e){return!e||e._isDestroyed?e:(this._removeChildView(e),this.children._updateLength(),this._updateIndices(e,!1),e)},isEmpty:function(e){var i=void 0;return t.result(e,"processedModels")?i=e.processedModels:(i=this.collection?this.collection.models:[],i=this._filterModels(i)),0===i.length},_checkEmpty:function(){this.isEmpty()&&this._showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return t.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e._isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){
var i=void 0,n=this.sort&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),!!i&&(i.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new be},_removeChildren:function(){this._destroyChildren({checkEmpty:!1})},_destroyChildren:function(e){if(this.children.length){this.triggerMethod("before:destroy:children",this);var t=this.children.map("model");this._removeChildModels(t,e),this.triggerMethod("destroy:children",this)}},_shouldAddChild:function(e,i){var n=this.filter;return!t.isFunction(n)||n.call(this,e,i,this.collection)},_proxyChildEvents:function(e){this.listenTo(e,"all",this._childViewEventHandler)}});t.extend(_e.prototype,ue);var Ce=["childViewContainer","template","templateContext"],ke=_e.extend({constructor:function(e){L("CompositeView is deprecated. Convert to View at your earliest convenience"),this.mergeOptions(e,Ce),_e.prototype.constructor.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"update",this._onCollectionUpdate),this.listenTo(this.collection,"reset",this.renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_getChildView:function(e){var t=this.childView;if(!t)return this.constructor;if(t=this._getView(t,e),!t)throw new G({name:"InvalidChildViewError",message:'"childView" must be a view class or a function that returns a view class'});return t},serializeData:function(){return this.serializeModel()},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.renderChildren(),this._isRendering=!1,this._isRendered=!0,this.triggerMethod("render",this),this},renderChildren:function(){(this._isRendered||this._isRendering)&&_e.prototype._renderChildren.call(this)},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,i){if(e.$childViewContainer)return e.$childViewContainer;var n=void 0,s=e.childViewContainer;if(s){var r=t.result(e,"childViewContainer");if(n="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r),n.length<=0)throw new G({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else n=e.$el;return e.$childViewContainer=n,n},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),Te=t.pick(ve.prototype,"serializeModel","getTemplate","_renderTemplate","mixinTemplateContext","attachElContent");t.extend(ke.prototype,Te);var Se=["collectionEvents","events","modelEvents","triggers","ui"],Ee=Z.extend({cidPrefix:"mnb",constructor:function(e,i){this.view=i,this.defaults=t.clone(t.result(this,"defaults",{})),this._setOptions(this.defaults,e),this.mergeOptions(this.options,Se),this.ui=t.extend({},t.result(this,"ui"),t.result(i,"ui")),Z.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(){return this.$el=this.view.$el,this.el=this.view.el,this},bindUIElements:function(){return this._bindUIElements(),this},unbindUIElements:function(){return this._unbindUIElements(),this},getUI:function(e){return this.view._ensureViewIsIntact(),this._getUI(e)},delegateEntityEvents:function(){return this._delegateEntityEvents(this.view.model,this.view.collection),this},undelegateEntityEvents:function(){return this._undelegateEntityEvents(this.view.model,this.view.collection),this},getEvents:function(){var e=this,i=this.normalizeUIKeys(t.result(this,"events"));return t.reduce(i,function(i,n,s){if(t.isFunction(n)||(n=e[n]),n)return s=re(s),i[s]=t.bind(n,e),i},{})},getTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(t.result(this,"triggers"));return this._getViewTriggers(this.view,e)}}});t.extend(Ee.prototype,ne,oe,de);var $e=["region","regionClass"],je=Z.extend({cidPrefix:"mna",constructor:function(e){this._setOptions(e),this.mergeOptions(e,$e),this._initRegion(),Z.prototype.constructor.apply(this,arguments)},regionClass:pe,_initRegion:function(){var e=this.region;if(e){var t={regionClass:this.regionClass};this._region=D(e,t)}},getRegion:function(){return this._region},showView:function(e){for(var t=this.getRegion(),i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return t.show.apply(t,[e].concat(n))},getView:function(){return this.getRegion().currentView},start:function(e){return this.triggerMethod("before:start",this,e),this.triggerMethod("start",this,e),this}}),ze=["appRoutes","controller"],De=e.Router.extend({constructor:function(t){this._setOptions(t),this.mergeOptions(t,ze),e.Router.apply(this,arguments);var i=this.appRoutes,n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();return this._addAppRoute(i,e,t),this},_processOnRoute:function(e,i){if(t.isFunction(this.onRoute)){var n=t.invert(this.appRoutes)[e];this.onRoute(e,n,i)}},processAppRoutes:function(e,i){var n=this;if(!i)return this;var s=t.keys(i).reverse();return t.each(s,function(t){n._addAppRoute(e,t,i[t])}),this},_getController:function(){return this.controller},_addAppRoute:function(e,i,n){var s=e[n];if(!s)throw new G('Method "'+n+'" was not found on the controller');this.route(i,n,t.bind(s,e))},triggerMethod:s});t.extend(De.prototype,K);var Pe={},Ie=e.Marionette,Oe=e.Marionette={};return Oe.noConflict=function(){return e.Marionette=Ie,this},Oe.bindEvents=M(b),Oe.unbindEvents=M(x),Oe.bindRequests=M(C),Oe.unbindRequests=M(k),Oe.mergeOptions=M(B),Oe.getOption=M(V),Oe.normalizeMethods=M(U),Oe.extend=N,Oe.isNodeAttached=H,Oe.deprecate=L,Oe.triggerMethod=M(s),Oe.triggerMethodOn=r,Oe.isEnabled=R,Oe.setEnabled=A,Oe.monitorViewEvents=v,Oe.Behaviors={},Oe.Behaviors.behaviorsLookup=O,Oe.Application=je,Oe.AppRouter=De,Oe.Renderer=ge,Oe.TemplateCache=ee,Oe.View=ve,Oe.CollectionView=_e,Oe.CompositeView=ke,Oe.Behavior=Ee,Oe.Region=pe,Oe.Error=G,Oe.Object=Z,Oe.DEV_MODE=!1,Oe.FEATURES=Pe,Oe.VERSION=F,Oe}),function(e,t){"undefined"!=typeof exports?t(_,Backbone):"function"==typeof define&&define.amd?define(["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(e._,e.Backbone)}(this,function(e,t){var i=function(t,i,r){var o,a,l,c=t.attributes,d=t._associations,u=[];for(a in d)l=d[a],o=i[a],n(l,c[a])?n(l,o)?(c[a]=o,u.push(a)):o&&null!==o&&(c[a].set(o,r),u.push(a)):i[a]=s(t,l,o,r);return e.omit(i,u)},n=function(e,t){return t instanceof e.type},s=function(t,i,n,s){var r=new i.type(n,s);return i.url&&(r.url=function(){return e.result(t,"url")+e.result(i,"url")}),r},r=function(t,i,n){var s=t[n],r=e.wrap(s,i);r.unwrap=function(){t[n]=s},t[n]=r},o={set:function(t,n,s,r){var o=this,a={};return e.isObject(n)?e.extend(a,n):a[n]=s,!e.isObject(s)||"undefined"!=typeof r&&null!==r||(r=s),t.call(o,i(o,a,r),r)},toJSON:function(e,t){var i,s=this,r=s._associations,o=e.call(s,t);for(i in r)n(r[i],o[i])&&(o[i]=o[i].toJSON());return o}},a=function(t,n,s){var a,l=this,c=e.clone(o);for(a in l._associations)c[a]=e.partial(l.get,a);return e.each(c,e.partial(r,l)),i(l,l.attributes,s),t.call(l,n,s)};return t.associate=function(t,i){var n=t.prototype;n._associations||(r(n,a,"initialize"),n._associations={}),e.extend(n._associations,i)},t.dissociate=function(e){var t=e.prototype;t.initialize.unwrap(),t._associations=null},t}),function(e){"use strict";String.prototype.repl=function(e,t){return this.split(e).join(t)};var t=function(e){var t,i=document.createElement("div");return i.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",t=1===i.getElementsByTagName("i").length,document.body.appendChild(i),i.parentNode.removeChild(i),t},i=function(){return window.File&&window.FileReader},n=function(){var e=document.createElement("div");return!t(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},s=function(){return i&&window.FormData},r=function(e,t){e.removeClass(t).addClass(t)},o='style="width:{width};height:{height};"',a='      <param name="controller" value="true" />\n      <param name="allowFullScreen" value="true" />\n      <param name="allowScriptAccess" value="always" />\n      <param name="autoPlay" value="false" />\n      <param name="autoStart" value="false" />\n      <param name="quality" value="high" />\n',l='<div class="file-preview-other">\n       <i class="w2ui-icon-file"></i>\n   </div>',c={removeIcon:'<i class="w2ui-icon-trash text-danger"></i>',removeClass:"btn btn-icon-only btn-red",removeTitle:"Remove file",uploadIcon:'<i class="w2ui-icon-upload text-info"></i>',uploadClass:"btn btn-icon-only btn-orange",uploadTitle:"Upload file",indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign file-icon-large text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."},d='{preview}\n<div class="kv-upload-progress hide"></div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   </div>\n</div>',u='{preview}\n<div class="kv-upload-progress hide"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',h='<div class="file-preview {class}">\n    <div class="closebtn fileinput-remove">&times;</div>\n    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',p='<span class="w2ui-icon-file kv-caption-icon"></span>',f='<div tabindex="-1" class="form-control file-caption {class}">\n   <span class="file-caption-ellipsis">&hellip;</span>\n   <div class="file-caption-name"></div>\n</div>',g='<div id="{id}" class="modal fade">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="closebtn" data-dismiss="modal" aria-hidden="true">&times;</button>\n        <h3 class="modal-title">Detailed Preview <small>{title}</small></h3>\n      </div>\n      <div class="modal-body">\n        <textarea class="form-control" style="font-family:Monaco,Consolas,monospace; height: {height}px;" readonly>{body}</textarea>\n      </div>\n    </div>\n  </div>\n</div>',m='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {percent}%\n     </div>\n</div>',v='<div class="file-thumbnail-footer">\n    <div class="file-caption-name">{caption}</div>\n    {actions}\n</div>',w='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload}{delete}{other}    </div>\n    <div class="file-upload-indicator" tabindex="-1" title="{indicatorTitle}">{indicator}</div>\n    <div class="clearfix"></div>\n</div>',y='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}"{dataUrl}{dataKey}>{removeIcon}</button>\n',b='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">   {uploadIcon}\n</button>\n',x='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   {content}\n   {footer}\n</div>\n',_='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n    <object data="{data}" type="{type}" width="{width}" height="{height}">\n       '+l+"\n    </object>\n   {footer}\n</div>",C='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <img src="{data}" class="file-preview-image" title="{caption}" alt="{caption}" '+o+">\n   {footer}\n</div>\n",k='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}">\n   <div class="file-preview-text" title="{caption}" '+o+">\n       {data}\n   </div>\n   {footer}\n</div>",T='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+o+'>\n   <video width="{width}" height="{height}" controls>\n       <source src="{data}" type="{type}">\n       '+l+"\n   </video>\n   {footer}\n</div>\n",S='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+o+'>\n   <audio controls>\n       <source src="{data}" type="{type}">\n       '+l+"\n   </audio>\n   {footer}\n</div>",E='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+o+'>\n   <object type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+a+"       "+l+"\n   </object>\n   {footer}\n</div>\n",$='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+o+'>\n   <object data="{data}" type="{type}" width="{width}" height="{height}">\n       <param name="movie" value="{caption}" />\n'+a+"         "+l+"\n   </object>\n   {footer}\n</div>",j='<div class="file-preview-frame{frameClass}" id="{previewId}" data-fileindex="{fileindex}" title="{caption}" '+o+">\n   "+l+"\n   {footer}\n</div>",z={main1:d,main2:u,preview:h,icon:p,caption:f,modal:g,progress:m,footer:v,actions:w,actionDelete:y,actionUpload:b},D={generic:x,html:_,image:C,text:k,video:T,audio:S,flash:E,object:$,other:j},P=["image","html","text","video","audio","flash","object"],I={image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"160px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},O={image:function(e,t){return void 0!==e?e.match("image.*"):t.match(/\.(gif|png|jpe?g)$/i)},html:function(e,t){return void 0!==e?"text/html"===e:t.match(/\.(htm|html)$/i)},text:function(e,t){return void 0!==e&&e.match("text.*")||t.match(/\.(txt|md|csv|nfo|php|ini)$/i)},video:function(e,t){return void 0!==e&&e.match(/\.video\/(ogg|mp4|webm)$/i)||t.match(/\.(og?|mp4|webm)$/i)},audio:function(e,t){return void 0!==e&&e.match(/\.audio\/(ogg|mp3|wav)$/i)||t.match(/\.(ogg|mp3|wav)$/i)},flash:function(e,t){return void 0!==e&&"application/x-shockwave-flash"===e||t.match(/\.(swf)$/i)},object:function(){return!0},other:function(){return!0}},R=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},A=function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},F=function(e,t){return"object"==typeof t&&e in t},M=function(t,i,n){return R(t)||R(t[i])?n:e(t[i])},N=function(){return Math.round((new Date).getTime()+100*Math.random())},L=function(e){return String(e).repl("&","&amp;").repl('"',"&quot;").repl("'","&#39;").repl("<","&lt;").repl(">","&gt;")},H=function(t,i){var n=t;return e.each(i,function(e,t){"function"==typeof t&&(t=t()),n=n.repl(e,t)}),n},B=window.URL||window.webkitURL,V=function(n,s){this.$element=e(n),i()||t(9)?(this.init(s),this.listen()):this.$element.removeClass("file-loading")};V.prototype={constructor:V,init:function(i){var o,a,l=this,d=l.$element;e.each(i,function(e,t){l[e]=t}),R(l.allowedPreviewTypes)&&(l.allowedPreviewTypes=P),l.uploadFileAttr=R(d.attr("name"))?"file_data":d.attr("name"),l.reader=null,l.formdata={},l.isIE9=t(9),l.isIE10=t(10),l.filestack=[],l.ajaxRequests=[],l.isError=!1,l.dropZoneEnabled=n()&&l.dropZoneEnabled,l.isDisabled=l.$element.attr("disabled")||l.$element.attr("readonly"),l.isUploadable=s&&!R(l.uploadUrl),l.slug="function"==typeof i.slugCallback?i.slugCallback:l.slugDefault,l.mainTemplate=l.showCaption?l.getLayoutTemplate("main1"):l.getLayoutTemplate("main2"),l.captionTemplate=l.getLayoutTemplate("caption"),l.previewGenericTemplate=l.getPreviewTemplate("generic"),R(l.$element.attr("id"))&&l.$element.attr("id",N()),void 0===l.$container?l.$container=l.createContainer():l.refreshContainer(),l.$progress=l.$container.find(".kv-upload-progress"),l.$btnUpload=l.$container.find(".kv-fileinput-upload"),l.$captionContainer=M(i,"elCaptionContainer",l.$container.find(".file-caption")),l.$caption=M(i,"elCaptionText",l.$container.find(".file-caption-name")),l.$previewContainer=M(i,"elPreviewContainer",l.$container.find(".file-preview")),l.$preview=M(i,"elPreviewImage",l.$container.find(".file-preview-thumbnails")),l.$previewStatus=M(i,"elPreviewStatus",l.$container.find(".file-preview-status")),l.$errorContainer=M(i,"elErrorContainer",l.$previewContainer.find(".kv-fileinput-error")),R(l.msgErrorClass)||r(l.$errorContainer,l.msgErrorClass),l.$errorContainer.hide(),l.initialPreviewContent="",o=l.initialPreview,l.initialPreviewCount=A(o)?o.length:o.length>0?o.split(l.initialPreviewDelimiter).length:0,l.fileActionSettings=e.extend(c,i.fileActionSettings),l.previewInitId="preview-"+N(),l.initPreview(),l.initPreviewDeletes(),l.original={preview:l.$preview.html(),caption:l.$caption.html()},l.options=i,l.setFileDropZoneTitle(),l.uploadCount=0,l.uploadPercent=0,l.$element.removeClass("file-loading"),a=l.getLayoutTemplate("progress"),l.progressTemplate=a.replace("{class}",l.progressClass),l.progressCompleteTemplate=a.replace("{class}",l.progressCompleteClass),l.setEllipsis()},raise:function(e,t){var i=this;void 0!==t?i.$element.trigger(e,t):i.$element.trigger(e)},getLayoutTemplate:function(e){var t=this,i=F(e,t.layoutTemplates)?t.layoutTemplates[e]:z[e];return R(t.customLayoutTags)?i:H(i,t.customLayoutTags)},getPreviewTemplate:function(e){var t=this,i=F(e,t.previewTemplates)?t.previewTemplates[e]:D[e];return R(t.customPreviewTags)?i:H(i,t.customPreviewTags)},getOutData:function(e,t,i){var n=this;return e=e||{},t=t||{},i=i||n.filestack.slice(0),{form:n.formdata,files:i,extra:n.getExtraData(),response:t,reader:n.reader,jqXHR:e}},setEllipsis:function(){var e=this,t=e.$captionContainer,i=e.$caption,n=i.clone().css("height","auto").hide();t.parent().before(n),t.removeClass("kv-has-ellipsis"),n.outerWidth()>i.outerWidth()&&t.addClass("kv-has-ellipsis"),n.remove()},listen:function(){var t=this,i=t.$element,n=t.$captionContainer,s=t.$btnFile;i.on("change",e.proxy(t.change,t)),e(window).on("resize",function(){t.setEllipsis()}),s.off("click").on("click",function(){t.raise("filebrowse"),t.isError&&!t.isUploadable&&t.clear(!0),n.focus()}),i.closest("form").off("reset").on("reset",e.proxy(t.reset,t)),t.$container.off("click").on("click",".fileinput-remove:not([disabled])",e.proxy(t.clear,t)).on("click",".fileinput-cancel",e.proxy(t.cancel,t)),t.isUploadable&&t.dropZoneEnabled&&t.showPreview&&t.initDragDrop(),t.isUploadable&&t.$container.find(".kv-fileinput-upload").off("click").on("click",function(i){t.isUploadable&&(i.preventDefault(),!e(this).hasClass("disabled")&&R(e(this).attr("disabled"))&&t.upload())})},setProgress:function(e){var t=this,i=Math.min(e,100),n=i<100?t.progressTemplate:t.progressCompleteTemplate;t.$progress.html(n.repl("{percent}",i))},upload:function(){var e,t,i,n=this,s=n.getFileStack().length;if(n.isUploadable&&!n.isDisabled&&0!==s)if(n.resetUpload(),n.$progress.removeClass("hide"),n.uploadCount=0,n.uploadPercent=0,n.lock(),n.setProgress(0),i=n.filestack.length,!n.uploadAsync&&1!==s||!n.showPreview)n.uploadBatch();else for(t=n.getOutData(),n.raise("filebatchpreupload",[t]),e=0;e<i;e+=1)void 0!==n.filestack[e]&&n.uploadSingle(e,n.filestack,!0)},lock:function(){var e=this;e.resetErrors(),e.disable(),e.showRemove&&r(e.$container.find(".fileinput-remove"),"hide"),e.showCancel&&e.$container.find(".fileinput-cancel").removeClass("hide"),e.raise("filelock",[e.filestack,e.getExtraData()])},unlock:function(e){var t=this;void 0===e&&(e=!0),t.enable(),t.showCancel&&r(t.$container.find(".fileinput-cancel"),"hide"),t.showRemove&&t.$container.find(".fileinput-remove").removeClass("hide"),e&&t.resetFileStack(),t.raise("fileunlock",[t.filestack,t.getExtraData()])},resetFileStack:function(){var t=this,i=0,n=[];t.$preview.find(".file-preview-frame").each(function(){var s=e(this),r=s.attr("data-fileindex"),o=t.filestack[r];r!=-1&&(void 0!==o?(n[i]=o,s.attr({id:t.previewInitId+"-"+i,"data-fileindex":i}),i+=1):s.attr({id:"uploaded-"+N(),"data-fileindex":"-1"}))}),t.filestack=n},refresh:function(t){var i,n=this,s=n.$element,r=arguments.length?e.extend(n.options,t):n.options;s.off(),n.init(r),i=n.$container.find(".file-drop-zone"),i.off("dragenter dragover drop"),e(document).off("dragenter dragover drop"),n.listen(),n.setFileDropZoneTitle()},initDragDrop:function(){var t=this,i=t.$container.find(".file-drop-zone");i.off("dragenter dragover drop"),e(document).off("dragenter dragover drop"),i.on("dragenter dragover",function(i){i.stopPropagation(),i.preventDefault(),t.isDisabled||r(e(this),"highlighted")}),i.on("dragleave",function(i){i.stopPropagation(),i.preventDefault(),t.isDisabled||e(this).removeClass("highlighted")}),i.on("drop",function(i){i.preventDefault(),t.isDisabled||(t.change(i,"dragdrop"),e(this).removeClass("highlighted"))}),e(document).on("dragenter dragover drop",function(e){e.stopPropagation(),e.preventDefault()})},setFileDropZoneTitle:function(){var e=this,t=e.$container.find(".file-drop-zone");t.find("."+e.dropZoneTitleClass).remove(),e.isUploadable&&e.showPreview&&0!==t.length&&!(e.getFileStack().length>0)&&e.dropZoneEnabled&&(0===t.find(".file-preview-frame").length&&t.prepend('<div class="'+e.dropZoneTitleClass+'">'+e.dropZoneTitle+"</div>"),e.$container.removeClass("file-input-new"),r(e.$container,"file-input-ajax-new"))},initFileActions:function(){var t=this;t.$preview.find(".kv-file-remove").each(function(){var i,n,s=e(this),r=s.closest(".file-preview-frame"),o=r.attr("data-fileindex");s.off("click").on("click",function(){r.fadeOut("slow",function(){t.filestack[o]=void 0,t.clearObjects(r),r.remove();var e=t.getFileStack(),s=e.length,a=t.$container.find(".file-preview-initial").length;0===s&&0===a?(t.original.preview="",t.reset()):(i=t.initialPreviewCount+s,n=i>1?t.msgSelected.repl("{n}",i):e[0].name,t.setCaption(n))})})}),t.$preview.find(".kv-file-upload").each(function(){var i=e(this);i.off("click").on("click",function(){var e=i.closest(".file-preview-frame"),n=e.attr("data-fileindex");t.uploadSingle(n,t.filestack,!1)})})},renderInitFileFooter:function(e){if(0===this.initialPreviewConfig.length||R(this.initialPreviewConfig[e]))return"";var t=this,i=t.getLayoutTemplate("footer"),n=t.initialPreviewConfig[e],s=F("caption",n)?n.caption:"",r=F("width",n)?n.width:"auto",o=!!F("url",n)&&n.url,a=F("key",n)?n.key:null,l=o===!1,c=t.initialPreviewShowDelete?t.renderFileActions(!1,!0,l,o,a):"",d=i.repl("{actions}",c);return d.repl("{caption}",s).repl("{width}",r).repl("{indicator}","").repl("{indicatorTitle}","")},renderFileFooter:function(e,t){var i,n=this,s=n.fileActionSettings,r=n.getLayoutTemplate("footer");return n.isUploadable?(i=r.repl("{actions}",n.renderFileActions(!0,!0,!1,!1,!1)),i.repl("{caption}",e).repl("{width}",t).repl("{indicator}",s.indicatorNew).repl("{indicatorTitle}",s.indicatorNewTitle)):r.repl("{actions}","").repl("{caption}",e).repl("{width}",t).repl("{indicator}","").repl("{indicatorTitle}","")},renderFileActions:function(e,t,i,n,s){if(!e&&!t)return"";var r=this,o=n===!1?"":' data-url="'+n+'"',a=s===!1?"":' data-key="'+s+'"',l=r.getLayoutTemplate("actionDelete"),c="",d=r.getLayoutTemplate("actions"),u=r.otherActionButtons.repl("{dataKey}",a),h=r.fileActionSettings,p=i?h.removeClass+" disabled":h.removeClass;return l=l.repl("{removeClass}",p).repl("{removeIcon}",h.removeIcon).repl("{removeTitle}",h.removeTitle).repl("{dataUrl}",o).repl("{dataKey}",a),e&&(c=r.getLayoutTemplate("actionUpload").repl("{uploadClass}",h.uploadClass).repl("{uploadIcon}",h.uploadIcon).repl("{uploadTitle}",h.uploadTitle)),d.repl("{delete}",l).repl("{upload}",c).repl("{other}",u)},getInitialPreview:function(e,t,i){var n=this,s="init_"+i,r=n.previewInitId+"-"+s,o=n.renderInitFileFooter(i,!1);return e.repl("{previewId}",r).repl("{frameClass}"," file-preview-initial").repl("{fileindex}",s).repl("{content}",t).repl("{footer}",o)},initPreview:function(){var e,t,i=this,n="",s=i.initialPreview,r=i.initialPreviewCount,o=i.initialCaption.length,a=o>0?i.initialCaption:i.msgSelected.repl("{n}",r);if(A(s)&&r>0){for(e=0;e<r;e+=1)n+=i.getInitialPreview(i.previewGenericTemplate,s[e],e);r>1&&0===o&&(a=i.msgSelected.repl("{n}",r))}else{if(!(r>0))return void(o>0&&i.setCaption(a));for(t=s.split(i.initialPreviewDelimiter),e=0;e<r;e+=1)n+=i.getInitialPreview(i.previewGenericTemplate,t[e],e);r>1&&0===o&&(a=i.msgSelected.repl("{n}",r))}i.initialPreviewContent=n,i.$preview.html(n),i.setCaption(a),i.$container.removeClass("file-input-new")},initPreviewDeletes:function(){var t=this,i=function(){0===t.$preview.find(".kv-file-remove").length&&t.reset()};t.$preview.find(".kv-file-remove").each(function(){var n,s=e(this),o=s.closest(".file-preview-frame"),a=s.attr("data-url"),l=s.attr("data-key");void 0!==a&&void 0!==l&&s.off("click").on("click",function(){e.ajax({url:a,type:"POST",dataType:"json",data:{key:l},beforeSend:function(e){r(o,"file-uploading"),r(s,"disabled"),t.raise("filepredelete",[l,e])},success:function(r,a,c){void 0===r.error?t.raise("filedeleted",[l,c]):(t.showError(r.error,null,s.attr("id"),l,"filedeleteerror",c),i()),o.removeClass("file-uploading").addClass("file-deleted"),o.fadeOut("slow",function(){t.clearObjects(o),o.remove(),n=e(document.createElement("div")).html(t.original.preview),n.find(".file-preview-frame").each(function(){var t=e(this);t.find(".kv-file-remove").attr("data-key")==l&&t.remove()}),t.initialPreviewContent=n.html(),t.initialPreviewCount>0&&(t.initialPreviewCount-=1);var s=t.initialCaption;0===t.initialCaption.length&&(s=t.msgSelected.repl("{n}",t.initialPreviewCount)),t.original.preview=n.html(),t.setCaption(s),t.original.caption=t.$caption.html(),n.remove(),i()})},error:function(e,n,r){t.showError(r,null,s.attr("id"),l,"filedeleteerror",e),o.removeClass("file-uploading"),i()}})})})},clearObjects:function(t){t.find("video audio").each(function(){this.pause(),e(this).remove()}),t.find("img object div").each(function(){e(this).remove()})},clearFileInput:function(){var t,i,n,s=this,r=s.$element;R(r.val())||(s.isIE9||s.isIE10?(t=r.closest("form"),i=e(document.createElement("form")),n=e(document.createElement("div")),r.before(n),t.length?t.after(i):n.after(i),i.append(r).trigger("reset"),n.before(r).remove(),i.remove()):r.val(""))},resetUpload:function(){var e=this;e.uploadCount=0,e.uploadPercent=0,e.$btnUpload.removeAttr("disabled"),e.setProgress(0),r(e.$progress,"hide"),e.resetErrors(!1),e.ajaxRequests=[]},cancel:function(){var t,i=this,n=i.ajaxRequests,s=n.length;if(s>0)for(t=0;t<s;t+=1)n[t].abort();i.$preview.find(".file-preview-frame").each(function(){var t=e(this),n=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==i.filestack[n]&&(t.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),t.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),i.unlock()})},clear:function(t){var i,n=this;!n.isIE9&&n.reader instanceof FileReader&&n.reader.abort(),n.$btnUpload.removeAttr("disabled"),n.resetUpload(),n.filestack=[],n.clearFileInput(),n.resetErrors(!0),t!==!0&&(n.raise("change"),n.raise("fileclear")),n.overwriteInitial&&(n.initialPreviewCount=0,n.initialPreviewContent=""),!n.overwriteInitial&&n.initialPreviewContent.length>0?(n.showFileIcon(),n.$preview.html(n.original.preview),n.$caption.html(n.original.caption),n.setEllipsis(),n.initPreviewDeletes(),n.$container.removeClass("file-input-new")):(n.$preview.find(".file-preview-frame").each(function(){n.clearObjects(e(this))}),n.$preview.html(""),i=!n.overwriteInitial&&n.initialCaption.length>0?n.original.caption:"",n.$caption.html(i),n.setEllipsis(),n.$caption.attr("title",""),r(n.$container,"file-input-new")),0===n.$container.find(".file-preview-frame").length&&(n.initialCaption="",n.original.caption="",n.$caption.html(""),n.setEllipsis(),n.$captionContainer.find(".kv-caption-icon").hide()),n.hideFileIcon(),n.raise("filecleared"),n.$captionContainer.focus(),n.setFileDropZoneTitle()},reset:function(){var e=this;e.clear(!0),e.$preview.html(e.original.preview),e.$caption.html(e.original.caption),e.setEllipsis(),e.$container.find(".fileinput-filename").text(""),e.raise("filereset"),e.initialPreview.length>0&&e.$container.removeClass("file-input-new"),e.setFileDropZoneTitle(),e.isUploadable&&e.resetUpload(),e.filestack=[],e.formdata={}},disable:function(){var e=this;e.isDisabled=!0,e.raise("filedisabled"),e.$element.attr("disabled","disabled"),e.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),e.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").attr("disabled",!0),e.initDragDrop()},enable:function(){var e=this;e.isDisabled=!1,e.raise("fileenabled"),e.$element.removeAttr("disabled"),e.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),e.$container.find(".btn-file, .fileinput-remove, .kv-fileinput-upload").removeAttr("disabled"),e.initDragDrop()},getExtraData:function(){var e=this,t=e.uploadExtraData;return"function"==typeof e.uploadExtraData&&(t=e.uploadExtraData()),t},uploadExtra:function(){var t=this,i=t.getExtraData();0!==i.length&&e.each(i,function(e,i){t.formdata.append(e,i)})},initXhr:function(e,t){var i=this;return e.upload&&e.upload.addEventListener("progress",function(e){var n=0,s=e.loaded||e.position,r=e.total;e.lengthComputable&&(n=Math.ceil(s/r*t)),i.uploadPercent=Math.max(n,i.uploadPercent),i.setProgress(i.uploadPercent)},!1),e},ajaxSubmit:function(t,i,n,s){var r,o=this;o.uploadExtra(),r=e.extend(o.ajaxSettings,{xhr:function(){var t=e.ajaxSettings.xhr();return o.initXhr(t,98)},url:o.uploadUrl,type:"POST",dataType:"json",data:o.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:t,success:i,complete:n,error:s}),o.ajaxRequests.push(e.ajax(r))},uploadSingle:function(t,i,n){var s,o,a,l,c,d,u,h,p,f,g,m=this,v=m.getFileStack().length,w=new FormData,y=m.previewInitId+"-"+t,b=e("#"+y),x=b.find(".kv-file-upload"),_=b.find(".kv-file-remove"),C=b.find(".file-upload-indicator"),k=m.fileActionSettings,T=m.filestack.length>0||!e.isEmptyObject(m.uploadExtraData);m.formdata=w,0!==v&&T&&!x.hasClass("disabled")&&(l=function(){var e=m.$preview.find(".file-preview-frame.file-uploading"),t=e.length;t>0||(m.setProgress(100),m.unlock(),m.clearFileInput(),m.raise("filebatchuploadcomplete",[m.filestack,m.getExtraData()]))},c=function(e,t){C.html(k[e]),C.attr("title",k[t])},d=function(){!n||0===v||m.uploadPercent>=100||(m.uploadCount+=1,a=80+Math.ceil(20*m.uploadCount/v),m.uploadPercent=Math.max(a,m.uploadPercent),m.setProgress(m.uploadPercent),m.initPreviewDeletes())},u=function(){x.removeAttr("disabled"),_.removeAttr("disabled"),b.removeClass("file-uploading")},h=function(e){s=m.getOutData(e),c("indicatorLoading","indicatorLoadingTitle"),r(b,"file-uploading"),x.attr("disabled",!0),_.attr("disabled",!0),n||m.lock(),m.raise("filepreupload",[s,y,t])},p=function(e,i,r){s=m.getOutData(r,e),setTimeout(function(){void 0===e.error?(c("indicatorSuccess","indicatorSuccessTitle"),x.hide(),_.hide(),m.filestack[t]=void 0,n||m.resetFileStack(),m.raise("fileuploaded",[s,y,t])):(c("indicatorError","indicatorErrorTitle"),m.showUploadError(e.error,s,y,t))},100)},f=function(){setTimeout(function(){d(),u(),n?l():m.unlock(!1)},100)},g=function(e,r,a){c("indicatorError","indicatorErrorTitle"),s=m.getOutData(e),n?(o=i[t].name,m.showUploadError("<b>"+o+"</b>: "+a,s,y,t)):m.showUploadError(a,s,y,t);
},w.append(m.uploadFileAttr,i[t]),w.append("file_id",t),m.ajaxSubmit(h,p,f,g))},uploadBatch:function(){var t,i,n,s,o,a,l,c,d=this,u=d.filestack,h=u.length,p=d.filestack.length>0||!e.isEmptyObject(d.uploadExtraData);d.formdata=new FormData,0!==h&&p&&(t=d.fileActionSettings,i=function(i,n,s){var r=e("#"+d.previewInitId+"-"+i).find(".file-upload-indicator");r.html(t[n]),r.attr("title",t[s])},s=function(t){var i=e("#"+d.previewInitId+"-"+t),n=i.find(".kv-file-upload"),s=i.find(".kv-file-delete");i.removeClass("file-uploading"),n.removeAttr("disabled"),s.removeAttr("disabled")},n=function(){e.each(u,function(e,t){d.filestack[e]=void 0}),d.clearFileInput()},o=function(t){d.lock();var i=d.getOutData(t);d.showPreview&&(d.$preview.find(".file-preview-frame").each(function(){var t=e(this),i=t.find(".kv-file-upload"),n=t.find(".kv-file-remove");r(t,"file-uploading"),i.attr("disabled",!0),n.attr("disabled",!0)}),d.raise("filebatchpreupload",[i]))},a=function(t,r,o){var a=d.getOutData(o,t),l=R(t.errorkeys)?[]:t.errorkeys;void 0===t.error||R(t.error)?(d.raise("filebatchuploadsuccess",[a]),n(),d.showPreview?(d.$preview.find(".kv-file-upload").hide(),d.$preview.find(".kv-file-remove").hide(),d.$preview.find(".file-preview-frame").each(function(){var t=e(this),n=t.attr("data-fileindex");i(n,"indicatorSuccess","indicatorSuccessTitle"),s(n)})):d.reset()):(d.$preview.find(".file-preview-frame").each(function(){var t=e(this),n=parseInt(t.attr("data-fileindex"),10);return s(n),0===l.length?void i(n,"indicatorError","indicatorErrorTitle"):void(e.inArray(n,l)!==-1?i(n,"indicatorError","indicatorErrorTitle"):(t.find(".kv-file-upload").hide(),t.find(".kv-file-remove").hide(),i(n,"indicatorSuccess","indicatorSuccessTitle"),d.filestack[n]=void 0))}),d.showUploadError(t.error,a,null,null,"filebatchuploaderror"))},l=function(){d.setProgress(100),d.unlock(),d.raise("filebatchuploadcomplete",[d.filestack,d.getExtraData()]),d.clearFileInput()},c=function(t,n,s){var r=d.getOutData(t);d.showUploadError(s,r,null,null,"filebatchuploaderror"),d.uploadFileCount=h-1,d.$preview.find(".file-preview-frame").each(function(){var t=e(this),n=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==d.filestack[n]&&i(n,"indicatorError","indicatorErrorTitle")}),d.$preview.find(".file-preview-frame").removeClass("file-uploading"),d.$preview.find(".file-preview-frame kv-file-upload").removeAttr("disabled"),d.$preview.find(".file-preview-frame kv-file-delete").removeAttr("disabled")},e.each(u,function(e,t){R(u[e])||d.formdata.append(d.uploadFileAttr,t)}),d.ajaxSubmit(o,a,l,c))},hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},resetErrors:function(e){var t=this,i=t.$errorContainer;t.isError=!1,t.$container.removeClass("has-error"),i.html(""),e?i.fadeOut("slow"):i.hide()},showUploadError:function(e,t,i,n,s){var o=this,a=o.$errorContainer;return s=s||"fileuploaderror",0===a.find("ul").length?a.html('<ul class="text-left"><li>'+e+"</li></ul>"):a.find("ul").append("<li>"+e+"</li>"),a.fadeIn(800),o.raise(s,[t,i,n,o.reader]),r(o.$container,"has-error"),!0},showError:function(e,t,i,n,s,o){var a=this,l=a.$errorContainer;return s=s||"fileerror",o=o||{},l.html(e),l.fadeIn(800),a.raise(s,[t,i,n,a.reader,o]),a.isUploadable||a.clearFileInput(),r(a.$container,"has-error"),a.$btnUpload.attr("disabled",!0),!0},errorHandler:function(e,t){var i=this,n=e.target.error;switch(n.code){case n.NOT_FOUND_ERR:i.addError(i.msgFileNotFound.repl("{name}",t));break;case n.SECURITY_ERR:i.addError(i.msgFileSecured.repl("{name}",t));break;case n.NOT_READABLE_ERR:i.addError(i.msgFileNotReadable.repl("{name}",t));break;case n.ABORT_ERR:i.addError(i.msgFilePreviewAborted.repl("{name}",t));break;default:i.addError(i.msgFilePreviewError.repl("{name}",t))}},parseFileType:function(e){var t,i,n,s,r=this;for(s=0;s<P.length;s+=1)if(n=P[s],t=F(n,r.fileTypeSettings)?r.fileTypeSettings[n]:O[n],i=t(e.type,e.name)?n:"",!R(i))return i;return"other"},previewDefault:function(t,i,n){if(this.showPreview){var s=this,r=B.createObjectURL(t),o=e("#"+i),a=s.previewSettings.other,l=s.renderFileFooter(t.name,a.width),c=s.getPreviewTemplate("other"),d=i.slice(i.lastIndexOf("-")+1),u="";n===!0&&(u=" btn disabled",l+='<div class="file-other-error text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i></div>'),s.$preview.append("\n"+c.repl("{previewId}",i).repl("{frameClass}",u).repl("{fileindex}",d).repl("{caption}",s.slug(t.name)).repl("{width}",a.width).repl("{height}",a.height).repl("{type}",t.type).repl("{data}",r).repl("{footer}",l)),o.on("load",function(){B.revokeObjectURL(o.attr("data"))})}},previewFile:function(e,t,i,n){if(this.showPreview){var s,r,o,a,l=this,c=l.parseFileType(e),d=l.slug(e.name),u=l.allowedPreviewTypes,h=l.allowedPreviewMimeTypes,p=F(c,l.previewTemplates)?l.previewTemplates[c]:D[c],f=F(c,l.previewSettings)?l.previewSettings[c]:I[c],g=parseInt(l.wrapTextLength,10),m=l.wrapIndicator,v=u.indexOf(c)>=0,w=R(h)||!R(h)&&F(e.type,h),y=l.renderFileFooter(d,f.width),b="",x=i.slice(i.lastIndexOf("-")+1);v&&w?("text"===c?(r=L(t.target.result),B.revokeObjectURL(n),r.length>g&&(o="text-"+N(),a=.75*window.innerHeight,b=l.getLayoutTemplate("modal").repl("{id}",o).repl("{title}",d).repl("{height}",a).repl("{body}",r),m=m.repl("{title}",d).repl("{dialog}","$('#"+o+"').modal('show')"),r=r.substring(0,g-1)+m),s=p.repl("{previewId}",i).repl("{caption}",d).repl("{frameClass}","").repl("{type}",e.type).repl("{width}",f.width).repl("{height}",f.height).repl("{data}",r).repl("{footer}",y).repl("{fileindex}",x)+b):s=p.repl("{previewId}",i).repl("{caption}",d).repl("{frameClass}","").repl("{type}",e.type).repl("{data}",n).repl("{width}",f.width).repl("{height}",f.height).repl("{footer}",y).repl("{fileindex}",x),l.$preview.append("\n"+s),l.autoSizeImage(i)):l.previewDefault(e,i)}},slugDefault:function(e){return R(e)?"":e.split(/(\\|\/)/g).pop().replace(/[^\w\-.\\\/ ]+/g,"")},getFileStack:function(){var e=this;return e.filestack.filter(function(e){return void 0!==e})},readFiles:function(e){function t(g){if(R(n.attr("multiple"))&&(u=1),g>=u)return o.removeClass("loading"),void a.html("");var m,v,w,y,b,x,_=p+g,C=d+"-"+_,k=e[g],T=i.slug(k.name),S=(k.size||0)/1e3,E="",$=B.createObjectURL(k),j=0,z=i.allowedFileTypes,D=R(z)?"":z.join(", "),P=i.allowedFileExtensions,I=R(P)?"":P.join(", ");if(R(P)||(E=new RegExp("\\.("+P.join("|")+")$","i")),S=S.toFixed(2),i.maxFileSize>0&&S>i.maxFileSize)return y=i.msgSizeTooLarge.repl("{name}",T).repl("{size}",S).repl("{maxSize}",i.maxFileSize),void(i.isError=f(y,k,C,g));if(!R(z)&&A(z)){for(w=0;w<z.length;w+=1)b=z[w],v=h[b],x=void 0!==v&&v(k.type,T),j+=R(x)?0:x.length;if(0===j)return y=i.msgInvalidFileType.repl("{name}",T).repl("{types}",D),void(i.isError=f(y,k,C,g))}return 0!==j||R(P)||!A(P)||R(E)||(x=T.match(E),j+=R(x)?0:x.length,0!==j)?i.showPreview?(s.length>0&&void 0!==FileReader?(a.html(l.repl("{index}",g+1).repl("{files}",u)),o.addClass("loading"),r.onerror=function(e){i.errorHandler(e,T)},r.onload=function(e){i.previewFile(k,e,C,$),i.initFileActions()},r.onloadend=function(){y=c.repl("{index}",g+1).repl("{files}",u).repl("{percent}",50).repl("{name}",T),setTimeout(function(){a.html(y),B.revokeObjectURL($)},100),setTimeout(function(){t(g+1),i.updateFileDetails(u)},100),i.raise("fileloaded",[k,C,g,r])},r.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100,i=Math.ceil(t);y=c.repl("{index}",g+1).repl("{files}",u).repl("{percent}",i).repl("{name}",T),setTimeout(function(){a.html(y)},100)}},m=F("text",h)?h.text:O.text,m(k.type,T)?r.readAsText(k,i.textEncoding):r.readAsArrayBuffer(k)):(i.previewDefault(k,C),setTimeout(function(){t(g+1),i.updateFileDetails(u)},100),i.raise("fileloaded",[k,C,g,r])),void i.filestack.push(k)):(i.filestack.push(k),setTimeout(t(g+1),100),void i.raise("fileloaded",[k,C,g,r])):(y=i.msgInvalidFileExtension.repl("{name}",T).repl("{extensions}",I),void(i.isError=f(y,k,C,g)))}this.reader=new FileReader;var i=this,n=i.$element,s=i.$preview,r=i.reader,o=i.$previewContainer,a=i.$previewStatus,l=i.msgLoading,c=i.msgProgress,d=i.previewInitId,u=e.length,h=i.fileTypeSettings,p=i.filestack.length,f=function(t,n,s,r){i.previewDefault(n,s,!0);var o=i.getOutData({},{},e);return i.isUploadable?i.showUploadError(t,o,s,r):i.showError(t,n,s,r)};t(0),i.updateFileDetails(u,!1)},updateFileDetails:function(e){var t=this,i=t.msgSelected,n=t.$element,s=t.getFileStack(),r=n.val()||s.length&&s[0].name||"",o=t.slug(r),a=t.isUploadable?s.length:e,l=t.initialPreviewCount+a,c=a>1?i.repl("{n}",l):o;t.isError?(t.$previewContainer.removeClass("loading"),t.$previewStatus.html(""),t.$captionContainer.find(".kv-caption-icon").hide(),c=t.msgValidationError):t.showFileIcon(),t.setCaption(c),t.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&t.raise("fileselect",[e,o])},change:function(e){var t,i,n,s=this,r=s.$element,o=s.$preview,a=arguments.length>1,l=a?e.originalEvent.dataTransfer.files:r.get(0).files,c=R(r.attr("multiple")),d=s.filestack.length,u=s.isUploadable&&0!==d,h=function(e,t,i,n){var r=s.getOutData({},{},l);return s.isUploadable?s.showUploadError(e,r,i,n):s.showError(e,t,i,n)};return s.resetUpload(),s.hideFileIcon(),s.$container.find(".file-drop-zone ."+s.dropZoneTitleClass).remove(),t=a?l:void 0===e.target.files?e.target&&e.target.value?[{name:e.target.value.replace(/^.+\\/,"")}]:[]:e.target.files,R(t)||0===t.length?(u||s.clear(!0),void s.raise("fileselectnone")):(s.resetErrors(),(!u||c&&d>0)&&(s.overwriteInitial?o.html(""):o.html(s.initialPreviewContent),c&&d>0&&(s.filestack=[])),n=s.isUploadable?s.getFileStack().length+t.length:t.length,s.maxFileCount>0&&n>s.maxFileCount?(i=s.msgFilesTooMany.repl("{m}",s.maxFileCount).repl("{n}",n),s.isError=h(i,null,null,null),s.$captionContainer.find(".kv-caption-icon").hide(),s.$caption.html(s.msgValidationError),s.setEllipsis(),void s.$container.removeClass("file-input-new file-input-ajax-new")):(s.isIE9?s.updateFileDetails(1):s.readFiles(l),u?s.raise("filebatchselected",[s.getFileStack()]):s.raise("filebatchselected",[t]),void(s.reader=null)))},autoSizeImage:function(e){var t,i,n,s=this,r=s.$preview,o=r.find("#"+e),a=o.find("img");a.length&&a.on("load",function(){t=o.width(),i=r.width(),t>i&&(a.css("width","100%"),o.css("width","97%")),n=a.closest(".file-preview-frame").find(".file-caption-name"),n.length&&(n.width(a.width()),n.attr("title",n.text())),s.raise("fileimageloaded",e)})},setCaption:function(t){var i=this,n=e("<div>"+t+"</div>").text(),s=i.getLayoutTemplate("icon"),r=s+n;0!==i.$caption.length&&(i.$caption.html(r),i.$caption.attr("title",n),i.$captionContainer.find(".file-caption-ellipsis").attr("title",n),i.setEllipsis())},initBrowse:function(e){var t=this;t.$btnFile=e.find(".btn-file"),t.$btnFile.append(t.$element)},createContainer:function(){var t=this,i=e(document.createElement("span")).attr({class:"file-input file-input-new"}).html(t.renderMain());return t.$element.before(i),t.initBrowse(i),i},refreshContainer:function(){var e=this,t=e.$container;t.before(e.$element),t.html(e.renderMain()),e.initBrowse(t)},renderMain:function(){var e=this,t=e.isUploadable&&e.dropZoneEnabled?" file-drop-zone":"",i=e.showPreview?e.getLayoutTemplate("preview").repl("{class}",e.previewClass).repl("{dropClass}",t):"",n=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,s=e.captionTemplate.repl("{class}",n+" kv-fileinput-caption");return e.mainTemplate.repl("{class}",e.mainClass).repl("{preview}",i).repl("{caption}",s).repl("{upload}",e.renderUpload()).repl("{remove}",e.renderRemove()).repl("{cancel}",e.renderCancel()).repl("{browse}",e.renderBrowse())},renderBrowse:function(){var e=this,t=e.browseClass+" btn-file",i="";return e.isDisabled&&(i=" disabled "),'<div class="'+t+'"'+i+"> "+e.browseIcon+e.browseLabel+" </div>"},renderRemove:function(){var e=this,t=e.removeClass+" fileinput-remove fileinput-remove-button",i="";return e.showRemove?(e.isDisabled&&(i=" disabled "),'<button type="button" title="'+e.removeTitle+'" class="'+t+'"'+i+">"+e.removeIcon+e.removeLabel+"</button>"):""},renderCancel:function(){var e=this,t=e.cancelClass+" fileinput-cancel fileinput-cancel-button";return e.showCancel?'<button type="button" title="'+e.cancelTitle+'" class="hide '+t+'">'+e.cancelIcon+e.cancelLabel+"</button>":""},renderUpload:function(){var e=this,t=e.uploadClass+" kv-fileinput-upload fileinput-upload-button",i="",n="";return e.showUpload?(e.isDisabled&&(n=" disabled "),i=!e.isUploadable||e.isDisabled?'<button type="submit" title="'+e.uploadTitle+'"class="'+t+'"'+n+">"+e.uploadIcon+e.uploadLabel+"</button>":'<a href="'+e.uploadUrl+'" title="'+e.uploadTitle+'" class="'+t+'"'+n+">"+e.uploadIcon+e.uploadLabel+"</a>"):""}},e.fn.fileinput=function(n){if(i()||t(9)){var s=Array.apply(null,arguments);return s.shift(),this.each(function(){var t=e(this),i=t.data("fileinput"),r="object"==typeof n&&n;i||(i=new V(this,e.extend({},e.fn.fileinput.defaults,r,e(this).data())),t.data("fileinput",i)),"string"==typeof n&&i[n].apply(i,s)})}},e.fn.fileinput.defaults={showCaption:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,mainClass:"",previewClass:"",captionClass:"",mainTemplate:null,initialCaption:"",initialPreview:"",initialPreviewCount:0,initialPreviewDelimiter:"*$$*",initialPreviewConfig:[],initialPreviewShowDelete:!0,overwriteInitial:!0,layoutTemplates:z,previewTemplates:D,allowedPreviewTypes:P,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,customLayoutTags:{},customPreviewTags:{},previewSettings:I,fileTypeSettings:O,browseLabel:"Browse &hellip;",browseIcon:'<i class="w2ui-icon-folder"></i> &nbsp;',browseClass:"btn btn-blue",removeLabel:"Remove",removeTitle:"Clear selected files",removeIcon:'<i class="w2ui-icon-trash"></i> ',removeClass:"btn btn-red",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",cancelIcon:'<i class="w2ui-icon-ban"></i> ',cancelClass:"btn btn-red",uploadLabel:"Upload",uploadTitle:"Upload selected files",uploadIcon:'<i class="w2ui-icon-upload"></i> ',uploadClass:"btn btn-orange",uploadUrl:null,uploadExtraData:[],uploadAsync:!0,maxFileSize:0,maxFileCount:0,msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>. Please retry your upload!',msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>. Please retry your upload!",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgValidationError:'<span class="text-danger"><i class="glyphicon glyphicon-exclamation-sign"></i> File Upload Error</span>',msgErrorClass:"file-error-message",msgLoading:"Loading  file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} files selected",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",previewFileType:"image",wrapTextLength:250,wrapIndicator:' <span class="wrap-indicator" title="{title}" onclick="{dialog}">[&hellip;]</span>',elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,slugCallback:null,dropZoneEnabled:!0,dropZoneTitle:"Drag & drop files here &hellip;",dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{}},e.fn.fileinput.Constructor=V,e(document).ready(function(){var t=e("input.file[type=file]"),i=t.attr("type")?t.length:0;i>0&&t.fileinput()})}(window.jQuery),function(e){"function"==typeof define&&define.amd?define(["underscore","backbone","exports"],e):"object"==typeof exports?e(_,Backbone,exports):e(_,Backbone,{})}(function(e,t,i){i._handlers=[],i.addHandler=function(t){t=e.map(e.flatten([t]),function(t){return e.extend({updateModel:!0,updateView:!0,updateMethod:"text"},t)}),this._handlers=this._handlers.concat(t)},i.ViewMixin={_modelBindings:null,unstickit:function(t,i){if(e.isObject(i))return void e.each(e.keys(i),function(e){this.unstickit(t,e)},this);var n=[],s=[];e.each(this._modelBindings,function(e,r){t&&e.model!==t||i&&e.config.selector!=i||(s.push(e.config._destroy),e.model.off(e.event,e.fn),n.push(e.model),delete this._modelBindings[r])},this),e.invoke(e.uniq(n),"trigger","stickit:unstuck",this.cid),e.each(e.uniq(s),function(e){e.call(this)},this),this._modelBindings=e.compact(this._modelBindings),this.$el.off(".stickit"+(t?"."+t.cid:""),i)},stickit:function(t,i){var n=t||this.model,s=i||e.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(n,s);var r=this.remove;r.stickitWrapped||(this.remove=function(){var e=this;return this.unstickit(),r&&(e=r.apply(this,arguments)),e}),this.remove.stickitWrapped=!0},addBinding:function(t,i,n){var r,f,g,m,v,w=t||this.model,y=".stickit."+w.cid,b=n||{},x=e.uniqueId();if(!e.isString(i)){var _=i;return void e.each(_,function(e,t){this.addBinding(w,t,_[t])},this)}v=i,r=":el"===v?this.$el:this.$(v),this.unstickit(w,v),r.length&&(e.isString(b)&&(b={observe:b}),e.isFunction(b.observe)&&(b.observe=b.observe.call(this)),m=d(r,b),m.selector=v,g=m.observe,m.bindId=x,m.view=this,f=e.extend({stickitChange:m},m.setOptions),m._destroy=function(){s(this,m.destroy,r,w,m)},u(this,r,m,w,g),h(this,r,m,w,g),g&&(e.each(m.events,function(t){var i=t+y,n=function(t){var i=m.getVal.call(this,r,t,m,e.rest(arguments));o(this,m.updateModel,i,t,m)&&l(w,g,i,f,this,m)};n=e.bind(n,this),":el"===v?this.$el.on(i,n):this.$el.on(i,v,n)},this),e.each(e.flatten([g]),function(e){a(w,this,"change:"+e,m,function(e,t,i){var n=i&&i.stickitChange&&i.stickitChange.bindId||null;n!==x&&p(this,r,m,c(e,g,m,this),e)})},this),p(this,r,m,c(w,g,m,this),w,!0)),s(this,m.initialize,r,w,m))}},e.extend(t.View.prototype,i.ViewMixin);var n=function(t,i){var n=(i||"").split("."),s=e.reduce(n,function(e,t){return e[t]},t);return null==s?t:s},s=function(t,i){if(i)return(e.isString(i)?n(t,i):i).apply(t,e.rest(arguments,2))},r=function(e){return e.find("option").not(function(){return!this.selected})},o=function(t,i){return e.isBoolean(i)?i:!(!e.isFunction(i)&&!e.isString(i))&&s.apply(this,arguments)},a=function(e,t,i,n,s){e.on(i,s,t),t._modelBindings.push({model:e,event:i,fn:s,config:n})},l=function(t,i,n,r,o,a){var l={};a.onSet&&(n=s(o,a.onSet,n,a)),a.set?s(o,a.set,i,n,r,a):(l[i]=n,e.isArray(i)&&e.isArray(n)&&(l=e.reduce(i,function(t,i,s){return t[i]=e.has(n,s)?n[s]:null,t},{})),t.set(l,r))},c=function(t,i,n,r){var o,a=function(e){return t[n.escape?"escape":"get"](e)},l=function(e){return null==e?"":e};return o=e.isArray(i)?e.map(i,a):a(i),n.onGet&&(o=s(r,n.onGet,o,n)),e.isArray(o)?e.map(o,l):l(o)},d=i.getConfiguration=function(t,n){var s=[{updateModel:!1,updateMethod:"text",update:function(e,t,i,n){e[n.updateMethod]&&e[n.updateMethod](t)},getVal:function(e,t,i){return e[i.updateMethod]()}}];s=s.concat(e.filter(i._handlers,function(e){return t.is(e.selector)})),s.push(n);var r=e.extend.apply(e,s);return r.visible&&!e.has(r,"updateView")?r.updateView=!1:e.has(r,"updateView")||(r.updateView=!0),r},u=function(t,i,n,s,r){var o=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"];e.each(n.attributes||[],function(l){var d,u,h="";l=e.clone(l),d=l.observe||(l.observe=r),u=function(){var n=e.indexOf(o,l.name,!0)>-1?"prop":"attr",r=c(s,d,l,t);"class"===l.name?(i.removeClass(h).addClass(r),h=r):i[n](l.name,r)},e.each(e.flatten([d]),function(e){a(s,t,"change:"+e,n,u)}),u()})},h=function(t,i,n,r,o){if(null!=n.visible){var l=function(){var a=n.visible,l=n.visibleFn,d=c(r,o,n,t),u=!!d;(e.isFunction(a)||e.isString(a))&&(u=!!s(t,a,d,n)),l?s(t,l,i,u,n):i.toggle(u)};e.each(e.flatten([o]),function(e){a(r,t,"change:"+e,n,l)}),l()}},p=function(e,t,i,n,r,a){o(e,i.updateView,n,i)&&(s(e,i.update,t,n,r,i),a||s(e,i.afterUpdate,t,n,i))};return i.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:'input[type="radio"]',events:["change"],update:function(e,t){e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(i,n,s,r){if(i.length>1)n||(n=[]),i.each(function(i,s){var r=t.$(s),o=e.indexOf(n,r.val())>-1;r.prop("checked",o)});else{var o=e.isBoolean(n)?n:n===i.val();i.prop("checked",o)}},getVal:function(i){var n;if(i.length>1)n=e.reduce(i,function(e,i){var n=t.$(i);return n.prop("checked")&&e.push(n.val()),e},[]);else{n=i.prop("checked");var s=i.val();"on"!==s&&null!=s&&(n=n?i.val():null)}return n}},{selector:"select",events:["change"],update:function(i,r,o,a){var l,c=a.selectOptions,d=c&&c.collection||void 0,u=i.prop("multiple");if(!c){c={};var h=function(e){return e.map(function(){return{value:this.value,label:this.text}}).get()};i.find("optgroup").length?(d={opt_labels:[]},i.find("> option").length&&(d.opt_labels.push(void 0),e.each(i.find("> option"),function(e){d[void 0]=h(t.$(e))})),e.each(i.find("optgroup"),function(e){var i=t.$(e).attr("label");d.opt_labels.push(i),d[i]=h(t.$(e).find("option"))})):d=h(i.find("option"))}c.valuePath=c.valuePath||"value",c.labelPath=c.labelPath||"label";var p=function(i,s,r){e.each(i,function(i){var o=t.$("<option/>"),a=i,l=function(t,i){o.text(t),a=i,o.data("stickit_bind_val",a),e.isArray(a)||e.isObject(a)||o.val(a)};"__default__"===i?l(c.defaultOption.label,c.defaultOption.value):l(n(i,c.labelPath),n(i,c.valuePath)),!u&&null!=a&&null!=r&&a===r||e.isObject(r)&&e.isEqual(a,r)?o.prop("selected",!0):u&&e.isArray(r)&&e.each(r,function(t){e.isObject(t)&&(t=n(t,c.valuePath)),(t===a||e.isObject(t)&&e.isEqual(a,t))&&o.prop("selected",!0)}),s.append(o)})};i.find("*").remove();var f=function(e,t){var i=window;return 0===t.indexOf("this.")&&(i=e),t=t.replace(/^[a-z]*\.(.+)$/,"$1"),n(i,t)};if(l=e.isString(d)?f(this,d):e.isFunction(d)?s(this,d,i,a):d,l instanceof t.Collection&&(l=l.toJSON()),c.defaultOption&&p(["__default__"],i),e.isArray(l))p(l,i,r);else if(l.opt_labels)e.each(l.opt_labels,function(e){var n=t.$("<optgroup/>").attr("label",e);p(l[e],n,r),i.append(n)});else{var g,m=[];for(var v in l)g={},g[c.valuePath]=v,g[c.labelPath]=l[v],m.push(g);p(e.sortBy(m,c.comparator||c.labelPath),i,r)}},getVal:function(e){var i;return i=e.prop("multiple")?t.$(r(e).map(function(){return t.$(this).data("stickit_bind_val")})).get():r(e).data("stickit_bind_val")}}]),t.Stickit=i,t.Stickit}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";e.fileMenu=function(t,i){var n=this;n.$el=e(t).first("ul"),n.el=t,n.index=0,n.actions=[],n.options=e.extend({},e.fileMenu.defaultOptions,i),n.touch=!1,n.$=function(e){return n.$el.find(e)},n.setMenuItems=function(e){var t;t=e?e:n.options.items;for(var i in t){var s=t[i];if(s.index||(s.index=n.index,n.index+=1),s.enabled=!0,s.show)try{s.hidden=!s.show()}catch(e){s.hidden=!0}s.submenu&&n.setMenuItems(s.submenu)}n.options.items=t},n.refresh=function(e){n.setMenuItems(),n.appendHtml(n.buildHTML()),n.addListeners()},n.buildHTML=function(){var e="<ul>",t=n.options.items;for(var i in t){var s=t[i];e+='<li data-index="'+s.index+'" id = "menu'+s.index+'" class="'+("separator"===s.type?"divider":"")+(s.enabled?"":" disabled")+(s.hidden?" hidden":"")+'">'+(s.icon?'<i class="'+s.icon+'"></i>':"")+" "+(s.label?s.label:""),e+=s.submenu?n.buildSubHtml(s.submenu):'<ul><li class="disabled">Empty</li></ul>',e+="</li>"}return e+="</ul>"},n.buildSubHtml=function(e){var t="<ul>";for(var i in e){var s=e[i];s.click&&n.actions.push({index:s.index,menu:s}),t+='<li data-index="'+s.index+'" id="menu'+s.index+'"'+(n.click?'data-action="'+s.index+'"':"")+'class="'+(s.submenu?"sub":"")+" "+(s.click?"menuaction":"")+(s.enabled?"":" disabled")+(s.hidden?" hidden":"")+" "+("separator"===s.type?"divider":"")+'"><div class="menuicon">'+(s.icon?'<i class="'+s.icon+'"></i>':" ")+"</div>  "+(s.label?s.label:""),s.submenu&&(t+=n.buildSubHtml(s.submenu)),t+="</li>"}return t+="</ul>"},n.appendHtml=function(t){n.$el.html(t);var i=n.$el.children("ul")[0];n.menu=e(i),n.menu.addClass("w2ui-filemenu")},n.hideMenu=function(){n.$(".selected ul").slideUp(n.options.slideSpeed),n.$(".selected").removeClass("selected"),n.menu.removeClass("active")},n.showMenu=function(e){var t=e.parent(),i=e.children("ul").first(),s=e.offset();t.addClass("active"),e.addClass("selected"),i.css({left:s.left,top:s.top+t.height()}),i.slideDown(n.options.slideSpeed)},n.addListeners=function(){n.menu.children("li").on("click",function(t){var i=e(this);i.hasClass("selected")?n.hideMenu():(n.hideMenu(),n.showMenu(i)),t.stopPropagation()}),n.$("li").on("click",".menuaction",function(t){var i=e(t.target),s=i.data("index"),r=_.where(n.actions,{index:s})[0].menu;r.click&&"function"==typeof r.click&&(r.click.apply(this,arguments),i.parent().addClass("selected"),n.hideMenu()),t.stopPropagation()}),n.menu.children("li").on("mouseenter",function(){var t=e(this);t.parent().hasClass("active")&&(t.hasClass("selected")||(n.hideMenu(),n.showMenu(t)))}),n.$("ul").on("click",function(t){var i=e(t.target);("LI"!==i.get(0).tagName||i.hasClass("sub"))&&t.stopPropagation()}),n.$("ul").on("click",".toggle",function(t){e(this).toggleClass("active"),t.stopPropagation()}),n.menu.on("mouseenter","ul li",function(){var t=e(this);t.find("ul").first().css({left:t.parent().width(),"margin-top":-t.height(),display:""})}),e("html").on("click",function(){n.hideMenu()})},n.init=function(){n.setMenuItems();var e=n.buildHTML();n.appendHtml(e),n.addListeners()},n.init(),e.extend(w2ui.obj,n),w2ui.filemenu=n},e.fileMenu.defaultOptions={slideSpeed:100,items:[]},e.fn.fileMenu=function(t){return this.each(function(){new e.fileMenu(this,t)})}});var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(e){function t(e){var t=/^[0-1]+$/;return t.test(e)}function i(e){var t=/^[-+]?[0-9]+$/;return t.test(e)}function n(e){return"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),("number"==typeof e||"string"==typeof e&&""!==e)&&!isNaN(Number(e))}function s(e){var t=w2utils.settings,i=new RegExp("^"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[-+]?"+(t.currencyPrefix?"\\"+t.currencyPrefix+"?":"")+"[0-9]*[\\"+t.decimalSymbol+"]?[0-9]+"+(t.currencySuffix?"\\"+t.currencySuffix+"?":"")+"$","i");return"string"==typeof e&&(e=e.replace(new RegExp(t.groupSymbol,"g"),"")),"object"!=typeof e&&""!==e&&i.test(e)}function r(e){var t=/^[a-fA-F0-9]+$/;return t.test(e)}function o(e){var t=/^[a-zA-Z0-9_-]+$/;return t.test(e)}function a(e){var t=/^[a-zA-Z0-9._%-+]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return t.test(e)}function l(e,t,n){if(!e)return!1;var s,r,o,a="Invalid Date";if(null==t&&(t=w2utils.settings.dateFormat),"function"==typeof e.getUTCFullYear)o=e.getUTCFullYear(),s=e.getUTCMonth()+1,r=e.getUTCDate();else if(parseInt(e)==e&&parseInt(e)>0)e=new Date(parseInt(e)),o=e.getUTCFullYear(),s=e.getUTCMonth()+1,r=e.getUTCDate();else{if(e=String(e),new RegExp("mon","ig").test(t)){t=t.replace(/month/gi,"m").replace(/mon/gi,"m").replace(/dd/gi,"d").replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase(),e=e.replace(/[, ]/gi,"/").replace(/\/\//g,"/").toLowerCase();for(var l=0,c=w2utils.settings.fullmonths.length;l<c;l++){var d=w2utils.settings.fullmonths[l];e=e.replace(new RegExp(d,"ig"),parseInt(l)+1).replace(new RegExp(d.substr(0,3),"ig"),parseInt(l)+1)}}var u=e.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/"),h=t.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===h&&(s=u[0],r=u[1],o=u[2]),"m/d/yyyy"===h&&(s=u[0],r=u[1],o=u[2]),"dd/mm/yyyy"===h&&(s=u[1],r=u[0],o=u[2]),"d/m/yyyy"===h&&(s=u[1],r=u[0],o=u[2]),"yyyy/dd/mm"===h&&(s=u[2],r=u[1],o=u[0]),"yyyy/d/m"===h&&(s=u[2],r=u[1],o=u[0]),"yyyy/mm/dd"===h&&(s=u[1],r=u[2],o=u[0]),"yyyy/m/d"===h&&(s=u[1],r=u[2],o=u[0]),"mm/dd/yy"===h&&(s=u[0],r=u[1],o=u[2]),"m/d/yy"===h&&(s=u[0],r=u[1],o=parseInt(u[2])+1900),"dd/mm/yy"===h&&(s=u[1],r=u[0],o=parseInt(u[2])+1900),"d/m/yy"===h&&(s=u[1],r=u[0],o=parseInt(u[2])+1900),"yy/dd/mm"===h&&(s=u[2],r=u[1],o=parseInt(u[0])+1900),"yy/d/m"===h&&(s=u[2],r=u[1],o=parseInt(u[0])+1900),"yy/mm/dd"===h&&(s=u[1],r=u[2],o=parseInt(u[0])+1900),"yy/m/d"===h&&(s=u[1],r=u[2],o=parseInt(u[0])+1900)}return!!i(o)&&(!!i(s)&&(!!i(r)&&(o=+o,s=+s,r=+r,a=new Date(o,s-1,r),null!=s&&("Invalid Date"!=String(a)&&(a.getMonth()+1===s&&a.getDate()===r&&a.getFullYear()===o&&(n!==!0||a))))))}function c(t,i){if(null==t)return!1;var n,s,r;t=String(t),t=t.toUpperCase(),s=t.indexOf("AM")>=0,r=t.indexOf("PM")>=0;var o=r||s;n=o?12:24,t=t.replace("AM","").replace("PM",""),t=e.trim(t);var a=t.split(":"),l=parseInt(a[0]||0),c=parseInt(a[1]||0),d=parseInt(a[2]||0);return!!(o&&1===a.length||2===a.length||3===a.length)&&(!(""===a[0]||l<0||l>n||!this.isInt(a[0])||a[0].length>2)&&(!(a.length>1&&(""===a[1]||c<0||c>59||!this.isInt(a[1])||2!==a[1].length))&&(!(a.length>2&&(""===a[2]||d<0||d>59||!this.isInt(a[2])||2!==a[2].length))&&(!!(o||n!==l||0===c&&0===d)&&((!o||1!==a.length||0!==l)&&(i!==!0||(r&&12!==l&&(l+=12),s&&12===l&&(l+=12),{hours:l,minutes:c,seconds:d})))))))}function d(e,t,i){null==t&&(t=w2utils.settings.datetimeFormat);var n=t.split("|");if("function"==typeof e.getUTCFullYear)return i!==!0||e;if(parseInt(e)==e&&parseInt(e)>0)return e=new Date(parseInt(e)),i!==!0||e;var s=String(e).indexOf(" "),r=[e.substr(0,s),e.substr(s).trim()];n[0]=n[0].trim(),n[1]&&(n[1]=n[1].trim());var o=w2utils.isDate(r[0],n[0],!0),a=w2utils.isTime(r[1],!0);return o!==!1&&a!==!1&&(i!==!0||(o.setHours(a.hours),o.setMinutes(a.minutes),o.setSeconds(a.seconds),o))}function u(e){var t;if(""===e||null==e)return"";if(t="function"==typeof e.getUTCFullYear?e:parseInt(e)==e&&parseInt(e)>0?new Date(parseInt(e)):new Date(e),"Invalid Date"==String(t))return"";var i=new Date,n=(i.getTime()-t.getTime())/1e3,s="",r="";return n<0?(s=0,r="sec"):n<60?(s=Math.floor(n),r="sec",n<0&&(s=0,r="sec")):n<3600?(s=Math.floor(n/60),r="min"):n<86400?(s=Math.floor(n/60/60),r="hour"):n<2592e3?(s=Math.floor(n/24/60/60),r="day"):n<31536e3?(s=Math.floor(n/30/24/60/60*10)/10,r="month"):n<126144e3?(s=Math.floor(n/365/24/60/60*10)/10,r="year"):n>=126144e3&&(s=Math.floor(n/365.25/24/60/60*10)/10,r="year"),s+" "+r+(s>1?"s":"")}function h(e){var t="";return t=e<1e3?"< 1 sec":e<6e4?Math.floor(e/1e3)+" secs":e<36e5?Math.floor(e/6e4)+" mins":e<864e5?Math.floor(e/36e5*10)/10+" hours":e<2628e6?Math.floor(e/864e5*10)/10+" days":e<31536e6?Math.floor(e/2628e6*10)/10+" months":Math.floor(e/31536e5)/10+" years"}function p(e){if(""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var t=new Date(e);if(w2utils.isInt(e)&&(t=new Date(Number(e))),"Invalid Date"==String(t))return"";var i=w2utils.settings.shortmonths,n=new Date,s=new Date;s.setTime(s.getTime()-864e5);var r=i[t.getMonth()]+" "+t.getDate()+", "+t.getFullYear(),o=i[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear(),a=i[s.getMonth()]+" "+s.getDate()+", "+s.getFullYear(),l=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+" "+(t.getHours()>=12?"pm":"am"),c=t.getHours()-(t.getHours()>12?12:0)+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()+" "+(t.getHours()>=12?"pm":"am"),d=r;
return r===o&&(d=l),r===a&&(d=w2utils.lang("Yesterday")),'<span title="'+r+" "+c+'">'+d+"</span>"}function f(e){if(!w2utils.isFloat(e)||""===e)return"";if(e=parseFloat(e),0===e)return 0;var t=["Bt","KB","MB","GB","TB","PB","EB","ZB"],i=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return(Math.floor(e/Math.pow(1024,i)*10)/10).toFixed(0===i?0:1)+" "+(t[i]||"??")}function g(e,t,i){if(null==e||""===e||"object"==typeof e)return"";var n={minimumFractionDigits:t,maximumFractionDigits:t,useGrouping:i};return(null==t||t<0)&&(n.minimumFractionDigits=0,n.maximumFractionDigits=20),parseFloat(e).toLocaleString(w2utils.settings.locale,n)}function m(e,t){if(t||(t=this.settings.dateFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),"Invalid Date"==String(i))return"";var n=i.getFullYear(),s=i.getMonth(),r=i.getDate();return t.toLowerCase().replace("month",w2utils.settings.fullmonths[s]).replace("mon",w2utils.settings.shortmonths[s]).replace(/yyyy/g,n).replace(/yyy/g,n).replace(/yy/g,n>2e3?100+parseInt(String(n).substr(2)):String(n).substr(2)).replace(/(^|[^a-z$])y/g,"$1"+n).replace(/mm/g,(s+1<10?"0":"")+(s+1)).replace(/dd/g,(r<10?"0":"")+r).replace(/th/g,1==r?"st":"th").replace(/th/g,2==r?"nd":"th").replace(/th/g,3==r?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(s+1)).replace(/(^|[^a-z$])d/g,"$1"+r)}function v(e,t){w2utils.settings.shortmonths,w2utils.settings.fullmonths;if(t||(t=this.settings.timeFormat),""===e||null==e||"object"==typeof e&&!e.getMonth)return"";var i=new Date(e);if(w2utils.isInt(e)&&(i=new Date(Number(e))),w2utils.isTime(e)){var n=w2utils.isTime(e,!0);i=new Date,i.setHours(n.hours),i.setMinutes(n.minutes)}if("Invalid Date"==String(i))return"";var s="am",r=i.getHours(),o=i.getHours(),a=i.getMinutes(),l=i.getSeconds();return a<10&&(a="0"+a),l<10&&(l="0"+l),t.indexOf("am")===-1&&t.indexOf("pm")===-1||(r>=12&&(s="pm"),r>12&&(r-=12)),t.toLowerCase().replace("am",s).replace("pm",s).replace("hhh",r<10?"0"+r:r).replace("hh24",o<10?"0"+o:o).replace("h24",o).replace("hh",r).replace("mm",a).replace("mi",a).replace("ss",l).replace(/(^|[^a-z$])h/g,"$1"+r).replace(/(^|[^a-z$])m/g,"$1"+a).replace(/(^|[^a-z$])s/g,"$1"+l)}function w(e,t){var i;return""===e||null==e||"object"==typeof e&&!e.getMonth?"":("string"!=typeof t?i=[this.settings.dateFormat,this.settings.timeFormat]:(i=t.split("|"),i[0]=i[0].trim(),i[1]=i[1].trim()),"h12"==i[1]&&(i[1]="h:m pm"),"h24"==i[1]&&(i[1]="h24:m"),this.formatDate(e,i[0])+" "+this.formatTime(e,i[1]))}function y(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/(<([^>]+)>)/gi,"");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.stripTags(t[i])}else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.stripTags(t[i])}}return t}function b(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.encodeTags(t[i])}else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.encodeTags(t[i])}}return t}function x(t){if(null==t)return t;switch(typeof t){case"number":break;case"string":t=String(t).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&");break;case"object":if(Array.isArray(t)){t=e.extend(!0,[],t);for(var i=0;i<t.length;i++)t[i]=this.decodeTags(t[i])}else{t=e.extend(!0,{},t);for(var i in t)t[i]=this.decodeTags(t[i])}}return t}function _(e){return""===e||null==e?"":String(e).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")}function C(e){function t(e){e=String(e).replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}var i,n,s,r,o,a,l,c="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=t(e);d<e.length;)i=e.charCodeAt(d++),n=e.charCodeAt(d++),s=e.charCodeAt(d++),r=i>>2,o=(3&i)<<4|n>>4,a=(15&n)<<2|s>>6,l=63&s,isNaN(n)?a=l=64:isNaN(s)&&(l=64),c=c+u.charAt(r)+u.charAt(o)+u.charAt(a)+u.charAt(l);return c}function k(e){function t(e){for(var t,i,n="",s=0,r=0;s<e.length;)r=e.charCodeAt(s),r<128?(n+=String.fromCharCode(r),s++):r>191&&r<224?(t=e.charCodeAt(s+1),n+=String.fromCharCode((31&r)<<6|63&t),s+=2):(t=e.charCodeAt(s+1),i=e.charCodeAt(s+2),n+=String.fromCharCode((15&r)<<12|(63&t)<<6|63&i),s+=3);return n}var i,n,s,r,o,a,l,c="",d=0,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");d<e.length;)r=u.indexOf(e.charAt(d++)),o=u.indexOf(e.charAt(d++)),a=u.indexOf(e.charAt(d++)),l=u.indexOf(e.charAt(d++)),i=r<<2|o>>4,n=(15&o)<<4|a>>2,s=(3&a)<<6|l,c+=String.fromCharCode(i),64!==a&&(c+=String.fromCharCode(n)),64!==l&&(c+=String.fromCharCode(s));return c=t(c)}function T(e){function t(e){return n(i(s(e)))}function i(e){return o(a(r(e),8*e.length))}function n(e){try{}catch(e){g=0}for(var t,i=g?"0123456789ABCDEF":"0123456789abcdef",n="",s=0;s<e.length;s++)t=e.charCodeAt(s),n+=i.charAt(t>>>4&15)+i.charAt(15&t);return n}function s(e){for(var t,i,n="",s=-1;++s<e.length;)t=e.charCodeAt(s),i=s+1<e.length?e.charCodeAt(s+1):0,55296<=t&&t<=56319&&56320<=i&&i<=57343&&(t=65536+((1023&t)<<10)+(1023&i),s++),t<=127?n+=String.fromCharCode(t):t<=2047?n+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n}function r(e){for(var t=Array(e.length>>2),i=0;i<t.length;i++)t[i]=0;for(var i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}function o(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function a(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var i=1732584193,n=-271733879,s=-1732584194,r=271733878,o=0;o<e.length;o+=16){var a=i,l=n,f=s,g=r;i=c(i,n,s,r,e[o+0],7,-680876936),r=c(r,i,n,s,e[o+1],12,-389564586),s=c(s,r,i,n,e[o+2],17,606105819),n=c(n,s,r,i,e[o+3],22,-1044525330),i=c(i,n,s,r,e[o+4],7,-176418897),r=c(r,i,n,s,e[o+5],12,1200080426),s=c(s,r,i,n,e[o+6],17,-1473231341),n=c(n,s,r,i,e[o+7],22,-45705983),i=c(i,n,s,r,e[o+8],7,1770035416),r=c(r,i,n,s,e[o+9],12,-1958414417),s=c(s,r,i,n,e[o+10],17,-42063),n=c(n,s,r,i,e[o+11],22,-1990404162),i=c(i,n,s,r,e[o+12],7,1804603682),r=c(r,i,n,s,e[o+13],12,-40341101),s=c(s,r,i,n,e[o+14],17,-1502002290),n=c(n,s,r,i,e[o+15],22,1236535329),i=d(i,n,s,r,e[o+1],5,-165796510),r=d(r,i,n,s,e[o+6],9,-1069501632),s=d(s,r,i,n,e[o+11],14,643717713),n=d(n,s,r,i,e[o+0],20,-373897302),i=d(i,n,s,r,e[o+5],5,-701558691),r=d(r,i,n,s,e[o+10],9,38016083),s=d(s,r,i,n,e[o+15],14,-660478335),n=d(n,s,r,i,e[o+4],20,-405537848),i=d(i,n,s,r,e[o+9],5,568446438),r=d(r,i,n,s,e[o+14],9,-1019803690),s=d(s,r,i,n,e[o+3],14,-187363961),n=d(n,s,r,i,e[o+8],20,1163531501),i=d(i,n,s,r,e[o+13],5,-1444681467),r=d(r,i,n,s,e[o+2],9,-51403784),s=d(s,r,i,n,e[o+7],14,1735328473),n=d(n,s,r,i,e[o+12],20,-1926607734),i=u(i,n,s,r,e[o+5],4,-378558),r=u(r,i,n,s,e[o+8],11,-2022574463),s=u(s,r,i,n,e[o+11],16,1839030562),n=u(n,s,r,i,e[o+14],23,-35309556),i=u(i,n,s,r,e[o+1],4,-1530992060),r=u(r,i,n,s,e[o+4],11,1272893353),s=u(s,r,i,n,e[o+7],16,-155497632),n=u(n,s,r,i,e[o+10],23,-1094730640),i=u(i,n,s,r,e[o+13],4,681279174),r=u(r,i,n,s,e[o+0],11,-358537222),s=u(s,r,i,n,e[o+3],16,-722521979),n=u(n,s,r,i,e[o+6],23,76029189),i=u(i,n,s,r,e[o+9],4,-640364487),r=u(r,i,n,s,e[o+12],11,-421815835),s=u(s,r,i,n,e[o+15],16,530742520),n=u(n,s,r,i,e[o+2],23,-995338651),i=h(i,n,s,r,e[o+0],6,-198630844),r=h(r,i,n,s,e[o+7],10,1126891415),s=h(s,r,i,n,e[o+14],15,-1416354905),n=h(n,s,r,i,e[o+5],21,-57434055),i=h(i,n,s,r,e[o+12],6,1700485571),r=h(r,i,n,s,e[o+3],10,-1894986606),s=h(s,r,i,n,e[o+10],15,-1051523),n=h(n,s,r,i,e[o+1],21,-2054922799),i=h(i,n,s,r,e[o+8],6,1873313359),r=h(r,i,n,s,e[o+15],10,-30611744),s=h(s,r,i,n,e[o+6],15,-1560198380),n=h(n,s,r,i,e[o+13],21,1309151649),i=h(i,n,s,r,e[o+4],6,-145523070),r=h(r,i,n,s,e[o+11],10,-1120210379),s=h(s,r,i,n,e[o+2],15,718787259),n=h(n,s,r,i,e[o+9],21,-343485551),i=p(i,a),n=p(n,l),s=p(s,f),r=p(r,g)}return Array(i,n,s,r)}function l(e,t,i,n,s,r){return p(f(p(p(t,e),p(n,r)),s),i)}function c(e,t,i,n,s,r,o){return l(t&i|~t&n,e,t,s,r,o)}function d(e,t,i,n,s,r,o){return l(t&n|i&~n,e,t,s,r,o)}function u(e,t,i,n,s,r,o){return l(t^i^n,e,t,s,r,o)}function h(e,t,i,n,s,r,o){return l(i^(t|~n),e,t,s,r,o)}function p(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i}function f(e,t){return e<<t|e>>>32-t}var g=0;return t(e)}function S(t,i,n,s){var r=e(t).width(),o=e(t).height(),a=.5;if(!t||!i)return void console.log("ERROR: Cannot do transition when one of the divs is null");switch(t.parentNode.style.cssText+="perspective: 900px; overflow: hidden;",t.style.cssText+="; position: absolute; z-index: 1019; backface-visibility: hidden",i.style.cssText+="; position: absolute; z-index: 1020; backface-visibility: hidden",n){case"slide-left":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d("+r+"px, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: "+a+"s; transform: translate3d(-"+r+"px, 0, 0)"},1);break;case"slide-right":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(-"+r+"px, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: translate3d(0px, 0, 0)",t.style.cssText+="transition: "+a+"s; transform: translate3d("+r+"px, 0, 0)"},1);break;case"slide-down":t.style.cssText+="overflow: hidden; z-index: 1; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; z-index: 0; transform: translate3d(0, 0, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: "+a+"s; transform: translate3d(0, "+o+"px, 0)"},1);break;case"slide-up":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, "+o+"px, 0)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: translate3d(0, 0, 0)",t.style.cssText+="transition: "+a+"s; transform: translate3d(0, 0, 0)"},1);break;case"flip-left":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(-180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: rotateY(0deg)",t.style.cssText+="transition: "+a+"s; transform: rotateY(180deg)"},1);break;case"flip-right":t.style.cssText+="overflow: hidden; transform: rotateY(0deg)",i.style.cssText+="overflow: hidden; transform: rotateY(180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: rotateY(0deg)",t.style.cssText+="transition: "+a+"s; transform: rotateY(-180deg)"},1);break;case"flip-down":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: rotateX(0deg)",t.style.cssText+="transition: "+a+"s; transform: rotateX(-180deg)"},1);break;case"flip-up":t.style.cssText+="overflow: hidden; transform: rotateX(0deg)",i.style.cssText+="overflow: hidden; transform: rotateX(-180deg)",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: rotateX(0deg)",t.style.cssText+="transition: "+a+"s; transform: rotateX(180deg)"},1);break;case"pop-in":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(.8); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; transform: scale(1); opacity: 1;",t.style.cssText+="transition: "+a+"s;"},1);break;case"pop-out":t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); transform: scale(1); opacity: 1;",i.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; opacity: 1;",t.style.cssText+="transition: "+a+"s; transform: scale(1.7); opacity: 0;"},1);break;default:t.style.cssText+="overflow: hidden; transform: translate3d(0, 0, 0)",i.style.cssText+="overflow: hidden; translate3d(0, 0, 0); opacity: 0;",e(i).show(),window.setTimeout(function(){i.style.cssText+="transition: "+a+"s; opacity: 1;",t.style.cssText+="transition: "+a+"s"},1)}setTimeout(function(){"slide-down"===n&&(e(t).css("z-index","1019"),e(i).css("z-index","1020")),i&&e(i).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),t&&e(t).css({opacity:"1"}).css(w2utils.cssPrefix({transition:"",transform:""})),"function"==typeof s&&s()},1e3*a)}function E(t,i,n){var s={};"object"==typeof i?s=i:(s.msg=i,s.spinner=n),s.msg||0===s.msg||(s.msg=""),w2utils.unlock(t),e(t).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');var r=e(t).find(".w2ui-lock"),o=e(t).find(".w2ui-lock-msg");s.msg||o.css({"background-color":"transparent",border:"0px"}),s.spinner===!0&&(s.msg='<div class="w2ui-spinner" '+(s.msg?"":'style="width: 35px; height: 35px"')+"></div>"+s.msg),null!=s.opacity&&r.css("opacity",s.opacity),"function"==typeof r.fadeIn?(r.fadeIn(200),o.html(s.msg).fadeIn(200)):(r.show(),o.html(s.msg).show(0))}function $(t,n){i(n)?(e(t).find(".w2ui-lock").fadeOut(n),setTimeout(function(){e(t).find(".w2ui-lock").remove(),e(t).find(".w2ui-lock-msg").remove()},n)):(e(t).find(".w2ui-lock").remove(),e(t).find(".w2ui-lock-msg").remove())}function j(t,i){function n(i,n){if(null==r&&(r=n.trigger({phase:"before",type:"open",target:"self"}),r.isCancelled===!0))return u.css("z-index",u.data("old-z-index")),void e(t.box).find("#w2ui-message"+p).remove();var s=i.data("prev_focus");i.remove(),s&&s.length>0?s.focus():o&&o.focus&&o.focus(),u.css("z-index",u.data("old-z-index")),n.trigger(e.extend(r,{phase:"after"}))}var s,r,o=this;e().w2tag(),i||(i={width:200,height:100}),null==i.on&&e.extend(i,w2utils.event),null==i.width&&(i.width=200),null==i.height&&(i.height=100);var a=parseInt(e(t.box).width()),l=parseInt(e(t.box).height()),c=parseInt(e(t.box).find(t.title).css("height")||0);i.width>a&&(i.width=a-10),i.height>l-c&&(i.height=l-10-c),i.originalWidth=i.width,i.originalHeight=i.height,parseInt(i.width)<0&&(i.width=a+i.width),parseInt(i.width)<10&&(i.width=10),parseInt(i.height)<0&&(i.height=l+i.height-c),parseInt(i.height)<10&&(i.height=10),null==i.hideOnClick&&(i.hideOnClick=!1);var d=e(t.box).data("options")||{};(null==i.width||i.width>d.width-10)&&(i.width=d.width-10),(null==i.height||i.height>d.height-c-5)&&(i.height=d.height-c-5),i.originalHeight<0&&(i.height=l+i.originalHeight-c),i.originalWidth<0&&(i.width=a+2*i.originalWidth);var u=e(t.box).find(t.title),h=e(t.box).find(".w2ui-message.w2ui-closing");e(t.box).find(".w2ui-message.w2ui-closing").length>0&&(clearTimeout(s),n(h,h.data("options")||{}));var p=e(t.box).find(".w2ui-message").length;if(""===e.trim(i.html)&&""===e.trim(i.body)&&""===e.trim(i.buttons)){if(0===p)return;var f=e(t.box).find("#w2ui-message"+(p-1)),i=f.data("options")||{};if(r=i.trigger({phase:"before",type:"close",target:"self"}),r.isCancelled===!0)return;f.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+i.height+"px)"})).addClass("w2ui-closing"),1==p?this.unlock&&(t.param?this.unlock(t.param,150):this.unlock(150)):e(t.box).find("#w2ui-message"+(p-2)).css("z-index",1500),s=setTimeout(function(){n(f,i)},150)}else{""===e.trim(i.body)&&""===e.trim(i.buttons)||(i.html='<div class="w2ui-message-body">'+(i.body||"")+'</div><div class="w2ui-message-buttons">'+(i.buttons||"")+"</div>"),e(t.box).find(".w2ui-message").css("z-index",1390),u.data("old-z-index",u.css("z-index")),u.css("z-index",1501),e(t.box).find(t.body).before('<div id="w2ui-message'+p+'" onmousedown="event.stopPropagation();"    class="w2ui-message" style="display: none; z-index: 1500; '+(0===u.length?"top: 0px;":"top: "+w2utils.getSize(u,"height")+"px;")+(null!=i.width?"width: "+i.width+"px; left: "+(a-i.width)/2+"px;":"left: 10px; right: 10px;")+(null!=i.height?"height: "+i.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(i.hideOnClick===!0?t.param?'onclick="'+t.path+".message('"+t.param+"');\"":'onclick="'+t.path+'.message();"':"")+"></div>"),e(t.box).find("#w2ui-message"+p).data("options",i).data("prev_focus",e(":focus"));var g=e(t.box).find("#w2ui-message"+p).css("display");if(e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transform:"none"==g?"translateY(-"+i.height+"px)":"translateY(0px)"})),"none"==g){if(e(t.box).find("#w2ui-message"+p).show().html(i.html),i.box=e(t.box).find("#w2ui-message"+p),r=i.trigger({phase:"before",type:"open",target:"self"}),r.isCancelled===!0)return u.css("z-index",u.data("old-z-index")),void e(t.box).find("#w2ui-message"+p).remove();setTimeout(function(){e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transform:"none"==g?"translateY(0px)":"translateY(-"+i.height+"px)"}))},1),0===p&&this.lock&&(t.param?this.lock(t.param):this.lock()),setTimeout(function(){e(t.box).find("#w2ui-message"+p).css(w2utils.cssPrefix({transition:"0s"})),i.trigger(e.extend(r,{phase:"after"}))},350)}}}function z(t,i){var n=e(t),s={left:parseInt(n.css("border-left-width"))||0,right:parseInt(n.css("border-right-width"))||0,top:parseInt(n.css("border-top-width"))||0,bottom:parseInt(n.css("border-bottom-width"))||0},r={left:parseInt(n.css("margin-left"))||0,right:parseInt(n.css("margin-right"))||0,top:parseInt(n.css("margin-top"))||0,bottom:parseInt(n.css("margin-bottom"))||0},o={left:parseInt(n.css("padding-left"))||0,right:parseInt(n.css("padding-right"))||0,top:parseInt(n.css("padding-top"))||0,bottom:parseInt(n.css("padding-bottom"))||0};switch(i){case"top":return s.top+r.top+o.top;case"bottom":return s.bottom+r.bottom+o.bottom;case"left":return s.left+r.left+o.left;case"right":return s.right+r.right+o.right;case"width":return s.left+s.right+r.left+r.right+o.left+o.right+parseInt(n.width());case"height":return s.top+s.bottom+r.top+r.bottom+o.top+o.bottom+parseInt(n.height());case"+width":return s.left+s.right+r.left+r.right+o.left+o.right;case"+height":return s.top+s.bottom+r.top+r.bottom+o.top+o.bottom}return 0}function D(t,i){var n,s='<div id="_tmp_width" style="position: absolute; top: -900px;'+(i||"")+'">'+b(t)+"</div>";return e("body").append(s),n=e("#_tmp_width").width(),e("#_tmp_width").remove(),n}function P(e){var t=this.settings.phrases[e];return null==t?e:t}function I(t){return t||(t="en-us"),"string"!=typeof t?void(w2utils.settings=e.extend(!0,w2utils.settings,t)):(5===t.length&&(t="locale/"+t+".json"),w2utils.settings.phrases={},void e.ajax({url:t,type:"GET",dataType:"JSON",async:!1,success:function(t,i,n){w2utils.settings=e.extend(!0,w2utils.settings,t)},error:function(e,i,n){console.log("ERROR: Cannot load locale "+t)}}))}function O(){if(B.scrollBarSize)return B.scrollBarSize;var t='<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>';return e("body").append(t),B.scrollBarSize=100-e("#_scrollbar_width > div").width(),e("#_scrollbar_width").remove(),String(navigator.userAgent).indexOf("MSIE")>=0&&(B.scrollBarSize=B.scrollBarSize/2),B.scrollBarSize}function R(e,t){return e&&null!=e.name?null!=w2ui[e.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+e.name+")."),!1):!!w2utils.isAlphaNumeric(e.name)||(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+t+"()."),!1)}function A(t,i,n,s){e.isArray(i)||(i=[i]);for(var r=0;r<i.length;r++)if(i[r].id===t)return console.log('ERROR: The parameter "id='+t+'" is not unique within the current '+n+". (obj: "+s+")"),!1;return!0}function F(e){var t=[],i=e.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,i,n,s,r,o){return t.push({name:s,optional:!!o}),i=i||"",""+(o?"":i)+"(?:"+(o?i:"")+(n||"")+(r||n&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+i+"$","i"),keys:t}}function M(t,i,n){var s={},r={},o="";e.isPlainObject(t)?(s=t,i===!0&&(n=!0)):s[t]=i;for(var a in s)r[a]=s[a],r["-webkit-"+a]=s[a],r["-moz-"+a]=s[a].replace("-webkit-","-moz-"),r["-ms-"+a]=s[a].replace("-webkit-","-ms-"),r["-o-"+a]=s[a].replace("-webkit-","-o-");if(n===!0)for(var a in r)o+=a+": "+r[a]+"; ";else o=r;return o}function N(e){if(null==e)return null;var t,i=0,n=e.ownerDocument||e.document,s=n.defaultView||n.parentWindow;if(e.tagName&&"INPUT"==e.tagName.toUpperCase()&&e.selectionStart)i=e.selectionStart;else if(s.getSelection){if(t=s.getSelection(),t.rangeCount>0){var r=t.getRangeAt(0),o=r.cloneRange();o.selectNodeContents(e),o.setEnd(r.endContainer,r.endOffset),i=o.toString().length}}else if((t=n.selection)&&"Control"!=t.type){var a=t.createRange(),l=n.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",a),i=l.text.length}return i}function L(t,i,n){var s,r=document.createRange(),o=window.getSelection();if(null!=t){for(var a=0;a<t.childNodes.length;a++){var l=e(t.childNodes[a]).text();if(t.childNodes[a].tagName&&(l=e(t.childNodes[a]).html(),l=l.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&nbsp;/g," ")),i<=l.length){s=t.childNodes[a],s.childNodes&&s.childNodes.length>0&&(s=s.childNodes[0]),s.childNodes&&s.childNodes.length>0&&(s=s.childNodes[0]);break}i-=l.length}null!=s&&(i>s.length&&(i=s.length),r.setStart(s,i),n?r.setEnd(s,n):r.collapse(!0),o.removeAllRanges(),o.addRange(r))}}function H(){var e="w2ui_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}var B={},V={version:"1.5.x",settings:{locale:"en-us",dateFormat:"m/d/yyyy",timeFormat:"hh:mi pm",datetimeFormat:"m/d/yyyy|hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fullmonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortdays:["M","T","W","T","F","S","S"],fulldays:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekStarts:"M",dataType:"HTTPJSON",phrases:{},dateStartYear:1950,dateEndYear:2020},isBin:t,isInt:i,isFloat:n,isMoney:s,isHex:r,isAlphaNumeric:o,isEmail:a,isDate:l,isTime:c,isDateTime:d,age:u,interval:h,date:p,formatSize:f,formatNumber:g,formatDate:m,formatTime:v,formatDateTime:w,stripTags:y,encodeTags:b,decodeTags:x,escapeId:_,base64encode:C,base64decode:k,md5:T,transition:S,lock:E,unlock:$,message:j,lang:P,locale:I,getSize:z,getStrWidth:D,scrollBarSize:O,checkName:R,checkUniqueId:A,parseRoute:F,cssPrefix:M,getCursorPosition:N,setCursorPosition:L,testLocalStorage:H,hasLocalStorage:H(),isIOS:navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipod")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1,isIE:navigator.userAgent.toLowerCase().indexOf("msie")!=-1||navigator.userAgent.toLowerCase().indexOf("trident")!=-1};return V}(jQuery);w2utils.formatters={number:function(e,t){return parseInt(t)>20&&(t=20),parseInt(t)<0&&(t=0),null==e||""===e?"":w2utils.formatNumber(parseFloat(e),t,!0)},float:function(e,t){return w2utils.formatters.number(e,t)},int:function(e,t){return w2utils.formatters.number(e,0)},money:function(e,t){if(null==e||""===e)return"";var i=w2utils.formatNumber(Number(e),w2utils.settings.currencyPrecision||2);return(w2utils.settings.currencyPrefix||"")+i+(w2utils.settings.currencySuffix||"")},currency:function(e,t){return w2utils.formatters.money(e,t)},percent:function(e,t){return null==e||""===e?"":w2utils.formatNumber(e,t||1)+"%"},size:function(e,t){return null==e||""===e?"":w2utils.formatSize(parseInt(e))},date:function(e,t){if(""===t&&(t=w2utils.settings.dateFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return i===!1&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDate(i,t)+"</span>"},datetime:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return i===!1&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatDateTime(i,t)+"</span>"},time:function(e,t){if(""===t&&(t=w2utils.settings.timeFormat),"h12"===t&&(t="hh:mi pm"),"h24"===t&&(t="h24:mi"),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return i===!1&&(i=w2utils.isDate(e,t,!0)),'<span title="'+i+'">'+w2utils.formatTime(e,t)+"</span>"},timestamp:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return i===!1&&(i=w2utils.isDate(e,t,!0)),i.toString?i.toString():""},gmt:function(e,t){if(""===t&&(t=w2utils.settings.datetimeFormat),null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,t,!0);return i===!1&&(i=w2utils.isDate(e,t,!0)),i.toUTCString?i.toUTCString():""},age:function(e,t){if(null==e||0===e||""===e)return"";var i=w2utils.isDateTime(e,null,!0);return i===!1&&(i=w2utils.isDate(e,null,!0)),'<span title="'+i+'">'+w2utils.age(e)+(t?" "+t:"")+"</span>"},interval:function(e,t){return null==e||0===e||""===e?"":w2utils.interval(e)+(t?" "+t:"")},toggle:function(e,t){return e?"Yes":""},password:function(e,t){for(var i="",n=0;n<e.length;n++)i+="*";return i}},w2utils.event={on:function(e,t){var i=jQuery;if("string"==typeof e&&e.indexOf(":")!=-1){var n=e.split(":");["complete","done"].indexOf(e[1])!=-1&&(e[1]="after"),e={type:n[0],execute:n[1]}}return i.isPlainObject(e)||(e={type:e}),e=i.extend({type:null,execute:"before",target:null,onComplete:null},e),e.type?t?(i.isArray(this.handlers)||(this.handlers=[]),void this.handlers.push({edata:e,handler:t})):void console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):void console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(e,t){var i=jQuery;if("string"==typeof e&&e.indexOf(":")!=-1){var n=e.split(":");["complete","done"].indexOf(e[1])!=-1&&(e[1]="after"),e={type:n[0],execute:n[1]}}if(i.isPlainObject(e)||(e={type:e}),e=i.extend({},{type:null,execute:"before",target:null,onComplete:null},e),!e.type)return void console.log("ERROR: You must specify event type when calling .off() method of "+this.name);t||(t=null);for(var s=[],r=0,o=this.handlers.length;r<o;r++){var a=this.handlers[r];(a.edata.type!==e.type&&"*"!==e.type||a.edata.target!==e.target&&null!=e.target||a.edata.execute!==e.execute&&null!=e.execute||a.handler!==t&&null!=t)&&s.push(a)}this.handlers=s},trigger:function(e){var t=jQuery,e=t.extend({type:null,phase:"before",target:null,doneHandlers:[]},e,{isStopped:!1,isCancelled:!1,done:function(e){this.doneHandlers.push(e)},preventDefault:function(){this.isCancelled=!0},stopPropagation:function(){this.isStopped=!0}});"before"===e.phase&&(e.onComplete=null);var i,n,s;null==e.target&&(e.target=null),t.isArray(this.handlers)||(this.handlers=[]);for(var r=this.handlers.length-1;r>=0;r--){var o=this.handlers[r];if(!(o.edata.type!==e.type&&"*"!==o.edata.type||o.edata.target!==e.target&&null!=o.edata.target||o.edata.execute!==e.phase&&"*"!==o.edata.execute&&"*"!==o.edata.phase)&&(e=t.extend({},o.edata,e),i=[],s=new RegExp(/\((.*?)\)/).exec(o.handler),s&&(i=s[1].split(/\s*,\s*/)),2===i.length?o.handler.call(this,e.target,e):o.handler.call(this,e),e.isStopped===!0||e.stop===!0))return e}var a="on"+e.type.substr(0,1).toUpperCase()+e.type.substr(1);if("before"===e.phase&&"function"==typeof this[a]&&(n=this[a],i=[],s=new RegExp(/\((.*?)\)/).exec(n),s&&(i=s[1].split(/\s*,\s*/)),2===i.length?n.call(this,e.target,e):n.call(this,e),e.isStopped===!0||e.stop===!0))return e;if(null!=e.object&&"before"===e.phase&&"function"==typeof e.object[a]&&(n=e.object[a],i=[],s=new RegExp(/\((.*?)\)/).exec(n),s&&(i=s[1].split(/\s*,\s*/)),2===i.length?n.call(this,e.target,e):n.call(this,e),e.isStopped===!0||e.stop===!0))return e;if("after"===e.phase){"function"==typeof e.onComplete&&e.onComplete.call(this,e);for(var l=0;l<e.doneHandlers.length;l++)"function"==typeof e.doneHandlers[l]&&e.doneHandlers[l].call(this,e)}return e}},function(e){e.fn.w2render=function(t){e(this).length>0&&("string"==typeof t&&w2ui[t]&&w2ui[t].render(e(this)[0]),"object"==typeof t&&t.render(e(this)[0]))},e.fn.w2destroy=function(e){!e&&this.length>0&&(e=this.attr("name")),"string"==typeof e&&w2ui[e]&&w2ui[e].destroy(),"object"==typeof e&&e.destroy()},e.fn.w2marker=function(){function t(e,t){for(;t.innerHTML.indexOf('<span class="w2ui-marker">')!=-1;)t.innerHTML=t.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>((.|\n|\r)*)\<\/span\>/gi,"$1")}var i=Array.prototype.slice.call(arguments,0);return Array.isArray(i[0])&&(i=i[0]),0!==i.length&&i[0]?e(this).each(function(e,n){function s(e){return'<span class="w2ui-marker">'+e+"</span>"}t(e,n);for(var r=0;r<i.length;r++){var o=i[r];"string"!=typeof o&&(o=String(o)),o=o.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");var a=new RegExp(o+"(?!([^<]+)?>)","gi");n.innerHTML=n.innerHTML.replace(a,s)}}):e(this).each(t)},e.fn.w2tag=function(t,i){return 1==arguments.length&&"object"==typeof t&&(i=t,null!=i.html&&(t=i.html)),i=e.extend({id:null,html:t,position:"right|top",align:"none",left:0,top:0,style:"",css:{},className:"",inputClass:"",onShow:null,onHide:null,hideOnKeyPress:!0,hideOnBlur:!1,hideOnClick:!1},i),null!=i.name&&null==i.id&&(i.id=i.name),""!==i.class&&""===i.inputClass&&(i.inputClass=i.class),0===e(this).length?void e(".w2ui-tag").each(function(t,i){var n=e(i).data("options");null==n&&(n={}),e(e(i).data("taged-el")).removeClass(n.inputClass).removeData("w2tag").removeData("checkIfMoved"),clearInterval(e(i).data("timer")),e(i).remove()}):e(this).each(function(n,s){function r(){c=e("#w2ui-tag-"+l),c.length<=0||(clearInterval(c.data("timer")),c.remove(),e(document).off(".w2tag"),e(s).off(".w2tag",r).removeClass(i.inputClass).removeData("w2tag").removeData("checkIfMoved"),e(s).length>0&&(e(s)[0].style.cssText=d),"function"==typeof i.onHide&&i.onHide())}function o(t,n){var a=e(s).offset();if(0===e(s).length||0===a.left&&0===a.top||0===c.find(".w2ui-tag-body").length)return clearInterval(c.data("timer")),void r();n||setTimeout(o,100);var l="w2ui-tag-right",d=parseInt(a.left+s.offsetWidth+(i.left?i.left:0)),u=parseInt(a.top+(i.top?i.top:0)),h=c.find(".w2ui-tag-body"),p=h[0].offsetWidth,f=h[0].offsetHeight;if("string"==typeof i.position&&i.position.indexOf("|")!=-1&&(i.position=i.position.split("|")),"top"==i.position)l="w2ui-tag-top",d=parseInt(a.left+(i.left?i.left:0))-14,u=parseInt(a.top+(i.top?i.top:0))-f-10;else if("bottom"==i.position)l="w2ui-tag-bottom",d=parseInt(a.left+(i.left?i.left:0))-14,u=parseInt(a.top+s.offsetHeight+(i.top?i.top:0))+10;else if("left"==i.position)l="w2ui-tag-left",d=parseInt(a.left+(i.left?i.left:0))-p-20,u=parseInt(a.top+(i.top?i.top:0));else if(Array.isArray(i.position)){for(var g=window.innerWidth,m=window.innerHeight,v=0;v<i.position.length;v++){var w=i.position[v];if("right"==w){if(l="w2ui-tag-right",d=parseInt(a.left+s.offsetWidth+(i.left?i.left:0)),
u=parseInt(a.top+(i.top?i.top:0)),d+p<=g)break}else if("left"==w){if(l="w2ui-tag-left",d=parseInt(a.left+(i.left?i.left:0))-p-20,u=parseInt(a.top+(i.top?i.top:0)),d>=0)break}else if("top"==w){if(l="w2ui-tag-top",d=parseInt(a.left+(i.left?i.left:0))-14,u=parseInt(a.top+(i.top?i.top:0))-f-10,d+p<=g&&u>=0)break}else if("bottom"==w&&(l="w2ui-tag-bottom",d=parseInt(a.left+(i.left?i.left:0))-14,u=parseInt(a.top+s.offsetHeight+(i.top?i.top:0))+10,d+p<=g&&u+f<=m))break}h.data("posClass")!==l&&h.removeClass("w2ui-tag-right w2ui-tag-left w2ui-tag-top w2ui-tag-bottom").addClass(l).data("posClass",l)}return c.data("position")!==d+"x"+u&&t!==!0&&c.css(w2utils.cssPrefix({transition:n?"0s":".2s"})).css({left:d+"px",top:u+"px"}).data("position",d+"x"+u),{left:d,top:u,posClass:l}}var a=i.id?i.id:s.id,l=w2utils.escapeId(a),c=e("#w2ui-tag-"+l);if(""===t||null==t)return c.css("opacity",0),clearInterval(c.data("timer")),void c.remove();if(0!==c.length)i=e.extend(c.data("options"),i),c.data("options",i),c.find(".w2ui-tag-body").attr("style",i.style).addClass(i.className).html(i.html),o(!0);else{var d="";e(s).length>0&&(d=e(s)[0].style.cssText),e("body").append('<div onclick="event.stopPropagation()" style="display:none;" id="w2ui-tag-'+a+'"        class="w2ui-tag '+(e(s).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-tag-popup":"")+'">   <div style="margin: -2px 0px 0px -2px; white-space: nowrap;">      <div class="w2ui-tag-body '+i.className+'" style="'+(i.style||"")+'">'+t+"</div>   </div></div>"),c=e("#w2ui-tag-"+l),e(s).data("w2tag",c.get(0)).data("checkIfMoved",o)}setTimeout(function(){if(c.css("display","block"),e(s).offset()){var t=o(!0);null!=t&&(c.css({opacity:"1",left:t.left+"px",top:t.top+"px"}).data("options",i).data("taged-el",s).data("position",t.left+"x"+t.top).data("timer",setTimeout(o,100)).find(".w2ui-tag-body").addClass(t.posClass),e(s).css(i.css).off(".w2tag").addClass(i.inputClass),i.hideOnKeyPress&&e(s).on("keypress.w2tag",r),i.hideOnBlur&&e(s).on("blur.w2tag",r),i.hideOnClick&&e(document).on("click.w2tag",r),"function"==typeof i.onShow&&i.onShow())}},1)})},e.fn.w2overlay=function(t,i){function n(){var t=e("#w2ui-overlay"+a);if(t.data("element")===o[0]&&0!==t.length){var i=e(o).offset()||{},r=i.left+"x"+i.top;t.data("position")!==r?s():setTimeout(n,250)}}function s(t){if(!t||0===t.button){var n=e("#w2ui-overlay"+a);if(n.data("keepOpen")===!0)return void n.removeData("keepOpen");var r;"function"==typeof i.onHide&&(r=i.onHide()),r!==!1&&(n.remove(),e(document).off("click",s),clearInterval(n.data("timer")))}}function r(){var t=e("#w2ui-overlay"+a),n=t.find(" > div"),s=e("#w2ui-overlay"+a+" div.menu");if(s.css("overflow-y","hidden"),t.length>0){n.height("auto").width("auto");var l=!1,c=n.height(),d=n.width();i.width&&i.width<d&&(d=i.width),d<30&&(d=30),i.tmp.contentHeight&&(c=parseInt(i.tmp.contentHeight),n.height(c),setTimeout(function(){var e=n.find("div.menu");c>e.height()&&n.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){var e=n.find("div.menu");"auto"!=e.css("overflow-y")&&e.css("overflow-y","auto")},10)),i.tmp.contentWidth&&"both"!=i.align&&(d=parseInt(i.tmp.contentWidth),n.width(d),setTimeout(function(){d>n.find("div.menu > table").width()&&n.find("div.menu > table").css("overflow-x","hidden")},1),setTimeout(function(){n.find("div.menu > table").css("overflow-x","auto")},10));var u=i.left,h=i.width,p=i.tipLeft;switch(i.align){case"both":u=17,0===i.width&&(i.width=w2utils.getSize(e(o),"width")),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth);break;case"left":u=17;break;case"right":u=w2utils.getSize(e(o),"width")-d+10,p=d-40}h=30!==d||h?i.width?i.width:"auto":30;var f=(d-17)/2;"auto"!=h&&(f=(h-17)/2),f<25&&(u=25-f,p=Math.floor(f));var g,m,v;if(i.contextMenu)g=i.pageX+8,m=i.pageY-0,v=i.pageY;else{var w=o.offset()||{};g=(w.left>25?w.left:25)+u,m=w.top+w2utils.getSize(o,"height")+i.top+7,v=w.top}t.css({left:g+"px",top:m+"px","min-width":h,"min-height":i.height?i.height:"auto"});var w=n.offset()||{},y=window.innerHeight+e(document).scrollTop()-w.top-7,b=window.innerWidth+e(document).scrollLeft()-w.left-7;if(i.contextMenu&&(y=window.innerHeight+e(document).scrollTop()-i.pageY-15,b=window.innerWidth+e(document).scrollLeft()-i.pageX),y>-50&&y<210||i.openAbove===!0){var x;i.contextMenu?(y=i.pageY-7,x=5):(y=w.top-e(document).scrollTop()-7,x=24),i.maxHeight&&y>i.maxHeight&&(y=i.maxHeight),c>y&&(l=!0,n.height(y).width(d).css({"overflow-y":"auto"}),c=y),t.addClass("bottom-arrow"),t.css("top",v-c-x+i.top+"px"),t.find(">style").html("#w2ui-overlay"+a+":before { margin-left: "+parseInt(p)+"px; }#w2ui-overlay"+a+":after { margin-left: "+parseInt(p)+"px; }")}else i.maxHeight&&y>i.maxHeight&&(y=i.maxHeight),c>y&&(l=!0,n.height(y).width(d).css({"overflow-y":"auto"})),t.addClass("top-arrow"),t.find(">style").html("#w2ui-overlay"+a+":before { margin-left: "+parseInt(p)+"px; }#w2ui-overlay"+a+":after { margin-left: "+parseInt(p)+"px; }");d=n.width(),b=window.innerWidth+e(document).scrollLeft()-w.left-7,i.maxWidth&&b>i.maxWidth&&(b=i.maxWidth),d>b&&"both"!==i.align&&(i.align="right",setTimeout(function(){r()},1)),(i.contextMenu||i.noTip)&&t.find(">style").html("#w2ui-overlay"+a+":before { display: none; }#w2ui-overlay"+a+":after { display: none; }"),l&&"both"!=i.align&&n.width(d+w2utils.scrollBarSize()+2)}s.css("overflow-y","auto")}var o=this,a="",l={name:null,html:"",align:"none",left:0,top:0,tipLeft:30,noTip:!1,selectable:!1,width:0,height:0,maxWidth:null,maxHeight:null,contextMenu:!1,pageX:null,pageY:null,originalEvent:null,style:"",class:"",overlayStyle:"",onShow:null,onHide:null,openAbove:!1,tmp:{}};1==arguments.length&&(i="object"==typeof t?t:{html:t}),2==arguments.length&&(i.html=t),e.isPlainObject(i)||(i={}),i=e.extend({},l,i),i.name&&(a="-"+i.name);var c;if(0===this.length||""===i.html||null==i.html)return e("#w2ui-overlay"+a).length>0?(c=e("#w2ui-overlay"+a)[0].hide,"function"==typeof c&&c()):e("#w2ui-overlay"+a).remove(),e(this);e("#w2ui-overlay"+a).length>0&&(c=e("#w2ui-overlay"+a)[0].hide,e(document).off(".w2overlayHide"),"function"==typeof c&&c()),o.length>0&&(null==o[0].tagName||"BODY"==o[0].tagName.toUpperCase())&&(i.contextMenu=!0),i.contextMenu&&i.originalEvent&&(i.pageX=i.originalEvent.pageX,i.pageY=i.originalEvent.pageY),!i.contextMenu||null!=i.pageX&&null!=i.pageY||console.log("ERROR: to display menu at mouse location, pass options.pageX and options.pageY."),e("body").append('<div id="w2ui-overlay'+a+'" style="display: none; left: 0px; top: 0px; '+i.overlayStyle+'"        class="w2ui-reset w2ui-overlay '+(e(this).parents(".w2ui-popup, .w2ui-overlay-popup, .w2ui-message").length>0?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="min-width: 100%; '+i.style+'" class="'+i.class+'"></div></div>');var d=e("#w2ui-overlay"+a),u=d.find(" > div");u.html(i.html);var h=u.css("background-color");null!=h&&"rgba(0, 0, 0, 0)"!==h&&"transparent"!==h&&d.css({"background-color":h,"border-color":h});var p=e(o).offset()||{};return d.data("element",o.length>0?o[0]:null).data("options",i).data("position",p.left+"x"+p.top).fadeIn("fast").on("click",function(e){"LABEL"==e.target.tagName.toUpperCase()&&e.stopPropagation()}).on("mousedown",function(t){e("#w2ui-overlay"+a).data("keepOpen",!0),["INPUT","TEXTAREA","SELECT"].indexOf(t.target.tagName.toUpperCase())!=-1||i.selectable||t.preventDefault()}),d[0].hide=s,d[0].resize=r,setTimeout(function(){r(),e(document).off(".w2overlayHide").on("click.w2overlayHide",s),"function"==typeof i.onShow&&i.onShow()},10),n(),e(this)},e.fn.w2menu=function(t,i){function n(){setTimeout(function(){e("#w2ui-overlay"+l+" tr.w2ui-selected").removeClass("w2ui-selected");var t=e("#w2ui-overlay"+l+" tr[index="+i.index+"]"),n=e("#w2ui-overlay"+l+" div.menu").scrollTop();if(t.addClass("w2ui-selected"),i.tmp&&(i.tmp.contentHeight=e("#w2ui-overlay"+l+" table").height()+(i.search?50:10)),i.tmp&&(i.tmp.contentWidth=e("#w2ui-overlay"+l+" table").width()),e("#w2ui-overlay"+l).length>0&&e("#w2ui-overlay"+l)[0].resize(),t.length>0){var s=t[0].offsetTop-5,r=e("#w2ui-overlay"+l+" div.menu"),o=r.height();e("#w2ui-overlay"+l+" div.menu").scrollTop(n),(s<n||s+t.height()>n+o)&&e("#w2ui-overlay"+l+" div.menu").animate({scrollTop:s-(o-2*t.height())/2},200,"linear")}},1)}function s(t){var s=this.value,r=t.keyCode,o=!1;switch(r){case 13:e("#w2ui-overlay"+l).remove(),e.fn.w2menuClick(t,i.index);break;case 9:case 27:e("#w2ui-overlay"+l).remove(),e.fn.w2menuClick(t,-1);break;case 38:for(i.index=w2utils.isInt(i.index)?parseInt(i.index):0,i.index--;i.index>0&&i.items[i.index].hidden;)i.index--;if(0===i.index&&i.items[i.index].hidden)for(;i.items[i.index]&&i.items[i.index].hidden;)i.index++;i.index<0&&(i.index=0),o=!0;break;case 40:for(i.index=w2utils.isInt(i.index)?parseInt(i.index):0,i.index++;i.index<i.items.length-1&&i.items[i.index].hidden;)i.index++;if(i.index===i.items.length-1&&i.items[i.index].hidden)for(;i.items[i.index]&&i.items[i.index].hidden;)i.index--;i.index>=i.items.length&&(i.index=i.items.length-1),o=!0}if(!o){for(var c=0,d=0;d<i.items.length;d++){var u=i.items[d],h="",p="";["is","begins with"].indexOf(i.match)!==-1&&(h="^"),["is","ends with"].indexOf(i.match)!==-1&&(p="$");try{var f=new RegExp(h+s+p,"i");f.test(u.text)||"..."===u.text?u.hidden=!1:u.hidden=!0}catch(e){}"enum"===a.type&&e.inArray(u.id,ids)!==-1&&(u.hidden=!0),u.hidden!==!0&&c++}for(i.index=0;i.index<i.items.length-1&&i.items[i.index].hidden;)i.index++;c<=0&&(i.index=-1)}e(a).w2menu("refresh",i),n()}function r(){if(i.spinner)return'<table class="w2ui-drop-menu"><tbody><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+w2utils.lang("Loading...")+"</div></td></tr></tbody></table>";for(var e=0,t='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu"><tbody>',n=null,s=null,r=0;r<i.items.length;r++){var o=i.items[r];if("string"==typeof o?o={id:o,text:o}:(null!=o.text&&null==o.id&&(o.id=o.text),null==o.text&&null!=o.id&&(o.text=o.id),null!=o.caption&&(o.text=o.caption),n=o.img,s=o.icon,null==n&&(n=null),null==s&&(s=null)),["radio","check"].indexOf(i.type)!=-1&&(s=o.checked===!0?"w2ui-icon-check":"w2ui-icon-empty"),o.hidden!==!0){var a="",l=o.text;if("function"==typeof i.render&&(l=i.render(o,i)),n&&(a='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+n+'"></div></td>'),s&&(a='<td class="menu-icon" align="center"><span class="w2ui-icon '+s+'"></span></td>'),null==l||""===l||/^-+$/.test(l))t+='<tr><td colspan="3" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var c=e%2===0?"w2ui-item-even":"w2ui-item-odd";i.altRows!==!0&&(c="");var d=1;""===a&&d++,null==o.count&&null==o.hotkey&&d++,null==o.tooltip&&null!=o.hint&&(o.tooltip=o.hint),t+='<tr index="'+r+'" style="'+(o.style?o.style:"")+'" '+(o.tooltip?'title="'+w2utils.lang(o.tooltip)+'"':"")+'        class="'+c+" "+(i.index===r?"w2ui-selected":"")+" "+(o.disabled===!0?"w2ui-disabled":"")+'"        onmousedown="if ('+(o.disabled===!0?"true":"false")+") return;               jQuery.fn.w2menuDown(event, '"+r+'\');"        onclick="event.stopPropagation();                if ('+(o.disabled===!0?"true":"false")+") return;               jQuery.fn.w2menuClick(event, '"+r+"');\">"+a+'   <td class="menu-text" colspan="'+d+'">'+w2utils.lang(l)+'</td>   <td class="menu-count">'+(null!=o.count?"<span>"+o.count+"</span>":"")+(null!=o.hotkey?'<span class="hotkey">'+o.hotkey+"</span>":"")+"</td></tr>",e++}}i.items[r]=o}return 0===e&&(t+='<tr><td style="padding: 13px; color: #999; text-align: center">'+i.msgNoItems+"</div></td></tr>"),t+="</tbody></table>"}i&&"function"==typeof i.items&&(i.items=i.items());var o={type:"normal",index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},a=this,l="";if("refresh"===t)if(e("#w2ui-overlay"+l).length>0){i=e.extend(e.fn.w2menuOptions,i);var c=e("#w2ui-overlay"+l+" div.menu").scrollTop();e("#w2ui-overlay"+l+" div.menu").html(r()),e("#w2ui-overlay"+l+" div.menu").scrollTop(c),n()}else e(this).w2menu(i);else{if("refresh-index"!==t){1===arguments.length?i=t:i.items=t,"object"!=typeof i&&(i={}),i=e.extend({},o,i),e.fn.w2menuOptions=i,i.name&&(l="-"+i.name),"function"==typeof i.select&&"function"!=typeof i.onSelect&&(i.onSelect=i.select),"function"==typeof i.onRender&&"function"!=typeof i.render&&(i.render=i.onRender),e.fn.w2menuClick=function(t,n){var s=!1;["radio","check"].indexOf(i.type)!=-1&&(t.shiftKey||t.metaKey||t.ctrlKey)&&(s=!0),"function"==typeof i.onSelect&&setTimeout(function(){i.onSelect({index:n,item:i.items[n],keepOpen:s,originalEvent:t})},10);var r=e("#w2ui-overlay"+l);r.removeData("keepOpen"),"function"!=typeof r[0].hide||s||r[0].hide()},e.fn.w2menuDown=function(t,n){var s=e(t.target).parents("tr"),r=s.find(".w2ui-icon");if("check"==i.type||"radio"==i.type){var o=i.items[n];o.checked=!o.checked,o.checked?("radio"==i.type&&r.parents("table").find(".w2ui-icon").removeClass("w2ui-icon-check").addClass("w2ui-icon-empty"),r.removeClass("w2ui-icon-empty").addClass("w2ui-icon-check")):"check"==i.type&&r.removeClass("w2ui-icon-check").addClass("w2ui-icon-empty")}s.parent().find("tr").removeClass("w2ui-selected"),s.addClass("w2ui-selected")};var d="";if(i.search){d+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"/></div>',i.style+=";background-color: #ECECEC",i.index=0;for(var u=0;u<i.items.length;u++)i.items[u].hidden=!1}d+='<div class="menu" style="position: absolute; top: '+(i.search?40:0)+'px; bottom: 0px; width: 100%;">'+r()+"</div>";var h=e(this).w2overlay(d,i);return setTimeout(function(){if(e("#w2ui-overlay"+l+" #menu-search").on("keyup",s).on("keydown",function(e){9===e.keyCode&&(e.stopPropagation(),e.preventDefault())}),i.search){if(["text","password"].indexOf(e(a)[0].type)!=-1||"TEXTAREA"==e(a)[0].tagName.toUpperCase())return;e("#w2ui-overlay"+l+" #menu-search").focus()}n()},200),n(),h}var p=e("#w2ui-overlay"+l+" div.menu"),f=p.find("tr[index="+i.index+"]"),c=p.scrollTop();if(p.find("tr.w2ui-selected").removeClass("w2ui-selected"),f.addClass("w2ui-selected"),f.length>0){var g=f[0].offsetTop-5,m=p.height();p.scrollTop(c),(g<c||g+f.height()>c+m)&&p.animate({scrollTop:g-(m-2*f.height())/2},200,"linear")}n()}},e.fn.w2color=function(t,i){function n(e){for(var t=(e.color,'<div class="w2ui-color" onmousedown="event.stopPropagation(); event.preventDefault()"><table cellspacing="5"><tbody>'),i=0;i<o.length-1;i++){t+="<tr>";for(var n=0;n<o[i].length;n++)t+='<td>    <div class="color '+(""===o[i][n]?"no-color":"")+'" style="background-color: #'+o[i][n]+';"        name="'+o[i][n]+'" index="'+i+":"+n+'">'+(e.color==o[i][n]?"&#149;":"&#160;")+"    </div></td>",e.color==o[i][n]&&(r=[i,n]);t+="</tr>",i<2&&(t+='<tr><td style="height: 8px" colspan="8"></td></tr>')}var s=o[o.length-1];return t+='<tr><td style="height: 8px" colspan="8"></td></tr><tr>   <td colspan="4" style="text-align: left"><input placeholder="#FFF000" style="margin-left: 1px; width: 74px" maxlength="7"/></td>   <td><div class="color" style="background-color: #'+s[0]+';" name="'+s[0]+'" index="8:0">'+(e.color==s[0]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+s[1]+';" name="'+s[1]+'" index="8:0">'+(e.color==s[1]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+s[2]+';" name="'+s[2]+'" index="8:0">'+(e.color==s[2]?"&#149;":"&#160;")+'</div></td>   <td><div class="color" style="background-color: #'+s[3]+';" name="'+s[3]+'" index="8:0">'+(e.color==s[3]?"&#149;":"&#160;")+'</div></td></tr><tr><td style="height: 4px" colspan="8"></td></tr>',t+="</tbody></table></div>"}var s=e(this)[0],r=[-1,-1];null==e.fn.w2colorPalette&&(e.fn.w2colorPalette=[["000000","555555","888888","BBBBBB","DDDDDD","EEEEEE","F7F7F7","FFFFFF"],["FF011B","FF9838","FFFD59","01FD55","00FFFE","006CE7","9B24F4","FF21F5"],["FFEAEA","FCEFE1","FCF5E1","EBF7E7","E9F3F5","ECF4FC","EAE6F4","F5E7ED"],["F4CCCC","FCE5CD","FFF2CC","D9EAD3","D0E0E3","CFE2F3","D9D1E9","EAD1DC"],["EA9899","F9CB9C","FEE599","B6D7A8","A2C4C9","9FC5E8","B4A7D6","D5A6BD"],["E06666","F6B26B","FED966","93C47D","76A5AF","6FA8DC","8E7CC3","C27BA0"],["CC0814","E69138","F1C232","6AA84F","45818E","3D85C6","674EA7","A54D79"],["99050C","B45F17","BF901F","37761D","124F5C","0A5394","351C75","741B47"],["F2F2F2","F2F2F2","F2F2F2","F2F2F2","F2F2F2"]]);var o=e.fn.w2colorPalette;"string"==typeof t&&(t={color:t,transparent:!0}),t.transparent&&"555555"==o[0][1]&&(o[0].splice(1,1),o[0].push("")),t.transparent||"555555"==o[0][1]||(o[0].splice(1,0,"555555"),o[0].pop()),t.color&&(t.color=String(t.color).toUpperCase()),0===e("#w2ui-overlay").length?e(s).w2overlay(n(t),{onHide:function(){"function"==typeof i&&i(e(s).data("_color")),e(s).removeData("_color")}}):e("#w2ui-overlay .w2ui-color").parent().html(n(t)),e("#w2ui-overlay .color").off(".w2color").on("mousedown.w2color",function(t){var i=e(t.originalEvent.target).attr("name");r=e(t.originalEvent.target).attr("index").split(":"),e(s).data("_color",i)}).on("mouseup.w2color",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),e("#w2ui-overlay input").off(".w2color").on("mousedown.w2color",function(t){e("#w2ui-overlay").data("keepOpen",!0),setTimeout(function(){e("#w2ui-overlay").data("keepOpen",!0)},10),t.stopPropagation()}).on("keyup.w2color",function(e){""!==this.value&&"#"!==this.value[0]&&(this.value="#"+this.value)}).on("change.w2color",function(n){var r=this.value;return"#"==r.substr(0,1)&&(r=r.substr(1)),6!=r.length?void e(this).w2tag("Invalid color."):(e.fn.w2colorPalette[o.length-1].unshift(r.toUpperCase()),e(s).w2color(t,i),void setTimeout(function(){e("#w2ui-overlay input")[0].focus()},100))}).w2field("hex"),s.nav=function(t){switch(t){case"up":r[0]--;break;case"down":r[0]++;break;case"right":r[1]++;break;case"left":r[1]--}return r[0]<0&&(r[0]=0),r[0]>o.length-2&&(r[0]=o.length-2),r[1]<0&&(r[1]=0),r[1]>o[0].length-1&&(r[1]=o[0].length-1),color=o[r[0]][r[1]],e(s).data("_color",color),color}}}(jQuery),function($){var w2grid=function(e){this.name=null,this.box=null,this.header="",this.url="",this.routeData={},this.columns=[],this.columnGroups=[],this.records=[],this.summary=[],this.searches=[],this.searchData=[],this.sortData=[],this.postData={},this.httpHeaders={},this.toolbar={},this.stateId=null,this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarInput:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,searchAll:!0,statusRange:!0,statusBuffered:!1,statusRecordID:!0,statusSelection:!0,statusResponse:!0,statusSort:!1,statusSearch:!1,recordTitles:!0,selectionBorder:!0,skipRecords:!0,saveRestoreState:!0},this.hasFocus=!1,this.autoLoad=!0,this.fixedBody=!0,this.recordHeight=24,this.lineNumberWidth=null,this.vs_start=150,this.vs_extra=15,this.keyboard=!0,this.selectType="row",this.multiSearch=!0,this.multiSelect=!0,this.multiSort=!0,this.reorderColumns=!1,this.reorderRows=!1,this.markSearch=!0,this.columnTooltip="normal",this.disableCVS=!1,this.textSearch="begins",this.total=0,this.limit=100,this.offset=0,this.style="",this.ranges=[],this.menu=[],this.method=null,this.recid=null,this.parser=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},$.extend(!0,this,w2obj.grid,e)};$.fn.w2grid=function(e){if($.isPlainObject(e)){if(!w2utils.checkName(e,"w2grid"))return;var t=e.columns,i=e.columnGroups,n=e.records,s=e.searches,r=e.searchData,o=e.sortData,a=e.postData,l=e.httpHeaders,c=e.toolbar,d=new w2grid(e);$.extend(d,{postData:{},httpHeaders:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]}),null!=d.onExpand&&(d.show.expandColumn=!0),$.extend(!0,d.toolbar,c);var u;if(t)for(u=0;u<t.length;u++)d.columns[u]=$.extend(!0,{},t[u]);if(i)for(u=0;u<i.length;u++)d.columnGroups[u]=$.extend(!0,{},i[u]);if(s)for(u=0;u<s.length;u++)d.searches[u]=$.extend(!0,{},s[u]);if(r)for(u=0;u<r.length;u++)d.searchData[u]=$.extend(!0,{},r[u]);if(o)for(u=0;u<o.length;u++)d.sortData[u]=$.extend(!0,{},o[u]);if(d.postData=$.extend(!0,{},a),d.httpHeaders=$.extend(!0,{},l),n)for(var h=0;h<n.length;h++){if(null==n[h].recid&&null==n[h][d.recid])return void console.log("ERROR: Cannot add records without recid. (obj: "+d.name+")");d.records[h]=$.extend(!0,{},n[h])}for(var p=0;p<d.columns.length;p++){var f=d.columns[p],g=f.searchable;if(null!=g&&g!==!1&&null==d.getSearch(f.field))if($.isPlainObject(g))d.addSearch($.extend({field:f.field,caption:f.caption,type:"text"},g));else{var m=f.searchable,v="";f.searchable===!0&&(m="text",v='size="20"'),d.addSearch({field:f.field,caption:f.caption,type:m,attr:v})}}return d.initToolbar(),0!==$(this).length&&d.render($(this)[0]),w2ui[d.name]=d,d}var w=w2ui[$(this).attr("name")];return w?arguments.length>0?(w[e]&&w[e].apply(w,Array.prototype.slice.call(arguments,1)),this):w:null},w2grid.prototype={msgDelete:"Are you sure you want to delete selected records?",msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgNeedReload:"Your remote data source record count has changed, reloading from the first record.",msgEmpty:"",buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",tooltip:"Reload data in the list"},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",tooltip:"Show/hide columns",arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:"<div class=\"w2ui-icon icon-search-down w2ui-search-down\" onclick=\"var obj = w2ui[jQuery(this).parents('div.w2ui-grid').attr('name')]; obj.searchShowFields();\"></div>"},"search-go":{type:"drop",id:"w2ui-search-advanced",icon:"w2ui-icon-search",text:"Search",tooltip:"Open Search Fields"},add:{type:"button",id:"w2ui-add",text:"Add New",tooltip:"Add new record",icon:"w2ui-icon-plus"},edit:{type:"button",id:"w2ui-edit",text:"Edit",tooltip:"Edit selected record",icon:"w2ui-icon-pencil",disabled:!0},delete:{type:"button",id:"w2ui-delete",text:"Delete",tooltip:"Delete selected records",icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",text:"Save",tooltip:"Save changed records",icon:"w2ui-icon-check"}},operators:{text:["is","begins","contains","ends"],number:["is","between",{oper:"less",text:"less than"},{oper:"more",text:"more than"}],date:["is","between",{oper:"less",text:"before"},{oper:"more",text:"after"}],list:["is"],hex:["is","between"],color:["is","begins","contains","ends"],enum:["in","not in"]},operatorsMap:{text:"text",int:"number",float:"number",money:"number",currency:"number",percent:"number",hex:"hex",alphanumeric:"text",color:"color",date:"date",time:"date",datetime:"date",list:"list",combo:"text",enum:"enum",file:"enum",select:"list",radio:"list",checkbox:"list",toggle:"list"},onAdd:null,onEdit:null,onRequest:null,onLoad:null,onDelete:null,onSave:null,onSelect:null,onUnselect:null,onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onColumnClick:null,onColumnDblClick:null,onColumnResize:null,onSort:null,onSearch:null,onSearchOpen:null,onChange:null,onRestore:null,onExpand:null,onCollapse:null,onError:null,onKeydown:null,onToolbar:null,onColumnOnOff:null,onCopy:null,onPaste:null,onSelectionExtend:null,onEditField:null,onRender:null,onRefresh:null,onReload:null,onResize:null,onDestroy:null,onStateSave:null,onStateRestore:null,onFocus:null,onBlur:null,onReorderRow:null,add:function(e,t){$.isArray(e)||(e=[e]);for(var i=0,n=0;n<e.length;n++){var s=e[n];null!=s.recid||null!=s[this.recid]?(s.w2ui&&s.w2ui.summary===!0?t?this.summary.unshift(s):this.summary.push(s):t?this.records.unshift(s):this.records.push(s),i++):console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")")}var r="object"!=typeof this.url?this.url:this.url.get;return r?(this.refresh(),i):(this.total=this.records.length,this.localSort(!1,!0),this.localSearch(),this.refreshBody(),this.resizeRecords(),i)},find:function(e,t){null==e&&(e={});var i=[],n=!1;for(var s in e)String(s).indexOf(".")!=-1&&(n=!0);for(var r=0;r<this.records.length;r++){var o=!0;for(var s in e){var a=this.records[r][s];n&&String(s).indexOf(".")!=-1&&(a=this.parseField(this.records[r],s)),"not-null"==e[s]?null!=a&&""!==a||(o=!1):e[s]!=a&&(o=!1)}o&&t!==!0&&i.push(this.records[r].recid),o&&t===!0&&i.push(r)}return i},set:function(e,t,i){if("object"==typeof e&&(i=t,t=e,e=null),null==e){for(var n=0;n<this.records.length;n++)$.extend(!0,this.records[n],t);i!==!0&&this.refresh()}else{var s=this.get(e,!0);if(null==s)return!1;var r=!this.records[s]||this.records[s].recid!=e;r?$.extend(!0,this.summary[s],t):$.extend(!0,this.records[s],t),i!==!0&&this.refreshRow(e,s)}return!0},get:function(e,t){if($.isArray(e)){for(var i=[],n=0;n<this.records.length;n++)$.inArray(this.records[n].recid,e)!=-1&&(t===!0?i.push(n):i.push(this.records[n]));for(var n=0;n<this.summary.length;n++)$.inArray(this.summary[n].recid,e)!=-1&&(t===!0?i.push(n):i.push(this.summary[n]));return i}for(var n=0;n<this.records.length;n++)if(this.records[n].recid==e)return t===!0?n:this.records[n];for(var n=0;n<this.summary.length;n++)if(this.summary[n].recid==e)return t===!0?n:this.summary[n];return null},remove:function(){for(var e=0,t=0;t<arguments.length;t++){for(var i=this.records.length-1;i>=0;i--)this.records[i].recid==arguments[t]&&(this.records.splice(i,1),e++);for(var i=this.summary.length-1;i>=0;i--)this.summary[i].recid==arguments[t]&&(this.summary.splice(i,1),e++)}var n="object"!=typeof this.url?this.url:this.url.get;return n||(this.localSort(!1,!0),this.localSearch()),this.refresh(),e},addColumn:function(e,t){var i=0;1==arguments.length?(t=e,e=this.columns.length):("string"==typeof e&&(e=this.getColumn(e,!0)),null==e&&(e=this.columns.length)),$.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){if(this.columns.splice(e,0,t[n]),t[n].searchable){var s=t[n].searchable,r="";t[n].searchable===!0&&(s="text",r='size="20"'),this.addSearch({field:t[n].field,caption:t[n].caption,type:s,attr:r})}e++,i++}return this.refresh(),i},removeColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--)this.columns[i].field==arguments[t]&&(this.columns[i].searchable&&this.removeSearch(arguments[t]),this.columns.splice(i,1),e++);return this.refresh(),e},getColumn:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.columns.length;n++)i.push(this.columns[n].field);return i}for(var n=0;n<this.columns.length;n++)if(this.columns[n].field==e)return t===!0?n:this.columns[n];return null},toggleColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var n=this.columns[i];n.field==arguments[t]&&(n.hidden=!n.hidden,e++)}return this.refreshBody(),this.resizeRecords(),e},showColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var n=this.columns[i];n.gridMinWidth&&delete n.gridMinWidth,n.field==arguments[t]&&n.hidden!==!1&&(n.hidden=!1,e++)}return this.refreshBody(),this.resizeRecords(),e},hideColumn:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.columns.length-1;i>=0;i--){var n=this.columns[i];n.field==arguments[t]&&n.hidden!==!0&&(n.hidden=!0,e++)}return this.refreshBody(),this.resizeRecords(),e},addSearch:function(e,t){var i=0;1==arguments.length?(t=e,e=this.searches.length):("string"==typeof e&&(e=this.getSearch(e,!0)),null==e&&(e=this.searches.length)),$.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++)this.searches.splice(e,0,t[n]),e++,i++;return this.searchClose(),i},removeSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches.splice(i,1),e++);return this.searchClose(),e},getSearch:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.searches.length;n++)i.push(this.searches[n].field);return i}for(var n=0;n<this.searches.length;n++)if(this.searches[n].field==e)return t===!0?n:this.searches[n];return null},toggleSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&(this.searches[i].hidden=!this.searches[i].hidden,e++);return this.searchClose(),e},showSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!1&&(this.searches[i].hidden=!1,e++);return this.searchClose(),e},hideSearch:function(){for(var e=0,t=0;t<arguments.length;t++)for(var i=this.searches.length-1;i>=0;i--)this.searches[i].field==arguments[t]&&this.searches[i].hidden!==!0&&(this.searches[i].hidden=!0,e++);return this.searchClose(),e},getSearchData:function(e){for(var t=0;t<this.searchData.length;t++)if(this.searchData[t].field==e)return this.searchData[t];return null},localSort:function(e,t){function i(){for(var e=0;e<d.records.length;e++){var t=d.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=r(t))}}function n(){for(var e=0;e<d.records.length;e++){var t=d.records[e];t.w2ui&&null!=t.w2ui.parent_recid&&(t.w2ui._path=null)}}function s(e,t){if(!(e.w2ui&&null!=e.w2ui.parent_recid||t.w2ui&&null!=t.w2ui.parent_recid))return o(e,t);for(var i=r(e),n=r(t),s=0;s<Math.min(i.length,n.length);s++){var a=o(i[s],n[s]);if(0!==a)return a}return i.length>n.length?1:i.length<n.length?-1:(console.log("ERROR: two paths should not be equal."),0)}function r(e){if(!e.w2ui||null==e.w2ui.parent_recid)return[e];if(e.w2ui._path)return e.w2ui._path;var t=d.get(e.w2ui.parent_recid);return t?r(t).concat(e):(console.log("ERROR: no parent record: "+e.w2ui.parent_recid),[e])}function o(e,t){if(e===t)return 0;for(var i=0;i<d.sortData.length;i++){var n=d.sortData[i].field;d.sortData[i].field_&&(n=d.sortData[i].field_);var s=e[n],r=t[n];String(n).indexOf(".")!=-1&&(s=d.parseField(e,n),r=d.parseField(t,n));var o=d.getColumn(n);o&&null!=o.editable&&($.isPlainObject(s)&&s.text&&(s=s.text),$.isPlainObject(r)&&r.text&&(r=r.text));var l=a(s,r,i,d.sortData[i].direction);if(0!==l)return l}var l=a(e.recid,t.recid,-1,"asc");return 0!==l?l:0}function a(e,t,i,n){if(e===t)return 0;if((null==e||""===e)&&null!=t&&""!==t)return 1;if(null!=e&&""!==e&&(null==t||""===t))return-1;var s="asc"==n?1:-1;if(typeof e!=typeof t)return typeof e>typeof t?s:-s;if(e.constructor.name!=t.constructor.name)return e.constructor.name>t.constructor.name?s:-s;e&&"object"==typeof e&&(e=e.valueOf()),t&&"object"==typeof t&&(t=t.valueOf());var r={}.toString;return e&&"object"==typeof e&&e.toString!=r&&(e=String(e)),t&&"object"==typeof t&&t.toString!=r&&(t=String(t)),"string"==typeof e&&(e=$.trim(e.toLowerCase())),"string"==typeof t&&(t=$.trim(t.toLowerCase())),e>t?s:e<t?-s:0}var l="object"!=typeof this.url?this.url:this.url.get;if(l)return void console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");if(!$.isEmptyObject(this.sortData)){var c=(new Date).getTime(),d=this;d.selectionSave(),d.prepareData(),t||d.reset();for(var u=0;u<this.sortData.length;u++){var h=this.getColumn(this.sortData[u].field);if(!h)return;"string"==typeof h.render&&(["date","age"].indexOf(h.render.split(":")[0])!=-1&&(this.sortData[u].field_=h.field+"_"),
["time"].indexOf(h.render.split(":")[0])!=-1&&(this.sortData[u].field_=h.field+"_"))}return i(),this.records.sort(function(e,t){return s(e,t)}),n(),d.selectionRestore(t),c=(new Date).getTime()-c,e!==!0&&d.show.statusSort&&setTimeout(function(){d.status(w2utils.lang("Sorting took")+" "+c/1e3+" "+w2utils.lang("sec"))},10),c}},localSearch:function(e){function t(e){for(var i=0,n=0;n<r.searchData.length;n++){var s=r.searchData[n],a=r.getSearch(s.field);if(null!=s){null==a&&(a={field:s.field,type:s.type});var l=r.parseField(e,a.field),c=null===l||void 0===l||"object"==typeof l&&l.toString==o?"":String(l).toLowerCase();if(null!=s.value)if($.isArray(s.value))var d=s.value[0],u=s.value[1];else var d=String(s.value).toLowerCase();switch(s.operator){case"is":if(r.parseField(e,a.field)==s.value)i++;else if("date"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDate(h,"yyyy-mm-dd"),d=w2utils.formatDate(w2utils.isDate(d,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");c==d&&i++}else if("time"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatTime(h,"hh24:mi"),d=w2utils.formatTime(d,"hh24:mi");c==d&&i++}else if("datetime"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),d=w2utils.formatDateTime(w2utils.isDateTime(d,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");c==d&&i++}break;case"between":if(["int","float","money","currency","percent"].indexOf(a.type)!=-1)parseFloat(r.parseField(e,a.field))>=parseFloat(d)&&parseFloat(r.parseField(e,a.field))<=parseFloat(u)&&i++;else if("date"==a.type){var c=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),d=w2utils.isDate(d,w2utils.settings.dateFormat,!0),u=w2utils.isDate(u,w2utils.settings.dateFormat,!0);null!=u&&(u=new Date(u.getTime()+864e5)),c>=d&&c<u&&i++}else if("time"==a.type){var c=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),d=w2utils.isTime(d,!0),u=w2utils.isTime(u,!0);d=(new Date).setHours(d.hours,d.minutes,d.seconds?d.seconds:0,0),u=(new Date).setHours(u.hours,u.minutes,u.seconds?u.seconds:0,0),c>=d&&c<u&&i++}else if("datetime"==a.type){var c=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),d=w2utils.isDateTime(d,w2utils.settings.datetimeFormat,!0),u=w2utils.isDateTime(u,w2utils.settings.datetimeFormat,!0);u&&(u=new Date(u.getTime()+864e5)),c>=d&&c<u&&i++}break;case"less":if(["int","float","money","currency","percent"].indexOf(a.type)!=-1)parseFloat(r.parseField(e,a.field))<=parseFloat(s.value)&&i++;else if("date"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDate(h,"yyyy-mm-dd"),d=w2utils.formatDate(w2utils.isDate(d,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");c<=d&&i++}else if("time"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatTime(h,"hh24:mi"),d=w2utils.formatTime(d,"hh24:mi");c<=d&&i++}else if("datetime"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),d=w2utils.formatDateTime(w2utils.isDateTime(d,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");c.length==d.length&&c<=d&&i++}break;case"more":if(["int","float","money","currency","percent"].indexOf(a.type)!=-1)parseFloat(r.parseField(e,a.field))>=parseFloat(s.value)&&i++;else if("date"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDate(h,"yyyy-mm-dd"),d=w2utils.formatDate(w2utils.isDate(d,w2utils.settings.dateFormat,!0),"yyyy-mm-dd");c>=d&&i++}else if("time"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatTime(h,"hh24:mi"),d=w2utils.formatTime(d,"hh24:mi");c>=d&&i++}else if("datetime"==a.type){var h=r.parseField(e,a.field+"_")instanceof Date?r.parseField(e,a.field+"_"):r.parseField(e,a.field),c=w2utils.formatDateTime(h,"yyyy-mm-dd|hh24:mm:ss"),d=w2utils.formatDateTime(w2utils.isDateTime(d,w2utils.settings.datetimeFormat,!0),"yyyy-mm-dd|hh24:mm:ss");c.length==d.length&&c>=d&&i++}break;case"in":var h=s.value;s.svalue&&(h=s.svalue),h.indexOf(w2utils.isFloat(c)?parseFloat(c):c)!==-1&&i++,h.indexOf(w2utils.isFloat(l)?parseFloat(l):l)!==-1&&i++;break;case"not in":var h=s.value;s.svalue&&(h=s.svalue),h.indexOf(w2utils.isFloat(c)?parseFloat(c):c)==-1&&i++,h.indexOf(w2utils.isFloat(l)?parseFloat(l):l)==-1&&i++;break;case"begins":case"begins with":0===c.indexOf(d)&&i++;break;case"contains":c.indexOf(d)>=0&&i++;break;case"null":null==r.parseField(e,a.field)&&i++;break;case"not null":null!=r.parseField(e,a.field)&&i++;break;case"ends":case"ends with":var p=c.lastIndexOf(d);p!==-1&&p==c.length-d.length&&i++}}}if("OR"==r.last.logic&&0!==i||"AND"==r.last.logic&&i==r.searchData.length)return!0;if(e.w2ui&&e.w2ui.children&&e.w2ui.expanded!==!0)for(var f=0;f<e.w2ui.children.length;f++){var g=e.w2ui.children[f];if(t(g))return!0}return!1}function i(e){if(void 0!==e&&!a[e]){a[e]=!0;var t=r.get(e,!0);if(null!=t&&$.inArray(t,r.last.searchIds)==-1){var n=r.records[t];n&&n.w2ui&&i(n.w2ui.parent_recid),r.last.searchIds.push(t)}}}var n="object"!=typeof this.url?this.url:this.url.get;if(n)return void console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");var s=(new Date).getTime(),r=this,o={}.toString,a={};if(this.total=this.records.length,this.last.searchIds=[],this.prepareData(),this.searchData.length>0&&!n){this.total=0;for(var l=0;l<this.records.length;l++){var c=this.records[l],d=t(c);d&&(c&&c.w2ui&&i(c.w2ui.parent_recid),this.last.searchIds.push(l))}this.total=this.last.searchIds.length}return s=(new Date).getTime()-s,e!==!0&&r.show.statusSearch&&setTimeout(function(){r.status(w2utils.lang("Search took")+" "+s/1e3+" "+w2utils.lang("sec"))},10),s},getRangeData:function(e,t){var i=this.get(e[0].recid,!0),n=this.get(e[1].recid,!0),s=e[0].column,r=e[1].column,o=[];if(s==r)for(var a=i;a<=n;a++){var l=this.records[a],c=l[this.columns[s].field]||null;t!==!0?o.push(c):o.push({data:c,column:s,index:a,record:l})}else if(i==n)for(var l=this.records[i],d=s;d<=r;d++){var c=l[this.columns[d].field]||null;t!==!0?o.push(c):o.push({data:c,column:d,index:i,record:l})}else for(var a=i;a<=n;a++){var l=this.records[a];o.push([]);for(var d=s;d<=r;d++){var c=l[this.columns[d].field];t!==!0?o[o.length-1].push(c):o[o.length-1].push({data:c,column:d,index:a,record:l})}}return o},addRange:function(e){var t=0;if("row"==this.selectType)return t;$.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){if("object"!=typeof e[i]&&(e[i]={name:"selection"}),"selection"==e[i].name){if(this.show.selectionBorder===!1)continue;var n=this.getSelection();if(0===n.length){this.removeRange("selection");continue}var s=n[0],r=n[n.length-1]}else var s=e[i].range[0],r=e[i].range[1];if(s){for(var o={name:e[i].name,range:[{recid:s.recid,column:s.column},{recid:r.recid,column:r.column}],style:e[i].style||""},a=!1,l=0;l<this.ranges.length;l++)if(this.ranges[l].name==e[i].name){a=l;break}a!==!1?this.ranges[a]=o:this.ranges.push(o),t++}}return this.refreshRanges(),t},removeRange:function(){for(var e=0,t=0;t<arguments.length;t++){var i=arguments[t];$("#grid_"+this.name+"_"+i).remove(),$("#grid_"+this.name+"_f"+i).remove();for(var n=this.ranges.length-1;n>=0;n--)this.ranges[n].name==i&&(this.ranges.splice(n,1),e++)}return e},refreshRanges:function(){function e(e){var s=n.getSelection();n.last.move={type:"expand",x:e.screenX,y:e.screenY,divX:0,divY:0,recid:s[0].recid,column:s[0].column,originalRange:[{recid:s[0].recid,column:s[0].column},{recid:s[s.length-1].recid,column:s[s.length-1].column}],newRange:[{recid:s[0].recid,column:s[0].column},{recid:s[s.length-1].recid,column:s[s.length-1].column}]},$(document).off("mousemove",t).on("mousemove",t),$(document).off("mouseup",i).on("mouseup",i),e.preventDefault()}function t(e){var t=n.last.move;if(t&&"expand"==t.type){t.divX=e.screenX-t.x,t.divY=e.screenY-t.y;var i,s,r=e.originalEvent.target;if("TD"!=r.tagName.toUpperCase()&&(r=$(r).parents("td")[0]),null!=$(r).attr("col")&&(s=parseInt($(r).attr("col"))),r=$(r).parents("tr")[0],i=$(r).attr("recid"),t.newRange[1].recid!=i||t.newRange[1].column!=s){var o=$.extend({},t.newRange);return t.newRange=[{recid:t.recid,column:t.column},{recid:i,column:s}],E=n.trigger($.extend(E,{originalRange:t.originalRange,newRange:t.newRange})),E.isCancelled===!0?(t.newRange=o,void(E.newRange=o)):(n.removeRange("grid-selection-expand"),void n.addRange({name:"grid-selection-expand",range:E.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function i(e){n.removeRange("grid-selection-expand"),delete n.last.move,$(document).off("mousemove",t),$(document).off("mouseup",i),n.trigger($.extend(E,{phase:"after"}))}if(0!==this.ranges.length){for(var n=this,s=(new Date).getTime(),r=$("#grid_"+this.name+"_frecords"),o=$("#grid_"+this.name+"_records"),a=0;a<this.ranges.length;a++){var l=this.ranges[a],c=l.range[0],d=l.range[1];null==c.index&&(c.index=this.get(c.recid,!0)),null==d.index&&(d.index=this.get(d.recid,!0));var u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)+' td[col="'+c.column+'"]'),h=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(d.recid)+' td[col="'+d.column+'"]'),p=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(c.recid)+' td[col="'+c.column+'"]'),f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(d.recid)+' td[col="'+d.column+'"]'),g=d.column;c.column<this.last.colStart&&d.column>this.last.colStart&&(u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)+' td[col="start"]')),c.column<this.last.colEnd&&d.column>this.last.colEnd&&(g='"end"',h=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(d.recid)+' td[col="end"]'));var m=parseInt($("#grid_"+this.name+"_rec_top").next().attr("index")),v=parseInt($("#grid_"+this.name+"_rec_bottom").prev().attr("index")),w=parseInt($("#grid_"+this.name+"_frec_top").next().attr("index")),y=parseInt($("#grid_"+this.name+"_frec_bottom").prev().attr("index"));0===u.length&&c.index<m&&d.index>m&&(u=$("#grid_"+this.name+"_rec_top").next().find("td[col="+c.column+"]")),0===h.length&&d.index>v&&c.index<v&&(h=$("#grid_"+this.name+"_rec_bottom").prev().find("td[col="+g+"]")),0===p.length&&c.index<w&&d.index>w&&(p=$("#grid_"+this.name+"_frec_top").next().find("td[col="+c.column+"]")),0===f.length&&d.index>y&&c.index<y&&(f=$("#grid_"+this.name+"_frec_bottom").prev().find("td[col="+d.column+"]"));var b=$(this.box).find("#grid_"+this.name+"_editable"),x=b.find(".w2ui-input"),_=x.attr("recid"),C=x.attr("column");if("selection"!=l.name||l.range[0].recid!=_||l.range[0].column!=C){var k=$("#grid_"+this.name+"_f"+l.name);if(p.length>0||f.length>0)if(0===k.length?(r.append('<div id="grid_'+this.name+"_f"+l.name+'" class="w2ui-selection" style="'+l.style+'">'+("selection"==l.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),k=$("#grid_"+this.name+"_f"+l.name)):(k.attr("style",l.style),k.find(".w2ui-selection-resizer").show()),0===f.length&&(f=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(d.recid)+" td:last-child"),0===f.length&&(f=$("#grid_"+this.name+"_frec_bottom td:first-child")),k.css("border-right","0px"),k.find(".w2ui-selection-resizer").hide()),null!=c.recid&&null!=d.recid&&p.length>0&&f.length>0){var T=p.position().left-1+r.scrollLeft(),S=p.position().top-1+r.scrollTop();k.show().css({left:(T>0?T:0)+"px",top:(S>0?S:0)+"px",width:f.position().left-p.position().left+f.width()+3+"px",height:f.position().top-p.position().top+f.height()+3+"px"})}else k.hide();else k.hide();var k=$("#grid_"+this.name+"_"+l.name);if(u.length>0||h.length>0)if(0===k.length?(o.append('<div id="grid_'+this.name+"_"+l.name+'" class="w2ui-selection" style="'+l.style+'">'+("selection"==l.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':"")+"</div>"),k=$("#grid_"+this.name+"_"+l.name)):k.attr("style",l.style),0===u.length&&(u=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(c.recid)+" td:first-child"),0===u.length&&(u=$("#grid_"+this.name+"_rec_top td:first-child"))),0!==f.length&&k.css("border-left","0px"),null!=c.recid&&null!=d.recid&&u.length>0&&h.length>0){var T=u.position().left-1+o.scrollLeft(),S=u.position().top-1+o.scrollTop();k.show().css({left:(T>0?T:0)+"px",top:(S>0?S:0)+"px",width:h.position().left-u.position().left+h.width()+3+"px",height:h.position().top-u.position().top+h.height()+3+"px"})}else k.hide();else k.hide()}}$(this.box).find(".w2ui-selection-resizer").off("mousedown").on("mousedown",e).off("dblclick").on("dblclick",function(e){var t=n.trigger({phase:"before",type:"resizerDblClick",target:n.name,originalEvent:e});t.isCancelled!==!0&&n.trigger($.extend(t,{phase:"after"}))});var E={phase:"before",type:"selectionExtend",target:n.name,originalRange:null,newRange:null};return(new Date).getTime()-s}},select:function(){if(0===arguments.length)return 0;var e=((new Date).getTime(),0),t=this.last.selection;this.multiSelect||this.selectNone();var i={phase:"before",type:"select",target:this.name};1==arguments.length?(i.multiple=!1,$.isPlainObject(arguments[0])?(i.recid=arguments[0].recid,i.column=arguments[0].column):i.recid=arguments[0]):(i.multiple=!0,i.recids=Array.prototype.slice.call(arguments,0));var n=this.trigger(i);if(n.isCancelled===!0)return 0;if("row"==this.selectType)for(var s=0;s<arguments.length;s++){var r="object"==typeof arguments[s]?arguments[s].recid:arguments[s],o=this.get(r,!0);if(null!=o){var a=null,l=null;if((0!==this.searchData.length||o+1>=this.last.range_start&&o+1<=this.last.range_end)&&(a=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r)),l=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r))),"row"==this.selectType){if(t.indexes.indexOf(o)!=-1)continue;t.indexes.push(o),a&&l&&(a.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),l.addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),a.find(".w2ui-grid-select-check").prop("checked",!0)),e++}}}else{for(var c={},s=0;s<arguments.length;s++){var r="object"==typeof arguments[s]?arguments[s].recid:arguments[s],d="object"==typeof arguments[s]?arguments[s].column:null;if(c[r]=c[r]||[],$.isArray(d))c[r]=d;else if(w2utils.isInt(d))c[r].push(d);else for(var u=0;u<this.columns.length;u++)this.columns[u].hidden||c[r].push(parseInt(u))}var h=[];for(var r in c){var o=this.get(r,!0);if(null!=o){var a=null,l=null;o+1>=this.last.range_start&&o+1<=this.last.range_end&&(a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(r)),l=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(r)));var p=t.columns[o]||[];t.indexes.indexOf(o)==-1&&t.indexes.push(o);for(var f=0;f<c[r].length;f++)p.indexOf(c[r][f])==-1&&p.push(c[r][f]);p.sort(function(e,t){return e-t});for(var f=0;f<c[r].length;f++){var g=c[r][f];h.indexOf(g)==-1&&h.push(g),a&&(a.find("#grid_"+this.name+"_data_"+o+"_"+g).addClass("w2ui-selected"),a.find(".w2ui-col-number").addClass("w2ui-row-selected"),a.data("selected","yes"),a.find(".w2ui-grid-select-check").prop("checked",!0)),l&&(l.find("#grid_"+this.name+"_data_"+o+"_"+g).addClass("w2ui-selected"),l.find(".w2ui-col-number").addClass("w2ui-row-selected"),l.data("selected","yes"),l.find(".w2ui-grid-select-check").prop("checked",!0)),e++}t.columns[o]=p}}for(var m=0;m<h.length;m++)$(this.box).find("#grid_"+this.name+"_column_"+h[m]+" .w2ui-col-header").addClass("w2ui-col-selected")}t.indexes.sort(function(e,t){return e-t});var v=this.records.length>0&&t.indexes.length==this.records.length,w=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return v||w?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),this.trigger($.extend(n,{phase:"after"})),e},unselect:function(){for(var e=0,t=this.last.selection,i=0;i<arguments.length;i++){var n="object"==typeof arguments[i]?arguments[i].recid:arguments[i],s=this.get(n);if(null!=s){var r=this.get(s.recid,!0),o=$("#grid_"+this.name+"_frec_"+w2utils.escapeId(n)),a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n));if("row"==this.selectType){if(t.indexes.indexOf(r)==-1)continue;var l=this.trigger({phase:"before",type:"unselect",target:this.name,recid:n,index:r});if(l.isCancelled===!0)continue;t.indexes.splice(t.indexes.indexOf(r),1),o.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),a.removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),0!=o.length&&(o[0].style.cssText="height: "+this.recordHeight+"px; "+o.attr("custom_style"),a[0].style.cssText="height: "+this.recordHeight+"px; "+a.attr("custom_style")),o.find(".w2ui-grid-select-check").prop("checked",!1),e++}else{var c=arguments[i].column;if(!w2utils.isInt(c)){for(var d=[],u=0;u<this.columns.length;u++)this.columns[u].hidden||d.push({recid:n,column:u});return this.unselect.apply(this,d)}var h=t.columns[r];if(!$.isArray(h)||h.indexOf(c)==-1)continue;var l=this.trigger({phase:"before",type:"unselect",target:this.name,recid:n,column:c});if(l.isCancelled===!0)continue;h.splice(h.indexOf(c),1),$("#grid_"+this.name+"_rec_"+w2utils.escapeId(n)).find(" > td[col="+c+"]").removeClass("w2ui-selected w2ui-inactive"),$("#grid_"+this.name+"_frec_"+w2utils.escapeId(n)).find(" > td[col="+c+"]").removeClass("w2ui-selected w2ui-inactive");for(var p=!1,f=!1,g=this.getSelection(),u=0;u<g.length;u++)g[u].column==c&&(p=!0),g[u].recid==n&&(f=!0);p||$(this.box).find(".w2ui-grid-columns td[col="+c+"] .w2ui-col-header, .w2ui-grid-fcolumns td[col="+c+"] .w2ui-col-header").removeClass("w2ui-col-selected"),f||$("#grid_"+this.name+"_frec_"+w2utils.escapeId(n)).find(".w2ui-col-number").removeClass("w2ui-row-selected"),e++,0===h.length&&(delete t.columns[r],t.indexes.splice(t.indexes.indexOf(r),1),o.removeData("selected"),o.find(".w2ui-grid-select-check").prop("checked",!1),a.removeData("selected"))}this.trigger($.extend(l,{phase:"after"}))}}var m=this.records.length>0&&t.indexes.length==this.records.length,v=t.indexes.length>0&&0!==this.searchData.length&&t.indexes.length==this.last.searchIds.length;return m||v?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status(),this.addRange("selection"),e},selectAll:function(){var e=(new Date).getTime();if(this.multiSelect!==!1){var t=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(t.isCancelled!==!0){for(var i="object"!=typeof this.url?this.url:this.url.get,n=this.last.selection,s=[],r=0;r<this.columns.length;r++)s.push(r);if(n.indexes=[],i||0===this.searchData.length){var o=this.records.length;0==this.searchData.length||i||(o=this.last.searchIds.length);for(var r=0;r<o;r++)n.indexes.push(r),"row"!=this.selectType&&(n.columns[r]=s.slice())}else for(var r=0;r<this.last.searchIds.length;r++)n.indexes.push(this.last.searchIds[r]),"row"!=this.selectType&&(n.columns[this.last.searchIds[r]]=s.slice());"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").addClass("w2ui-selected").data("selected","yes").find(".w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").addClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-records tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").addClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr").not(".w2ui-empty-record").find(".w2ui-grid-data").not(".w2ui-col-select").addClass("w2ui-selected").data("selected","yes"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!0));var n=this.getSelection();return 1==n.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),n.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete"),this.addRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!0),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}}},selectNone:function(){var e=(new Date).getTime(),t=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(t.isCancelled!==!0){var i=this.last.selection;return"row"==this.selectType?($(this.box).find(".w2ui-grid-records tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected").find(".w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)):($(this.box).find(".w2ui-grid-columns td .w2ui-col-header, .w2ui-grid-fcolumns td .w2ui-col-header").removeClass("w2ui-col-selected"),$(this.box).find(".w2ui-grid-records tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-frecords tr .w2ui-col-number").removeClass("w2ui-row-selected"),$(this.box).find(".w2ui-grid-data.w2ui-selected").removeClass("w2ui-selected w2ui-inactive").removeData("selected"),$(this.box).find("input.w2ui-grid-select-check").prop("checked",!1)),i.indexes=[],i.columns={},this.toolbar.disable("w2ui-edit","w2ui-delete"),this.removeRange("selection"),$("#grid_"+this.name+"_check_all").prop("checked",!1),this.trigger($.extend(t,{phase:"after"})),(new Date).getTime()-e}},getSelection:function(e){var t=[],i=this.last.selection;if("row"==this.selectType){for(var n=0;n<i.indexes.length;n++)this.records[i.indexes[n]]&&(e===!0?t.push(i.indexes[n]):t.push(this.records[i.indexes[n]].recid));return t}for(var n=0;n<i.indexes.length;n++){var s=i.columns[i.indexes[n]];if(this.records[i.indexes[n]])for(var r=0;r<s.length;r++)t.push({recid:this.records[i.indexes[n]].recid,index:parseInt(i.indexes[n]),column:s[r]})}return t},search:function(e,t){for(var i="object"!=typeof this.url?this.url:this.url.get,n=[],s=this.last.multi,r=this.last.logic,o=this.last.field,a=this.last.search,l=!1,c=0;c<this.searches.length;c++)this.searches[c].hidden&&(n.push({field:this.searches[c].field,operator:this.searches[c].operator||"is",type:this.searches[c].type,value:this.searches[c].value||""}),l=!0);if(0===arguments.length){a="";for(var c=0;c<this.searches.length;c++){var d=this.searches[c],u=$("#grid_"+this.name+"_operator_"+c).val(),h=$("#grid_"+this.name+"_field_"+c),p=$("#grid_"+this.name+"_field2_"+c),f=h.val(),g=p.val(),m=null,v=null;if(["int","float","money","currency","percent"].indexOf(d.type)!=-1){var w=h.data("w2field"),y=p.data("w2field");w&&(f=w.clean(f)),y&&(g=y.clean(g))}if(["list","enum"].indexOf(d.type)!=-1)if(f=h.data("selected")||{},$.isArray(f)){m=[];for(var b=0;b<f.length;b++)m.push(w2utils.isFloat(f[b].id)?parseFloat(f[b].id):String(f[b].id).toLowerCase()),delete f[b].hidden;$.isEmptyObject(f)&&(f="")}else v=f.text||"",f=f.id||"";if(""!==f&&null!=f||null!=g&&""!==g){var x={field:d.field,type:d.type,operator:u};"between"==u?$.extend(x,{value:[f,g]}):"in"==u&&"string"==typeof f?$.extend(x,{value:f.split(",")}):"not in"==u&&"string"==typeof f?$.extend(x,{value:f.split(",")}):$.extend(x,{value:f}),m&&$.extend(x,{svalue:m}),v&&$.extend(x,{text:v});try{"date"==d.type&&"between"==u&&(x.value[0]=f,x.value[1]=g),"date"==d.type&&"is"==u&&(x.value=f)}catch(e){}n.push(x)}}s=!0,r="AND"}if("string"==typeof e&&(1==arguments.length&&(t=e,e="all"),o=e,a=t,s=!1,r=l?"AND":"OR",null!=t))if("all"==e.toLowerCase())if(this.searches.length>0)for(var c=0;c<this.searches.length;c++){var d=this.searches[c];if("text"==d.type||"alphanumeric"==d.type&&w2utils.isAlphaNumeric(t)||"int"==d.type&&w2utils.isInt(t)||"float"==d.type&&w2utils.isFloat(t)||"percent"==d.type&&w2utils.isFloat(t)||("hex"==d.type||"color"==d.type)&&w2utils.isHex(t)||"currency"==d.type&&w2utils.isMoney(t)||"money"==d.type&&w2utils.isMoney(t)||"date"==d.type&&w2utils.isDate(t)||"time"==d.type&&w2utils.isTime(t)||"datetime"==d.type&&w2utils.isDateTime(t)||"enum"==d.type&&w2utils.isAlphaNumeric(t)||"list"==d.type&&w2utils.isAlphaNumeric(t)){var x={field:d.field,type:d.type,operator:null!=d.operator?d.operator:"text"==d.type?this.textSearch:"is",value:t};""!=$.trim(t)&&n.push(x)}if(["int","float","money","currency","percent"].indexOf(d.type)!=-1&&2==$.trim(String(t)).split("-").length){var _=$.trim(String(t)).split("-"),x={field:d.field,type:d.type,operator:null!=d.operator?d.operator:"between",value:[_[0],_[1]]};n.push(x)}if(["list","enum"].indexOf(d.type)!=-1){for(var C=[],b=0;b<d.options.items;b++){var x=d.options.items[b];try{var k=new RegExp(t,"i");k.test(x)&&C.push(b),x.text&&k.test(x.text)&&C.push(x.id)}catch(e){}}if(C.length>0){var x={field:d.field,type:d.type,operator:null!=d.operator?d.operator:"in",value:C};n.push(x)}}}else for(var c=0;c<this.columns.length;c++){var x={field:this.columns[c].field,type:"text",operator:this.textSearch,value:t};n.push(x)}else{var T=$("#grid_"+this.name+"_search_all"),d=this.getSearch(e);if(null==d&&(d={field:e,type:"text"}),d.field==e&&(this.last.caption=d.caption),""!==t){var S=this.textSearch,E=t;if(["date","time","datetime"].indexOf(d.type)!=-1&&(S="is"),["list","enum"].indexOf(d.type)!=-1){S="is";var x=T.data("selected");E=x&&!$.isEmptyObject(x)?x.id:""}if("int"==d.type&&""!==t){if(S="is",String(t).indexOf("-")!=-1){var x=t.split("-");2==x.length&&(S="between",E=[parseInt(x[0]),parseInt(x[1])])}if(String(t).indexOf(",")!=-1){var x=t.split(",");S="in",E=[];for(var c=0;c<x.length;c++)E.push(x[c])}}null!=d.operator&&(S=d.operator);var x={field:d.field,type:d.type,operator:S,value:E};n.push(x)}}if($.isArray(e)){var j="AND";"string"==typeof t&&(j=t.toUpperCase(),"OR"!=j&&"AND"!=j&&(j="AND")),a="",s=!0,r=j;for(var c=0;c<e.length;c++){var z=e[c],d=this.getSearch(z.field);if(null==d&&(d={type:"text",operator:"begins"}),$.isArray(z.value))for(var b=0;b<z.value.length;b++)"string"==typeof z.value[b]&&(z.value[b]=z.value[b].toLowerCase());n.push($.extend(!0,{},d,z))}}var D=this.trigger({phase:"before",type:"search",multi:0===arguments.length,target:this.name,searchData:n,searchField:e?e:"multi",searchValue:e?t:"multi"});D.isCancelled!==!0&&(this.searchData=D.searchData,this.last.field=o,this.last.search=a,this.last.multi=s,this.last.logic=r,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),i?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(D,{phase:"after"})))},searchOpen:function(){if(this.box&&0!==this.searches.length){var e=this,t=this.trigger({phase:"before",type:"searchOpen",target:this.name});return t.isCancelled===!0?void setTimeout(function(){e.toolbar.uncheck("w2ui-search-advanced")},1):void $("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay({html:this.getSearchesHTML(),name:this.name+"-searchOverlay",left:-10,class:"w2ui-grid-searches",onShow:function(){e.initSearches(),$("#w2ui-overlay-"+e.name+"-searchOverlay .w2ui-grid-searches").data("grid-name",e.name);var i=$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]");i.length>0&&i[0].focus(),e.trigger($.extend(t,{phase:"after"}))}})}},searchClose:function(){this.box&&0!==this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),$().w2overlay({name:this.name+"-searchOverlay"}),$().w2overlay({name:this.name+"-searchOverlay"}))},searchReset:function(e){for(var t=[],i=!1,n=0;n<this.searches.length;n++)this.searches[n].hidden&&(t.push({field:this.searches[n].field,operator:this.searches[n].operator||"is",type:this.searches[n].type,value:this.searches[n].value||""}),i=!0);var s=this.trigger({phase:"before",type:"search",reset:!0,target:this.name,searchData:t});if(s.isCancelled!==!0){if(this.searchData=s.searchData,this.last.search="",this.last.logic=i?"AND":"OR",this.searches.length>0)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var r=0;r<this.searches.length&&(this.searches[r].hidden||this.searches[r].simple===!1);)r++;r>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[r].field,this.last.caption=this.searches[r].caption)}this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val("").removeData("selected"),e||this.reload(),this.trigger($.extend(s,{phase:"after"}))}},searchShowFields:function(){for(var e=this,t=$("#grid_"+this.name+"_search_all"),i='<div class="w2ui-select-field"><table><tbody>',n=-1;n<this.searches.length;n++){var s=this.searches[n];if(n==-1){if(!this.multiSearch||!this.show.searchAll)continue;s={field:"all",caption:w2utils.lang("All Fields")}}else if(this.searches[n].hidden===!0||this.searches[n].simple===!1)continue;i+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+s.field+"');      event.stopPropagation(); jQuery('#grid_"+this.name+"_search_all').w2overlay({ name: '"+this.name+'-searchFields\' });">   <td>       <span class="w2ui-column-check w2ui-icon-'+(s.field==this.last.field?"check":"empty")+'"></span>   </td>   <td>'+s.caption+"</td></tr>"}i+="</tbody></table></div>",setTimeout(function(){$(t).w2overlay({html:i,name:e.name+"-searchFields",left:-10})},1)},initAllField:function(e,t){var i=$("#grid_"+this.name+"_search_all");if("all"==e){var n={field:"all",caption:w2utils.lang("All Fields")};i.w2field("clear"),i.change()}else{var n=this.getSearch(e);if(null==n)return;var s=n.type;["enum","select"].indexOf(s)!=-1&&(s="list"),i.w2field(s,$.extend({},n.options,{suffix:"",autoFormat:!1,selected:t})),["list","enum","date","time","datetime"].indexOf(n.type)!=-1&&(this.last.search="",this.last.item="",i.val(""))}""!=this.last.search?(this.last.caption=n.caption,this.search(n.field,this.last.search)):(this.last.field=n.field,this.last.caption=n.caption),i.attr("placeholder",w2utils.lang(n.caption)),$().w2overlay({name:this.name+"-searchFields"})},clear:function(e){this.total=0,this.records=[],this.summary=[],this.last.xhr_offset=0,this.reset(!0),e||this.refresh()},reset:function(e){this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection={indexes:[],columns:{}},this.last.range_start=null,this.last.range_end=null,$("#grid_"+this.name+"_records").prop("scrollTop",0),e||this.refresh()},skip:function(e,t){var i="object"!=typeof this.url?this.url:this.url.get;i?(this.offset=parseInt(e),this.offset>this.total&&(this.offset=this.total-this.limit),(this.offset<0||!w2utils.isInt(this.offset))&&(this.offset=0),this.clear(!0),this.reload(t)):console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(e,t){return null==e?void console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):(this.clear(!0),void this.request("get",{},e,t))},reload:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;t.selectionSave(),i?this.load(i,function(){
t.selectionRestore(),"function"==typeof e&&e()}):(this.reset(!0),this.localSearch(),this.selectionRestore(),"function"==typeof e&&e({status:"success"}))},request:function(e,t,i,n){if(null==t&&(t={}),""!=i&&null!=i||(i=this.url),""!=i&&null!=i){var s={};if(w2utils.isInt(this.offset)||(this.offset=0),w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0),s.cmd=e,s.selected=this.getSelection(),s.limit=this.limit,s.offset=parseInt(this.offset)+parseInt(this.last.xhr_offset),s.search=this.searchData,s.searchLogic=this.last.logic,s.sort=this.sortData,0===this.searchData.length&&(delete s.search,delete s.searchLogic),0===this.sortData.length&&delete s.sort,$.extend(s,this.postData),$.extend(s,t),"get"==e){var r=this.trigger({phase:"before",type:"request",target:this.name,url:i,postData:s,httpHeaders:this.httpHeaders});if(r.isCancelled===!0)return void("function"==typeof n&&n({status:"error",message:"Request aborted."}))}else var r={url:i,postData:s,httpHeaders:this.httpHeaders};var o=this;if(0===this.last.xhr_offset)o.lock(w2utils.lang(o.msgRefresh),!0);else{var a=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");this.autoLoad===!0?a.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):a.find("td").html("<div>"+w2utils.lang("Load")+" "+o.limit+" "+w2utils.lang("More")+"...</div>")}if(this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(i="object"!=typeof r.url?r.url:r.url.get,"save"==s.cmd&&"object"==typeof r.url&&(i=r.url.save),"delete"==s.cmd&&"object"==typeof r.url&&(i=r.url.remove),!$.isEmptyObject(o.routeData)){var l=w2utils.parseRoute(i);if(l.keys.length>0)for(var c=0;c<l.keys.length;c++)null!=o.routeData[l.keys[c].name]&&(i=i.replace(new RegExp(":"+l.keys[c].name,"g"),o.routeData[l.keys[c].name]))}var d={type:"POST",url:i,data:r.postData,headers:r.httpHeaders,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(d.data="object"==typeof d.data?String($.param(d.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):d.data),"HTTPJSON"==w2utils.settings.dataType&&(d.data={request:JSON.stringify(d.data)}),"RESTFULL"==w2utils.settings.dataType&&(d.type="GET","save"==s.cmd&&(d.type="PUT"),"delete"==s.cmd&&(d.type="DELETE"),d.data="object"==typeof d.data?String($.param(d.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):d.data),"RESTFULLJSON"==w2utils.settings.dataType&&(d.type="GET","save"==s.cmd&&(d.type="PUT"),"delete"==s.cmd&&(d.type="DELETE"),d.data=JSON.stringify(d.data),d.contentType="application/json"),"JSON"==w2utils.settings.dataType&&(d.type="POST",d.data=JSON.stringify(d.data),d.contentType="application/json"),this.method&&(d.type=this.method),this.last.xhr_cmd=s.cmd,this.last.xhr_start=(new Date).getTime(),this.last.xhr=$.ajax(d).done(function(t,i,s){o.requestComplete(i,e,n)}).fail(function(t,i,s){var r={status:i,error:s,rawResponseText:t.responseText},a=o.trigger({phase:"before",type:"error",error:r,xhr:t});if(a.isCancelled!==!0){if("abort"!=i){var l;try{l=$.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText),o.requestComplete("error",e,n)}o.trigger($.extend(a,{phase:"after"}))}}),"get"==e&&this.trigger($.extend(r,{phase:"after"}))}},requestComplete:function(status,cmd,callBack){var obj=this;this.unlock(),setTimeout(function(){obj.show.statusResponse&&obj.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-obj.last.xhr_start)/1e3+" "+w2utils.lang("sec"))},10),this.last.pull_more=!1,this.last.pull_refresh=!0;var event_name="load";"save"==this.last.xhr_cmd&&(event_name="save"),"delete"==this.last.xhr_cmd&&(event_name="delete");var edata=this.trigger({phase:"before",target:this.name,type:event_name,xhr:this.last.xhr,status:status});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=this.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!=responseText){if("object"==typeof responseText)data=responseText;else if("function"==typeof obj.parser)data=obj.parser(responseText),"object"!=typeof data&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+responseText)}catch(e){}if(null==data?data={status:"error",message:w2utils.lang(this.msgNotJSON),responseText:responseText}:Array.isArray(data)&&(data={status:"success",records:data}),obj.recid&&data.records)for(var i=0;i<data.records.length;i++)data.records[i].recid=data.records[i][obj.recid];if("error"==data.status)obj.error(data.message);else{if("get"==cmd){if(null==data.total&&(data.total=-1),data.records.length==this.limit?this.last.xhr_hasMore=!0:(this.last.xhr_hasMore=!1,this.total=this.last.xhr_offset+data.records.length),0===this.last.xhr_offset)this.records=[],this.summary=[],w2utils.isInt(data.total)&&(this.total=parseInt(data.total));else if(data.total!=-1&&parseInt(data.total)!=parseInt(this.total))return void this.message(w2utils.lang(this.msgNeedReload),function(){delete this.last.xhr_offset,this.reload()}.bind(this));if(data.records)for(var r=0;r<data.records.length;r++)this.records.push(data.records[r]);if(data.summary){this.summary=[];for(var r=0;r<data.summary.length;r++)this.summary.push(data.summary[r])}}if("delete"==cmd)return this.reset(),void this.reload()}}}else data={status:"error",message:w2utils.lang(this.msgAJAXerror),responseText:responseText},obj.error(w2utils.lang(this.msgAJAXerror));var url="object"!=typeof this.url?this.url:this.url.get;url||(this.localSort(),this.localSearch()),this.total=parseInt(this.total),"function"==typeof callBack&&callBack(data),this.trigger($.extend(edata,{phase:"after"})),0===this.last.xhr_offset?this.refresh():(this.scroll(),this.resize())},error:function(e){var t=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return t.isCancelled===!0?void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."})):(this.message(e),void this.trigger($.extend(t,{phase:"after"})))},getChanges:function(){for(var e=[],t=0;t<this.records.length;t++){var i=this.records[t];i.w2ui&&null!=i.w2ui.changes&&e.push($.extend(!0,{recid:i.recid},i.w2ui.changes))}return e},mergeChanges:function(){for(var changes=this.getChanges(),c=0;c<changes.length;c++){var record=this.get(changes[c].recid);for(var s in changes[c])if("recid"!=s){"object"==typeof changes[c][s]&&(changes[c][s]=changes[c][s].text);try{s.indexOf(".")!=-1?eval("record['"+s.replace(/\./g,"']['")+"'] = changes[c][s]"):record[s]=changes[c][s]}catch(e){console.log("ERROR: Cannot merge. ",e.message||"",e)}record.w2ui&&delete record.w2ui.changes}}this.refresh()},save:function(){var e=this,t=this.getChanges(),i=this.trigger({phase:"before",target:this.name,type:"save",changes:t});if(i.isCancelled!==!0){var n="object"!=typeof this.url?this.url:this.url.save;n?this.request("save",{changes:i.changes},null,function(t){"error"!==t.status&&e.mergeChanges(),e.trigger($.extend(i,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(i,{phase:"after"})))}},editField:function(e,t,i,n){function s(e){try{var t="DIV"==this.tagName.toUpperCase()?$(this).text():this.value,i=$("#grid_"+r.name+"_editable"),n="font-family: "+$(this).css("font-family")+"; font-size: "+$(this).css("font-size")+"; white-space: pre;",s=w2utils.getStrWidth(t,n);s+20>i.width()&&i.width(s+20)}catch(e){}}var r=this,o=r.get(e,!0),a=r.getCellEditable(o,t);if(a){var l=r.records[o],c=r.columns[t],d=c.frozen===!0?"_f":"_";if(["enum","file"].indexOf(a.type)!=-1)return void console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');var u=r.trigger({phase:"before",type:"editField",target:r.name,recid:e,column:t,value:i,index:o,originalEvent:n});if(u.isCancelled!==!0&&(i=u.value,this.selectNone(),this.select({recid:e,column:t}),this.last.edit_col=t,["checkbox","check"].indexOf(a.type)==-1)){var h=$("#grid_"+r.name+d+"rec_"+w2utils.escapeId(e)),p=h.find("[col="+t+"] > div");$(this.box).find("div.w2ui-edit-box").remove(),"row"!=this.selectType&&($("#grid_"+this.name+d+"selection").attr("id","grid_"+this.name+"_editable").removeClass("w2ui-selection").addClass("w2ui-edit-box").prepend('<div style="position: absolute; top: 0px; bottom: 0px; left: 0px; right: 0px;"></div>').find(".w2ui-selection-resizer").remove(),p=$("#grid_"+this.name+"_editable >div:first-child")),null==a.inTag&&(a.inTag=""),null==a.outTag&&(a.outTag=""),null==a.style&&(a.style=""),null==a.items&&(a.items=[]);var f=l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[c.field]?w2utils.stripTags(l.w2ui.changes[c.field]):w2utils.stripTags(l[c.field]);null==f&&(f="");var g="object"!=typeof f?f:"";null!=u.old_value&&(g=u.old_value),null!=i&&(f=i);var m=null!=c.style?c.style+";":"";switch("string"==typeof c.render&&["number","int","float","money","percent","size"].indexOf(c.render.split(":")[0])!=-1&&(m+="text-align: right;"),a.items.length>0&&!$.isPlainObject(a.items[0])&&(a.items=w2obj.field.prototype.normMenu(a.items)),a.type){case"select":for(var v="",w=0;w<a.items.length;w++)v+='<option value="'+a.items[w].id+'"'+(a.items[w].id==f?' selected="selected"':"")+">"+a.items[w].text+"</option>";p.addClass("w2ui-editable").html('<select id="grid_'+r.name+"_edit_"+e+"_"+t+'" column="'+t+'" class="w2ui-input"    style="width: 100%; pointer-events: auto; padding: 0 0 0 3px; margin: 0px; border-left: 0; border-right: 0; border-radius: 0px;            outline: none; font-family: inherit;'+m+a.style+'"     field="'+c.field+'" recid="'+e+'"     '+a.inTag+">"+v+"</select>"+a.outTag),setTimeout(function(){p.find("select").on("change",function(e){delete r.last.move}).on("blur",function(e){1!=$(this).data("keep-open")&&r.editChange.call(r,this,o,t,e)})},10);break;case"div":var y=h.find("[col="+t+"] > div"),b="font-family: "+y.css("font-family")+"; font-size: "+y.css("font-size")+";";p.addClass("w2ui-editable").html('<div id="grid_'+r.name+"_edit_"+e+"_"+t+'" class="w2ui-input"    contenteditable style="'+b+m+a.style+'" autocorrect="off" autocomplete="off" spellcheck="false"     field="'+c.field+'" recid="'+e+'" column="'+t+'" '+a.inTag+"></div>"+a.outTag),null==i&&p.find("div.w2ui-input").text("object"!=typeof f?f:"");var x=p.find("div.w2ui-input").get(0);setTimeout(function(){var e=x;$(e).on("blur",function(i){1!=$(this).data("keep-open")&&r.editChange.call(r,e,o,t,i)})},10),null!=i&&$(x).text("object"!=typeof f?f:"");break;default:var y=h.find("[col="+t+"] > div"),b="font-family: "+y.css("font-family")+"; font-size: "+y.css("font-size");p.addClass("w2ui-editable").html('<input id="grid_'+r.name+"_edit_"+e+"_"+t+'" autocorrect="off" autocomplete="off" spellcheck="false" type="text"     style="'+b+"; width: 100%; height: 100%; padding: 3px; border-color: transparent; outline: none; border-radius: 0;        pointer-events: auto; "+m+a.style+'"     field="'+c.field+'" recid="'+e+'" column="'+t+'" class="w2ui-input"'+a.inTag+"/>"+a.outTag),"number"==a.type&&(f=w2utils.formatNumber(f)),"date"==a.type&&(f=w2utils.formatDate(w2utils.isDate(f,a.format,!0),a.format)),null==i&&p.find("input").val("object"!=typeof f?f:"");var x=p.find("input").get(0);$(x).w2field(a.type,$.extend(a,{selected:f})),setTimeout(function(){var e=x;"list"==a.type&&(e=$($(x).data("w2field").helpers.focus).find("input"),"object"!=typeof f&&""!=f&&e.val(f).css({opacity:1}).prev().css({opacity:1}),p.find("input").on("change",function(e){r.editChange.call(r,x,o,t,e)})),$(e).on("blur",function(e){1!=$(this).data("keep-open")&&r.editChange.call(r,x,o,t,e)})},10),null!=i&&$(x).val("object"!=typeof f?f:"")}setTimeout(function(){p.find("input, select, div.w2ui-input").data("old_value",g).on("mousedown",function(e){e.stopPropagation()}).on("click",function(e){"div"==a.type?s.call(p.find("div.w2ui-input")[0],null):s.call(p.find("input, select")[0],null)}).on("paste",function(e){var t=e.originalEvent;e.preventDefault();var i=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)}).on("keydown",function(i){var n=this,d="DIV"==n.tagName.toUpperCase()?$(n).text():$(n).val();switch(i.keyCode){case 8:"list"!=a.type||$(x).data("w2field")||i.preventDefault();break;case 9:case 13:i.preventDefault();break;case 37:0===w2utils.getCursorPosition(n)&&i.preventDefault();break;case 39:w2utils.getCursorPosition(n)==d.length&&(w2utils.setCursorPosition(n,d.length),i.preventDefault())}setTimeout(function(){switch(i.keyCode){case 9:var a=e,d=i.shiftKey?r.prevCell(o,t,!0):r.nextCell(o,t,!0);if(null==d){var u=i.shiftKey?r.prevRow(o,t):r.nextRow(o,t);if(null!=u&&u!=o){a=r.records[u].recid;for(var h=0;h<r.columns.length;h++){var p=r.getCellEditable(o,h);if(null!=p&&["checkbox","check"].indexOf(p.type)==-1&&(d=parseInt(h),!i.shiftKey))break}}}a===!1&&(a=e),null==d&&(d=t),n.blur(),setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:a,column:d})):r.editField(a,d,null,i)},1),i.preventDefault&&i.preventDefault();break;case 13:n.blur();var f=i.shiftKey?r.prevRow(o,t):r.nextRow(o,t);null!=f&&f!=o&&setTimeout(function(){"row"!=r.selectType?(r.selectNone(),r.select({recid:r.records[f].recid,column:t})):r.editField(r.records[f].recid,t,null,i)},1),"DIV"==n.tagName.toUpperCase()&&i.preventDefault();break;case 27:var g=r.parseField(l,c.field);l.w2ui&&l.w2ui.changes&&null!=l.w2ui.changes[c.field]&&(g=l.w2ui.changes[c.field]),null!=$(n).data("old_value")&&(g=$(n).data("old_value")),"DIV"==n.tagName.toUpperCase()?$(n).text(null!=g?g:""):n.value=null!=g?g:"",n.blur(),setTimeout(function(){r.select({recid:e,column:t})},1)}s.call(n,i)},1)}).on("keyup",function(e){s.call(this,e)}),setTimeout(function(){var e=p.find(".w2ui-input"),t=$(e).val().length;"div"==a.type&&(t=$(e).text().length),e.length>0&&(e.focus(),clearTimeout(r.last.kbd_timer),"SELECT"!=e[0].tagName&&w2utils.setCursorPosition(e[0],t),e[0].resize=s,s.call(e[0],null))},50),r.trigger($.extend(u,{phase:"after",input:p.find("input, select, div.w2ui-input")}))},5)}}},editChange:function(e,t,i,n){var s=this;setTimeout(function(){var e=$(s.box).find("#grid_"+s.name+"_focus");e.is(":focus")||e.focus()},10);var r=t<0;t=t<0?-t-1:t;var o=r?this.summary:this.records,a=o[t],l=this.columns[i],c=$("#grid_"+this.name+(l.frozen===!0?"_frec_":"_rec_")+w2utils.escapeId(a.recid)),d=e.tagName&&"DIV"==e.tagName.toUpperCase()?$(e).text():e.value,u=this.parseField(a,l.field),h=$(e).data("w2field");h&&("list"==h.type&&(d=$(e).data("selected")),($.isEmptyObject(d)||null==d)&&(d=""),$.isPlainObject(d)||(d=h.clean(d))),"checkbox"==e.type&&(a.w2ui&&a.w2ui.editable===!1&&(e.checked=!e.checked),d=e.checked);var p={phase:"before",type:"change",target:this.name,input_id:e.id,recid:a.recid,index:t,column:i,originalEvent:n.originalEvent?n.originalEvent:n,value_new:d,value_previous:a.w2ui&&a.w2ui.changes&&a.w2ui.changes.hasOwnProperty(l.field)?a.w2ui.changes[l.field]:u,value_original:u};for(null!=$(n.target).data("old_value")&&(p.value_previous=$(n.target).data("old_value"));;){if(d=p.value_new,"object"!=typeof d&&String(u)!=String(d)||"object"==typeof d&&d.id!=u&&("object"!=typeof u||null==u||d.id!=u.id)){if(p=this.trigger($.extend(p,{type:"change",phase:"before"})),p.isCancelled!==!0){if(d!==p.value_new)continue;a.w2ui=a.w2ui||{},a.w2ui.changes=a.w2ui.changes||{},a.w2ui.changes[l.field]=p.value_new,this.trigger($.extend(p,{phase:"after"}))}}else if(p=this.trigger($.extend(p,{type:"restore",phase:"before"})),p.isCancelled!==!0){if(d!==p.value_new)continue;a.w2ui&&a.w2ui.changes&&delete a.w2ui.changes[l.field],a.w2ui&&$.isEmptyObject(a.w2ui.changes)&&delete a.w2ui.changes,this.trigger($.extend(p,{phase:"after"}))}break}var f=$(c).find("[col="+i+"]");r||(a.w2ui&&a.w2ui.changes&&null!=a.w2ui.changes[l.field]?f.addClass("w2ui-changed"):f.removeClass("w2ui-changed"),f.replaceWith(this.getCellHTML(t,i,r))),$(this.box).find("div.w2ui-edit-box").remove(),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save"))},delete:function(e){var t=((new Date).getTime(),this),i=this.trigger({phase:"before",target:this.name,type:"delete",force:e});if(i.isCancelled!==!0){e=i.force,setTimeout(function(){$().w2tag()},20);var n=this.getSelection();if(0!==n.length){if(""!=this.msgDelete&&!e)return void this.message({width:350,height:170,body:'<div class="w2ui-centered">'+w2utils.lang(t.msgDelete)+"</div>",buttons:'<button class="w2ui-btn w2ui-btn-red" onclick="w2ui[\''+this.name+"'].delete(true)\">"+w2utils.lang("Yes")+'</button><button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">"+w2utils.lang("No")+"</button>",onOpen:function(e){var i=$(this.box).find("input, textarea, select, button");i.off(".message").on("blur.message",function(e){i.index(e.target)+1===i.length&&(i.get(0).focus(),e.preventDefault())}).on("keydown.message",function(e){27==e.keyCode&&t.message()}),setTimeout(function(){$(this.box).find(".w2ui-btn:last-child").focus(),clearTimeout(t.last.kbd_timer)},25)}});this.message();var s="object"!=typeof this.url?this.url:this.url.remove;if(s)this.request("delete");else if("object"!=typeof n[0])this.selectNone(),this.remove.apply(this,n);else{for(var r=0;r<n.length;r++){var o=this.columns[n[r].column].field,a=this.get(n[r].recid,!0),l=this.records[a];null!=a&&"recid"!=o&&(this.records[a][o]="",l.w2ui&&l.w2ui.changes&&delete l.w2ui.changes[o])}this.update()}this.trigger($.extend(i,{phase:"after"}))}}},click:function(e,t){var i=(new Date).getTime(),n=null,s=this;if(!(1==this.last.cancelClick||t&&t.altKey)){if("object"==typeof e&&(n=e.column,e=e.recid),null==t&&(t={}),i-parseInt(this.last.click_time)<350&&this.last.click_recid==e&&"click"==t.type)return void this.dblClick(e,t);this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null),this.last.click_time=i;var r=this.last.click_recid;if(this.last.click_recid=e,null==n&&t.target){var o=t.target;"TD"!=o.tagName.toUpperCase()&&(o=$(o).parents("td")[0]),null!=$(o).attr("col")&&(n=parseInt($(o).attr("col")))}var a=this.trigger({phase:"before",target:this.name,type:"click",recid:e,column:n,originalEvent:t});if(a.isCancelled!==!0){var s=this,l=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);var c=this.get(e,!0),d=(this.records[c],[]);if(s.last.sel_ind=c,s.last.sel_col=n,s.last.sel_recid=e,s.last.sel_type="click",t.shiftKey&&l.length>0&&s.multiSelect){if(l[0].recid){var u=this.get(l[0].recid,!0),h=this.get(e,!0);if(n>l[0].column)var p=l[0].column,f=n;else var p=n,f=l[0].column;for(var g=p;g<=f;g++)d.push(g)}else var u=this.get(r,!0),h=this.get(e,!0);var m=[];if(u>h){var o=u;u=h,h=o}for(var v="object"!=typeof this.url?this.url:this.url.get,w=u;w<=h;w++)if(!(this.searchData.length>0)||v||$.inArray(w,this.last.searchIds)!=-1)if("row"==this.selectType)m.push(this.records[w].recid);else for(var y=0;y<d.length;y++)m.push({recid:this.records[w].recid,column:d[y]});this.select.apply(this,m)}else{var b=this.last.selection,x=b.indexes.indexOf(c)!=-1,_=!1;$(t.target).parents("td").hasClass("w2ui-col-select")&&(_=!0),(t.ctrlKey||t.shiftKey||t.metaKey||_)&&this.multiSelect||this.showSelectColumn?("row"!=this.selectType&&$.inArray(n,b.columns[c])==-1&&(x=!1),x===!0?this.unselect({recid:e,column:n}):this.select({recid:e,column:n})):("row"!=this.selectType&&$.inArray(n,b.columns[c])==-1&&(x=!1),l.length>300?this.selectNone():this.unselect.apply(this,l),x===!0&&1==l.length?this.unselect({recid:e,column:n}):this.select({recid:e,column:n}))}this.status(),s.initResize(),this.trigger($.extend(a,{phase:"after"}))}}},columnClick:function(e,t){var i=this.trigger({phase:"before",type:"columnClick",target:this.name,field:e,originalEvent:t});if(i.isCancelled!==!0){if("row"==this.selectType){var n=this.getColumn(e);n&&n.sortable&&this.sort(e,null,!(!t||!t.ctrlKey&&!t.metaKey)),"line-number"==i.field&&(this.getSelection().length>=this.records.length?this.selectNone():this.selectAll())}else if("line-number"==i.field)this.getSelection().length>=this.records.length?this.selectNone():this.selectAll();else{t.shiftKey||t.metaKey||t.ctrlKey||this.selectNone();var s=this.getSelection(),n=this.getColumn(i.field,!0),r=[],o=[];if(0!=s.length&&t.shiftKey){var a=n,l=s[0].column;a>l&&(a=s[0].column,l=n);for(var c=a;c<=l;c++)o.push(c)}else o.push(n);var i=this.trigger({phase:"before",type:"columnSelect",target:this.name,columns:o});if(i.isCancelled!==!0){for(var c=0;c<this.records.length;c++)r.push({recid:this.records[c].recid,column:o});this.select.apply(this,r)}this.trigger($.extend(i,{phase:"after"}))}this.trigger($.extend(i,{phase:"after"}))}},columnDblClick:function(e,t){var i=this.trigger({phase:"before",type:"columnDblClick",target:this.name,field:e,originalEvent:t});i.isCancelled!==!0&&this.trigger($.extend(i,{phase:"after"}))},focus:function(e){var t=this,i=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:e});return i.isCancelled!==!0&&(this.hasFocus=!0,$(this.box).find(".w2ui-inactive").removeClass("w2ui-inactive"),setTimeout(function(){var e=$(t.box).find("#grid_"+t.name+"_focus");e.is(":focus")||e.focus()},10),void this.trigger($.extend(i,{phase:"after"})))},blur:function(e){var t=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:e});return t.isCancelled!==!0&&(this.hasFocus=!1,$(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),$(this.box).find(".w2ui-selection").addClass("w2ui-inactive"),void this.trigger($.extend(t,{phase:"after"})))},keydown:function(e){function t(){var e=Math.floor(a[0].scrollTop/n.recordHeight)+1;(!n.records[e]||e<2)&&(e=0),n.select({recid:n.records[e].recid,column:0})}function i(){if("click"!=n.last.sel_type)return!1;if("row"!=n.selectType){if(n.last.sel_type="key",l.length>1){for(var e=0;e<l.length;e++)if(l[e].recid==n.last.sel_recid&&l[e].column==n.last.sel_col){l.splice(e,1);break}return n.unselect.apply(n,l),!0}return!1}return n.last.sel_type="key",l.length>1&&(l.splice(l.indexOf(n.records[n.last.sel_ind].recid),1),n.unselect.apply(n,l),!0)}var n=this,s="object"!=typeof this.url?this.url:this.url.get;if(n.keyboard===!0){var r=n.trigger({phase:"before",type:"keydown",target:n.name,originalEvent:e});if(r.isCancelled!==!0){if($(this.box).find(">.w2ui-message").length>0)return void(27==e.keyCode&&this.message());var o=!1,a=$("#grid_"+n.name+"_records"),l=n.getSelection();0===l.length&&(o=!0);var c=l[0]||null,d=[],u=l[l.length-1];if("object"==typeof c&&null!=c){c=l[0].recid,d=[];for(var h=0;;){if(!l[h]||l[h].recid!=c)break;d.push(l[h].column),h++}u=l[l.length-1].recid}var p=n.get(c,!0),f=n.get(u,!0),g=(n.get(c),$("#grid_"+n.name+"_rec_"+(null!=p?w2utils.escapeId(n.records[p].recid):"none"))),m=!1,v=e.keyCode,w=e.shiftKey;switch(v){case 8:case 46:(this.show.toolbarDelete||this.onDelete)&&n.delete(),m=!0,e.stopPropagation();break;case 27:n.selectNone(),m=!0;break;case 65:if(!e.metaKey&&!e.ctrlKey)break;n.selectAll(),m=!0;break;case 13:if("row"==this.selectType&&n.show.expandColumn===!0){if(g.length<=0)break;n.toggle(c,e),m=!0}else{for(var y=0;y<this.columns.length;y++){var b=this.getCellEditable(p,y);if(b){d.push(parseInt(y));break}}"row"==this.selectType&&this.last.edit_col&&(d=[this.last.edit_col]),d.length>0&&(n.editField(c,d[0],null,e),m=!0)}break;case 37:if(o){t();break}if("row"==this.selectType){if(g.length<=0)break;var x=this.records[p].w2ui||{};!x||null==x.parent_recid||Array.isArray(x.children)&&0!==x.children.length&&x.expanded?n.collapse(c,e):(n.unselect(c),n.collapse(x.parent_recid,e),n.select(x.parent_recid))}else{var _=n.prevCell(p,d[0]);if(w||null!=_||(this.selectNone(),_=0),null!=_)if(w&&n.multiSelect){if(i())return;var x=[],C=[],k=[];if(0===d.indexOf(this.last.sel_col)&&d.length>1){for(var T=0;T<l.length;T++)x.indexOf(l[T].recid)==-1&&x.push(l[T].recid),k.push({recid:l[T].recid,column:d[d.length-1]});n.unselect.apply(n,k),n.scrollIntoView(p,d[d.length-1],!0)}else{for(var T=0;T<l.length;T++)x.indexOf(l[T].recid)==-1&&x.push(l[T].recid),C.push({recid:l[T].recid,column:_});n.select.apply(n,C),n.scrollIntoView(p,_,!0)}}else e.metaKey=!1,n.click({recid:c,column:_},e),n.scrollIntoView(p,_,!0);else if(!w)if(l.length>1)n.selectNone();else for(var S=1;S<l.length;S++)n.unselect(l[S])}m=!0;break;case 39:if(o){t();break}if("row"==this.selectType){if(g.length<=0)break;n.expand(c,e)}else{var E=n.nextCell(p,d[d.length-1]);if(w||null!=E||(this.selectNone(),E=this.columns.length-1),null!=E)if(w&&39==v&&n.multiSelect){if(i())return;var x=[],C=[],k=[];if(d.indexOf(this.last.sel_col)==d.length-1&&d.length>1){for(var T=0;T<l.length;T++)x.indexOf(l[T].recid)==-1&&x.push(l[T].recid),k.push({recid:l[T].recid,column:d[0]});n.unselect.apply(n,k),n.scrollIntoView(p,d[0],!0)}else{for(var T=0;T<l.length;T++)x.indexOf(l[T].recid)==-1&&x.push(l[T].recid),C.push({recid:l[T].recid,column:E});n.select.apply(n,C),n.scrollIntoView(p,E,!0)}}else e.metaKey=!1,n.click({recid:c,column:E},e),n.scrollIntoView(p,E,!0);else if(!w)if(l.length>1)n.selectNone();else for(var S=0;S<l.length-1;S++)n.unselect(l[S])}m=!0;break;case 38:if(o&&t(),g.length<=0)break;var _=n.prevRow(p,d[0]);if(w||null!=_||(_=0==this.searchData.length||s?0:this.last.searchIds[0]),null!=_){if(w&&n.multiSelect){if(i())return;if("row"==n.selectType)n.last.sel_ind>_&&n.last.sel_ind!=f?n.unselect(n.records[f].recid):n.select(n.records[_].recid);else if(n.last.sel_ind>_&&n.last.sel_ind!=f){_=f;for(var x=[],y=0;y<d.length;y++)x.push({recid:n.records[_].recid,column:d[y]});n.unselect.apply(n,x)}else{for(var x=[],y=0;y<d.length;y++)x.push({recid:n.records[_].recid,column:d[y]});n.select.apply(n,x)}}else l.length>300?this.selectNone():this.unselect.apply(this,l),n.click({recid:n.records[_].recid,column:d[0]},e);n.scrollIntoView(_),e.preventDefault&&e.preventDefault()}else if(!w)if(l.length>1)n.selectNone();else for(var S=1;S<l.length;S++)n.unselect(l[S]);break;case 40:if(o&&t(),g.length<=0)break;var E=n.nextRow(f,d[0]);if(w||null!=E||(E=0==this.searchData.length||s?this.records.length-1:this.last.searchIds[this.last.searchIds.length-1]),null!=E){if(w&&n.multiSelect){if(i())return;if("row"==n.selectType)this.last.sel_ind<E&&this.last.sel_ind!=p?n.unselect(n.records[p].recid):n.select(n.records[E].recid);else if(this.last.sel_ind<E&&this.last.sel_ind!=p){E=p;for(var x=[],y=0;y<d.length;y++)x.push({recid:n.records[E].recid,column:d[y]});n.unselect.apply(n,x)}else{for(var x=[],y=0;y<d.length;y++)x.push({recid:n.records[E].recid,column:d[y]});n.select.apply(n,x)}}else l.length>300?this.selectNone():this.unselect.apply(this,l),n.click({recid:n.records[E].recid,column:d[0]},e);n.scrollIntoView(E),m=!0}else if(!w)if(l.length>1)n.selectNone();else for(var S=0;S<l.length-1;S++)n.unselect(l[S]);break;case 17:case 91:if(o)break;n.last.isSafari&&(n.last.copy_event=n.copy(!1,e),$("#grid_"+n.name+"_focus").val(n.last.copy_event.text).select());break;case 67:(e.metaKey||e.ctrlKey)&&(n.last.isSafari?n.copy(n.last.copy_event,e):(n.last.copy_event=n.copy(!1,e),$("#grid_"+n.name+"_focus").val(n.last.copy_event.text).select(),n.copy(n.last.copy_event,e)));break;case 88:if(o)break;(e.ctrlKey||e.metaKey)&&(n.last.isSafari?n.copy(n.last.copy_event,e):(n.last.copy_event=n.copy(!1,e),$("#grid_"+n.name+"_focus").val(n.last.copy_event.text).select(),n.copy(n.last.copy_event,e)),setTimeout(function(){n.delete(!0)},100))}for(var x=[32,187,189,192,219,220,221,186,222,188,190,191],T=48;T<=111;T++)x.push(T);x.indexOf(v)==-1||e.ctrlKey||e.metaKey||m||(0===d.length&&d.push(0),m=!1,setTimeout(function(){var t=$("#grid_"+n.name+"_focus"),i=t.val();t.val(""),n.editField(c,d[0],i,e)},1)),m&&e.preventDefault&&e.preventDefault(),n.trigger($.extend(r,{phase:"after"}))}}},scrollIntoView:function(e,t,i){var n=this.records.length;if(0==this.searchData.length||this.url||(n=this.last.searchIds.length),0!==n){if(null==e){var s=this.getSelection();if(0===s.length)return;$.isPlainObject(s[0])?(e=s[0].index,t=s[0].column):e=this.get(s[0],!0)}var r=$("#grid_"+this.name+"_records"),o=this.last.searchIds.length;if(o>0&&(e=this.last.searchIds.indexOf(e)),r.height()<this.recordHeight*(o>0?o:n)&&r.length>0){var a=Math.floor(r[0].scrollTop/this.recordHeight),l=a+Math.floor(r.height()/this.recordHeight);e==a&&(i===!0?r.prop({scrollTop:r.scrollTop()-r.height()/1.3}):(r.stop(),r.animate({scrollTop:r.scrollTop()-r.height()/1.3},250,"linear"))),e==l&&(i===!0?r.prop({scrollTop:r.scrollTop()+r.height()/1.3}):(r.stop(),r.animate({scrollTop:r.scrollTop()+r.height()/1.3},250,"linear"))),(e<a||e>l)&&(i===!0?r.prop({scrollTop:(e-1)*this.recordHeight}):(r.stop(),r.animate({scrollTop:(e-1)*this.recordHeight},250,"linear")))}if(null!=t){for(var c=0,d=0,u=w2utils.scrollBarSize(),h=0;h<=t;h++){var p=this.columns[h];p.frozen||p.hidden||(c=d,d+=parseInt(p.sizeCalculated))}r.width()<d-r.scrollLeft()?i===!0?r.prop({scrollLeft:c-u}):r.animate({scrollLeft:c-u},250,"linear"):c<r.scrollLeft()&&(i===!0?r.prop({scrollLeft:d-r.width()+2*u}):r.animate({scrollLeft:d-r.width()+2*u},250,"linear"))}}},dblClick:function(e,t){var i=null;if("object"==typeof e&&(i=e.column,e=e.recid),null==t&&(t={}),null==i&&t.target){var n=t.target;"TD"!=n.tagName.toUpperCase()&&(n=$(n).parents("td")[0]),i=parseInt($(n).attr("col"))}var s=this.get(e,!0),r=this.records[s],o=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:e,column:i,originalEvent:t});if(o.isCancelled!==!0){this.selectNone();var a=this.getCellEditable(s,i);a?this.editField(e,i,null,t):(this.select({recid:e,column:i}),(this.show.expandColumn||r.w2ui&&Array.isArray(r.w2ui.children))&&this.toggle(e)),this.trigger($.extend(o,{phase:"after"}))}},contextMenu:function(e,t,i){var n=this;if("text"!=n.last.userSelect){null==i&&(i={offsetX:0,offsetY:0,target:$("#grid_"+n.name+"_rec_"+e)[0]}),null==i.offsetX&&(i.offsetX=i.layerX-i.target.offsetLeft,i.offsetY=i.layerY-i.target.offsetTop),w2utils.isFloat(e)&&(e=parseFloat(e));var s=this.getSelection();if("row"==this.selectType)s.indexOf(e)==-1&&n.click(e);else{var r=$(i.target);"TD"!=r[0].tagName.toUpperCase()&&(r=$(i.target).parents("td"));var o=!1;t=r.attr("col");for(var a=0;a<s.length;a++)s[a].recid!=e&&s[a].column!=t||(o=!0);o||null==e||n.click({recid:e,column:t}),o||null==t||n.columnClick(this.columns[t].field,i)}var l=n.trigger({phase:"before",type:"contextMenu",target:n.name,originalEvent:i,recid:e,column:t});l.isCancelled!==!0&&(n.menu.length>0&&$(n.box).find(i.target).w2menu(n.menu,{originalEvent:i,contextMenu:!0,onSelect:function(t){n.menuClick(e,parseInt(t.index),t.originalEvent)}}),i.preventDefault&&i.preventDefault(),n.trigger($.extend(l,{phase:"after"})))}},menuClick:function(e,t,i){var n=this,s=n.trigger({phase:"before",type:"menuClick",target:n.name,originalEvent:i,recid:e,menuIndex:t,menuItem:n.menu[t]});s.isCancelled!==!0&&n.trigger($.extend(s,{phase:"after"}))},toggle:function(e){var t=this.get(e);return t.w2ui=t.w2ui||{},t.w2ui.expanded===!0?this.collapse(e):this.expand(e)},expand:function(e){var t=this.get(e,!0),i=this.records[t];i.w2ui=i.w2ui||{};var n=w2utils.escapeId(e),s=i.w2ui.children;if(Array.isArray(s)){if(i.w2ui.expanded===!0||0===s.length)return!1;var r=this.trigger({phase:"before",type:"expand",target:this.name,recid:e});if(r.isCancelled===!0)return!1;i.w2ui.expanded=!0,s.forEach(function(e){e.w2ui=e.w2ui||{},e.w2ui.parent_recid=i.recid,null==e.w2ui.children&&(e.w2ui.children=[])}),this.records.splice.apply(this.records,[t+1,0].concat(s)),this.total+=s.length;var o="object"!=typeof this.url?this.url:this.url.get;o||(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0)),this.refresh(),this.trigger($.extend(r,{phase:"after"}))}else{if($("#grid_"+this.name+"_rec_"+n+"_expanded_row").length>0||this.show.expandColumn!==!0)return!1;if("none"==i.w2ui.expanded)return!1;$("#grid_"+this.name+"_rec_"+n).after('<tr id="grid_'+this.name+"_rec_"+e+'_expanded_row" class="w2ui-expanded-row">    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+e+'_expanded"></div>    </td>    <td class="w2ui-grid-data-last"></td></tr>'),
$("#grid_"+this.name+"_frec_"+n).after('<tr id="grid_'+this.name+"_frec_"+e+'_expanded_row" class="w2ui-expanded-row">'+(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="100">       <div id="grid_'+this.name+"_frec_"+e+'_expanded"></div>   </td></tr>');var r=this.trigger({phase:"before",type:"expand",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+e+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+n+"_expanded"});if(r.isCancelled===!0)return $("#grid_"+this.name+"_rec_"+n+"_expanded_row").remove(),$("#grid_"+this.name+"_frec_"+n+"_expanded_row").remove(),!1;var a=$(this.box).find("#grid_"+this.name+"_rec_"+e+"_expanded"),l=$(this.box).find("#grid_"+this.name+"_frec_"+e+"_expanded"),c=a.find("> div:first-child").height();a.height()<c&&a.css({height:c+"px"}),l.height()<c&&l.css({height:c+"px"}),$("#grid_"+this.name+"_rec_"+n).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+n).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("-"),i.w2ui.expanded=!0,this.trigger($.extend(r,{phase:"after"})),this.resizeRecords()}return!0},collapse:function(e){function t(e){e.w2ui.expanded=!1;for(var i=0;i<e.w2ui.children.length;i++){var n=e.w2ui.children[i];n.w2ui.expanded&&t(n)}}var i=this,n=this.get(e,!0),s=this.records[n];s.w2ui=s.w2ui||{};var r=w2utils.escapeId(e),o=s.w2ui.children;if(Array.isArray(o)){if(s.w2ui.expanded!==!0)return!1;var a=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e});if(a.isCancelled===!0)return!1;t(s);for(var l=[],c=s;null!=c;c=this.get(c.w2ui.parent_recid))l.push(c.w2ui.parent_recid);for(var d=n+1,u=d;;){if(this.records.length<=u+1||null==this.records[u+1].w2ui||l.indexOf(this.records[u+1].w2ui.parent_recid)>=0)break;u++}this.records.splice(d,u-d+1),this.total-=u-d+1;var h="object"!=typeof this.url?this.url:this.url.get;h||this.searchData.length>0&&this.localSearch(!0),this.refresh(),i.trigger($.extend(a,{phase:"after"}))}else{if(0===$("#grid_"+this.name+"_rec_"+r+"_expanded_row").length||this.show.expandColumn!==!0)return!1;var a=this.trigger({phase:"before",type:"collapse",target:this.name,recid:e,box_id:"grid_"+this.name+"_rec_"+r+"_expanded",fbox_id:"grid_"+this.name+"_frec_"+r+"_expanded"});if(a.isCancelled===!0)return!1;$("#grid_"+this.name+"_rec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_frec_"+r).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_cell_"+this.get(e,!0)+"_expand div").html("+"),$("#grid_"+i.name+"_rec_"+r+"_expanded").css("height","0px"),$("#grid_"+i.name+"_frec_"+r+"_expanded").css("height","0px"),setTimeout(function(){$("#grid_"+i.name+"_rec_"+r+"_expanded_row").remove(),$("#grid_"+i.name+"_frec_"+r+"_expanded_row").remove(),s.w2ui.expanded=!1,i.trigger($.extend(a,{phase:"after"})),i.resizeRecords()},300)}return!0},sort:function(e,t,i){var n=this.trigger({phase:"before",type:"sort",target:this.name,field:e,direction:t,multiField:i});if(n.isCancelled!==!0){if(null!=e){for(var s=this.sortData.length,r=0;r<this.sortData.length;r++)if(this.sortData[r].field==e){s=r;break}if(null==t)if(null==this.sortData[s])t="asc";else switch(String(this.sortData[s].direction)){case"asc":t="desc";break;case"desc":t="asc";break;default:t="asc"}this.multiSort===!1&&(this.sortData=[],s=0),1!=i&&(this.sortData=[],s=0),null==this.sortData[s]&&(this.sortData[s]={}),this.sortData[s].field=e,this.sortData[s].direction=t}else this.sortData=[];var o="object"!=typeof this.url?this.url:this.url.get;o?(this.trigger($.extend(n,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(!0,!0),this.searchData.length>0&&this.localSearch(!0),this.last.scrollTop=0,$("#grid_"+this.name+"_records").prop("scrollTop",0),this.trigger($.extend(n,{phase:"after"})),this.refresh())}},copy:function(e,t){if($.isPlainObject(e))return this.trigger($.extend(e,{phase:"after"})),e.text;var i=this.getSelection();if(0===i.length)return"";var n="";if("object"==typeof i[0]){for(var s=i[0].column,r=i[0].column,o=[],a=0;a<i.length;a++)i[a].column<s&&(s=i[a].column),i[a].column>r&&(r=i[a].column),o.indexOf(i[a].index)==-1&&o.push(i[a].index);o.sort(function(e,t){return e-t});for(var l=0;l<o.length;l++){for(var c=o[l],d=s;d<=r;d++){var u=this.columns[d];u.hidden!==!0&&(n+=w2utils.stripTags(this.getCellHTML(c,d))+"\t")}n=n.substr(0,n.length-1),n+="\n"}}else{for(var d=0;d<this.columns.length;d++){var u=this.columns[d];if(u.hidden!==!0){var h=u.caption?u.caption:u.field;u.caption&&u.caption.length<3&&u.tooltip&&(h=u.tooltip),n+='"'+w2utils.stripTags(h)+'"\t'}}n=n.substr(0,n.length-1),n+="\n";for(var a=0;a<i.length;a++){for(var c=this.get(i[a],!0),d=0;d<this.columns.length;d++){var u=this.columns[d];u.hidden!==!0&&(n+='"'+w2utils.stripTags(this.getCellHTML(c,d))+'"\t')}n=n.substr(0,n.length-1),n+="\n"}}if(n=n.substr(0,n.length-1),null==e){var p=this.trigger({phase:"before",type:"copy",target:this.name,text:n,originalEvent:t});return p.isCancelled===!0?"":(n=p.text,this.trigger($.extend(p,{phase:"after"})),n)}if(e===!1){var p=this.trigger({phase:"before",type:"copy",target:this.name,text:n,originalEvent:t});return p.isCancelled===!0?"":(n=p.text,p)}},paste:function(e){var t=this.getSelection(),i=this.get(t[0].recid,!0),n=t[0].column,s=this.trigger({phase:"before",type:"paste",target:this.name,text:e,index:i,column:n});if(s.isCancelled!==!0){if(e=s.text,"row"==this.selectType||0===t.length)return console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected."),void this.trigger($.extend(s,{phase:"after"}));for(var r=[],e=e.split("\n"),o=0;o<e.length;o++){var a=e[o].split("\t"),l=0,c=this.records[i],d=[];if(null!=c){for(var u=0;u<a.length;u++)if(this.columns[n+l]){var h=this.columns[n+l].field;c.w2ui=c.w2ui||{},c.w2ui.changes=c.w2ui.changes||{},c.w2ui.changes[h]=a[u],d.push(n+l),l++}for(var p=0;p<d.length;p++)r.push({recid:c.recid,column:d[p]});i++}}this.selectNone(),this.select.apply(this,r),this.refresh(),this.trigger($.extend(s,{phase:"after"}))}},resize:function(){var e=this,t=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div.w2ui-grid-box").css("width",$(this.box).width()).css("height",$(this.box).height());var i=this.trigger({phase:"before",type:"resize",target:this.name});if(i.isCancelled!==!0)return e.resizeBoxes(),e.resizeRecords(),e.toolbar&&e.toolbar.resize&&e.toolbar.resize(),this.trigger($.extend(i,{phase:"after"})),(new Date).getTime()-t}},update:function(e){var t=(new Date).getTime();if(null==this.box)return 0;if(null==e){for(var i=this.last.range_start-1;i<=this.last.range_end-1;i++)if(!(i<0)){var n=this.records[i]||{};n.w2ui||(n.w2ui={});for(var s=0;s<this.columns.length;s++){var r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s);o.replaceWith(this.getCellHTML(i,s,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s),null==n.w2ui.style||$.isEmptyObject(n.w2ui.style)?o.attr("style",""):("string"==typeof n.w2ui.style&&r.attr("style",n.w2ui.style),$.isPlainObject(n.w2ui.style)&&"string"==typeof n.w2ui.style[s]&&o.attr("style",n.w2ui.style[s])),null==n.w2ui.class||$.isEmptyObject(n.w2ui.class)||("string"==typeof n.w2ui.class&&r.addClass(n.w2ui.class),$.isPlainObject(n.w2ui.class)&&"string"==typeof n.w2ui.class[s]&&o.addClass(n.w2ui.class[s]))}}}else for(var a=0;a<e.length;a++){var i=e[a].index,s=e[a].column;if(!(i<0))if(null!=i&&null!=s){var n=this.records[i]||{},r=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(n.recid)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s);n.w2ui||(n.w2ui={}),o.replaceWith(this.getCellHTML(i,s,!1)),o=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s),null==n.w2ui.style||$.isEmptyObject(n.w2ui.style)?o.attr("style",""):("string"==typeof n.w2ui.style&&r.attr("style",n.w2ui.style),$.isPlainObject(n.w2ui.style)&&"string"==typeof n.w2ui.style[s]&&o.attr("style",n.w2ui.style[s])),null==n.w2ui.class||$.isEmptyObject(n.w2ui.class)||("string"==typeof n.w2ui.class&&r.addClass(n.w2ui.class),$.isPlainObject(n.w2ui.class)&&"string"==typeof n.w2ui.class[s]&&o.addClass(n.w2ui.class[s]))}else console.log("ERROR: Wrong argument for grid.update(cells), cells should be [{ index: X, column: Y }, ...]")}return(new Date).getTime()-t},refreshCell:function(e,t){var i=this.get(e,!0),n=!this.records[i]||this.records[i].recid!=e,s=this.getColumn(t,!0),r=n?this.summary[i]:this.records[i],o=this.columns[s],a=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s);return null!=r&&(a.replaceWith(this.getCellHTML(i,s,n)),a=$(this.box).find("#grid_"+this.name+"_data_"+i+"_"+s),r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[o.field]?a.addClass("w2ui-changed"):a.removeClass("w2ui-changed"),r.w2ui&&null!=r.w2ui.style&&!$.isEmptyObject(r.w2ui.style)?("string"==typeof r.w2ui.style&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)).attr("style",r.w2ui.style),$.isPlainObject(r.w2ui.style)&&"string"==typeof r.w2ui.style[s]&&a.attr("style",r.w2ui.style[s])):a.attr("style",""),void(r.w2ui&&null!=r.w2ui.class&&!$.isEmptyObject(r.w2ui.class)&&("string"==typeof r.w2ui.class&&$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(r.recid)).addClass(r.w2ui.class),$.isPlainObject(r.w2ui.class)&&"string"==typeof r.w2ui.class[s]&&a.addClass(r.w2ui.class[s]))))},refreshRow:function(e,t){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if(i.length>0){null==t&&(t=this.get(e,!0));var s=i.attr("line"),r=!this.records[t]||this.records[t].recid!=e,o="object"!=typeof this.url?this.url:this.url.get;if(this.searchData.length>0&&!o)for(var a=0;a<this.last.searchIds.length;a++)this.last.searchIds[a]==t&&(t=a);var l=this.getRecordHTML(t,s,r);$(i).replaceWith(l[0]),$(n).replaceWith(l[1]);var c=this.records[t].w2ui?this.records[t].w2ui.style:"";if("string"==typeof c){var i=$(this.box).find("#grid_"+this.name+"_frec_"+w2utils.escapeId(e)),n=$(this.box).find("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));i.attr("custom_style",c),n.attr("custom_style",c),i.hasClass("w2ui-selected")&&(c=c.replace("background-color","none")),i[0].style.cssText="height: "+this.recordHeight+"px;"+c,n[0].style.cssText="height: "+this.recordHeight+"px;"+c}r&&this.resize()}},refresh:function(){var e=this,t=(new Date).getTime(),i="object"!=typeof this.url?this.url:this.url.get;if(this.total<=0&&!i&&0===this.searchData.length&&(this.total=this.records.length),this.toolbar.disable("w2ui-edit","w2ui-delete"),this.box){var n=this.trigger({phase:"before",target:this.name,type:"refresh"});if(n.isCancelled!==!0){if(this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&#160;").show():$("#grid_"+this.name+"_header").hide(),this.show.toolbar){if(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked);else if($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)for(var s=this.toolbar.items,r=0;r<s.length;r++)"w2ui-search"!=s[r].id&&"break"!=s[r].type&&this.toolbar.refresh(s[r].id)}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var o=$("#grid_"+e.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&this.searches.length>0&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var a=0;a<this.searches.length;a++)this.searches[a].field==this.last.field&&(this.last.caption=this.searches[a].caption);if(this.last.multi?(o.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"),o.w2field("clear")):o.attr("placeholder",w2utils.lang(this.last.caption)),o.val()!=this.last.search){var l=this.last.search,s=o.data("w2field");s&&(l=s.format(l)),o.val(l)}e.refreshBody(),this.show.footer?$("#grid_"+this.name+"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();var c=$("#grid_"+this.name+"_searchClear");c.hide(),this.searchData.some(function(t){var i=e.getSearch(t.field);if(e.last.multi||i&&!i.hidden&&"list"!=i.type)return c.show(),!0});var d=this.last.selection,u=this.records.length>0&&d.indexes.length==this.records.length,h=d.indexes.length>0&&0!==this.searchData.length&&d.indexes.length==this.last.searchIds.length;u||h?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1),this.status();for(var p=e.find({"w2ui.expanded":!0},!0),f=0;f<p.length;f++){var s=e.records[p[f]].w2ui;s&&!Array.isArray(s.children)&&(s.expanded=!1)}return e.markSearch&&setTimeout(function(){for(var t=[],i=0;i<e.searchData.length;i++){var n=e.searchData[i],s=e.getSearch(n.field);s&&!s.hidden&&t.indexOf(n.value)==-1&&t.push(n.value)}t.length>0&&$(e.box).find(".w2ui-grid-data > div").w2marker(t)},50),this.show.toolbarSave&&(this.getChanges().length>0?this.toolbar.enable("w2ui-save"):this.toolbar.disable("w2ui-save")),this.trigger($.extend(n,{phase:"after"})),e.resize(),e.addRange("selection"),setTimeout(function(){e.resize(),e.scroll()},1),e.reorderColumns&&!e.last.columnDrag?e.last.columnDrag=e.initColumnDrag():!e.reorderColumns&&e.last.columnDrag&&e.last.columnDrag.remove(),(new Date).getTime()-t}}},refreshBody:function(){var e=this.find({"w2ui.summary":!0},!0);if(e.length>0){for(var t=0;t<e.length;t++)this.summary.push(this.records[e[t]]);for(var t=e.length-1;t>=0;t--)this.records.splice(e[t],1)}this.scroll();var i=this.getRecordsHTML(),n=this.getColumnsHTML(),s='<div id="grid_'+this.name+'_frecords" class="w2ui-grid-frecords" style="margin-bottom: '+(w2utils.scrollBarSize()-1)+'px;">'+i[0]+'</div><div id="grid_'+this.name+'_records" class="w2ui-grid-records" onscroll="w2ui[\''+this.name+"'].scroll(event);\">"+i[1]+'</div><div id="grid_'+this.name+'_scroll1" class="w2ui-grid-scroll1" style="height: '+w2utils.scrollBarSize()+'px"></div><div id="grid_'+this.name+'_fcolumns" class="w2ui-grid-fcolumns">    <table><tbody>'+n[0]+'</tbody></table></div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table><tbody>'+n[1]+"</tbody></table></div>";if($("#grid_"+this.name+"_body").html(s),0===this.records.length&&this.msgEmpty?$("#grid_"+this.name+"_body").append('<div id="grid_'+this.name+'_empty_msg" class="w2ui-grid-empty-msg"><div>'+this.msgEmpty+"</div></div>"):$("#grid_"+this.name+"_empty_msg").length>0&&$("#grid_"+this.name+"_empty_msg").remove(),this.summary.length>0){var r=this.getSummaryHTML();$("#grid_"+this.name+"_fsummary").html(r[0]).show(),$("#grid_"+this.name+"_summary").html(r[1]).show()}else $("#grid_"+this.name+"_fsummary").hide(),$("#grid_"+this.name+"_summary").hide()},render:function(e){function t(e){if(1==e.which&&("text"==s.last.userSelect&&(delete s.last.userSelect,$(s.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","none"))),!("row"==s.selectType&&($(e.target).parents().hasClass("w2ui-head")||$(e.target).hasClass("w2ui-head"))||s.last.move&&"expand"==s.last.move.type))){if(e.altKey)$(s.box).find(".w2ui-grid-body").css(w2utils.cssPrefix("user-select","text")),s.selectNone(),s.last.move={type:"text-select"},s.last.userSelect="text";else if(s.multiSelect||s.reorderRows){for(var t=e.target,r={x:e.offsetX-10,y:e.offsetY-10},o=!1;t&&(!t.classList||!t.classList.contains("w2ui-grid"));)t.tagName&&"TD"==t.tagName.toUpperCase()&&(o=!0),t.tagName&&"TR"!=t.tagName.toUpperCase()&&1==o&&(r.x+=t.offsetLeft,r.y+=t.offsetTop),t=t.parentNode;s.last.move={x:e.screenX,y:e.screenY,divX:0,divY:0,focusX:r.x,focusY:r.y,recid:$(e.target).parents("tr").attr("recid"),column:parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col")),type:"select",ghost:!1,start:!0},null==s.last.move.recid&&(s.last.move.type="select-column");var a=e.target,l=$(s.box).find("#grid_"+s.name+"_focus");if(s.last.move){var c=s.last.move.focusX,d=s.last.move.focusY,u=$(a).parents("table").parent();(u.hasClass("w2ui-grid-records")||u.hasClass("w2ui-grid-frecords")||u.hasClass("w2ui-grid-columns")||u.hasClass("w2ui-grid-fcolumns")||u.hasClass("w2ui-grid-summary"))&&(c=s.last.move.focusX-$(s.box).find("#grid_"+s.name+"_records").scrollLeft(),d=s.last.move.focusY-$(s.box).find("#grid_"+s.name+"_records").scrollTop()),($(a).hasClass("w2ui-grid-footer")||$(a).parents("div.w2ui-grid-footer").length>0)&&(d=$(s.box).find("#grid_"+s.name+"_footer").position().top),l.css({left:c-10,top:d})}setTimeout(function(){["INPUT","TEXTAREA","SELECT"].indexOf(a.tagName.toUpperCase())!=-1?$(a).focus():l.is(":focus")||l.focus()},50)}if(1==s.reorderRows){var h=e.target;if("TD"!=h.tagName.toUpperCase()&&(h=$(h).parents("td")[0]),$(h).hasClass("w2ui-col-number")){s.selectNone(),s.last.move.reorder=!0;var p=$(s.box).find(".w2ui-even.w2ui-empty-record").css("background-color"),f=$(s.box).find(".w2ui-odd.w2ui-empty-record").css("background-color");$(s.box).find(".w2ui-even td").not(".w2ui-col-number").css("background-color",p),$(s.box).find(".w2ui-odd td").not(".w2ui-col-number").css("background-color",f);var g=s.last.move;if(!g.ghost){var m=$("#grid_"+s.name+"_rec_"+g.recid),t=m.parents("table").find("tr:first-child").clone();g.offsetY=e.offsetY,g.from=g.recid,g.pos=m.position(),g.ghost=$(m).clone(!0),g.ghost.removeAttr("id"),m.find("td").remove(),m.append('<td colspan="1000" style="height: '+s.recordHeight+'px; background-color: #eee; border-bottom: 1px dashed #aaa; border-top: 1px dashed #aaa;"></td>');var v=$(s.box).find(".w2ui-grid-records");v.append('<table id="grid_'+s.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.7; pointer-events: none;"></table>'),$("#grid_"+s.name+"_ghost").append(t).append(g.ghost)}var w=$("#grid_"+s.name+"_ghost"),v=$(s.box).find(".w2ui-grid-records");w.css({top:g.pos.top+v.scrollTop(),left:g.pos.left,"border-top":"1px solid #aaa","border-bottom":"1px solid #aaa"})}else s.last.move.reorder=!1}$(document).on("mousemove",i),$(document).on("mouseup",n),e.stopPropagation()}}function i(e){var t=s.last.move;if(t&&["select","select-column"].indexOf(t.type)!=-1&&(t.divX=e.screenX-t.x,t.divY=e.screenY-t.y,!(Math.abs(t.divX)<=1&&Math.abs(t.divY)<=1))){if(s.last.cancelClick=!0,1==s.reorderRows&&s.last.move.reorder){var i=$(e.target).parents("tr"),n=i.attr("recid");if(n!=t.from){var r=($("#grid_"+s.name+"_rec_"+t.recid),$("#grid_"+s.name+"_rec_"+n));$(s.box).find(".tmp-ghost").css("border-top","0px"),r.addClass("tmp-ghost").css("border-top","2px solid #769EFC"),t.lastY=e.screenY,t.to=n}var o=$("#grid_"+s.name+"_ghost"),a=$(s.box).find(".w2ui-grid-records");return void o.css({top:t.pos.top+t.divY+a.scrollTop(),left:t.pos.left})}t.start&&t.recid&&(s.selectNone(),t.start=!1);var l=[],n="TR"==e.target.tagName.toUpperCase()?$(e.target).attr("recid"):$(e.target).parents("tr").attr("recid");if(null==n){if("row"==s.selectType)return;if(s.last.move&&"select"==s.last.move.type)return;var c=parseInt($(e.target).parents("td").attr("col"));if(isNaN(c))s.removeRange("column-selection"),$(s.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected"),$(s.box).find(".w2ui-col-number").removeClass("w2ui-row-selected"),delete t.colRange;else{var d=c+"-"+c;t.column<c&&(d=t.column+"-"+c),t.column>c&&(d=c+"-"+t.column);for(var u=[],i=d.split("-"),p=parseInt(i[0]);p<=parseInt(i[1]);p++)u.push(p);if(t.colRange!=d&&(h=s.trigger({phase:"before",type:"columnSelect",target:s.name,columns:u,isCancelled:!1}),h.isCancelled!==!0)){null==t.colRange&&s.selectNone();var i=d.split("-");$(s.box).find(".w2ui-grid-columns .w2ui-col-header, .w2ui-grid-fcolumns .w2ui-col-header").removeClass("w2ui-col-selected");for(var f=parseInt(i[0]);f<=parseInt(i[1]);f++)$(s.box).find("#grid_"+s.name+"_column_"+f+" .w2ui-col-header").addClass("w2ui-col-selected");$(s.box).find(".w2ui-col-number").not(".w2ui-head").addClass("w2ui-row-selected"),t.colRange=d,s.removeRange("column-selection"),s.addRange({name:"column-selection",range:[{recid:s.records[0].recid,column:i[0]},{recid:s.records[s.records.length-1].recid,column:i[1]}],style:"background-color: rgba(90, 145, 234, 0.1)"})}}}else{var g=s.get(t.recid,!0);if(null==g||s.records[g]&&s.records[g].recid!=t.recid)return;var m=s.get(n,!0);if(null==m)return;var v=parseInt(t.column),w=parseInt("TD"==e.target.tagName.toUpperCase()?$(e.target).attr("col"):$(e.target).parents("td").attr("col"));if(isNaN(v)&&isNaN(w)&&(v=0,w=s.columns.length-1),g>m){var i=g;g=m,m=i}var i="ind1:"+g+",ind2;"+m+",col1:"+v+",col2:"+w;if(t.range==i)return;t.range=i;for(var y=g;y<=m;y++)if(!(s.last.searchIds.length>0&&s.last.searchIds.indexOf(y)==-1))if("row"!=s.selectType){if(v>w){var i=v;v=w,w=i}for(var i=[],b=v;b<=w;b++)s.columns[b].hidden||l.push({recid:s.records[y].recid,column:parseInt(b)})}else l.push(s.records[y].recid);if("row"!=s.selectType){for(var x=s.getSelection(),i=[],_=0;_<l.length;_++){for(var C=!1,k=0;k<x.length;k++)l[_].recid==x[k].recid&&l[_].column==x[k].column&&(C=!0);C||i.push({recid:l[_].recid,column:l[_].column})}s.select.apply(s,i);for(var i=[],k=0;k<x.length;k++){for(var C=!1,_=0;_<l.length;_++)l[_].recid==x[k].recid&&l[_].column==x[k].column&&(C=!0);C||i.push({recid:x[k].recid,column:x[k].column})}s.unselect.apply(s,i)}else if(s.multiSelect){for(var x=s.getSelection(),_=0;_<l.length;_++)x.indexOf(l[_])==-1&&s.select(l[_]);for(var k=0;k<x.length;k++)l.indexOf(x[k])==-1&&s.unselect(x[k])}}}}function n(e){var t=s.last.move;if(setTimeout(function(){delete s.last.cancelClick},1),!$(e.target).parents().hasClass(".w2ui-head")&&!$(e.target).hasClass(".w2ui-head")){if(t&&["select","select-column"].indexOf(t.type)!=-1){if(null!=t.colRange&&h.isCancelled!==!0){for(var r=t.colRange.split("-"),o=[],a=0;a<s.records.length;a++){for(var l=[],c=parseInt(r[0]);c<=parseInt(r[1]);c++)l.push(c);o.push({recid:s.records[a].recid,column:l})}s.removeRange("column-selection"),s.trigger($.extend(h,{phase:"after"})),s.select.apply(s,o)}if(1==s.reorderRows&&s.last.move.reorder){var d=s.trigger({phase:"before",target:s.name,type:"reorderRow",recid:t.from,moveAfter:t.to});if(d.isCancelled===!0)return $("#grid_"+s.name+"_ghost").remove(),void s.refresh();var u=s.get(t.from,!0),p=s.get(t.to,!0),r=s.records[u];null!=u&&null!=p&&(s.records.splice(u,1),u>p?s.records.splice(p,0,r):s.records.splice(p-1,0,r)),$("#grid_"+s.name+"_ghost").remove(),s.refresh(),s.trigger($.extend(d,{phase:"after"}))}}delete s.last.move,$(document).off("mousemove",i),$(document).off("mouseup",n)}}var s=this,r=(new Date).getTime();if(null!=e&&($(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=e),this.box){var o="object"!=typeof this.url?this.url:this.url.get,a=this.trigger({phase:"before",target:this.name,type:"render",box:e});if(a.isCancelled!==!0){if(this.reset(!0),!this.last.field)if(this.multiSearch&&this.show.searchAll)this.last.field="all",this.last.caption=w2utils.lang("All Fields");else{for(var l=0;l<this.searches.length&&(this.searches[l].hidden||this.searches[l].simple===!1);)l++;l>=this.searches.length?(this.last.field="",this.last.caption=""):(this.last.field=this.searches[l].field,this.last.caption=this.searches[l].caption)}if($(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div class="w2ui-grid-box">    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_fsummary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div>    <textarea id="grid_'+this.name+'_focus" class="w2ui-grid-focus-input"></textarea></div>'),"row"!=this.selectType&&$(this.box).addClass("w2ui-ss"),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),this.initToolbar(),null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]),this.last.field&&"all"!=this.last.field){var c=this.searchData;setTimeout(function(){s.initAllField(s.last.field,1==c.length?c[0].value:null)},1)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML()),this.last.state||(this.last.state=this.stateSave(!0)),this.stateRestore(),o&&this.refresh();for(var d=!1,u=0;u<this.searches.length;u++)if(this.searches[u].hidden){d=!0;break}d?(this.searchReset(!1),o||setTimeout(function(){s.searchReset()},1)):this.reload(),$(this.box).find("#grid_"+this.name+"_focus").on("focus",function(e){clearTimeout(s.last.kbd_timer),s.hasFocus||s.focus()}).on("blur",function(e){clearTimeout(s.last.kbd_timer),s.last.kbd_timer=setTimeout(function(){s.hasFocus&&s.blur()},100)}).on("paste",function(e){var t=this;setTimeout(function(){w2ui[s.name].paste(t.value),t.value=""},1)}).on("keydown",function(e){w2ui[s.name].keydown.call(w2ui[s.name],e)});var h;return $(this.box).on("mousedown",t),this.trigger($.extend(a,{phase:"after"})),0===$(".w2ui-layout").length&&$(window).off("resize.w2ui-"+this.name).on("resize.w2ui-"+this.name,function(e){w2ui[s.name].resize()}),(new Date).getTime()-r}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});e.isCancelled!==!0&&($(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),$(this.box).find("#grid_"+this.name+"_body").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){for(var e=this,t='<div class="w2ui-col-on-off"><table><tbody><tr id="grid_'+this.name+'_column_ln_check" onclick="w2ui[\''+e.name+'\'].columnOnOff(event, \'line-numbers\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(e.show.lineNumbers?"check":"empty")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">      <label>'+w2utils.lang("Line #")+"</label>   </td></tr>",i=0;i<this.columns.length;i++){var n=this.columns[i],s=this.columns[i].caption;n.hideable!==!1&&(!s&&this.columns[i].tooltip&&(s=this.columns[i].tooltip),s||(s="- column "+(parseInt(i)+1)+" -"),t+='<tr id="grid_'+this.name+"_column_"+i+'_check"        onclick="w2ui[\''+e.name+"'].columnOnOff(event, '"+n.field+'\'); event.stopPropagation();">   <td style="width: 30px; text-align: center; padding-right: 3px; color: #888;">      <span class="w2ui-column-check w2ui-icon-'+(n.hidden?"empty":"check")+'"></span>   </td>   <td onclick="jQuery(\'.w2ui-overlay\')[0].hide();">       <label>'+w2utils.stripTags(s)+"</label>   </td></tr>")}var r="object"!=typeof this.url?this.url:this.url.get;(r&&e.show.skipRecords||e.show.saveRestoreState)&&(t+='<tr style="pointer-events: none"><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>'),r&&e.show.skipRecords&&(t+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 60px" value="'+this.offset+'"             onkeydown="if ([48,49,50,51,52,53,54,55,56,57,58,13,8,46,37,39].indexOf(event.keyCode) == -1) { event.preventDefault() }"            onkeypress="if (event.keyCode == 13) {                w2ui[\''+e.name+"'].skip(this.value);                jQuery('.w2ui-overlay')[0].hide();             }\"/> "+w2utils.lang("Records")+"    </div></td></tr>"),e.show.saveRestoreState&&(t+='<tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateSave();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="var obj = w2ui[\''+e.name+"']; obj.toolbar.uncheck('w2ui-column-on-off'); obj.stateReset();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Restore Default State")+"</div></td></tr>"),t+="</tbody></table></div>",this.toolbar.get("w2ui-column-on-off").html=t}},initColumnDrag:function(e){function t(){c.pressed=!1,clearTimeout(c.timeout)}function i(e){c.timeout&&clearTimeout(c.timeout);var t=this;c.pressed=!0,c.timeout=setTimeout(function(){if(c.pressed){var i,r,o,a,d,u=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"],h=["w2ui-head-last"],p=u.concat(h),f=".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select",g=".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select";if($(e.originalEvent.target).parents().hasClass("w2ui-head")){for(var m=0,v=p.length;m<v;m++)if($(e.originalEvent.target).parents().hasClass(p[m]))return;if(c.numberPreColumnsPresent=$(l.box).find(g).length,c.columnHead=a=$(e.originalEvent.target).parents(".w2ui-head"),d=parseInt(a.attr("col"),10),i=l.trigger({type:"columnDragStart",phase:"before",originalEvent:e,origColumnNumber:d,target:a[0]}),i.isCancelled===!0)return!1;r=c.columns=$(l.box).find(".w2ui-head:not(.w2ui-head-last)"),$(document).on("mouseup",s),$(document).on("mousemove",n),c.originalPos=parseInt($(e.originalEvent.target).parent(".w2ui-head").attr("col"),10),c.ghost=$(t).clone(!0),$(c.ghost).find('[col]:not([col="'+c.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),$(c.ghost).find(f).remove(),$(c.ghost).find(".w2ui-grid-body").css({top:0}),o=$(c.ghost).find('[col="'+c.originalPos+'"]'),$(document.body).append(c.ghost),$(c.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:o.width(),height:$(l.box).find(".w2ui-grid-body:first").height(),left:e.pageX,top:e.pageY,opacity:.8},0),c.offsets=[];for(var m=0,v=r.length;m<v;m++)c.offsets.push($(r[m]).offset().left);l.trigger($.extend(i,{phase:"after"}))}}},150)}function n(e){if(c.pressed){var t=e.originalEvent.pageX,i=e.originalEvent.pageY,n=c.offsets,s=$(".w2ui-head:not(.w2ui-head-last)").width();c.targetInt=Math.max(c.numberPreColumnsPresent,o(t,n,s)),r(c.targetInt),a(t,i)}}function s(e){c.pressed=!1;var t,i,r,o,a,d=$(".w2ui-grid-ghost");return t=l.trigger({type:"columnDragEnd",phase:"before",originalEvent:e,target:c.columnHead[0]}),t.isCancelled!==!0&&(r=l.columns[c.originalPos],o=l.columns,a=$(c.columns[Math.min(c.lastInt,c.columns.length-1)]),i=c.lastInt<c.columns.length?parseInt(a.attr("col")):o.length,i!==c.originalPos+1&&i!==c.originalPos&&a&&a.length?($(c.ghost).animate({top:$(l.box).offset().top,left:a.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove(),d.remove()}),o.splice(i,0,$.extend({},r)),o.splice(o.indexOf(r),1)):($(c.ghost).remove(),d.remove()),$(document).off("mouseup",s),$(document).off("mousemove",n),c.marker&&c.marker.remove(),c={},l.refresh(),void l.trigger($.extend(t,{phase:"after",targetColumnNumber:i-1})))}function r(e){c.marker||c.markerLeft||(c.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),c.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),c.lastInt&&c.lastInt===e||(c.lastInt=e,c.marker.remove(),c.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),e>=c.columns.length?($(c.columns[c.columns.length-1]).children("div:last").append(c.marker.addClass("right").removeClass("left")),$(c.columns[c.columns.length-1]).addClass("w2ui-col-intersection")):e<=c.numberPreColumnsPresent?($(c.columns[c.numberPreColumnsPresent]).prepend(c.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(c.columns[c.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(c.columns[e]).children("div:last").prepend(c.marker.addClass("left").removeClass("right")),$(c.columns[e]).prev().children("div:last").append(c.markerLeft.addClass("right").removeClass("left")).css({
position:"relative"}),$(c.columns[e-1]).addClass("w2ui-col-intersection")))}function o(e,t,i){if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var n=0,s=t.length;n<s;n++){var r=t[n],o=t[n+1]||t[n]+i,a=(o-t[n])/2+t[n];if(e>r&&e<=a)return n;if(e>a&&e<=o)return n+1}return intersection}function a(e,t){$(c.ghost).css({left:e-10,top:t-10})}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var l=this,c={};return c.lastInt=null,c.pressed=!1,c.timeout=null,c.columnHead=null,$(l.box).on("mousedown",i),$(l.box).on("mouseup",t),{remove:function(){$(l.box).off("mousedown",i),$(l.box).off("mouseup",t),$(l.box).find(".w2ui-head").removeAttr("draggable"),l.last.columnDrag=!1}}},columnOnOff:function(e,t){var i=$(e.target).parents("tr").find(".w2ui-column-check"),n=this.trigger({phase:"before",target:this.name,type:"columnOnOff",field:t,originalEvent:e});if(n.isCancelled!==!0){for(var s=this,r=s.find({"w2ui.expanded":!0},!0),o=0;o<r.length;o++){var a=this.records[o].w2ui;a&&!Array.isArray(a.children)&&(this.records[o].w2ui.expanded=!1)}if("line-numbers"==t)this.show.lineNumbers=!this.show.lineNumbers,this.show.lineNumbers?i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"):i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.refreshBody(),this.resizeRecords();else{var l=this.getColumn(t);l.hidden?(i.addClass("w2ui-icon-check").removeClass("w2ui-icon-empty"),this.showColumn(l.field)):(i.addClass("w2ui-icon-empty").removeClass("w2ui-icon-check"),this.hideColumn(l.field))}e.shiftKey||e.metaKey||e.ctrlKey||setTimeout(function(){$().w2overlay({name:s.name+"_toolbar"})},150),this.trigger($.extend(n,{phase:"after"}))}},scrollToColumn:function(e){if(null!=e){for(var t=0,i=!1,n=0;n<this.columns.length;n++){var s=this.columns[n];if(s.field==e){i=!0;break}if(!s.frozen&&!s.hidden){var r=parseInt(s.sizeCalculated?s.sizeCalculated:s.size);t+=r}}i&&(this.last.scrollLeft=t+1,this.scroll())}},initToolbar:function(){var e=this;if(null==this.toolbar.render){var t=this.toolbar.items;if(this.toolbar.items=[],this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload)),this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns)),(this.show.toolbarReload||this.show.toolbarColumns)&&this.toolbar.items.push({type:"break",id:"w2ui-break0"}),this.show.toolbarInput){var i='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tbody><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input type="text" id="grid_'+this.name+'_search_all" class="w2ui-search-all" tabindex="-1"             placeholder="'+w2utils.lang(this.last.caption)+'" value="'+this.last.search+'"            onfocus="clearTimeout(w2ui[\''+this.name+'\'].last.kbd_timer);"            onkeydown="if (event.keyCode == 13 &amp;&amp; w2utils.isIE) this.onchange();"            onchange="                var grid = w2ui[\''+this.name+"'];                 var val = this.value;                 var sel = jQuery(this).data('selected');                var fld = jQuery(this).data('w2field');                 if (fld) val = fld.clean(val);                if (fld &amp;&amp; fld.type == 'list' &amp;&amp; sel &amp;&amp; typeof sel.id == 'undefined') {                   grid.searchReset();                } else {                   grid.search(grid.last.field, val);                }            \"/>    </td>    <td>        <div class=\"w2ui-search-clear\" id=\"grid_"+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+'\']; obj.searchReset();" style="display: none"        >&#160;&#160;</div>    </td></tr></tbody></table></div>';this.toolbar.items.push({type:"html",id:"w2ui-search",html:i})}if(this.show.toolbarSearch&&this.multiSearch&&this.searches.length>0&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"])),(this.show.toolbarSearch||this.show.toolbarInput)&&(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"}),this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add)),this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit)),this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons.delete)),this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save))),t)for(var n=0;n<t.length;n++)this.toolbar.items.push(t[n]);var e=this;this.toolbar.on("click",function(t){function i(){$("#w2ui-overlay-"+e.name+"-searchOverlay").data("keepOpen")!==!0&&(o.uncheck(s),$(document).off("click","body",i))}var n=e.trigger({phase:"before",type:"toolbar",target:t.target,originalEvent:t});if(n.isCancelled!==!0){var s=t.target;switch(s){case"w2ui-reload":var r=e.trigger({phase:"before",type:"reload",target:e.name});if(r.isCancelled===!0)return!1;e.reload(),e.trigger($.extend(r,{phase:"after"}));break;case"w2ui-column-on-off":e.initColumnOnOff(),e.initResize(),e.resize();break;case"w2ui-search-advanced":var o=this,a=this.get(s);a.checked?(e.searchClose(),setTimeout(function(){o.uncheck(s)},1)):(e.searchOpen(),t.originalEvent.stopPropagation(),$(document).on("click","body",i));break;case"w2ui-add":var n=e.trigger({phase:"before",target:e.name,type:"add",recid:null});e.trigger($.extend(n,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-edit":var l=e.getSelection(),c=null;1==l.length&&(c=l[0]);var n=e.trigger({phase:"before",target:e.name,type:"edit",recid:c});e.trigger($.extend(n,{phase:"after"})),setTimeout(function(){$().w2tag()},20);break;case"w2ui-delete":e.delete();break;case"w2ui-save":e.save()}e.trigger($.extend(n,{phase:"after"}))}})}},initResize:function(){var e=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}).off("mousedown").on("mousedown",function(t){t||(t=window.event),e.resizing=!0,e.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt($(this).attr("name"))},t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();for(var i=0;i<e.columns.length;i++)e.columns[i].hidden||(null==e.columns[i].sizeOriginal&&(e.columns[i].sizeOriginal=e.columns[i].size),e.columns[i].size=e.columns[i].sizeCalculated);var n={phase:"before",type:"columnResize",target:e.name,column:e.last.tmp.col,field:e.columns[e.last.tmp.col].field};n=e.trigger($.extend(n,{resizeBy:0,originalEvent:t}));var s=function(t){if(1==e.resizing){if(t||(t=window.event),n=e.trigger($.extend(n,{resizeBy:t.screenX-e.last.tmp.gx,originalEvent:t})),n.isCancelled===!0)return void(n.isCancelled=!1);e.last.tmp.x=t.screenX-e.last.tmp.x,e.last.tmp.y=t.screenY-e.last.tmp.y,e.columns[e.last.tmp.col].size=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.resizeRecords(),e.scroll(),e.last.tmp.x=t.screenX,e.last.tmp.y=t.screenY}},r=function(t){delete e.resizing,$(document).off("mousemove","body"),$(document).off("mouseup","body"),e.resizeRecords(),e.scroll(),e.trigger($.extend(n,{phase:"after",originalEvent:t}))};$(document).on("mousemove","body",s),$(document).on("mouseup","body",r)}).each(function(e,t){var i=$(t).parent();$(t).css({height:"25px","margin-left":i.width()-3+"px"})})},resizeBoxes:function(){var e=$("#grid_"+this.name+"_header"),t=$("#grid_"+this.name+"_toolbar"),i=$("#grid_"+this.name+"_fsummary"),n=$("#grid_"+this.name+"_summary"),s=$("#grid_"+this.name+"_footer"),r=$("#grid_"+this.name+"_body");this.show.header&&e.css({top:"0px",left:"0px",right:"0px"}),this.show.toolbar&&t.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+"px",left:"0px",right:"0px"}),this.summary.length>0&&(i.css({bottom:0+(this.show.footer?w2utils.getSize(s,"height"):0)+"px"}),n.css({bottom:0+(this.show.footer?w2utils.getSize(s,"height"):0)+"px",right:"0px"})),this.show.footer&&s.css({bottom:"0px",left:"0px",right:"0px"}),r.css({top:0+(this.show.header?w2utils.getSize(e,"height"):0)+(this.show.toolbar?w2utils.getSize(t,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(s,"height"):0)+(this.summary.length>0?w2utils.getSize(n,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){function e(e,t,i){var n="",s="",r="";n+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',s+='<tr class="'+(e%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+t+'px">',i.show.lineNumbers&&(n+='<td class="w2ui-col-number"></td>'),i.show.selectColumn&&(n+='<td class="w2ui-grid-data w2ui-col-select"></td>'),i.show.expandColumn&&(n+='<td class="w2ui-grid-data w2ui-col-expand"></td>'),s+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var o=0;o<i.columns.length;o++){var a=i.columns[o];(a.hidden||o<i.last.colStart||o>i.last.colEnd)&&!a.frozen||(r='<td class="w2ui-grid-data" '+(null!=a.attr?a.attr:"")+' col="'+o+'"></td>',a.frozen?n+=r:s+=r)}n+='<td class="w2ui-grid-data-last"></td> </tr>',s+='<td class="w2ui-grid-data-last" col="end"></td> </tr>',$("#grid_"+i.name+"_frecords > table").append(n),$("#grid_"+i.name+"_records > table").append(s)}var t=this;$(this.box).find(".w2ui-empty-record").remove();var i=$(this.box),n=$(this.box).find("> div.w2ui-grid-box"),s=$("#grid_"+this.name+"_header"),r=$("#grid_"+this.name+"_toolbar"),o=$("#grid_"+this.name+"_summary"),a=$("#grid_"+this.name+"_fsummary"),l=$("#grid_"+this.name+"_footer"),c=$("#grid_"+this.name+"_body"),d=$("#grid_"+this.name+"_columns"),u=$("#grid_"+this.name+"_fcolumns"),h=$("#grid_"+this.name+"_records"),p=$("#grid_"+this.name+"_frecords"),f=$("#grid_"+this.name+"_scroll1"),g=8*String(this.total).length+10;g<34&&(g=34),null!=this.lineNumberWidth&&(g=this.lineNumberWidth);for(var m=!1,v=!1,w=0,y=0;y<t.columns.length;y++)if(!t.columns[y].frozen&&!t.columns[y].hidden){var b=parseInt(t.columns[y].sizeCalculated?t.columns[y].sizeCalculated:t.columns[y].size);w+=b}if(h.width()<w&&(m=!0),c.height()-d.height()<$(h).find(">table").height()+(m?w2utils.scrollBarSize():0)&&(v=!0),this.fixedBody){var x=n.height()-(this.show.header?w2utils.getSize(s,"height"):0)-(this.show.toolbar?w2utils.getSize(r,"height"):0)-("none"!=o.css("display")?w2utils.getSize(o,"height"):0)-(this.show.footer?w2utils.getSize(l,"height"):0);c.css("height",x)}else{var x=w2utils.getSize(d,"height")+w2utils.getSize($("#grid_"+t.name+"_records table"),"height")+(m?w2utils.scrollBarSize():0);t.height=x+w2utils.getSize(n,"+height")+(t.show.header?w2utils.getSize(s,"height"):0)+(t.show.toolbar?w2utils.getSize(r,"height"):0)+("none"!=o.css("display")?w2utils.getSize(o,"height"):0)+(t.show.footer?w2utils.getSize(l,"height"):0),n.css("height",t.height),c.css("height",x),i.css("height",w2utils.getSize(n,"height")+w2utils.getSize(i,"+height"))}var _=this.records.length,C="object"!=typeof this.url?this.url:this.url.get;if(0==this.searchData.length||C||(_=this.last.searchIds.length),this.fixedBody||(v=!1),m||v?(d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),h.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(d,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":m?"auto":"hidden","overflow-y":v?"auto":"hidden"})):(d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),h.css({top:(this.columnGroups.length>0&&this.show.columns?1:0)+w2utils.getSize(d,"height")+"px",overflow:"hidden"}),h.length>0&&(this.last.scrollTop=0,this.last.scrollLeft=0)),m?(p.css("margin-bottom",w2utils.scrollBarSize()),f.show()):(p.css("margin-bottom",0),f.hide()),p.css({overflow:"hidden",top:h.css("top")}),this.show.emptyRecords&&!v){var k=Math.floor(h.height()/this.recordHeight)-1,T=0;if(h[0]&&(T=h[0].scrollHeight-k*this.recordHeight),T>=this.recordHeight&&(T-=this.recordHeight,k++),this.fixedBody){for(var S=_;S<k;S++)e(S,this.recordHeight,this);e(k,T,this)}}if(c.length>0){for(var E=parseInt(c.width())-(v?w2utils.scrollBarSize():0)-(this.show.lineNumbers?g:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0)-1,j=E,z=0,D=!1,y=0;y<this.columns.length;y++){var P=this.columns[y];P.gridMinWidth>0&&(P.gridMinWidth>j&&P.hidden!==!0&&(P.hidden=!0,D=!0),P.gridMinWidth<j&&P.hidden===!0&&(P.hidden=!1,D=!0))}if(D===!0)return void this.refresh();for(var y=0;y<this.columns.length;y++){var P=this.columns[y];P.hidden||("px"==String(P.size).substr(String(P.size).length-2).toLowerCase()?(E-=parseFloat(P.size),this.columns[y].sizeCalculated=P.size,this.columns[y].sizeType="px"):(z+=parseFloat(P.size),this.columns[y].sizeType="%",delete P.sizeCorrected))}if(100!=z&&z>0)for(var y=0;y<this.columns.length;y++){var P=this.columns[y];P.hidden||"%"==P.sizeType&&(P.sizeCorrected=Math.round(100*parseFloat(P.size)*100/z)/100+"%")}for(var y=0;y<this.columns.length;y++){var P=this.columns[y];P.hidden||"%"==P.sizeType&&(null!=this.columns[y].sizeCorrected?this.columns[y].sizeCalculated=Math.floor(E*parseFloat(P.sizeCorrected)/100)-1+"px":this.columns[y].sizeCalculated=Math.floor(E*parseFloat(P.size)/100)-1+"px")}}for(var I=0,y=0;y<this.columns.length;y++){var P=this.columns[y];P.hidden||(null==P.min&&(P.min=20),parseInt(P.sizeCalculated)<parseInt(P.min)&&(P.sizeCalculated=P.min+"px"),parseInt(P.sizeCalculated)>parseInt(P.max)&&(P.sizeCalculated=P.max+"px"),I+=parseInt(P.sizeCalculated))}var O=parseInt(j)-parseInt(I);if(O>0&&z>0)for(var y=0;;){var P=this.columns[y];if(null!=P)if(P.hidden||"px"==P.sizeType)y++;else{if(P.sizeCalculated=parseInt(P.sizeCalculated)+1+"px",O--,0===O)break;y++}else y=0}else O>0&&d.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();var R=1;this.show.lineNumbers&&(R+=g),this.show.selectColumn&&(R+=26),this.show.expandColumn&&(R+=26);for(var y=0;y<this.columns.length;y++)this.columns[y].hidden||this.columns[y].frozen&&(R+=parseInt(this.columns[y].sizeCalculated));u.css("width",R),p.css("width",R),a.css("width",R),f.css("width",R),d.css("left",R),h.css("left",R),o.css("left",R),d.find("> table > tbody > tr:nth-child(1) td").add(u.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var s=0,r=0;r<t.last.colStart;r++)!t.columns[r]||t.columns[r].frozen||t.columns[r].hidden||(s+=parseInt(t.columns[r].sizeCalculated));$(i).css("width",s+"px")}t.columns[n]&&$(i).css("width",t.columns[n].sizeCalculated)}if($(i).hasClass("w2ui-head-last"))if(t.last.colEnd+1<t.columns.length){for(var s=0,r=t.last.colEnd+1;r<t.columns.length;r++)!t.columns[r]||t.columns[r].frozen||t.columns[r].hidden||(s+=parseInt(t.columns[r].sizeCalculated));$(i).css("width",s+"px")}else $(i).css("width",w2utils.scrollBarSize()+(O>0&&0===z?O:0)+"px")}),3==d.find("> table > tbody > tr").length&&d.find("> table > tbody > tr:nth-child(1) td").add(u.find("> table > tbody > tr:nth-child(1) td")).html("").css({height:"0px",border:"0px",padding:"0px",margin:"0px"}),h.find("> table > tbody > tr:nth-child(1) td").add(p.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var s=0,r=0;r<t.last.colStart;r++)!t.columns[r]||t.columns[r].frozen||t.columns[r].hidden||(s+=parseInt(t.columns[r].sizeCalculated));$(i).css("width",s+"px")}t.columns[n]&&$(i).css("width",t.columns[n].sizeCalculated)}if($(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length)if(t.last.colEnd+1<t.columns.length){for(var s=0,r=t.last.colEnd+1;r<t.columns.length;r++)!t.columns[r]||t.columns[r].frozen||t.columns[r].hidden||(s+=parseInt(t.columns[r].sizeCalculated));$(i).css("width",s+"px")}else $(i).css("width",(O>0&&0===z?O:0)+"px")}),o.find("> table > tbody > tr:nth-child(1) td").add(a.find("> table > tbody > tr:nth-child(1) td")).each(function(e,i){$(i).hasClass("w2ui-col-number")&&$(i).css("width",g);var n=$(i).attr("col");if(null!=n){if("start"==n){for(var s=0,r=0;r<t.last.colStart;r++)!t.columns[r]||t.columns[r].frozen||t.columns[r].hidden||(s+=parseInt(t.columns[r].sizeCalculated));$(i).css("width",s+"px")}t.columns[n]&&$(i).css("width",t.columns[n].sizeCalculated)}$(i).hasClass("w2ui-grid-data-last")&&0===$(i).parents(".w2ui-grid-frecords").length&&$(i).css("width",w2utils.scrollBarSize()+(O>0&&0===z?O:0)+"px")}),this.initResize(),this.refreshRanges(),(this.last.scrollTop||this.last.scrollLeft)&&h.length>0&&(d.prop("scrollLeft",this.last.scrollLeft),h.prop("scrollTop",this.last.scrollTop),h.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){function e(e,i){var n="",s=t.operators[t.operatorsMap[e]];null!=i&&(s=i);for(var r=0;r<s.length;r++){var o=s[r],a=o;Array.isArray(o)?(a=o[1],o=o[0],null==a&&(a=o)):$.isPlainObject(o)&&(a=o.text,o=o.oper),n+='<option value="'+o+'">'+w2utils.lang(a)+"</option>\n"}return n}for(var t=this,i='<table cellspacing="0" onclick="event.stopPropagation()"><tbody>',n=!1,s=0;s<this.searches.length;s++){var r=this.searches[s];if(r.type=String(r.type).toLowerCase(),!r.hidden){var o="";0==n&&(o='<button class="w2ui-btn close-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) obj.searchClose()\">X</button>",n=!0),null==r.inTag&&(r.inTag=""),null==r.outTag&&(r.outTag=""),null==r.style&&(r.style=""),null==r.type&&(r.type="text");var a='<select id="grid_'+this.name+"_operator_"+s+'" class="w2ui-input" onclick="event.stopPropagation();"   onchange="w2ui[\''+this.name+"'].initOperator(this, "+s+')">'+e(r.type,r.operators)+"</select>";switch(i+='<tr>    <td class="close-btn">'+o+'</td>    <td class="caption">'+(r.caption||"")+'</td>    <td class="operator">'+a+'</td>    <td class="value">',r.type){case"text":case"alphanumeric":case"hex":case"color":case"list":case"combo":case"enum":var l="width: 250px;";["hex","color"].indexOf(r.type)!=-1&&(l="width: 90px;"),i+='<input rel="search" type="text" id="grid_'+this.name+"_field_"+s+'" name="'+r.field+'"    class="w2ui-input" style="'+l+r.style+'" '+r.inTag+"/>";break;case"int":case"float":case"money":case"currency":case"percent":case"date":case"time":case"datetime":var l="width: 90px";"datetime"==r.type&&(l="width: 140px;"),i+='<input rel="search" type="text" class="w2ui-input" style="'+l+r.style+'" id="grid_'+this.name+"_field_"+s+'" name="'+r.field+'" '+r.inTag+'/><span id="grid_'+this.name+"_range_"+s+'" style="display: none">&#160;-&#160;&#160;<input rel="search" type="text" class="w2ui-input" style="'+l+r.style+'" id="grid_'+this.name+"_field2_"+s+'" name="'+r.field+'" '+r.inTag+"/></span>";break;case"select":i+='<select rel="search" class="w2ui-input" style="'+r.style+'" id="grid_'+this.name+"_field_"+s+'"  name="'+r.field+'" '+r.inTag+'  onclick="event.stopPropagation();"></select>'}i+=r.outTag+"    </td></tr>"}}return i+='<tr>    <td colspan="4" class="actions">        <div>        <button class="w2ui-btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="w2ui-btn w2ui-btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></tbody></table>"},initOperator:function(e,t){var i=this,n=i.searches[t],s=$("#grid_"+i.name+"_range_"+t),r=$("#grid_"+i.name+"_field_"+t),o=r.parent().find("span input");switch(r.show(),s.hide(),$(e).val()){case"between":s.show(),o.w2field(n.type,n.options);break;case"not null":case"null":r.hide(),r.val("1"),r.change()}},initSearches:function(){for(var e=this,t=0;t<this.searches.length;t++){var i=this.searches[t],n=this.getSearchData(i.field);i.type=String(i.type).toLowerCase();var s=e.operators[e.operatorsMap[i.type]];i.operators&&(s=i.operators);var r=s[0];$.isPlainObject(r)&&(r=r.oper),"object"!=typeof i.options&&(i.options={}),"text"==i.type&&(r="begins");for(var o=0;o<s.length;o++){var a=s[o];if($.isPlainObject(a)&&(a=a.oper),i.operator==a){r=i.operator;break}}switch(i.type){case"text":case"alphanumeric":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options);break;case"int":case"float":case"hex":case"color":case"money":case"currency":case"percent":case"date":case"time":case"datetime":$("#grid_"+this.name+"_field_"+t).w2field(i.type,i.options),$("#grid_"+this.name+"_field2_"+t).w2field(i.type,i.options),setTimeout(function(){$("#grid_"+e.name+"_field_"+t).keydown(),$("#grid_"+e.name+"_field2_"+t).keydown()},1);break;case"list":case"combo":case"enum":var l=i.options;"list"==i.type&&(l.selected={}),"enum"==i.type&&(l.selected=[]),n&&(l.selected=n.value),$("#grid_"+this.name+"_field_"+t).w2field(i.type,$.extend({openOnFocus:!0},l)),n&&null!=n.text&&$("#grid_"+this.name+"_field_"+t).data("selected",{id:n.value,text:n.text});break;case"select":for(var l='<option value="">--</option>',o=0;o<i.options.items.length;o++){var c=i.options.items[o];if($.isPlainObject(i.options.items[o])){var d=c.id,u=c.text;null==d&&null!=c.value&&(d=c.value),null==u&&null!=c.caption&&(u=c.caption),null==d&&(d=""),l+='<option value="'+d+'">'+u+"</option>"}else l+='<option value="'+c+'">'+c+"</option>"}$("#grid_"+this.name+"_field_"+t).html(l)}null!=n?("int"==n.type&&["in","not in"].indexOf(n.operator)!=-1&&$("#grid_"+this.name+"_field_"+t).w2field("clear").val(n.value),$("#grid_"+this.name+"_operator_"+t).val(n.operator).trigger("change"),$.isArray(n.value)?["in","not in"].indexOf(n.operator)!=-1?$("#grid_"+this.name+"_field_"+t).val(n.value).trigger("change"):($("#grid_"+this.name+"_field_"+t).val(n.value[0]).trigger("change"),$("#grid_"+this.name+"_field2_"+t).val(n.value[1]).trigger("change")):null!=n.value&&$("#grid_"+this.name+"_field_"+t).val(n.value).trigger("change")):$("#grid_"+this.name+"_operator_"+t).val(r).trigger("change")}$("#w2ui-overlay-"+this.name+"-searchOverlay .w2ui-grid-searches *[rel=search]").on("keypress",function(t){13==t.keyCode&&(e.search(),$().w2overlay({name:e.name+"-searchOverlay"}))})},getColumnsHTML:function(){function e(){var e="<tr>",t="<tr>",n="";""!=i.columnGroups[i.columnGroups.length-1].caption&&i.columnGroups.push({caption:""}),i.show.lineNumbers&&(e+='<td class="w2ui-head w2ui-col-number">    <div style="height: '+(i.recordHeight+1)+'px">&#160;</div></td>'),i.show.selectColumn&&(e+='<td class="w2ui-head w2ui-col-select">    <div style="height: 25px">&#160;</div></td>'),i.show.expandColumn&&(e+='<td class="w2ui-head w2ui-col-expand">    <div style="height: 25px">&#160;</div></td>');var s=0;t+='<td id="grid_'+i.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var r=0;r<i.columnGroups.length;r++){var o=i.columnGroups[r],a=i.columns[s];null!=o.colspan&&(o.span=o.colspan),null!=o.span&&o.span==parseInt(o.span)||(o.span=1);for(var l=0,c=s;c<s+o.span;c++)i.columns[c]&&!i.columns[c].hidden&&l++;if(r==i.columnGroups.length-1&&l++,l<=0);else if(o.master===!0){for(var d="",u=0;u<i.sortData.length;u++)i.sortData[u].field==a.field&&(new RegExp("asc","i").test(i.sortData[u].direction)&&(d="w2ui-sort-up"),new RegExp("desc","i").test(i.sortData[u].direction)&&(d="w2ui-sort-down"));var h="";a.resizable!==!1&&(h='<div class="w2ui-resizer" name="'+s+'"></div>'),n='<td id="grid_'+i.name+"_column_"+s+'" class="w2ui-head '+d+'" col="'+s+'"     rowspan="2" colspan="'+l+'"     oncontextmenu = "w2ui[\''+i.name+"'].contextMenu(null, "+s+', event);"    onclick="w2ui[\''+i.name+"'].columnClick('"+a.field+"', event);\"    ondblclick=\"w2ui['"+i.name+"'].columnDblClick('"+a.field+"', event);\">"+h+'    <div class="w2ui-col-group w2ui-col-header '+(d?"w2ui-col-sorted":"")+'">        <div class="'+d+'"></div>'+(a.caption?a.caption:"&#160;")+"    </div></td>",a&&a.frozen?e+=n:t+=n}else n='<td id="grid_'+i.name+"_column_"+s+'" class="w2ui-head" col="'+s+'"         colspan="'+l+'">    <div class="w2ui-col-group">'+(o.caption?o.caption:"&#160;")+"    </div></td>",a&&a.frozen?e+=n:t+=n;s+=o.span}return e+="<td></td></tr>",t+='<td id="grid_'+i.name+'_column_end" class="w2ui-head" col="end"></td></tr>',[e,t]}function t(e){var t="<tr>",n="<tr>";i.show.lineNumbers&&(t+='<td class="w2ui-head w2ui-col-number"        onclick="w2ui[\''+i.name+"'].columnClick('line-number', event);\"       ondblclick=\"w2ui['"+i.name+"'].columnDblClick('line-number', event);\">    <div>#</div></td>"),i.show.selectColumn&&(t+='<td class="w2ui-head w2ui-col-select"       onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+i.name+'_check_all" tabindex="-1"            style="'+(0==i.multiSelect?"display: none;":"")+'"            onmousedown="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"            onclick="var grid = w2ui[\''+i.name+"'];               if (this.checked) grid.selectAll(); else grid.selectNone();               if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;               clearTimeout(grid.last.kbd_timer); /* keep focus */            \"/>    </div></td>"),i.show.expandColumn&&(t+='<td class="w2ui-head w2ui-col-expand">    <div>&#160;</div></td>');var s,r=0,o=0;n+='<td id="grid_'+i.name+'_column_start" class="w2ui-head" col="start" style="border-right: 0"></td>';for(var a=0;a<i.columns.length;a++){var l=i.columns[a];if(a==o&&(s=i.columnGroups[r++]||{},o+=s.span),(!(a<i.last.colStart||a>i.last.colEnd)||l.frozen)&&!l.hidden&&(s.master!==!0||e)){var c=i.getColumnCellHTML(a);l&&l.frozen?t+=c:n+=c}}return t+='<td class="w2ui-head w2ui-head-last"><div>&#160;</div></td>',n+='<td class="w2ui-head w2ui-head-last" col="end"><div>&#160;</div></td>',t+="</tr>",n+="</tr>",[t,n]}var i=this,n="",s="";if(this.show.columnHeaders)if(this.columnGroups.length>0){var r=t(!0),o=e(),a=t(!1);n=r[0]+o[0]+a[0],s=r[1]+o[1]+a[1]}else{var l=t(!0);n=l[0],s=l[1]}return[n,s]},getColumnCellHTML:function(e){var t=this.columns[e];if(null==t)return"";for(var i=!this.reorderColumns||this.columnGroups&&this.columnGroups.length?"":" w2ui-reorder-cols-head ",n="",s=0;s<this.sortData.length;s++)this.sortData[s].field==t.field&&(new RegExp("asc","i").test(this.sortData[s].direction)&&(n="w2ui-sort-up"),new RegExp("desc","i").test(this.sortData[s].direction)&&(n="w2ui-sort-down"));var r=this.last.selection.columns,o=!1;for(var a in r)for(var s=0;s<r[a].length;s++)r[a][s]==e&&(o=!0);var l='<td id="grid_'+this.name+"_column_"+e+'" col="'+e+'" class="w2ui-head '+n+i+'" '+("normal"==this.columnTooltip&&t.tooltip?'title="'+t.tooltip+'" ':"")+"    onmouseover = \"w2ui['"+this.name+"'].columnTooltipShow('"+e+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].columnTooltipHide('"+e+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(null, "+e+', event);"    onclick="w2ui[\''+this.name+"'].columnClick('"+t.field+"', event);\"    ondblclick=\"w2ui['"+this.name+"'].columnDblClick('"+t.field+"', event);\">"+(t.resizable!==!1?'<div class="w2ui-resizer" name="'+e+'"></div>':"")+'    <div class="w2ui-col-header '+(n?"w2ui-col-sorted":"")+" "+(o?"w2ui-col-selected":"")+'">        <div class="'+n+'"></div>'+(t.caption?t.caption:"&#160;")+"    </div></td>";return l},columnTooltipShow:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e),i=this.columns[e],n=this.columnTooltip;t.prop("_mouse_over",!0),setTimeout(function(){t.prop("_mouse_over")===!0&&t.prop("_mouse_tooltip")!==!0&&(t.prop("_mouse_tooltip",!0),t.w2tag(i.tooltip,{position:n}))},1)}},columnTooltipHide:function(e){if("normal"!=this.columnTooltip){var t=$(this.box).find("#grid_"+this.name+"_column_"+e);this.columns[e];t.removeProp("_mouse_over"),setTimeout(function(){t.prop("_mouse_over")!==!0&&t.prop("_mouse_tooltip")===!0&&(t.removeProp("_mouse_tooltip"),t.w2tag())},1)}},getRecordsHTML:function(){var e=this.records.length,t="object"!=typeof this.url?this.url:this.url.get;0==this.searchData.length||t||(e=this.last.searchIds.length),e>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start;var i=$("#grid_"+this.name+"_records"),n=Math.floor(i.height()/this.recordHeight)+this.last.show_extra+1;(!this.fixedBody||n>e)&&(n=e);var s=this.getRecordHTML(-1,0),r="<table><tbody>"+s[0],o="<table><tbody>"+s[1];r+='<tr id="grid_'+this.name+'_frec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>',o+='<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="2000"></td></tr>';for(var a=0;a<n;a++)s=this.getRecordHTML(a,a+1),r+=s[0],o+=s[1];return r+='<tr id="grid_'+this.name+'_frec_bottom" line="bottom" style="height: '+(e-n)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_frec_more" style="display: none; visibility: hidden">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',o+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(e-n)*this.recordHeight+'px">    <td colspan="2000" style="border: 0"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="2000" class="w2ui-load-more"></td></tr></tbody></table>',this.last.range_start=0,this.last.range_end=n,[r,o]},getSummaryHTML:function(){if(0!==this.summary.length){for(var e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1],n=0;n<this.summary.length;n++)e=this.getRecordHTML(n,n+1,!0),t+=e[0],i+=e[1];return t+="</tbody></table>",i+="</tbody></table>",[t,i]}},scroll:function(e){function t(){i.markSearch&&(clearTimeout(i.last.marker_timer),i.last.marker_timer=setTimeout(function(){for(var e=[],t=0;t<i.searchData.length;t++){var n=i.searchData[t],s=i.getSearch(n.field);s&&!s.hidden&&e.indexOf(n.value)==-1&&e.push(n.value)}e.length>0&&$(i.box).find(".w2ui-grid-data > div").w2marker(e)},50))}var i=((new Date).getTime(),this),n="object"!=typeof this.url?this.url:this.url.get,s=$("#grid_"+this.name+"_records"),r=$("#grid_"+this.name+"_frecords");if(e){var o=e.target.scrollTop,a=e.target.scrollLeft;i.last.scrollTop=o,i.last.scrollLeft=a,$("#grid_"+i.name+"_columns")[0].scrollLeft=a,$("#grid_"+i.name+"_summary")[0].scrollLeft=a,r[0].scrollTop=o}this.last.bubbleEl&&($(this.last.bubbleEl).w2tag(),this.last.bubbleEl=null);var l=null,c=null;if(i.disableCVS||i.columnGroups.length>0)l=0,c=i.columns.length-1;else{for(var d=s.width(),u=0,h=0;h<i.columns.length;h++)if(!i.columns[h].frozen&&!i.columns[h].hidden){var p=parseInt(i.columns[h].sizeCalculated?i.columns[h].sizeCalculated:i.columns[h].size);u+p+30>i.last.scrollLeft&&null==l&&(l=h),u+p-30>i.last.scrollLeft+d&&null==c&&(c=h),u+=p}null==c&&(c=i.columns.length-1)}if(null!=l&&(l<0&&(l=0),c<0&&(c=0),l==c&&(l>0?l--:c++),l!=i.last.colStart||c!=i.last.colEnd)){var f=$(i.box),g=Math.abs(l-i.last.colStart),m=Math.abs(c-i.last.colEnd);if(g<5&&m<5){var v=f.find(".w2ui-grid-columns #grid_"+i.name+"_column_start"),w=f.find(".w2ui-grid-columns .w2ui-head-last"),y=f.find("#grid_"+i.name+"_records .w2ui-grid-data-spacer"),b=f.find("#grid_"+i.name+"_records .w2ui-grid-data-last"),x=f.find("#grid_"+i.name+"_summary .w2ui-grid-data-spacer"),_=f.find("#grid_"+i.name+"_summary .w2ui-grid-data-last");if(l>i.last.colStart)for(var h=i.last.colStart;h<l;h++)f.find("#grid_"+i.name+"_columns #grid_"+i.name+"_column_"+h).remove(),f.find("#grid_"+i.name+'_records td[col="'+h+'"]').remove(),f.find("#grid_"+i.name+'_summary td[col="'+h+'"]').remove();if(c<i.last.colEnd)for(var h=i.last.colEnd;h>c;h--)f.find("#grid_"+i.name+"_columns #grid_"+i.name+"_column_"+h).remove(),f.find("#grid_"+i.name+'_records td[col="'+h+'"]').remove(),f.find("#grid_"+i.name+'_summary td[col="'+h+'"]').remove();if(l<i.last.colStart)for(var h=i.last.colStart-1;h>=l;h--)i.columns[h]&&(i.columns[h].frozen||i.columns[h].hidden)||(v.after(i.getColumnCellHTML(h)),
y.each(function(e,t){var n=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=n&&(s=i.getCellHTML(parseInt(n),h,!1)),$(t).after(s)}),x.each(function(e,t){var n=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=n&&(s=i.getCellHTML(parseInt(n),h,!0)),$(t).after(s)}));if(c>i.last.colEnd)for(var h=i.last.colEnd+1;h<=c;h++)i.columns[h]&&(i.columns[h].frozen||i.columns[h].hidden)||(w.before(i.getColumnCellHTML(h)),b.each(function(e,t){var n=$(t).parent().attr("index"),s='<td class="w2ui-grid-data" col="'+h+'" style="height: 0px"></td>';null!=n&&(s=i.getCellHTML(parseInt(n),h,!1)),$(t).before(s)}),_.each(function(e,t){var n=$(t).parent().attr("index"),s=i.getCellHTML(parseInt(n),h,!0);$(t).before(s)}));i.last.colStart=l,i.last.colEnd=c,i.resizeRecords()}else{i.last.colStart=l,i.last.colEnd=c;var C=this.getColumnsHTML(),k=this.getRecordsHTML(),T=this.getSummaryHTML(),S=f.find("#grid_"+this.name+"_columns"),E=f.find("#grid_"+this.name+"_records"),j=f.find("#grid_"+this.name+"_frecords"),z=f.find("#grid_"+this.name+"_summary");S.find("tbody").html(C[1]),j.html(k[0]),E.prepend(k[1]),null!=T&&z.html(T[1]),setTimeout(function(){E.find("> table").not("table:first-child").remove(),z[0]&&(z[0].scrollLeft=i.last.scrollLeft)},1),i.resizeRecords()}}var D=this.records.length;if(0==this.searchData.length||n||(D=this.last.searchIds.length),0!==D&&0!==s.length&&0!==s.height()&&(D>this.vs_start?this.last.show_extra=this.vs_extra:this.last.show_extra=this.vs_start,!(s.height()<D*this.recordHeight&&"hidden"==s.css("overflow-y")))){var P=Math.round(s[0].scrollTop/this.recordHeight+1),I=P+(Math.round(s.height()/this.recordHeight)-1);if(P>D&&(P=D),I>=D-1&&(I=D),$("#grid_"+this.name+"_footer .w2ui-footer-right").html((i.show.statusRange?w2utils.formatNumber(this.offset+P)+"-"+w2utils.formatNumber(this.offset+I)+(this.total!=-1?" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total):""):"")+(n&&i.show.statusBuffered?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(D)+(this.offset>0?", skip "+w2utils.formatNumber(this.offset):"")+")":"")),n||this.fixedBody&&!(this.total!=-1&&this.total<=this.vs_start)){var O=Math.floor(s[0].scrollTop/this.recordHeight)-this.last.show_extra,R=O+Math.floor(s.height()/this.recordHeight)+2*this.last.show_extra+1;O<1&&(O=1),R>this.total&&this.total!=-1&&(R=this.total);var A=s.find("#grid_"+this.name+"_rec_top"),F=s.find("#grid_"+this.name+"_rec_bottom"),M=r.find("#grid_"+this.name+"_frec_top"),N=r.find("#grid_"+this.name+"_frec_bottom");String(A.next().prop("id")).indexOf("_expanded_row")!=-1&&(A.next().remove(),M.next().remove()),this.total>R&&String(F.prev().prop("id")).indexOf("_expanded_row")!=-1&&(F.prev().remove(),N.prev().remove());var L=parseInt(A.next().attr("line")),H=parseInt(F.prev().attr("line"));if(L<O||1==L||this.last.pull_refresh){if(R<=H+this.last.show_extra-2&&R!=this.total)return;for(this.last.pull_refresh=!1;;){var B=r.find("#grid_"+this.name+"_frec_top").next(),V=s.find("#grid_"+this.name+"_rec_top").next();if("bottom"==V.attr("line"))break;if(!(parseInt(V.attr("line"))<O))break;B.remove(),V.remove()}var U=s.find("#grid_"+this.name+"_rec_bottom").prev(),q=U.attr("line");"top"==q&&(q=O);for(var h=parseInt(q)+1;h<=R;h++)if(this.records[h-1]){var V=this.records[h-1].w2ui;V&&!Array.isArray(V.children)&&(V.expanded=!1);var W=this.getRecordHTML(h-1,h);F.before(W[1]),N.before(W[0])}t(),setTimeout(function(){i.refreshRanges()},0)}else{if(O>=L-this.last.show_extra+2&&O>1)return;for(;;){var B=r.find("#grid_"+this.name+"_frec_bottom").prev(),V=s.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==V.attr("line"))break;if(!(parseInt(V.attr("line"))>R))break;B.remove(),V.remove()}var U=s.find("#grid_"+this.name+"_rec_top").next(),q=U.attr("line");"bottom"==q&&(q=R);for(var h=parseInt(q)-1;h>=O;h--)if(this.records[h-1]){var V=this.records[h-1].w2ui;V&&!Array.isArray(V.children)&&(V.expanded=!1);var W=this.getRecordHTML(h-1,h);A.after(W[1]),M.after(W[0])}t(),setTimeout(function(){i.refreshRanges()},0)}var Y=(O-1)*i.recordHeight,G=(D-R)*i.recordHeight;G<0&&(G=0),A.css("height",Y+"px"),M.css("height",Y+"px"),F.css("height",G+"px"),N.css("height",G+"px"),i.last.range_start=O,i.last.range_end=R;var X=Math.floor(s[0].scrollTop/this.recordHeight),K=X+Math.floor(s.height()/this.recordHeight);if(K+10>D&&this.last.pull_more!==!0&&(D<this.total-this.offset||this.total==-1&&this.last.xhr_hasMore))if(this.autoLoad===!0)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get");else{var J=$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more");"none"==J.css("display")&&J.show().on("click",function(){i.last.pull_more=!0,i.last.xhr_offset+=i.limit,i.request("get"),$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')}),(J.find("td .w2ui-spinner").length>0||J.find("td").text().indexOf("Load")==-1)&&J.find("td").html("<div>"+w2utils.lang("Load")+" "+i.limit+" "+w2utils.lang("More")+"...</div>")}D>=this.total-this.offset&&this.total!=-1&&$("#grid_"+this.name+"_rec_more, #grid_"+this.name+"_frec_more").hide()}}},getRecordHTML:function(e,t,i){var n,s="",r="",o="",a=this.last.selection;if(e==-1){r+='<tr line="0">',o+='<tr line="0">',this.show.lineNumbers&&(r+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(r+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(r+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),o+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(var l=0;l<this.columns.length;l++){var c=this.columns[l];if(s='<td class="w2ui-grid-data" col="'+l+'" style="height: 0px;"></td>',c.frozen&&!c.hidden)r+=s;else{if(c.hidden||l<this.last.colStart||l>this.last.colEnd)continue;o+=s}}return r+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',o+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',r+="</tr>",o+="</tr>",[r,o]}var d="object"!=typeof this.url?this.url:this.url.get;if(i!==!0)if(this.searchData.length>0&&!d){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],n=this.records[e]}else{if(e>=this.records.length)return"";n=this.records[e]}else{if(e>=this.summary.length)return"";n=this.summary[e]}if(!n)return"";null==n.recid&&null!=this.recid&&null!=n[this.recid]&&(n.recid=n[this.recid]);var u=(w2utils.escapeId(n.recid),!1);a.indexes.indexOf(e)!=-1&&(u=!0);var h=n.w2ui?n.w2ui.style:"";null!=h&&"string"==typeof h||(h="");var p=n.w2ui?n.w2ui.class:"";if(null!=p&&"string"==typeof p||(p=""),r+='<tr id="grid_'+this.name+"_frec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2===0?"w2ui-even":"w2ui-odd")+" "+p+(u&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&n.w2ui.editable===!1?" w2ui-no-edit":"")+(n.w2ui&&n.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",o+='<tr id="grid_'+this.name+"_rec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2===0?"w2ui-even":"w2ui-odd")+" "+p+(u&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&n.w2ui.editable===!1?" w2ui-no-edit":"")+(n.w2ui&&n.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",this.show.lineNumbers&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(u?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(i!==!0?this.getLineHTML(t,n):"")+"</td>"),this.show.selectColumn&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(i!==!0?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(u?'checked="checked"':"")+' style="pointer-events: none"/>    </div>':"")+"</td>"),this.show.expandColumn){var f="";f=n.w2ui&&n.w2ui.expanded===!0?"-":"+",n.w2ui&&"none"==n.w2ui.expanded&&(f=""),n.w2ui&&"spinner"==n.w2ui.expanded&&(f='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),r+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(i!==!0?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+f+" </div>":"")+"</td>"}o+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';for(var g=0,m=0;;){var v=1,c=this.columns[g];if(null==c)break;if(c.hidden)g++,m>0&&m--;else if(m>0){if(g++,null==this.columns[g])break;n.w2ui.colspan[this.columns[g-1].field]=0,m--}else{if(n.w2ui){var w=n.w2ui.colspan,y=this.columns[g].field;w&&0===w[y]&&delete w[y]}if(!(g<this.last.colStart||g>this.last.colEnd)||c.frozen){if(n.w2ui&&"object"==typeof n.w2ui.colspan){var b=parseInt(n.w2ui.colspan[c.field])||null;if(b>1){for(var x=0,l=g;l<g+b&&!(l>=this.columns.length);l++)this.columns[l].hidden&&x++;v=b-x,m=b-1}}var _=this.getCellHTML(e,g,i,v);c.frozen?r+=_:o+=_,g++}else g++}}return r+='<td class="w2ui-grid-data-last"></td>',o+='<td class="w2ui-grid-data-last" col="end"></td>',r+="</tr>",o+="</tr>",[r,o]},getLineHTML:function(e){return"<div>"+e+"</div>"},getCellHTML:function(e,t,i,n){var s=this.columns[t];if(null==s)return"";var r=i!==!0?this.records[e]:this.summary[e],o=this.getCellValue(e,t,i),a=this.getCellEditable(e,t),l="max-height: "+parseInt(this.recordHeight)+"px;",c=!i&&r&&r.w2ui&&r.w2ui.changes&&null!=r.w2ui.changes[s.field],d="",u="",h=this.last.selection,p=!1,f="";if(h.indexes.indexOf(e)!=-1&&(p=!0),null==n&&(n=r&&r.w2ui&&r.w2ui.colspan&&r.w2ui.colspan[s.field]?r.w2ui.colspan[s.field]:1),0===t&&r&&r.w2ui&&Array.isArray(r.w2ui.children)){for(var g=0,m=this.get(r.w2ui.parent_recid,!0);;){if(null==m)break;g++;var v=this.records[m].w2ui;if(null==v||null==v.parent_recid)break;m=this.get(v.parent_recid,!0)}if(r.w2ui.parent_recid)for(var w=0;w<g;w++)f+='<span class="w2ui-show-children w2ui-icon-empty"></span>';f+='<span class="w2ui-show-children '+(r.w2ui.children.length>0?r.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}if(s.info===!0&&(s.info={}),null!=s.info&&(s.info.icon||(s.info.icon="w2ui-icon-info"),f+='<span class="w2ui-info '+s.info.icon+'" style="'+(s.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+e+", "+t+')"></span>'),null!=s.render){if("function"==typeof s.render&&(o=$.trim(s.render.call(this,r,e,t,o)),(o.length<4||"<div"!=o.substr(0,4).toLowerCase())&&(o='<div style="'+l+'">'+f+String(o)+"</div>")),"object"==typeof s.render&&(o='<div style="'+l+'">'+f+(s.render[o]||"")+"</div>"),"string"==typeof s.render){var y=s.render.toLowerCase().indexOf(":"),v=[];y==-1?(v[0]=s.render.toLowerCase(),v[1]=""):(v[0]=s.render.toLowerCase().substr(0,y),v[1]=s.render.toLowerCase().substr(y+1));var b=w2utils.formatters[v[0]];o='<div style="'+l+'">'+f+("function"==typeof b?b(o,v[1]):"")+"</div>"}}else{if(a&&["checkbox","check"].indexOf(a.type)!=-1){var x=i?-(e+1):e;l+="text-align: center;",o='<input tabindex="-1" type="checkbox" '+(o?'checked="checked"':"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+x+", "+t+', event); "/>',f=""}if(this.show.recordTitles){var _=w2utils.stripTags(String(o).replace(/"/g,"''"));null!=s.title&&("function"==typeof s.title&&(_=s.title.call(this,r,e,t)),"string"==typeof s.title&&(_=s.title))}o='<div style="'+l+'" title="'+(_||"")+'">'+f+String(o)+"</div>"}if(null==o&&(o=""),"string"==typeof s.render){var v=s.render.toLowerCase().split(":");["number","int","float","money","currency","percent","size"].indexOf(v[0])!=-1&&(d+="text-align: right;")}r&&r.w2ui&&("object"==typeof r.w2ui.style&&("string"==typeof r.w2ui.style[t]&&(d+=r.w2ui.style[t]+";"),"string"==typeof r.w2ui.style[s.field]&&(d+=r.w2ui.style[s.field]+";")),"object"==typeof r.w2ui.class&&("string"==typeof r.w2ui.class[t]&&(u+=r.w2ui.class[t]+" "),"string"==typeof r.w2ui.class[s.field]&&(u+=r.w2ui.class[s.field]+" ")));var C=!1;return p&&$.inArray(t,h.columns[e])!=-1&&(C=!0),o='<td class="w2ui-grid-data'+(C?" w2ui-selected":"")+" "+u+(c?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+e+"_"+t+'" col="'+t+'"    style="'+d+(null!=s.style?s.style:"")+'" '+(null!=s.attr?s.attr:"")+(n>1?'colspan="'+n+'"':"")+">"+o+"</td>"},showBubble:function(e,t){var i="",n=this.columns[t].info,s=this.records[e],r=$(this.box).find("#grid_"+this.name+"_data_"+e+"_"+t+" .w2ui-info");if(this.last.bubbleEl&&$(this.last.bubbleEl).w2tag(),this.last.bubbleEl=r,null==n.fields){n.fields=[];for(var o=0;o<this.columns.length;o++){var a=this.columns[o];n.fields.push(a.field+("string"==typeof a.render?":"+a.render:""))}}var l=n.fields;if("function"==typeof l&&(l=l(s,e,t)),"function"==typeof n.render)i=n.render(s,e,t);else if($.isArray(l)){i='<table cellpadding="0" cellspacing="0">';for(var o=0;o<l.length;o++){var c=String(l[o]).split(":");if(""!=c[0]&&"-"!=c[0]&&"--"!=c[0]&&"---"!=c[0]){var a=this.getColumn(c[0]);null==a&&(a={field:c[0],caption:c[0]});var d=a?this.parseField(s,a.field):"";c.length>1&&(w2utils.formatters[c[1]]?d=w2utils.formatters[c[1]](d,c[2]||null):console.log('ERROR: w2utils.formatters["'+c[1]+'"] does not exists.')),(n.showEmpty===!0||null!=d&&""!=d)&&(null!=n.maxLength&&"string"==typeof d&&d.length>n.maxLength&&(d=d.substr(0,n.maxLength)+"..."),i+="<tr><td>"+a.caption+"</td><td>"+((0===d?"0":d)||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==c[0]?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}else if($.isPlainObject(l)){i='<table cellpadding="0" cellspacing="0">';for(var u in l){var h=l[u];if(""!=h&&"-"!=h&&"--"!=h&&"---"!=h){var c=String(h).split(":"),a=this.getColumn(c[0]);null==a&&(a={field:c[0],caption:c[0]});var d=a?this.parseField(s,a.field):"";c.length>1&&(w2utils.formatters[c[1]]?d=w2utils.formatters[c[1]](d,c[2]||null):console.log('ERROR: w2utils.formatters["'+c[1]+'"] does not exists.')),"function"==typeof h&&(d=h(s,e,t)),(n.showEmpty===!0||null!=d&&""!=d)&&(null!=n.maxLength&&"string"==typeof d&&d.length>n.maxLength&&(d=d.substr(0,n.maxLength)+"..."),i+="<tr><td>"+u+"</td><td>"+(d||"")+"</td></tr>")}else i+='<tr><td colspan=2><div style="border-top: '+(""==h?"0":"1")+'px solid #C1BEBE; margin: 6px 0px;"></div></td></tr>'}i+="</table>"}$(r).w2tag($.extend({html:i,left:-4,position:"bottom|top",className:"w2ui-info-bubble",style:"",hideOnClick:!0},n.options||{}))},getCellEditable:function(e,t){var i=this.columns[t],n=this.records[e];if(!n||!i)return null;var s=n.w2ui?n.w2ui.editable:null;if(s===!1)return null;if((null==s||s===!0)&&(s=i?i.editable:null,"function"==typeof s)){var r=this.getCellValue(e,t,!1);s=s.call(this,n,e,t,r)}return s},getCellValue:function(e,t,i){var n=this.columns[t],s=i!==!0?this.records[e]:this.summary[e],r=this.parseField(s,n.field);return s&&s.w2ui&&s.w2ui.changes&&null!=s.w2ui.changes[n.field]&&(r=s.w2ui.changes[n.field]),$.isPlainObject(r)&&n.editable&&(null!=r.text&&(r=r.text),null!=r.id&&(r=r.id)),null==r&&(r=""),r},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(e){if(null!=e)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(e);else{var t="",i=this.getSelection();if(i.length>0&&(this.show.statusSelection&&i.length>1&&(t=String(i.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected")),this.show.statusRecordID&&1==i.length)){var n=i[0];"object"==typeof n&&(n=n.recid+", "+w2utils.lang("Column")+": "+n.column),t=w2utils.lang("Record ID")+": "+n+" "}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(t),1==i.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit"),i.length>=1?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(e,t){var i=this,n=Array.prototype.slice.call(arguments,0);n.unshift(this.box),setTimeout(function(){$(i.box).find("#grid_"+i.name+"_empty_msg").remove(),w2utils.lock.apply(window,n)},10)},unlock:function(e){var t=this.box;setTimeout(function(){$(t).find(".w2ui-message").not(".w2ui-closing").length>0||w2utils.unlock(t,e)},25)},stateSave:function(e){if(!w2utils.hasLocalStorage)return null;for(var t={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},i=0;i<this.columns.length;i++){var n=this.columns[i];t.columns.push({field:n.field,hidden:!!n.hidden,frozen:!!n.frozen,size:n.size?n.size:null,sizeCalculated:n.sizeCalculated?n.sizeCalculated:null,sizeOriginal:n.sizeOriginal?n.sizeOriginal:null,sizeType:n.sizeType?n.sizeType:null})}for(var i=0;i<this.sortData.length;i++)t.sortData.push($.extend({},this.sortData[i]));for(var i=0;i<this.searchData.length;i++)t.searchData.push($.extend({},this.searchData[i]));if(e!==!0){var s=this.trigger({phase:"before",type:"stateSave",target:this.name,state:t});if(s.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));try{var r=$.parseJSON(localStorage.w2ui||"{}");r||(r={}),r.states||(r.states={}),r.states[this.stateId||this.name]=t,localStorage.w2ui=JSON.stringify(r)}catch(e){return delete localStorage.w2ui,null}this.trigger($.extend(s,{phase:"after"}))}return t},stateRestore:function(e){var t=this,i="object"!=typeof this.url?this.url:this.url.get;if(!e)try{if(!w2utils.hasLocalStorage)return!1;var n=$.parseJSON(localStorage.w2ui||"{}");n||(n={}),n.states||(n.states={}),e=n.states[this.stateId||this.name]}catch(e){return delete localStorage.w2ui,null}var s=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:e});if(s.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));if($.isPlainObject(e)){$.extend(this.show,e.show),$.extend(this.last,e.last);for(var r=this.last.scrollTop,o=this.last.scrollLeft,a=0;a<e.columns.length;a++){var n=e.columns[a],l=this.getColumn(n.field,!0);null!==l&&($.extend(this.columns[l],n),a!==l&&this.columns.splice(a,0,this.columns.splice(l,1)[0]))}this.sortData.splice(0,this.sortData.length);for(var a=0;a<e.sortData.length;a++)this.sortData.push(e.sortData[a]);this.searchData.splice(0,this.searchData.length);for(var a=0;a<e.searchData.length;a++)this.searchData.push(e.searchData[a]);setTimeout(function(){i||(t.sortData.length>0&&t.localSort(),t.searchData.length>0&&t.localSearch()),t.last.scrollTop=r,t.last.scrollLeft=o,t.refresh()},1)}return this.trigger($.extend(s,{phase:"after"})),!0},stateReset:function(){if(this.stateRestore(this.last.state),w2utils.hasLocalStorage)try{var e=$.parseJSON(localStorage.w2ui||"{}");e.states&&e.states[this.stateId||this.name]&&delete e.states[this.stateId||this.name],localStorage.w2ui=JSON.stringify(e)}catch(e){return delete localStorage.w2ui,null}},parseField:function(e,t){var i="";try{i=e;for(var n=String(t).split("."),s=0;s<n.length;s++)i=i[n[s]]}catch(e){i=""}return i},prepareData:function(){function e(i){for(var n=0;n<t.columns.length;n++){var s=t.columns[n];if(null!=i[s.field]&&"string"==typeof s.render){if(["number","int","float","money","currency","percent"].indexOf(s.render.split(":")[0])!=-1&&"number"!=typeof i[s.field]&&(i[s.field]=parseFloat(i[s.field])),["date","age"].indexOf(s.render.split(":")[0])!=-1&&!i[s.field+"_"]){var r=i[s.field];w2utils.isInt(r)&&(r=parseInt(r)),i[s.field+"_"]=new Date(r)}if(["time"].indexOf(s.render)!=-1)if(w2utils.isTime(i[s.field])){var o=w2utils.isTime(i[s.field],!0),r=new Date;r.setHours(o.hours,o.minutes,o.seconds?o.seconds:0,0),i[s.field+"_"]||(i[s.field+"_"]=r)}else{var o=i[s.field];w2utils.isInt(o)&&(o=parseInt(o));var o=null!=o?new Date(o):new Date,r=new Date;r.setHours(o.getHours(),o.getMinutes(),o.getSeconds(),0),i[s.field+"_"]||(i[s.field+"_"]=r)}}}if(i.w2ui&&i.w2ui.children&&i.w2ui.expanded!==!0)for(var a=0;a<i.w2ui.children.length;a++){var l=i.w2ui.children[a];e(l)}}for(var t=this,i=0;i<this.records.length;i++){var n=this.records[i];e(n)}},nextCell:function(e,t,i){var n=t+1;if(n>=this.columns.length)return null;var s=this.records[e].w2ui,r=(this.columns[t],this.columns[n]),o=s&&s.colspan&&!isNaN(s.colspan[r.field])?parseInt(s.colspan[r.field]):1;if(null==r)return null;if(r&&r.hidden||0===o)return this.nextCell(e,n,i);if(i){var a=this.getCellEditable(e,t);if(null==a||["checkbox","check"].indexOf(a.type)!=-1)return this.nextCell(e,n,i)}return n},prevCell:function(e,t,i){var n=t-1;if(n<0)return null;var s=this.records[e].w2ui,r=this.columns[n],o=s&&s.colspan&&!isNaN(s.colspan[r.field])?parseInt(s.colspan[r.field]):1;if(null==r)return null;if(r&&r.hidden||0===o)return this.prevCell(e,n,i);if(i){var a=this.getCellEditable(e,t);if(null==a||["checkbox","check"].indexOf(a.type)!=-1)return this.prevCell(e,n,i)}return n},nextRow:function(e,t){var i=this.last.searchIds,n=null;if(e+1<this.records.length&&0===i.length||i.length>0&&e<i[i.length-1]){if(e++,i.length>0)for(;;){if($.inArray(e,i)!=-1||e>this.records.length)break;e++}var s=this.records[e].w2ui,r=this.columns[t],o=s&&s.colspan&&null!=r&&!isNaN(s.colspan[r.field])?parseInt(s.colspan[r.field]):1;n=0===o?this.nextRow(e,t):e}return n},prevRow:function(e,t){var i=this.last.searchIds,n=null;if(e>0&&0===i.length||i.length>0&&e>i[0]){if(e--,i.length>0)for(;;){if($.inArray(e,i)!=-1||e<0)break;e--}var s=this.records[e].w2ui,r=this.columns[t],o=s&&s.colspan&&null!=r&&!isNaN(s.colspan[r.field])?parseInt(s.colspan[r.field]):1;n=0===o?this.prevRow(e,t):e}return n},selectionSave:function(){return this.last._selection=this.getSelection(),this.last._selection},selectionRestore:function(e){var t=(new Date).getTime();this.last.selection={indexes:[],columns:{}};for(var i=this.last.selection,n=this.last._selection,s=0;s<n.length;s++)if($.isPlainObject(n[s])){var r=this.get(n[s].recid,!0);null!=r&&(i.indexes.indexOf(r)==-1&&i.indexes.push(r),i.columns[r]||(i.columns[r]=[]),i.columns[r].push(n[s].column))}else{var r=this.get(n[s],!0);null!=r&&i.indexes.push(r)}return delete this.last._selection,e!==!0&&this.refresh(),(new Date).getTime()-t},message:function(e,t){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(this.box).find(".w2ui-btn").focus()},25)},onClose:function(e){"function"==typeof t&&t()}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-grid-header:visible",body:".w2ui-grid-box"},e)}},$.extend(w2grid.prototype,w2utils.event),w2obj.grid=w2grid}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.panels=[],this.tmp={},this.padding=1,this.resizer=4,this.style="",e.extend(!0,this,w2obj.layout,t)},i=["top","left","main","preview","right","bottom"];e.fn.w2layout=function(n){function s(t,i,n){var s=t.get(i);return null!=s&&null==n&&(n=s.tabs),null!=s&&null!=n&&(e.isArray(n)&&(n={tabs:n}),e().w2destroy(t.name+"_"+i+"_tabs"),s.tabs=e().w2tabs(e.extend({},n,{owner:t,name:t.name+"_"+i+"_tabs"})),s.show.tabs=!0,!0)}function r(t,i,n){var s=t.get(i);return null!=s&&null==n&&(n=s.toolbar),null!=s&&null!=n&&(e.isArray(n)&&(n={items:n}),e().w2destroy(t.name+"_"+i+"_toolbar"),s.toolbar=e().w2toolbar(e.extend({},n,{owner:t,name:t.name+"_"+i+"_toolbar"})),s.show.toolbar=!0,!0)}if(e.isPlainObject(n)){if(!w2utils.checkName(n,"w2layout"))return;var o=n.panels||[],a=new t(n);e.extend(a,{handlers:[],panels:[]});for(var l=0,c=o.length;l<c;l++)a.panels[l]=e.extend(!0,{},t.prototype.panel,o[l]),(e.isPlainObject(a.panels[l].tabs)||e.isArray(a.panels[l].tabs))&&s(a,o[l].type),(e.isPlainObject(a.panels[l].toolbar)||e.isArray(a.panels[l].toolbar))&&r(a,o[l].type);for(var d=0;d<i.length;d++)null==a.get(i[d])&&a.panels.push(e.extend(!0,{},t.prototype.panel,{type:i[d],hidden:"main"!==i[d],size:50}));return e(this).length>0&&a.render(e(this)[0]),w2ui[a.name]=a,a}var u=w2ui[e(this).attr("name")];return u?arguments.length>0?(u[n]&&u[n].apply(u,Array.prototype.slice.call(arguments,1)),this):u:null},t.prototype={onShow:null,onHide:null,onResizing:null,onResizerClick:null,onRender:null,onRefresh:null,onContent:null,onResize:null,onDestroy:null,panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(e,t,i){return this.content(e,t,i)},content:function(t,i,n){var s=this,r=this.get(t);if("css"==t)return e("#layout_"+s.name+"_panel_css").html("<style>"+i+"</style>"),!0;if(null==r)return!1;if(null==i)return r.content;var o=this.trigger({phase:"before",type:"content",target:t,object:r,content:i,transition:n});if(o.isCancelled!==!0){if(i instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var a="#layout_"+this.name+"_panel_"+r.type,l=e(a+"> .w2ui-panel-content"),c=0;if(l.length>0&&(e(a).scrollTop(0),c=e(l).position().top),""===r.content)r.content=i,this.refresh(t);else{if(r.content=i,!r.hidden&&null!=n&&""!==n){var d=e(a+"> .w2ui-panel-content");d.after('<div class="w2ui-panel-content new-panel" style="'+d[0].style.cssText+'"></div>');var u=e(a+"> .w2ui-panel-content.new-panel");d.css("top",c),u.css("top",c),"object"==typeof i?(i.box=u[0],i.render()):u.html(i),w2utils.transition(d[0],u[0],n,function(){d.remove(),u.removeClass("new-panel"),u.css("overflow",r.overflow),s.resize(),window.navigator.userAgent.indexOf("MSIE")!=-1&&setTimeout(function(){s.resize()},100)})}this.refresh(t)}return s.trigger(e.extend(o,{phase:"after"})),s.resize(),window.navigator.userAgent.indexOf("MSIE")!=-1&&setTimeout(function(){s.resize()},100),!0}},message:function(t,i){var n=this;"string"==typeof i&&(i={width:i.length<300?350:550,height:i.length<300?170:250,body:'<div class="w2ui-centered">'+i+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message('"+t+"')\">Ok</button>",onOpen:function(t){setTimeout(function(){e(this.box).find(".w2ui-btn").focus()},25)}});var s,r=this.get(t),o=e("#layout_"+this.name+"_panel_"+r.type),a=o.css("overflow");i&&(i.onClose&&(s=i.onClose),i.onClose=function(t){"function"==typeof s&&s(t),t.done(function(){e("#layout_"+n.name+"_panel_"+r.type).css("overflow",a)})}),e("#layout_"+this.name+"_panel_"+r.type).css("overflow","hidden"),w2utils.message.call(this,{box:e("#layout_"+this.name+"_panel_"+r.type),param:t,path:"w2ui."+this.name,title:".w2ui-panel-title:visible",body:".w2ui-panel-content"},i)},load:function(t,i,n,s){var r=this;return"css"==t?(e.get(i,function(e,i,n){r.content(t,n.responseText),s&&s()}),!0):null!=this.get(t)&&(e.get(i,function(e,i,o){r.content(t,o.responseText,n),s&&s(),r.resize(),window.navigator.userAgent.indexOf("MSIE")!=-1&&setTimeout(function(){r.resize()},100)}),!0)},sizeTo:function(t,i,n){var s=this,r=s.get(t);return null!=r&&(e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",n!==!0?".2s":"0s")),setTimeout(function(){s.set(t,{size:i})},1),setTimeout(function(){e(s.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),s.resize()},500),!0)},show:function(t,i){var n=this,s=this.trigger({phase:"before",type:"show",target:t,object:this.get(t),immediate:i});if(s.isCancelled!==!0){var r=n.get(t);return null!=r&&(r.hidden=!1,i===!0?(e("#layout_"+n.name+"_panel_"+t).css({opacity:"1"}),n.trigger(e.extend(s,{phase:"after"})),n.resize()):(e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),setTimeout(function(){n.resize()},1),setTimeout(function(){e("#layout_"+n.name+"_panel_"+t).css({opacity:"1"})},250),setTimeout(function(){e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),n.trigger(e.extend(s,{phase:"after"})),n.resize()},500)),!0)}},hide:function(t,i){var n=this,s=this.trigger({phase:"before",type:"hide",target:t,object:this.get(t),immediate:i});if(s.isCancelled!==!0){var r=n.get(t);return null!=r&&(r.hidden=!0,i===!0?(e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),n.trigger(e.extend(s,{phase:"after"})),n.resize()):(e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition",".2s")),e("#layout_"+n.name+"_panel_"+t).css({opacity:"0"}),setTimeout(function(){n.resize()},1),setTimeout(function(){e(n.box).find(" > div > .w2ui-panel").css(w2utils.cssPrefix("transition","0s")),n.trigger(e.extend(s,{phase:"after"})),n.resize()},500)),!0)}},toggle:function(e,t){var i=this.get(e);return null!=i&&(i.hidden?this.show(e,t):this.hide(e,t))},set:function(t,i){var n=this.get(t,!0);return null!=n&&(e.extend(this.panels[n],i),null==i.content&&null==i.resizable||this.refresh(t),this.resize(),!0)},get:function(e,t){for(var i=0;i<this.panels.length;i++)if(this.panels[i].type==e)return t===!0?i:this.panels[i];return null},el:function(t){var i=e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-content");return 1!=i.length?null:i[0]},hideToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(t){var i=this.get(t);i&&(i.show.toolbar=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(e){var t=this.get(e);t&&(t.show.toolbar?this.hideToolbar(e):this.showToolbar(e))},assignToolbar:function(t,i){"string"==typeof i&&null!=w2ui[i]&&(i=w2ui[i]);var n=this.get(t);n.toolbar=i;var s=e(this.box).find(t+"> .w2ui-panel-toolbar");null!=n.toolbar?(0===s.find("[name="+n.toolbar.name+"]").length?s.w2render(n.toolbar):null!=n.toolbar&&n.toolbar.refresh(),this.showToolbar(t),this.refresh("main")):(s.html(""),this.hideToolbar(t))},hideTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!1,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(t){var i=this.get(t);i&&(i.show.tabs=!0,e("#layout_"+this.name+"_panel_"+t+"> .w2ui-panel-tabs").show(),
this.resize())},toggleTabs:function(e){var t=this.get(e);t&&(t.show.tabs?this.hideTabs(e):this.showTabs(e))},render:function(t){function n(){a.tmp.events={resize:function(e){w2ui[a.name].resize()},resizeStart:s,mouseMove:o,mouseUp:r},e(window).on("resize",a.tmp.events.resize)}function s(t,n){if(a.box){n||(n=window.event),e(document).off("mousemove",a.tmp.events.mouseMove).on("mousemove",a.tmp.events.mouseMove),e(document).off("mouseup",a.tmp.events.mouseUp).on("mouseup",a.tmp.events.mouseUp),a.tmp.resize={type:t,x:n.screenX,y:n.screenY,diff_x:0,diff_y:0,value:0};for(var s=0;s<i.length;s++){var r=e(a.el(i[s])).parent().find(".w2ui-lock");r.length>0?r.attr("locked","previous"):a.lock(i[s],{opacity:0})}"left"!=t&&"right"!=t||(a.tmp.resize.value=parseInt(e("#layout_"+a.name+"_resizer_"+t)[0].style.left)),"top"!=t&&"preview"!=t&&"bottom"!=t||(a.tmp.resize.value=parseInt(e("#layout_"+a.name+"_resizer_"+t)[0].style.top))}}function r(t){if(a.box&&(t||(t=window.event),e(document).off("mousemove",a.tmp.events.mouseMove),e(document).off("mouseup",a.tmp.events.mouseUp),null!=a.tmp.resize)){for(var n=0;n<i.length;n++){var s=e(a.el(i[n])).parent().find(".w2ui-lock");"previous"==s.attr("locked")?s.removeAttr("locked"):a.unlock(i[n])}if(0!==a.tmp.diff_x||0!==a.tmp.resize.diff_y){var r,o,l=a.get("top"),c=a.get("bottom"),d=a.get(a.tmp.resize.type),u=parseInt(e(a.box).height()),h=parseInt(e(a.box).width()),p=String(d.size);switch(a.tmp.resize.type){case"top":r=parseInt(d.sizeCalculated)+a.tmp.resize.diff_y,o=0;break;case"bottom":r=parseInt(d.sizeCalculated)-a.tmp.resize.diff_y,o=0;break;case"preview":r=parseInt(d.sizeCalculated)-a.tmp.resize.diff_y,o=(l&&!l.hidden?l.sizeCalculated:0)+(c&&!c.hidden?c.sizeCalculated:0);break;case"left":r=parseInt(d.sizeCalculated)+a.tmp.resize.diff_x,o=0;break;case"right":r=parseInt(d.sizeCalculated)-a.tmp.resize.diff_x,o=0}"%"==p.substr(p.length-1)?d.size=Math.floor(100*r/("left"==d.type||"right"==d.type?h:u-o)*100)/100+"%":"-"==String(d.size).substr(0,1)?d.size=parseInt(d.size)-d.sizeCalculated+r:d.size=r,a.resize()}e("#layout_"+a.name+"_resizer_"+a.tmp.resize.type).removeClass("active"),delete a.tmp.resize}}function o(t){if(a.box&&(t||(t=window.event),null!=a.tmp.resize)){var i=a.get(a.tmp.resize.type),n=a.tmp.resize,s=a.trigger({phase:"before",type:"resizing",target:a.name,object:i,originalEvent:t,panel:n?n.type:"all",diff_x:n?n.diff_x:0,diff_y:n?n.diff_y:0});if(s.isCancelled!==!0){var r=e("#layout_"+a.name+"_resizer_"+n.type),o=t.screenX-n.x,l=t.screenY-n.y,c=a.get("main");switch(r.hasClass("active")||r.addClass("active"),n.type){case"left":i.minSize-o>i.width&&(o=i.minSize-i.width),i.maxSize&&i.width+o>i.maxSize&&(o=i.maxSize-i.width),c.minSize+o>c.width&&(o=c.width-c.minSize);break;case"right":i.minSize+o>i.width&&(o=i.width-i.minSize),i.maxSize&&i.width-o>i.maxSize&&(o=i.width-i.maxSize),c.minSize-o>c.width&&(o=c.minSize-c.width);break;case"top":i.minSize-l>i.height&&(l=i.minSize-i.height),i.maxSize&&i.height+l>i.maxSize&&(l=i.maxSize-i.height),c.minSize+l>c.height&&(l=c.height-c.minSize);break;case"preview":case"bottom":i.minSize+l>i.height&&(l=i.height-i.minSize),i.maxSize&&i.height-l>i.maxSize&&(l=i.height-i.maxSize),c.minSize-l>c.height&&(l=c.minSize-c.height)}switch(n.diff_x=o,n.diff_y=l,n.type){case"top":case"preview":case"bottom":n.diff_x=0,r.length>0&&(r[0].style.top=n.value+n.diff_y+"px");break;case"left":case"right":n.diff_y=0,r.length>0&&(r[0].style.left=n.value+n.diff_x+"px")}a.trigger(e.extend(s,{phase:"after"}))}}}var a=this,l=(new Date).getTime(),c=a.trigger({phase:"before",type:"render",target:a.name,box:t});if(c.isCancelled!==!0){if(null!=t&&(e(a.box).find("#layout_"+a.name+"_panel_main").length>0&&e(a.box).removeAttr("name").removeClass("w2ui-layout").html(""),a.box=t),!a.box)return!1;e(a.box).attr("name",a.name).addClass("w2ui-layout").html("<div></div>"),e(a.box).length>0&&(e(a.box)[0].style.cssText+=a.style);for(var d=0;d<i.length;d++){var u=(a.get(i[d]),'<div id="layout_'+a.name+"_panel_"+i[d]+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+a.name+"_resizer_"+i[d]+'" class="w2ui-resizer"></div>');e(a.box).find(" > div").append(u)}return e(a.box).find(" > div").append('<div id="layout_'+a.name+'_panel_css" style="position: absolute; top: 10000px;"></div>'),a.refresh(),a.trigger(e.extend(c,{phase:"after"})),setTimeout(function(){n(),a.resize()},0),(new Date).getTime()-l}},refresh:function(t){var i=this;null==t&&(t=null);var n=(new Date).getTime(),s=i.trigger({phase:"before",type:"refresh",target:null!=t?t:i.name,object:i.get(t)});if(s.isCancelled!==!0){if("string"==typeof t){var r=i.get(t);if(null==r)return;var o="#layout_"+i.name+"_panel_"+r.type,a="#layout_"+i.name+"_resizer_"+r.type;e(o).css({display:r.hidden?"none":"block"}),r.resizable?e(a).show():e(a).hide(),"object"==typeof r.content&&"function"==typeof r.content.render?(r.content.box=e(o+"> .w2ui-panel-content")[0],setTimeout(function(){e(o+"> .w2ui-panel-content").length>0&&(e(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").css("overflow",r.overflow)[0].style.cssText+=";"+r.style),r.content&&"function"==typeof r.content.render&&r.content.render()},1)):e(o+"> .w2ui-panel-content").length>0&&(e(o+"> .w2ui-panel-content").removeClass().removeAttr("name").addClass("w2ui-panel-content").html(r.content).css("overflow",r.overflow)[0].style.cssText+=";"+r.style);var l=e(i.box).find(o+"> .w2ui-panel-tabs");r.show.tabs?0===l.find("[name="+r.tabs.name+"]").length&&null!=r.tabs?l.w2render(r.tabs):r.tabs.refresh():l.html("").removeClass("w2ui-tabs").hide(),l=e(i.box).find(o+"> .w2ui-panel-toolbar"),r.show.toolbar?0===l.find("[name="+r.toolbar.name+"]").length&&null!=r.toolbar?l.w2render(r.toolbar):r.toolbar.refresh():l.html("").removeClass("w2ui-toolbar").hide(),l=e(i.box).find(o+"> .w2ui-panel-title"),r.title?l.html(r.title).show():l.html("").hide()}else{if(0===e("#layout_"+i.name+"_panel_main").length)return void i.render();i.resize();for(var c=0;c<this.panels.length;c++)i.refresh(this.panels[c].type)}return i.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-n}},resize:function(){if(!this.box)return!1;var t=(new Date).getTime(),n=this.tmp.resize,s=this.trigger({phase:"before",type:"resize",target:this.name,panel:n?n.type:"all",diff_x:n?n.diff_x:0,diff_y:n?n.diff_y:0});if(s.isCancelled!==!0){this.padding<0&&(this.padding=0);var r=parseInt(e(this.box).width()),o=parseInt(e(this.box).height());e(this.box).find(" > div").css({width:r+"px",height:o+"px"});for(var a,l,c,d,u,h=this,p=this.get("main"),f=this.get("preview"),g=this.get("left"),m=this.get("right"),v=this.get("top"),w=this.get("bottom"),y=null!=f&&f.hidden!==!0,b=null!=g&&g.hidden!==!0,x=null!=m&&m.hidden!==!0,_=null!=v&&v.hidden!==!0,C=null!=w&&w.hidden!==!0,k=0;k<i.length;k++)if("main"!==i[k]&&(n=this.get(i[k]))){var T=String(n.size||0);if("%"==T.substr(T.length-1)){var S=o;"preview"==n.type&&(S=S-(v&&!v.hidden?v.sizeCalculated:0)-(w&&!w.hidden?w.sizeCalculated:0)),n.sizeCalculated=parseInt(("left"==n.type||"right"==n.type?r:S)*parseFloat(n.size)/100)}else n.sizeCalculated=parseInt(n.size);n.sizeCalculated=Math.max(n.sizeCalculated,parseInt(n.minSize))}"-"==String(m.size).substr(0,1)&&(b&&"-"==g.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):m.sizeCalculated=r-(b?g.sizeCalculated:0)+parseInt(m.size)),"-"==String(g.size).substr(0,1)&&(x&&"-"==m.size.substr(0,1)?console.log("ERROR: you cannot have both left panel.size and right panel.size be negative."):g.sizeCalculated=r-(x?m.sizeCalculated:0)+parseInt(g.size)),null!=v&&v.hidden!==!0?(a=0,l=0,c=r,d=v.sizeCalculated,e("#layout_"+this.name+"_panel_top").css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}).show(),v.width=c,v.height=d,v.resizable&&(l=v.sizeCalculated-(0===this.padding?this.resizer:0),d=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:t});if(i.isCancelled!==!0)return w2ui[h.name].tmp.events.resizeStart("top",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_top").hide(),e("#layout_"+this.name+"_resizer_top").hide()),null!=g&&g.hidden!==!0?(a=0,l=0+(_?v.sizeCalculated+this.padding:0),c=g.sizeCalculated,d=o-(_?v.sizeCalculated+this.padding:0)-(C?w.sizeCalculated+this.padding:0),u=e("#layout_"+this.name+"_panel_left"),window.navigator.userAgent.indexOf("MSIE")!=-1&&u.length>0&&u[0].clientHeight<u[0].scrollHeight&&(c+=17),u.css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}).show(),g.width=c,g.height=d,g.resizable&&(a=g.sizeCalculated-(0===this.padding?this.resizer:0),c=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"left",originalEvent:t});if(i.isCancelled!==!0)return w2ui[h.name].tmp.events.resizeStart("left",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_left").hide(),e("#layout_"+this.name+"_resizer_left").hide()),null!=m&&m.hidden!==!0?(a=r-m.sizeCalculated,l=0+(_?v.sizeCalculated+this.padding:0),c=m.sizeCalculated,d=o-(_?v.sizeCalculated+this.padding:0)-(C?w.sizeCalculated+this.padding:0),e("#layout_"+this.name+"_panel_right").css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}).show(),m.width=c,m.height=d,m.resizable&&(a-=this.padding,c=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:t});if(i.isCancelled!==!0)return w2ui[h.name].tmp.events.resizeStart("right",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_right").hide(),e("#layout_"+this.name+"_resizer_right").hide()),null!=w&&w.hidden!==!0?(a=0,l=o-w.sizeCalculated,c=r,d=w.sizeCalculated,e("#layout_"+this.name+"_panel_bottom").css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}).show(),w.width=c,w.height=d,w.resizable&&(l-=0===this.padding?0:this.padding,d=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:t});if(i.isCancelled!==!0)return w2ui[h.name].tmp.events.resizeStart("bottom",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_bottom").hide(),e("#layout_"+this.name+"_resizer_bottom").hide()),a=0+(b?g.sizeCalculated+this.padding:0),l=0+(_?v.sizeCalculated+this.padding:0),c=r-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),d=o-(_?v.sizeCalculated+this.padding:0)-(C?w.sizeCalculated+this.padding:0)-(y?f.sizeCalculated+this.padding:0),u=e("#layout_"+this.name+"_panel_main"),window.navigator.userAgent.indexOf("MSIE")!=-1&&u.length>0&&u[0].clientHeight<u[0].scrollHeight&&(c+=17),u.css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}),p.width=c,p.height=d,null!=f&&f.hidden!==!0?(a=0+(b?g.sizeCalculated+this.padding:0),l=o-(C?w.sizeCalculated+this.padding:0)-f.sizeCalculated,c=r-(b?g.sizeCalculated+this.padding:0)-(x?m.sizeCalculated+this.padding:0),d=f.sizeCalculated,u=e("#layout_"+this.name+"_panel_preview"),window.navigator.userAgent.indexOf("MSIE")!=-1&&u.length>0&&u[0].clientHeight<u[0].scrollHeight&&(c+=17),u.css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px"}).show(),f.width=c,f.height=d,f.resizable&&(l-=0===this.padding?0:this.padding,d=this.resizer>this.padding?this.resizer:this.padding,e("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:a+"px",top:l+"px",width:c+"px",height:d+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(t){var i=h.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:t});if(i.isCancelled!==!0)return w2ui[h.name].tmp.events.resizeStart("preview",t),h.trigger(e.extend(i,{phase:"after"})),!1}))):(e("#layout_"+this.name+"_panel_preview").hide(),e("#layout_"+this.name+"_resizer_preview").hide());for(var E=0;E<i.length;E++){var $=this.get(i[E]),j="#layout_"+this.name+"_panel_"+i[E]+" > .w2ui-panel-",z=0;$&&($.title&&(z+=w2utils.getSize(e(j+"title").css({top:z+"px",display:"block"}),"height")),$.show.tabs&&(null!=$.tabs&&w2ui[this.name+"_"+i[E]+"_tabs"]&&w2ui[this.name+"_"+i[E]+"_tabs"].resize(),z+=w2utils.getSize(e(j+"tabs").css({top:z+"px",display:"block"}),"height")),$.show.toolbar&&(null!=$.toolbar&&w2ui[this.name+"_"+i[E]+"_toolbar"]&&w2ui[this.name+"_"+i[E]+"_toolbar"].resize(),z+=w2utils.getSize(e(j+"toolbar").css({top:z+"px",display:"block"}),"height"))),e(j+"content").css({display:"block"}).css({top:z+"px"})}return clearTimeout(this._resize_timer),this._resize_timer=setTimeout(function(){for(var t in w2ui)if("function"==typeof w2ui[t].resize){null==w2ui[t].panels&&w2ui[t].resize();var i=e(w2ui[t].box).parents(".w2ui-layout");i.length>0&&i.attr("name")==h.name&&w2ui[t].resize()}},100),this.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});if(t.isCancelled!==!0)return null!=w2ui[this.name]&&(e(this.box).find("#layout_"+this.name+"_panel_main").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-layout").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})),this.tmp.events&&this.tmp.events.resize&&e(window).off("resize",this.tmp.events.resize),!0)},lock:function(e,t,n){if(i.indexOf(e)==-1)return void console.log("ERROR: First parameter needs to be the a valid panel name.");var s=Array.prototype.slice.call(arguments,0);s[0]="#layout_"+this.name+"_panel_"+e,w2utils.lock.apply(window,s)},unlock:function(e,t){if(i.indexOf(e)==-1)return void console.log("ERROR: First parameter needs to be the a valid panel name.");var n="#layout_"+this.name+"_panel_"+e;w2utils.unlock(n,t)}},e.extend(t.prototype,w2utils.event),w2obj.layout=t}(jQuery);var w2popup={};!function(e){e.fn.w2popup=function(t,i){null==t&&(i={},t="open"),e.isPlainObject(t)&&(i=t,t="open"),t=t.toLowerCase(),"load"===t&&"string"==typeof i&&(i=e.extend({url:i},arguments.length>2?arguments[2]:{})),"open"===t&&null!=i.url&&(t="load"),i=i||{};var n={};if(e(this).length>0&&"open"==t){if(e(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){if(e("#w2ui-popup").length>0){var s=e("#w2ui-popup").data("options");w2popup._prev={template:w2popup._template,title:s.title,body:s.body,buttons:s.buttons}}w2popup._template=this,e(this).find("div[rel=title]").length>0&&(n.title=e(this).find("div[rel=title]")),e(this).find("div[rel=body]").length>0&&(n.body=e(this).find("div[rel=body]"),n.style=e(this).find("div[rel=body]")[0].style.cssText),e(this).find("div[rel=buttons]").length>0&&(n.buttons=e(this).find("div[rel=buttons]"))}else n.title="&#160;",n.body=e(this).html();0!==parseInt(e(this).css("width"))&&(n.width=parseInt(e(this).css("width"))),0!==parseInt(e(this).css("height"))&&(n.height=parseInt(e(this).css("height")))}return w2popup[t](e.extend({},n,i))},w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(t){function i(t){return t||(t=window.event),w2popup.status="moving",g.resizing=!0,g.isLocked=1==e("#w2ui-popup > .w2ui-lock").length,g.x=t.screenX,g.y=t.screenY,g.pos_x=e("#w2ui-popup").position().left,g.pos_y=e("#w2ui-popup").position().top,g.isLocked||w2popup.lock({opacity:0}),e(document).on("mousemove",g.mvMove),e(document).on("mouseup",g.mvStop),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!!t.preventDefault&&void t.preventDefault()}function n(t){1==g.resizing&&(t||(t=window.event),g.div_x=t.screenX-g.x,g.div_y=t.screenY-g.y,e("#w2ui-popup").css(w2utils.cssPrefix({transition:"none",transform:"translate3d("+g.div_x+"px, "+g.div_y+"px, 0px)"})))}function s(t){1==g.resizing&&(t||(t=window.event),w2popup.status="open",g.div_x=t.screenX-g.x,g.div_y=t.screenY-g.y,e("#w2ui-popup").css({left:g.pos_x+g.div_x+"px",top:g.pos_y+g.div_y+"px"}).css(w2utils.cssPrefix({transition:"none",transform:"translate3d(0px, 0px, 0px)"})),g.resizing=!1,e(document).off("mousemove",g.mvMove),e(document).off("mouseup",g.mvStop),g.isLocked||w2popup.unlock())}var r=this;if("closing"==w2popup.status)return void setTimeout(function(){r.open.call(r,t)},100);var o=e("#w2ui-popup").data("options"),t=e.extend({},this.defaults,o,{title:"",body:"",buttons:""},t,{maximized:!1});setTimeout(function(){e("#w2ui-popup").data("options",t)},100),0===e("#w2ui-popup").length&&(w2popup.onMax=null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null),t.onOpen&&(w2popup.onOpen=t.onOpen),t.onClose&&(w2popup.onClose=t.onClose),t.onMax&&(w2popup.onMax=t.onMax),t.onMin&&(w2popup.onMin=t.onMin),t.onToggle&&(w2popup.onToggle=t.onToggle),t.onKeydown&&(w2popup.onKeydown=t.onKeydown),t.width=parseInt(t.width),t.height=parseInt(t.height);var a,l;void 0==window.innerHeight?(a=parseInt(document.documentElement.offsetWidth),l=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(a+=21,l+=4)):(a=parseInt(window.innerWidth),l=parseInt(window.innerHeight)),a-10<t.width&&(t.width=a-10),l-10<t.height&&(t.height=l-10);var c=(l-t.height)/2*.6,d=(a-t.width)/2;if(0===e("#w2ui-popup").length){var u=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!1});if(u.isCancelled===!0)return;w2popup.status="opening",w2popup.lockScreen(t);var h="";t.showClose&&(h+='<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>'),t.showMax&&(h+='<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');var p='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+d+"px; top: "+c+"px;     width: "+parseInt(t.width)+"px; height: "+parseInt(t.height)+"px; "+w2utils.cssPrefix("transform","scale(0.8)",!0)+'"></div>';e("body").append(p);var f=e("#w2ui-popup");if(f.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){var g=f.find("div[rel=title]");g.length>0&&(t.title=g.html(),g.remove());var g=f.find("div[rel=buttons]");g.length>0&&(t.buttons=g.html(),g.remove());var g=f.find("div[rel=body]");g.length>0?t.body=g.html():t.body=f.html()}var p='<div class="w2ui-popup-title" style="'+(t.title?"":"display: none")+'">'+h+'</div><div class="w2ui-box" style="'+(t.title?"":"top: 0px !important;")+(t.buttons?"":"bottom: 0px !important;")+'">    <div class="w2ui-popup-body'+(""!==!t.title?" w2ui-popup-no-title":"")+(t.buttons?"":" w2ui-popup-no-buttons")+'" style="'+t.style+'">    </div></div><div class="w2ui-popup-buttons" style="'+(t.buttons?"":"display: none")+'"></div><input class="w2ui-popup-hidden" style="position: absolute; top: -100px"/>';e("#w2ui-popup").html(p),t.title&&e("#w2ui-popup .w2ui-popup-title").append(t.title),t.buttons&&e("#w2ui-popup .w2ui-popup-buttons").append(t.buttons),t.body&&e("#w2ui-popup .w2ui-popup-body").append(t.body),setTimeout(function(){e("#w2ui-popup").css("opacity","1").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform",transform:"scale(1)"})),r.focus()},1),setTimeout(function(){e("#w2ui-popup").css(w2utils.cssPrefix("transform","")),w2popup.status="open",setTimeout(function(){r.trigger(e.extend(u,{phase:"after"}))},100)},1e3*t.speed)}else{null==w2popup._prev&&null!=w2popup._template&&r.restoreTemplate();var u=this.trigger({phase:"before",type:"open",target:"popup",options:t,present:!0});if(u.isCancelled===!0)return;w2popup.status="opening",null!=o&&(o.maximized||o.width==t.width&&o.height==t.height||w2popup.resize(t.width,t.height),t.prevSize=t.width+"px:"+t.height+"px",t.maximized=o.maximized);var m=e("#w2ui-popup .w2ui-box").clone();if(m.removeClass("w2ui-box").addClass("w2ui-box-temp").find(".w2ui-popup-body").empty().append(t.body),"string"==typeof t.body&&m.find("div[rel=title], div[rel=body], div[rel=buttons]").length>0){var g=m.find("div[rel=title]");g.length>0&&(t.title=g.html(),g.remove());var g=m.find("div[rel=buttons]");g.length>0&&(t.buttons=g.html(),g.remove());var g=m.find("div[rel=body]");g.length>0?t.body=g.html():t.body=m.html(),m.html(t.body)}e("#w2ui-popup .w2ui-box").after(m),t.buttons?(e("#w2ui-popup .w2ui-popup-buttons").show().html("").append(t.buttons),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","")):(e("#w2ui-popup .w2ui-popup-buttons").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-buttons"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("bottom","0px")),t.title?(e("#w2ui-popup .w2ui-popup-title").show().html((t.showClose?'<div class="w2ui-popup-button w2ui-popup-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(t.showMax?'<div class="w2ui-popup-button w2ui-popup-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':"")).append(t.title),e("#w2ui-popup .w2ui-popup-body").removeClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","")):(e("#w2ui-popup .w2ui-popup-title").hide().html(""),e("#w2ui-popup .w2ui-popup-body").addClass("w2ui-popup-no-title"),e("#w2ui-popup .w2ui-box, #w2ui-popup .w2ui-box-temp").css("top","0px"));var v=e("#w2ui-popup .w2ui-box")[0],w=e("#w2ui-popup .w2ui-box-temp")[0];w2utils.transition(v,w,t.transition,function(){r.restoreTemplate(),e(v).remove(),e(w).removeClass("w2ui-box-temp").addClass("w2ui-box");var i=e(w).find(".w2ui-popup-body");1==i.length&&(i[0].style.cssText=t.style),e("#w2ui-popup").data("prev-size",null),r.focus(),w2popup.status="open",r.trigger(e.extend(u,{phase:"after"}))})}t._last_focus=e(":focus"),t.keyboard&&e(document).on("keydown",this.keydown);var g={resizing:!1,mvMove:n,mvStop:s};return e("#w2ui-popup .w2ui-popup-title").on("mousedown",function(e){w2popup.get().maximized||i(e)}),this},keydown:function(t){var i=e("#w2ui-popup").data("options");if(!i||i.keyboard){var n=w2popup.trigger({phase:"before",type:"keydown",target:"popup",options:i,originalEvent:t});if(n.isCancelled!==!0){switch(t.keyCode){case 27:t.preventDefault(),e("#w2ui-popup .w2ui-message").length>0?w2popup.message():w2popup.close()}w2popup.trigger(e.extend(n,{phase:"after"}))}}},close:function(t){var i=this,t=e.extend({},e("#w2ui-popup").data("options"),t);if(0!==e("#w2ui-popup").length&&"closed"!=this.status){if("opening"==this.status)return void setTimeout(function(){w2popup.close()},100);var n=this.trigger({phase:"before",type:"close",target:"popup",options:t});n.isCancelled!==!0&&(w2popup.status="closing",e("#w2ui-popup").css("opacity","0").css(w2utils.cssPrefix({transition:t.speed+"s opacity, "+t.speed+"s -webkit-transform",transform:"scale(0.9)"})),w2popup.unlockScreen(t),setTimeout(function(){i.restoreTemplate(),e("#w2ui-popup").remove(),w2popup.status="closed",t._last_focus.length>0&&t._last_focus.focus(),i.trigger(e.extend(n,{phase:"after"}))},1e3*t.speed),t.keyboard&&e(document).off("keydown",this.keydown))}},toggle:function(){var t=this,i=e("#w2ui-popup").data("options"),n=this.trigger({phase:"before",type:"toggle",target:"popup",options:i});n.isCancelled!==!0&&(i.maximized===!0?w2popup.min():w2popup.max(),setTimeout(function(){t.trigger(e.extend(n,{phase:"after"}))},1e3*i.speed+50))},max:function(){var t=this,i=e("#w2ui-popup").data("options");if(i.maximized!==!0){var n=this.trigger({phase:"before",type:"max",target:"popup",options:i});n.isCancelled!==!0&&(w2popup.status="resizing",i.prevSize=e("#w2ui-popup").css("width")+":"+e("#w2ui-popup").css("height"),w2popup.resize(1e4,1e4,function(){w2popup.status="open",i.maximized=!0,t.trigger(e.extend(n,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()})}))}},min:function(){var t=this,i=e("#w2ui-popup").data("options");if(i.maximized===!0){var n=i.prevSize.split(":"),s=this.trigger({phase:"before",type:"min",target:"popup",options:i});s.isCancelled!==!0&&(w2popup.status="resizing",w2popup.resize(parseInt(n[0]),parseInt(n[1]),function(){w2popup.status="open",i.maximized=!1,i.prevSize=null,t.trigger(e.extend(s,{phase:"after"})),e("#w2ui-popup .w2ui-grid, #w2ui-popup .w2ui-form, #w2ui-popup .w2ui-layout").each(function(){var t=e(this).attr("name");w2ui[t]&&w2ui[t].resize&&w2ui[t].resize()})}))}},get:function(){return e("#w2ui-popup").data("options")},set:function(e){w2popup.open(e)},clear:function(){e("#w2ui-popup .w2ui-popup-title").html(""),e("#w2ui-popup .w2ui-popup-body").html(""),e("#w2ui-popup .w2ui-popup-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(t){function i(i,n){if(delete t.url,e("body").append('<div id="w2ui-tmp" style="display: none">'+i+"</div>"),null!=n&&e("#w2ui-tmp #"+n).length>0?e("#w2ui-tmp #"+n).w2popup(t):e("#w2ui-tmp > div").w2popup(t),e("#w2ui-tmp > style").length>0){var s=e("<div>").append(e("#w2ui-tmp > style").clone()).html();0===e("#w2ui-popup #div-style").length&&e("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>'),e("#w2ui-popup #div-style").html(s)}e("#w2ui-tmp").remove()}if(w2popup.status="loading",null==t.url)return void console.log("ERROR: The url parameter is empty.");var n=String(t.url).split("#"),s=n[0],r=n[1];null==t&&(t={});var o=e("#w2ui-popup").data(s);null!=o?i(o,r):e.get(s,function(t,n,o){i(o.responseText,r),e("#w2ui-popup").data(s,o.responseText)})},message:function(t){var i=this;e().w2tag(),t||(t={width:200,height:100});var n=parseInt(e("#w2ui-popup").width()),s=parseInt(e("#w2ui-popup").height());t.originalWidth=t.width,t.originalHeight=t.height,parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10),null==t.hideOnClick&&(t.hideOnClick=!1);var r=e("#w2ui-popup").data("options")||{},o=parseInt(e("#w2ui-popup > .w2ui-popup-title").css("height"));(null==t.width||t.width>r.width-10)&&(t.width=r.width-10),(null==t.height||t.height>r.height-o-5)&&(t.height=r.height-o-5),t.originalHeight<0&&(t.height=s+t.originalHeight-o),t.originalWidth<0&&(t.width=n+2*t.originalWidth);var a=e("#w2ui-popup .w2ui-popup-title"),l=e("#w2ui-popup .w2ui-message").length;if(""===e.trim(t.html)&&""===e.trim(t.body)&&""===e.trim(t.buttons)){var c=e("#w2ui-popup #w2ui-message"+(l-1)),t=c.data("options")||{};c.css(w2utils.cssPrefix({transition:"0.15s",transform:"translateY(-"+t.height+"px)"})),1==l?w2popup.unlock(150):e("#w2ui-popup #w2ui-message"+(l-2)).css("z-index",1500),setTimeout(function(){var e=c.data("prev_focus");c.remove(),e&&e.length>0?e.focus():i.focus(),"function"==typeof t.onClose&&t.onClose()},150)}else{""===e.trim(t.body)&&""===e.trim(t.buttons)||(t.html='<div class="w2ui-message-body">'+t.body+'</div><div class="w2ui-message-buttons">'+t.buttons+"</div>"),e("#w2ui-popup .w2ui-message").css("z-index",1390),a.css("z-index",1501),e("#w2ui-popup .w2ui-box").before('<div id="w2ui-message'+l+'" class="w2ui-message" style="display: none; z-index: 1500; '+(0===a.length?"top: 0px;":"top: "+w2utils.getSize(a,"height")+"px;")+(null!=t.width?"width: "+t.width+"px; left: "+(n-t.width)/2+"px;":"left: 10px; right: 10px;")+(null!=t.height?"height: "+t.height+"px;":"bottom: 6px;")+w2utils.cssPrefix("transition",".3s",!0)+'"'+(t.hideOnClick===!0?'onclick="w2popup.message();"':"")+"></div>"),e("#w2ui-popup #w2ui-message"+l).data("options",t).data("prev_focus",e(":focus"));var d=e("#w2ui-popup #w2ui-message"+l).css("display");e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"==d?"translateY(-"+t.height+"px)":"translateY(0px)"})),"none"==d&&(e("#w2ui-popup #w2ui-message"+l).show().html(t.html),setTimeout(function(){e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transform:"none"==d?"translateY(0px)":"translateY(-"+t.height+"px)"}))},1),0===l&&w2popup.lock(),setTimeout(function(){i.focus(),e("#w2ui-popup #w2ui-message"+l).css(w2utils.cssPrefix({transition:"0s"})),"function"==typeof t.onOpen&&t.onOpen()},350))}},focus:function(){var t=null,i=e("#w2ui-popup"),n="input:visible, button:visible, select:visible, textarea:visible";e(i).find(n).off(".keep-focus");var s=e("#w2ui-popup .w2ui-message").length-1,r=e("#w2ui-popup #w2ui-message"+s);if(r.length>0){var o=e(r[r.length-1]).find("button");o.length>0&&o[0].focus(),t=r}else if(i.length>0){var o=i.find(".w2ui-popup-buttons button");o.length>0&&o[0].focus(),t=i}e(t).find(n).on("blur.keep-focus",function(i){setTimeout(function(){var i=e(":focus");if(i.length>0&&!e(t).find(n).is(i)||i.hasClass("w2ui-popup-hidden")){var s=e(t).find(n);s.length>0&&s[0].focus()}},1)})},lock:function(t,i){var n=Array.prototype.slice.call(arguments,0);n.unshift(e("#w2ui-popup")),w2utils.lock.apply(window,n)},unlock:function(t){w2utils.unlock(e("#w2ui-popup"),t)},lockScreen:function(t){return!(e("#w2ui-lock").length>0)&&(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+t.color+'; width: 100%; height: 100%; opacity: 0;"></div>'),setTimeout(function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",t.speed+"s opacity"))},1),1==t.modal?(e("#w2ui-lock").on("mousedown",function(){e("#w2ui-lock").css("opacity","0.6").css(w2utils.cssPrefix("transition",".1s"))}),e("#w2ui-lock").on("mouseup",function(){setTimeout(function(){e("#w2ui-lock").css("opacity",t.opacity).css(w2utils.cssPrefix("transition",".1s"))},100)})):e("#w2ui-lock").on("mousedown",function(){w2popup.close()}),!0)},unlockScreen:function(t){return 0!==e("#w2ui-lock").length&&(null==t&&(t=e("#w2ui-popup").data("options")),null==t&&(t={}),t=e.extend({},w2popup.defaults,t),e("#w2ui-lock").css("opacity","0").css(w2utils.cssPrefix("transition",t.speed+"s opacity")),setTimeout(function(){e("#w2ui-lock").remove()},1e3*t.speed),!0)},resizeMessages:function(){e("#w2ui-popup").data("options");e("#w2ui-popup .w2ui-message").each(function(){var t=e(this).data("options"),i=e("#w2ui-popup");parseInt(t.width)<10&&(t.width=10),parseInt(t.height)<10&&(t.height=10);var n=parseInt(i.find("> .w2ui-popup-title").css("height")),s=parseInt(i.width()),r=parseInt(i.height());t.width=t.originalWidth,t.width>s-10&&(t.width=s-10),t.height=t.originalHeight,t.height>r-n-5&&(t.height=r-n-5),t.originalHeight<0&&(t.height=r+t.originalHeight-n),t.originalWidth<0&&(t.width=s+2*t.originalWidth),e(this).css({left:(s-t.width)/2+"px",width:t.width+"px",height:t.height+"px"})})},resize:function(t,i,n){var s=this,r=e("#w2ui-popup").data("options");
t=parseInt(t),i=parseInt(i);var o,a;void 0==window.innerHeight?(o=parseInt(document.documentElement.offsetWidth),a=parseInt(document.documentElement.offsetHeight),"IE7"===w2utils.engine&&(o+=21,a+=4)):(o=parseInt(window.innerWidth),a=parseInt(window.innerHeight)),o-10<t&&(t=o-10),a-10<i&&(i=a-10);var l=(a-i)/2*.6,c=(o-t)/2;e("#w2ui-popup").css(w2utils.cssPrefix({transition:r.speed+"s width, "+r.speed+"s height, "+r.speed+"s left, "+r.speed+"s top"})).css({top:l,left:c,width:t,height:i});var d=setInterval(function(){s.resizeMessages()},10);setTimeout(function(){clearInterval(d),r.width=t,r.height=i,s.resizeMessages(),"function"==typeof n&&n()},1e3*r.speed+50)},restoreTemplate:function(){var t=e("#w2ui-popup").data("options");if(null!=t){var i=w2popup._template,n=t.title,s=t.body,r=t.buttons;if(w2popup._prev?(i=w2popup._prev.template,n=w2popup._prev.title,s=w2popup._prev.body,r=w2popup._prev.buttons,delete w2popup._prev):delete w2popup._template,null!=i){var o=e(i);if(0===o.length)return;"body"==e(s).attr("rel")?(n&&o.append(n),s&&o.append(s),r&&o.append(r)):o.append(s)}}}},e.extend(w2popup,w2utils.event)}(jQuery);var w2alert=function(e,t,i){var n=jQuery;return null==t&&(t=w2utils.lang("Notification")),n("#w2ui-popup").length>0&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.message();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(){n("#w2ui-popup .w2ui-message .w2ui-popup-btn").focus()},onClose:function(){"function"==typeof i&&i()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:t,body:'<div class="w2ui-centered w2ui-alert-msg" style="font-size: 13px;">'+e+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn w2ui-btn">'+w2utils.lang("Ok")+"</button>",onOpen:function(e){setTimeout(function(){n("#w2ui-popup .w2ui-popup-btn").focus()},1)},onKeydown:function(e){n("#w2ui-popup .w2ui-popup-btn").focus().addClass("clicked")},onClose:function(){"function"==typeof i&&i()}}),{ok:function(e){return i=e,this},done:function(e){return i=e,this}}},w2confirm=function(e,t,i){var n=jQuery,s={},r={msg:"",title:w2utils.lang("Confirmation"),width:n("#w2ui-popup").length>0?400:450,height:n("#w2ui-popup").length>0?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};return 1==arguments.length&&"object"==typeof e?n.extend(s,r,e):"function"==typeof t?n.extend(s,r,{msg:e,callBack:t}):n.extend(s,r,{msg:e,title:t,callBack:i}),"object"==typeof s.btn_yes&&(s.yes_text=s.btn_yes.text||s.yes_text,s.yes_class=s.btn_yes.class||s.yes_class,s.yes_style=s.btn_yes.style||s.yes_style,s.yes_callBack=s.btn_yes.callBack||s.yes_callBack),"object"==typeof s.btn_no&&(s.no_text=s.btn_no.text||s.no_text,s.no_class=s.btn_no.class||s.no_class,s.no_style=s.btn_no.style||s.no_style,s.no_callBack=s.btn_no.callBack||s.no_callBack),n("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(s.width>w2popup.get().width&&(s.width=w2popup.get().width),s.height>w2popup.get().height-50&&(s.height=w2popup.get().height-50),w2popup.message({width:s.width,height:s.height,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+s.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.yes_class+'" style="'+s.yes_style+'">'+w2utils.lang(s.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+s.no_class+'" style="'+s.no_style+'">'+w2utils.lang(s.no_text)+"</button>",onOpen:function(){n("#w2ui-popup .w2ui-message .w2ui-btn").on("click.w2confirm",function(e){w2popup._confirm_btn=e.target.id,w2popup.message()})},onClose:function(){n("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2confirm"),setTimeout(function(){"function"==typeof s.callBack&&s.callBack(w2popup._confirm_btn),"Yes"==w2popup._confirm_btn&&"function"==typeof s.yes_callBack&&s.yes_callBack(),"No"==w2popup._confirm_btn&&"function"==typeof s.no_callBack&&s.no_callBack()},300)}})):(w2utils.isInt(s.height)||(s.height=s.height+50),w2popup.open({width:s.width,height:s.height,title:s.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered w2ui-confirm-msg" style="font-size: 13px;">'+s.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn w2ui-btn '+s.yes_class+'" style="'+s.yes_style+'">'+w2utils.lang(s.yes_text)+'</button><button id="No" class="w2ui-popup-btn w2ui-btn '+s.no_class+'" style="'+s.no_style+'">'+w2utils.lang(s.no_text)+"</button>",onOpen:function(e){setTimeout(function(){n("#w2ui-popup .w2ui-popup-btn").on("click",function(e){w2popup.close(),"function"==typeof s.callBack&&s.callBack(e.target.id),"Yes"==e.target.id&&"function"==typeof s.yes_callBack&&s.yes_callBack(),"No"==e.target.id&&"function"==typeof s.no_callBack&&s.no_callBack()}),n("#w2ui-popup .w2ui-popup-btn#Yes").focus()},1)},onKeydown:function(e){if(0===n("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:n("#w2ui-popup .w2ui-popup-btn#Yes").focus().addClass("clicked"),w2popup.close();break;case 27:n("#w2ui-popup .w2ui-popup-btn#No").focus().click(),w2popup.close()}}})),{yes:function(e){return s.yes_callBack=e,this},no:function(e){return s.no_callBack=e,this}}},w2prompt=function(e,t,i){var n=jQuery,s={},r={label:"",value:"",attrs:"",title:w2utils.lang("Notification"),ok_text:w2utils.lang("Ok"),cancel_text:w2utils.lang("Cancel"),width:n("#w2ui-popup").length>0?400:450,height:n("#w2ui-popup").length>0?170:220,callBack:null};return 1==arguments.length&&"object"==typeof e?n.extend(s,r,e):"function"==typeof t?n.extend(s,r,{label:e,callBack:t}):n.extend(s,r,{label:e,title:t,callBack:i}),n("#w2ui-popup").length>0&&"closing"!=w2popup.status&&w2popup.get()?(s.width>w2popup.get().width&&(s.width=w2popup.get().width),s.height>w2popup.get().height-50&&(s.height=w2popup.get().height-50),w2popup.message({width:s.width,height:s.height,body:'<div class="w2ui-centered" style="font-size: 13px;">   <label style="margin-right: 10px;">'+s.label+':</label>   <input id="w2prompt" '+s.attrs+"></div>",buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+s.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+s.cancel_text+"</button>",onOpen:function(){n("#w2prompt").val(s.value),n("#w2ui-popup .w2ui-message .w2ui-btn#Ok").on("click.w2prompt",function(e){w2popup._prompt_value=n("#w2prompt").val(),w2popup.message()}),n("#w2ui-popup .w2ui-message .w2ui-btn#Cancel").on("click.w2prompt",function(e){w2popup._prompt_value=null,w2popup.message()}),setTimeout(function(){n("#w2prompt").focus()},100)},onClose:function(){n("#w2ui-popup .w2ui-message .w2ui-btn").off("click.w2prompt"),setTimeout(function(){"function"==typeof s.callBack&&null!=w2popup._prompt_value&&s.callBack(w2popup._prompt_value)},300)}})):(w2utils.isInt(s.height)||(s.height=s.height+50),w2popup.open({width:s.width,height:s.height,title:s.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered" style="font-size: 13px;"><label style="margin-right: 10px;">'+s.label+':</label><input id="w2prompt"></div>',buttons:'<button id="Ok" class="w2ui-popup-btn w2ui-btn">'+s.ok_text+'</button><button id="Cancel" class="w2ui-popup-btn w2ui-btn">'+s.cancel_text+"</button>",onOpen:function(e){setTimeout(function(){n("#w2prompt").val(s.value),n("#w2prompt").w2field("text"),n("#w2ui-popup .w2ui-popup-btn#Ok").on("click",function(e){w2popup._prompt_value=n("#w2prompt").val(),w2popup.close(),"function"==typeof s.callBack&&s.callBack(w2popup._prompt_value)}),n("#w2ui-popup .w2ui-popup-btn#Cancel").on("click",function(e){w2popup._prompt_value=null,w2popup.close()}),n("#w2ui-popup .w2ui-popup-btn#Ok"),setTimeout(function(){n("#w2prompt").focus()},100)},1)},onKeydown:function(e){if(0===n("#w2ui-popup .w2ui-message").length)switch(e.originalEvent.keyCode){case 13:n("#w2ui-popup .w2ui-popup-btn#Ok").focus().addClass("clicked"),w2popup.close();break;case 27:w2popup.close()}}})),{change:function(e){return n("#w2prompt").on("keyup",e).keyup(),this},ok:function(e){return s.callBack=e,this}}};!function(e){var t=function(t){this.box=null,this.name=null,this.active=null,this.flow="down",this.tooltip="top|left",this.tabs=[],this.routeData={},this.right="",this.style="",e.extend(this,{handlers:[]}),e.extend(!0,this,w2obj.tabs,t)};e.fn.w2tabs=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2tabs"))return;for(var n=i.tabs||[],s=new t(i),r=0;r<n.length;r++)s.tabs[r]=e.extend({},t.prototype.tab,n[r]);return 0!==e(this).length&&s.render(e(this)[0]),w2ui[s.name]=s,s}var o=w2ui[e(this).attr("name")];return o?arguments.length>0?(o[i]&&o[i].apply(o,Array.prototype.slice.call(arguments,1)),this):o:null},t.prototype={onClick:null,onClose:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,tab:{id:null,text:null,route:null,hidden:!1,disabled:!1,closable:!1,tooltip:null,style:"",onClick:null,onRefresh:null,onClose:null},add:function(e){return this.insert(null,e)},insert:function(i,n){e.isArray(n)||(n=[n]);for(var s=0;s<n.length;s++){if(null==n[s].id)return void console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+this.name+")");if(!w2utils.checkUniqueId(n[s].id,this.tabs,"tabs",this.name))return;var r=e.extend({},t.prototype.tab,n[s]);if(null==i)this.tabs.push(r);else{var o=this.get(i,!0);this.tabs=this.tabs.slice(0,o).concat([r],this.tabs.slice(o))}this.refresh(n[s].id),this.resize()}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var n=this.get(arguments[i]);if(!n)return!1;t++,this.tabs.splice(this.get(n.id,!0),1),e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id)).remove()}return this.resize(),t},select:function(e){return this.active!=e&&null!=this.get(e)&&(this.active=e,this.refresh(),!0)},set:function(t,i){var n=this.get(t,!0);return null!=n&&(e.extend(this.tabs[n],i),this.refresh(t),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.tabs.length;n++)null!=this.tabs[n].id&&i.push(this.tabs[n].id);return i}for(var s=0;s<this.tabs.length;s++)if(this.tabs[s].id==e)return t===!0?s:this.tabs[s];return null},show:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&s.hidden!==!1&&(t++,s.hidden=!1,i.push(s.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},hide:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&s.hidden!==!0&&(t++,s.hidden=!0,i.push(s.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},enable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&s.disabled!==!1&&(t++,s.disabled=!1,i.push(s.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&s.disabled!==!0&&(t++,s.disabled=!0,i.push(s.id))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},tooltipShow:function(t,i,n){if(null!=this.tooltip){var s=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t)),r=this.get(t),o=this.tooltip,a=r.tooltip;"function"==typeof a&&(a=a.call(this,r)),s.prop("_mouse_over",!0),setTimeout(function(){s.prop("_mouse_over")===!0&&s.prop("_mouse_tooltip")!==!0&&(s.prop("_mouse_tooltip",!0),s.w2tag(w2utils.lang(a),{position:o})),1==n&&s.w2tag(w2utils.lang(a),{position:o})},1)}},tooltipHide:function(t){if(null!=this.tooltip){var i=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(t));this.get(t);i.removeProp("_mouse_over"),setTimeout(function(){i.prop("_mouse_over")!==!0&&i.prop("_mouse_tooltip")===!0&&(i.removeProp("_mouse_tooltip"),i.w2tag())},1)}},refresh:function(t){var i=(new Date).getTime();"up"==this.flow?e(this.box).addClass("w2ui-tabs-up"):e(this.box).removeClass("w2ui-tabs-up");var n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,object:this.get(t)});if(n.isCancelled!==!0){if(null==t)for(var s=0;s<this.tabs.length;s++)this.refresh(this.tabs[s].id);else{var r=this.get(t);if(null==r)return!1;null==r.text&&null!=r.caption&&(r.text=r.caption),null==r.tooltip&&null!=r.hint&&(r.tooltip=r.hint);var o=r.text;"function"==typeof o&&(o=o.call(this,r)),null==o&&(o="");var a=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(r.id)),l="";r.closable&&!r.disabled&&(l='<div class="w2ui-tab-close"     onmouseover = "w2ui[\''+this.name+"'].tooltipShow('"+r.id+"', event);\"    onmouseout  = \"w2ui['"+this.name+"'].tooltipHide('"+r.id+"', event);\"    onclick=\"w2ui['"+this.name+"'].animateClose('"+r.id+"', event);\"></div>");var c=l+'    <div class="w2ui-tab'+(this.active===r.id?" active":"")+(r.closable?" closable":"")+(r.class?" "+r.class:"")+'" style="'+r.style+'"         onmouseover = "'+(r.disabled?"":"w2ui['"+this.name+"'].tooltipShow('"+r.id+"', event);")+'"        onmouseout  = "'+(r.disabled?"":"w2ui['"+this.name+"'].tooltipHide('"+r.id+"', event);")+'"        onclick="w2ui[\''+this.name+"'].click('"+r.id+"', event);\">"+w2utils.lang(o)+"</div>";if(0===a.length){var d="";r.hidden&&(d+="display: none;"),r.disabled&&(d+="opacity: 0.2;");var u='<td id="tabs_'+this.name+"_tab_"+r.id+'" style="'+d+'" valign="middle">'+c+"</td>";this.get(t,!0)!==this.tabs.length-1&&e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).length>0?e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))+1].id)).before(u):e(this.box).find("#tabs_"+this.name+"_right").before(u)}else a.html(c),r.hidden?a.css("display","none"):a.css("display",""),r.disabled?a.css({opacity:"0.2"}):a.css({opacity:"1"})}return e("#tabs_"+this.name+"_right").html(this.right),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}},render:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(n.isCancelled!==!0){if(null!=t&&(e(this.box).find("> table #tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=t),!this.box)return!1;var s='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="1" width="100%"><tbody>    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+'</td></tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>";return e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-tabs").html(s),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.trigger(e.extend(n,{phase:"after"})),this.refresh(),this.resize(),(new Date).getTime()-i}},scroll:function(t){var i,n,s,r=e(this.box),o=this,a=r.find(".w2ui-scroll-wrapper"),l=a.scrollLeft();switch(t){case"left":i=a.outerWidth(),n=a.find(":first").outerWidth(),s=l-i+50,s<=0&&(s=0),a.animate({scrollLeft:s},300);break;case"right":i=a.outerWidth(),n=a.find(":first").outerWidth(),s=l+i-50,s>=n-i&&(s=n-i),a.animate({scrollLeft:s},300)}setTimeout(function(){o.resize()},350)},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(i.isCancelled!==!0){var n=e(this.box);n.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var s=n.find(".w2ui-scroll-wrapper");return s.find(":first").outerWidth()>s.outerWidth()&&(s.scrollLeft()>0&&n.find(".w2ui-scroll-left").show(),s.scrollLeft()<s.find(":first").outerWidth()-s.outerWidth()&&n.find(".w2ui-scroll-right").show()),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});t.isCancelled!==!0&&(e(this.box).find("> table #tabs_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},click:function(t,i){var n=this.get(t);if(null==n||n.disabled)return!1;var s=this.trigger({phase:"before",type:"click",target:t,tab:n,object:n,originalEvent:i});if(s.isCancelled!==!0){if(e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active"),this.active=n.id,"string"==typeof n.route){var r=""!==n.route?String("/"+n.route).replace(/\/{2,}/g,"/"):"",o=w2utils.parseRoute(r);if(o.keys.length>0)for(var a=0;a<o.keys.length;a++)null!=this.routeData[o.keys[a].name]&&(r=r.replace(new RegExp(":"+o.keys[a].name,"g"),this.routeData[o.keys[a].name]));setTimeout(function(){window.location.hash=r},1)}this.trigger(e.extend(s,{phase:"after"})),this.refresh(t)}},animateClose:function(t,i){var n=this.get(t);if(null==n||n.disabled)return!1;var s=this.trigger({phase:"before",type:"close",target:t,object:this.get(t),originalEvent:i});if(s.isCancelled!==!0){var r=this;e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(n.id)).css(w2utils.cssPrefix("transition",".2s")).css("opacity","0"),setTimeout(function(){var t=e(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(n.id)).width();e(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(n.id)).html('<div style="width: '+t+"px; "+w2utils.cssPrefix("transition",".2s",!0)+'"></div>'),setTimeout(function(){e(r.box).find("#tabs_"+r.name+"_tab_"+w2utils.escapeId(n.id)).find(":first-child").css({width:"0px"})},50)},200),setTimeout(function(){r.remove(t)},450),this.trigger(e.extend(s,{phase:"after"})),this.refresh()}},animateInsert:function(t,i){if(null!=this.get(t)&&e.isPlainObject(i)&&w2utils.checkUniqueId(i.id,this.tabs,"tabs",this.name)){var n=e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(i.id));if(0===n.length){null==i.text&&null!=i.caption&&(i.text=i.caption);var s='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tbody><tr><td id="_tmp_simple_tab" style="" valign="middle">'+(i.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===i.id?"active":"")+'">'+i.text+"</div></td></tr></tbody></table></div>";e("body").append(s);var r='<div style="width: 1px; '+w2utils.cssPrefix("transition",".2s",!0)+'">&#160;</div>',o="";i.hidden&&(o+="display: none;"),i.disabled&&(o+="opacity: 0.2;");var a='<td id="tabs_'+this.name+"_tab_"+i.id+'" style="'+o+'" valign="middle">'+r+"</td>";this.get(t,!0)!==this.tabs.length&&e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).length>0?e(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(t,!0))].id)).before(a):e(this.box).find("#tabs_"+this.name+"_right").before(a);var l=this;setTimeout(function(){var t=e("#_tmp_simple_tab").width();e("#_tmp_tabs").remove(),e("#tabs_"+l.name+"_tab_"+w2utils.escapeId(i.id)+" > div").css("width",t+"px")},1),setTimeout(function(){l.insert(t,i)},200)}}}},e.extend(t.prototype,w2utils.event),w2obj.tabs=t}(jQuery),function(e){var t=function(t){this.box=null,this.name=null,this.routeData={},this.items=[],this.right="",this.tooltip="top|left",e.extend(!0,this,w2obj.toolbar,t)};e.fn.w2toolbar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2toolbar"))return;var n=i.items||[],s=new t(i);e.extend(s,{items:[],handlers:[]});for(var r=0;r<n.length;r++)if(s.items[r]=e.extend({},t.prototype.item,n[r]),"menu-check"==s.items[r].type){var o=s.items[r];if(Array.isArray(o.selected)||(o.selected=[]),Array.isArray(o.items))for(var a=0;a<o.items.length;a++){var l=o.items[a];l.checked&&o.selected.indexOf(l.id)==-1&&o.selected.push(l.id),l.checked||o.selected.indexOf(l.id)==-1||(l.checked=!0),null==l.checked&&(l.checked=!1)}}else if("menu-radio"==s.items[r].type){var o=s.items[r];if(Array.isArray(o.items))for(var a=0;a<o.items.length;a++){var l=o.items[a];l.checked&&null==o.selected?o.selected=l.id:l.checked=!1,l.checked||o.selected!=l.id||(l.checked=!0),null==l.checked&&(l.checked=!1)}}return 0!==e(this).length&&s.render(e(this)[0]),w2ui[s.name]=s,s}var c=w2ui[e(this).attr("name")];return c?arguments.length>0?(c[i]&&c[i].apply(c,Array.prototype.slice.call(arguments,1)),this):c:null},t.prototype={onClick:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,item:{id:null,type:"button",text:null,html:"",tooltip:null,count:null,hidden:!1,disabled:!1,checked:!1,img:null,icon:null,route:null,arrow:!0,style:null,color:null,transparent:null,group:null,items:null,selected:null,overlay:{},onClick:null,onRefresh:null},add:function(e){this.insert(null,e)},insert:function(i,n){e.isArray(n)||(n=[n]);for(var s=0;s<n.length;s++){if(null==n[s].type)return void console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');if(e.inArray(String(n[s].type),["button","check","radio","drop","menu","menu-radio","menu-check","color","text-color","break","html","spacer"])==-1)return void console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');if(null==n[s].id&&"break"!=n[s].type&&"spacer"!=n[s].type)return void console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');if(!w2utils.checkUniqueId(n[s].id,this.items,"toolbar items",this.name))return;var r=e.extend({},t.prototype.item,n[s]);if(null==i)this.items.push(r);else{var o=this.get(i,!0);this.items=this.items.slice(0,o).concat([r],this.items.slice(o))}this.refresh(r.id),this.resize()}},remove:function(){for(var t=0,i=0;i<arguments.length;i++){var n=this.get(arguments[i]);if(n&&String(arguments[i]).indexOf(":")==-1){t++,e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(n.id)).remove();var s=this.get(n.id,!0);null!=s&&this.items.splice(s,1)}}return this.resize(),t},set:function(t,i){var n=this.get(t);return null!=n&&(e.extend(n,i),this.refresh(String(t).split(":")[0]),!0)},get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.items.length;n++)null!=this.items[n].id&&i.push(this.items[n].id);return i}for(var s=String(e).split(":"),r=0;r<this.items.length;r++){var o=this.items[r];if(["menu","menu-radio","menu-check"].indexOf(o.type)!=-1&&2==s.length&&o.id==s[0])for(var a=0;a<o.items.length;a++){var l=o.items[a];if(l.id==s[1]||null==l.id&&l.text==s[1])return 1==t?a:l}else if(o.id==s[0])return 1==t?r:o}return null},show:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&(t++,s.hidden=!1,i.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]);e.resize()},15),t},hide:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&(t++,s.hidden=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t]);e.resize()},15),t},enable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&(t++,s.disabled=!1,i.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},disable:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&(t++,s.disabled=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t]),e.tooltipHide(i[t])},15),t},check:function(){for(var e=this,t=0,i=[],n=0;n<arguments.length;n++){var s=this.get(arguments[n]);s&&String(arguments[n]).indexOf(":")==-1&&(t++,s.checked=!0,i.push(String(arguments[n]).split(":")[0]))}return setTimeout(function(){for(var t=0;t<i.length;t++)e.refresh(i[t])},15),t},uncheck:function(){for(var t=this,i=0,n=[],s=0;s<arguments.length;s++){var r=this.get(arguments[s]);r&&String(arguments[s]).indexOf(":")==-1&&(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(r.type)!=-1&&r.checked&&setTimeout(function(){var i=e("#tb_"+t.name+"_item_"+w2utils.escapeId(r.id));i.w2overlay({name:t.name})},1),i++,r.checked=!1,n.push(String(arguments[s]).split(":")[0]))}return setTimeout(function(){for(var e=0;e<n.length;e++)t.refresh(n[e])},15),i},click:function(t,i){var n=this,s=String(t).split(":"),r=this.get(s[0]);if(s.length>1){var o=this.get(t);return void(o&&!o.disabled&&n.menuClick({name:n.name,item:r,subItem:o,originalEvent:i}))}if(r&&!r.disabled){var a=this.trigger({phase:"before",type:"click",target:null!=t?t:this.name,item:r,object:r,originalEvent:i});if(a.isCancelled===!0)return;var l="#tb_"+this.name+"_item_"+w2utils.escapeId(r.id)+" table.w2ui-button";if(e(l).removeClass("down"),"radio"==r.type){for(var c=0;c<this.items.length;c++){var d=this.items[c];null!=d&&d.id!=r.id&&"radio"===d.type&&d.group==r.group&&d.checked&&(d.checked=!1,this.refresh(d.id))}r.checked=!0,e(l).addClass("checked")}if(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(r.type)!=-1&&(n.tooltipHide(t),r.checked?setTimeout(function(){var t=e("#tb_"+n.name+"_item_"+w2utils.escapeId(r.id));t.w2overlay({name:n.name}),r.checked=!1,n.refresh(r.id)},1):setTimeout(function(){function t(t){r.checked=!1,e(l).removeClass("checked")}var s=e("#tb_"+n.name+"_item_"+w2utils.escapeId(r.id));e.isPlainObject(r.overlay)||(r.overlay={});var o=(s.width()-50)/2;if(o>19&&(o=19),"drop"==r.type&&s.w2overlay(r.html,e.extend({name:n.name,left:o,top:3},r.overlay,{onHide:function(e){t()}})),["menu","menu-radio","menu-check"].indexOf(r.type)!=-1){var a="normal";"menu-radio"==r.type&&(a="radio",r.items.forEach(function(e){r.selected==e.id?e.checked=!0:e.checked=!1})),"menu-check"==r.type&&(a="check",r.items.forEach(function(t){e.isArray(r.selected)&&r.selected.indexOf(t.id)!=-1?t.checked=!0:t.checked=!1})),s.w2menu(e.extend({name:n.name,items:r.items,left:o,top:3},r.overlay,{type:a,select:function(e){n.menuClick({name:n.name,item:r,subItem:e.item,originalEvent:e.originalEvent,keepOpen:e.keepOpen})},onHide:function(e){t()}}))}["color","text-color"].indexOf(r.type)!=-1&&(null==r.transparent&&(r.transparent=!0),e(s).w2color({color:r.color,transparent:r.transparent},function(e,s){null!=e&&n.colorClick({name:n.name,item:r,color:e,originalEvent:i.originalEvent}),t()}))},1)),["check","menu","menu-radio","menu-check","drop","color","text-color"].indexOf(r.type)!=-1&&(r.checked=!r.checked,r.checked?e(l).addClass("checked"):e(l).removeClass("checked")),r.route){var u=String("/"+r.route).replace(/\/{2,}/g,"/"),h=w2utils.parseRoute(u);if(h.keys.length>0)for(var p=0;p<h.keys.length;p++)u=u.replace(new RegExp(":"+h.keys[p].name,"g"),this.routeData[h.keys[p].name]);setTimeout(function(){window.location.hash=u},1)}i&&["button","check","radio"].indexOf(r.type)!=-1&&this.tooltipShow(t,i,!0),this.trigger(e.extend(a,{phase:"after"}))}},scroll:function(t){var i,n,s,r=e(this.box),o=this,a=r.find(".w2ui-scroll-wrapper"),l=a.scrollLeft();switch(t){case"left":i=a.outerWidth(),n=a.find(":first").outerWidth(),s=l-i+50,s<=0&&(s=0),a.animate({scrollLeft:s},300);break;case"right":i=a.outerWidth(),n=a.find(":first").outerWidth(),s=l+i-50,s>=n-i&&(s=n-i),a.animate({scrollLeft:s},300)}setTimeout(function(){o.resize()},350)},render:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(n.isCancelled!==!0&&(null!=t&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=t),this.box)){for(var s='<div class="w2ui-scroll-wrapper" onmousedown="var el=w2ui[\''+this.name+'\']; if (el) el.resize();"><table cellspacing="0" cellpadding="0" width="100%"><tbody><tr>',r=0;r<this.items.length;r++){var o=this.items[r];null!=o&&(null==o.id&&(o.id="item_"+r),s+="spacer"==o.type?'<td width="100%" id="tb_'+this.name+"_item_"+o.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+o.id+'" style="'+(o.hidden?"display: none":"")+'"     class="'+(o.disabled?"disabled":"")+'" valign="middle"></td>')}return s+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>",s+='</tr></tbody></table></div><div class="w2ui-scroll-left" onclick="var el=w2ui[\''+this.name+"']; if (el) el.scroll('left');\"></div><div class=\"w2ui-scroll-right\" onclick=\"var el=w2ui['"+this.name+"']; if (el) el.scroll('right');\"></div>",e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(s),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style),this.refresh(),this.resize(),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}},refresh:function(t){var i=(new Date).getTime(),n=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,item:this.get(t)});if(n.isCancelled!==!0){if(null!=t){var s=this.get(t);if(null==s)return!1;if("function"==typeof s.onRefresh){var r=this.trigger({phase:"before",type:"refresh",target:t,item:s,object:s});if(r.isCancelled===!0)return}var o=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(s.id)),a=this.getItemHTML(s);return 0===o.length?(a="spacer"==s.type?'<td width="100%" id="tb_'+this.name+"_item_"+s.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+s.id+'" style="'+(s.hidden?"display: none":"")+'"     class="'+(s.disabled?"disabled":"")+'" valign="middle">'+a+"</td>",this.get(t,!0)==this.items.length-1?e(this.box).find("#tb_"+this.name+"_right").before(a):e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(t,!0))+1].id)).before(a)):(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(s.type)!=-1&&0==s.checked&&e("#w2ui-overlay-"+this.name).length>0&&e("#w2ui-overlay-"+this.name)[0].hide(),o.html(a),s.hidden?o.css("display","none"):o.css("display",""),s.disabled?o.addClass("disabled"):o.removeClass("disabled")),"function"==typeof s.onRefresh&&this.trigger(e.extend(r,{phase:"after"})),this.trigger(e.extend(n,{phase:"after"})),(new Date).getTime()-i}for(var l=0;l<this.items.length;l++){var c=this.items[l];null==c.id&&(c.id="item_"+l),this.refresh(c.id)}}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(i.isCancelled!==!0){var n=e(this.box);n.find(".w2ui-scroll-left, .w2ui-scroll-right").hide();var s=n.find(".w2ui-scroll-wrapper");return s.find(":first").outerWidth()>s.outerWidth()&&(s.scrollLeft()>0&&n.find(".w2ui-scroll-left").show(),s.scrollLeft()<s.find(":first").outerWidth()-s.outerWidth()&&n.find(".w2ui-scroll-right").show()),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t}},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});t.isCancelled!==!0&&(e(this.box).find("> table #tb_"+this.name+"_right").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),e(this.box).html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},getItemHTML:function(e){var t="";null!=e.caption&&null==e.text&&(e.text=e.caption),null==e.text&&(e.text=""),null==e.tooltip&&null!=e.hint&&(e.tooltip=e.hint),null==e.tooltip&&(e.tooltip="");var i="<td>&#160;</td>",n=e.text;if("function"==typeof n&&(n=n.call(this,e)),e.img&&(i='<td><div class="w2ui-tb-image w2ui-icon '+e.img+'"></div></td>'),e.icon&&(i='<td><div class="w2ui-tb-image"><span class="'+e.icon+'"></span></div></td>'),""===t)switch(e.type){case"color":case"text-color":"string"==typeof e.color&&"#"==e.color.substr(0,1)&&(e.color=e.color.substr(1)),"color"==e.type&&(n='<div style="height: 12px; width: 12px; margin-top: 1px; border: 1px solid #8A8A8A; border-radius: 1px; box-shadow: 0px 0px 1px #fff;         background-color: #'+(null!=e.color?e.color:"fff")+'; float: left;"></div>'+(e.text?'<div style="margin-left: 17px;">'+w2utils.lang(e.text)+"</div>":"")),"text-color"==e.type&&(n='<div style="color: #'+(null!=e.color?e.color:"444")+';">'+(e.text?w2utils.lang(e.text):"<b>Aa</b>")+"</div>");
case"menu":case"menu-check":case"menu-radio":case"button":case"check":case"radio":case"drop":t+='<table cellpadding="0" cellspacing="0"        class="w2ui-button '+(e.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+e.id+'\', event);"        onmouseover = "'+(e.disabled?"":"jQuery(this).addClass('over'); w2ui['"+this.name+"'].tooltipShow('"+e.id+"', event);")+'"       onmouseout  = "'+(e.disabled?"":"jQuery(this).removeClass('over').removeClass('down'); w2ui['"+this.name+"'].tooltipHide('"+e.id+"', event);")+'"       onmousedown = "'+(e.disabled?"":"jQuery(this).addClass('down');")+'"       onmouseup   = "'+(e.disabled?"":"jQuery(this).removeClass('down');")+'"><tbody><tr><td>  <table cellpadding="1" cellspacing="0"><tbody>  <tr>'+i+(""!==n?'<td class="w2ui-tb-caption" nowrap="nowrap" style="'+(e.style?e.style:"")+'">'+w2utils.lang(n)+"</td>":"")+(null!=e.count?'<td class="w2ui-tb-count" nowrap="nowrap"><span>'+e.count+"</span></td>":"")+(["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(e.type)!=-1&&e.arrow!==!1?'<td class="w2ui-tb-down" nowrap="nowrap"><div></div></td>':"")+"  </tr></tbody></table></td></tr></tbody></table>";break;case"break":t+='<table cellpadding="0" cellspacing="0" ><tbody><tr>    <td><div class="w2ui-break">&#160;</div></td></tr></tbody></table>';break;case"html":t+='<table cellpadding="0" cellspacing="0"><tbody><tr>    <td nowrap="nowrap">'+("function"==typeof e.html?e.html.call(this,e):e.html)+"</td></tr></tbody></table>"}return"<div>"+t+"</div>"},tooltipShow:function(t,i,n){if(null!=this.tooltip){var s=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t)),r=this.get(t),o=this.tooltip,a=r.tooltip;"function"==typeof a&&(a=a.call(this,r)),s.prop("_mouse_over",!0),setTimeout(function(){if(s.prop("_mouse_over")===!0&&s.prop("_mouse_tooltip")!==!0){if(s.prop("_mouse_tooltip",!0),["menu","menu-radio","menu-check","drop","color","text-color"].indexOf(r.type)!=-1&&1==r.checked)return;s.w2tag(w2utils.lang(a),{position:o})}1==n&&s.w2tag(w2utils.lang(a),{position:o})},1)}},tooltipHide:function(t,i){if(null!=this.tooltip){var n=e(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(t));this.get(t);n.removeProp("_mouse_over"),setTimeout(function(){n.prop("_mouse_over")!==!0&&n.prop("_mouse_tooltip")===!0&&(n.removeProp("_mouse_tooltip"),n.w2tag())},1)}},menuClick:function(t){var i=this;if(t.item&&!t.item.disabled){var n=this.trigger({phase:"before",type:"click",target:t.item.id+":"+t.subItem.id,item:t.item,subItem:t.subItem,originalEvent:t.originalEvent});if(n.isCancelled===!0)return;var s=t.subItem,r=this.get(t.item.id);if("menu-radio"==r.type&&(r.selected=s.id,t.item.items.forEach(function(e){e.checked=!1}),s.checked=!0),"menu-check"==r.type){e.isArray(r.selected)||(r.selected=[]);var o=r.selected.indexOf(s.id);o==-1?(r.selected.push(s.id),s.checked=!0):(r.selected.splice(o,1),s.checked=!1)}if("string"==typeof s.route){var a=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"",l=w2utils.parseRoute(a);if(l.keys.length>0)for(var c=0;c<l.keys.length;c++)null!=i.routeData[l.keys[c].name]&&(a=a.replace(new RegExp(":"+l.keys[c].name,"g"),this.routeData[l.keys[c].name]));setTimeout(function(){window.location.hash=a},1)}this.refresh(t.item.id),this.trigger(e.extend(n,{phase:"after"}))}},colorClick:function(t){var i=this;if(t.item&&!t.item.disabled){var n=this.trigger({phase:"before",type:"click",target:t.item.id,item:t.item,color:t.color,originalEvent:t.originalEvent});if(n.isCancelled===!0)return;t.item.color=t.color,i.refresh(t.item.id),this.trigger(e.extend(n,{phase:"after"}))}}},e.extend(t.prototype,w2utils.event),w2obj.toolbar=t}(jQuery),function(e){var t=function(t){this.name=null,this.box=null,this.sidebar=null,this.parent=null,this.nodes=[],this.menu=[],this.routeData={},this.selected=null,this.img=null,this.icon=null,this.style="",this.topHTML="",this.bottomHTML="",this.flatButton=!1,this.keyboard=!0,this.flat=!1,this.hasFocus=!1,e.extend(!0,this,w2obj.sidebar,t)};e.fn.w2sidebar=function(i){if(e.isPlainObject(i)){if(!w2utils.checkName(i,"w2sidebar"))return;var n=i.nodes,s=new t(i);return e.extend(s,{handlers:[],nodes:[]}),null!=n&&s.add(s,n),0!==e(this).length&&s.render(e(this)[0]),s.sidebar=s,w2ui[s.name]=s,s}var r=w2ui[e(this).attr("name")];return r?arguments.length>0?(r[i]&&r[i].apply(r,Array.prototype.slice.call(arguments,1)),this):r:null},t.prototype={onClick:null,onDblClick:null,onContextMenu:null,onMenuClick:null,onExpand:null,onCollapse:null,onKeydown:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onFocus:null,onBlur:null,onFlat:null,node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,disabled:!1,group:!1,groupShowHide:!0,collapsible:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(e,t){return 1==arguments.length&&(t=arguments[0],e=this),"string"==typeof e&&(e=this.get(e)),this.insert(e,null,t)},insert:function(i,n,s){var r,o,a,l,c;if(2==arguments.length)if(s=arguments[1],n=arguments[0],null!=n){if(o=this.get(n),null==o)return e.isArray(s)||(s=[s]),r=null!=s[0].caption?s[0].caption:s[0].text,console.log('ERROR: Cannot insert node "'+r+'" because cannot find node "'+n+'" to insert before.'),null;i=this.get(n).parent}else i=this;"string"==typeof i&&(i=this.get(i)),e.isArray(s)||(s=[s]);for(var d=0;d<s.length;d++)if(l=s[d],null!=typeof l.id)if(null==this.get(this,l.id)){if(a=e.extend({},t.prototype.node,l),a.sidebar=this,a.parent=i,c=a.nodes||[],a.nodes=[],null==n)i.nodes.push(a);else{if(o=this.get(i,n,!0),null==o)return r=null!=l.caption?l.caption:l.text,console.log('ERROR: Cannot insert node "'+r+'" because cannot find node "'+n+'" to insert before.'),null;i.nodes.splice(o,0,a)}c.length>0&&this.insert(a,null,c)}else r=null!=l.caption?l.caption:l.text,console.log("ERROR: Cannot insert node with id="+l.id+" (text: "+r+") because another node with the same id already exists.");else r=null!=l.caption?l.caption:l.text,console.log('ERROR: Cannot insert node "'+r+'" because it has no id.');return this.refresh(i.id),a},remove:function(){for(var e,t=0,i=0;i<arguments.length;i++)if(e=this.get(arguments[i]),null!=e){null!=this.selected&&this.selected===e.id&&(this.selected=null);var n=this.get(e.parent,arguments[i],!0);null!=n&&(e.parent.nodes[n].selected&&e.sidebar.unselect(e.id),e.parent.nodes.splice(n,1),t++)}return t>0&&1==arguments.length?this.refresh(e.parent.id):this.refresh(),t},set:function(t,i,n){if(2==arguments.length&&(n=i,i=t,t=this),"string"==typeof t&&(t=this.get(t)),null==t.nodes)return null;for(var s=0;s<t.nodes.length;s++){if(t.nodes[s].id===i){var r=n.nodes;return e.extend(t.nodes[s],n,{nodes:[]}),null!=r&&this.add(t.nodes[s],r),this.refresh(i),!0}var o=this.set(t.nodes[s],i,n);if(o)return!0}return!1},get:function(e,t,i){if(0===arguments.length){for(var n=[],s=this.find({}),r=0;r<s.length;r++)null!=s[r].id&&n.push(s[r].id);return n}if((1==arguments.length||2==arguments.length&&t===!0)&&(i=t,t=e,e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return null;for(var o=0;o<e.nodes.length;o++){if(e.nodes[o].id==t)return i===!0?o:e.nodes[o];var a=this.get(e.nodes[o],t,i);if(a||0===a)return a}return null},find:function(e,t,i){if(1==arguments.length&&(t=e,e=this),i||(i=[]),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return i;for(var n=0;n<e.nodes.length;n++){var s=!0;for(var r in t)e.nodes[n][r]!=t[r]&&(s=!1);s&&i.push(e.nodes[n]),e.nodes[n].nodes.length>0&&(i=this.find(e.nodes[n],t,i))}return i},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!0,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.hidden=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!0,i.selected&&this.unselect(i.id),e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);null!=i&&(i.disabled=!1,e++)}return 1==arguments.length?this.refresh(arguments[0]):this.refresh(),e},select:function(t){var i=this.get(t);return!!i&&((this.selected!=t||!i.selected)&&(this.unselect(this.selected),e(this.box).find("#node_"+w2utils.escapeId(t)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),i.selected=!0,this.selected=t,!0))},unselect:function(t){0===arguments.length&&(t=this.selected);var i=this.get(t);return!!i&&(i.selected=!1,e(this.box).find("#node_"+w2utils.escapeId(t)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),this.selected==t&&(this.selected=null),!0)},toggle:function(e){var t=this.get(e);return null!=t&&(t.plus?(this.set(e,{plus:!1}),this.expand(e),void this.refresh(e)):0!==t.nodes.length&&(!!t.collapsible&&(this.get(e).expanded?this.collapse(e):this.expand(e))))},collapse:function(t){var i=this,n=this.get(t),s=this.trigger({phase:"before",type:"collapse",target:t,object:n});if(s.isCancelled!==!0)return e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideUp(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),n.expanded=!1,this.trigger(e.extend(s,{phase:"after"})),setTimeout(function(){i.refresh(t)},200),!0},collapseAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)e.nodes[t].expanded===!0&&(e.nodes[t].expanded=!1),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.collapseAll(e.nodes[t]);return this.refresh(e.id),!0},expand:function(t){var i=this,n=this.get(t),s=this.trigger({phase:"before",type:"expand",target:t,object:n});if(s.isCancelled!==!0)return e(this.box).find("#node_"+w2utils.escapeId(t)+"_sub").slideDown(200),e(this.box).find("#node_"+w2utils.escapeId(t)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),n.expanded=!0,this.trigger(e.extend(s,{phase:"after"})),setTimeout(function(){i.refresh(t)},200),!0},expandAll:function(e){if(null==e&&(e=this),"string"==typeof e&&(e=this.get(e)),null==e.nodes)return!1;for(var t=0;t<e.nodes.length;t++)e.nodes[t].expanded===!1&&(e.nodes[t].expanded=!0),e.nodes[t].nodes&&e.nodes[t].nodes.length>0&&this.expandAll(e.nodes[t]);this.refresh(e.id)},expandParents:function(e){var t=this.get(e);return null!=t&&(t.parent&&(t.parent.expanded||(t.parent.expanded=!0,this.refresh(t.parent.id)),this.expandParents(t.parent.id)),!0)},click:function(t,i){var n=this,s=this.get(t);if(null!=s&&!s.disabled&&!s.group){e(n.box).find(".w2ui-node.w2ui-selected").each(function(t,i){var s=e(i).attr("id").replace("node_",""),r=n.get(s);null!=r&&(r.selected=!1),e(i).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});var r=e(n.box).find("#node_"+w2utils.escapeId(t)),o=e(n.box).find("#node_"+w2utils.escapeId(n.selected));r.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected"),setTimeout(function(){var a=n.trigger({phase:"before",type:"click",target:t,originalEvent:i,node:s,object:s});if(a.isCancelled===!0)return r.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),void o.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");if(null!=o&&(o.selected=!1),n.get(t).selected=!0,n.selected=t,"string"==typeof s.route){var l=""!==s.route?String("/"+s.route).replace(/\/{2,}/g,"/"):"",c=w2utils.parseRoute(l);if(c.keys.length>0)for(var d=0;d<c.keys.length;d++)null!=n.routeData[c.keys[d].name]&&(l=l.replace(new RegExp(":"+c.keys[d].name,"g"),n.routeData[c.keys[d].name]));setTimeout(function(){window.location.hash=l},1)}n.trigger(e.extend(a,{phase:"after"}))},1)}},focus:function(t){var i=this,n=this.trigger({phase:"before",type:"focus",target:this.name,originalEvent:t});return n.isCancelled!==!0&&(this.hasFocus=!0,e(this.box).find(".w2ui-selected").removeClass("w2ui-inactive"),setTimeout(function(){var t=e(i.box).find("#sidebar_"+i.name+"_focus");t.is(":focus")||t.focus()},10),void this.trigger(e.extend(n,{phase:"after"})))},blur:function(t){var i=this.trigger({phase:"before",type:"blur",target:this.name,originalEvent:t});return i.isCancelled!==!0&&(this.hasFocus=!1,e(this.box).find(".w2ui-selected").addClass("w2ui-inactive"),void this.trigger(e.extend(i,{phase:"after"})))},keydown:function(t){function i(e,t){null==e||e.hidden||e.disabled||e.group||(a.click(e.id,t),setTimeout(function(){a.scrollIntoView()},50))}function n(e,t){for(e=t(e);null!=e&&(e.hidden||e.disabled)&&!e.group;)e=t(e);return e}function s(e,t){if(null==e)return null;var i=e.parent,n=a.get(e.id,!0),r=null;if(e.expanded&&e.nodes.length>0&&t!==!0){var o=e.nodes[0];r=o.hidden||o.disabled||o.group?s(o):o}else r=i&&n+1<i.nodes.length?i.nodes[n+1]:s(i,!0);return null!=r&&(r.hidden||r.disabled||r.group)&&(r=s(r)),r}function r(e){if(null==e)return null;var t=e.parent,i=a.get(e.id,!0),n=i>0?o(t.nodes[i-1]):t;return null!=n&&(n.hidden||n.disabled||n.group)&&(n=r(n)),n}function o(e){if(e.expanded&&e.nodes.length>0){var t=e.nodes[e.nodes.length-1];return t.hidden||t.disabled||t.group?r(t):o(t)}return e}var a=this,l=a.get(a.selected);if(a.keyboard===!0){l||(l=a.nodes[0]);var c=a.trigger({phase:"before",type:"keydown",target:a.name,originalEvent:t});c.isCancelled!==!0&&(13!=t.keyCode&&32!=t.keyCode||l.nodes.length>0&&a.toggle(a.selected),37==t.keyCode&&(l.nodes.length>0&&l.expanded?a.collapse(a.selected):(i(l.parent),l.parent.group||a.collapse(l.parent.id))),39==t.keyCode&&(l.nodes.length>0||l.plus)&&!l.expanded&&a.expand(a.selected),38==t.keyCode&&i(n(l,r)),40==t.keyCode&&i(n(l,s)),e.inArray(t.keyCode,[13,32,37,38,39,40])!=-1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()),a.trigger(e.extend(c,{phase:"after"})))}},scrollIntoView:function(t){null==t&&(t=this.selected);var i=this.get(t);if(null!=i){var n=e(this.box).find(".w2ui-sidebar-div"),s=e(this.box).find("#node_"+w2utils.escapeId(t)),r=s.offset().top-n.offset().top;(r+s.height()>n.height()||r<=0)&&n.animate({scrollTop:n.scrollTop()+r-n.height()/2+s.height()},250,"linear")}},dblClick:function(t,i){var n=this.get(t),s=this.trigger({phase:"before",type:"dblClick",target:t,originalEvent:i,object:n});s.isCancelled!==!0&&(this.toggle(t),this.trigger(e.extend(s,{phase:"after"})))},contextMenu:function(t,i){var n=this,s=n.get(t);t!=n.selected&&n.click(t);var r=n.trigger({phase:"before",type:"contextMenu",target:t,originalEvent:i,object:s,allowOnDisabled:!1});r.isCancelled!==!0&&(s.disabled&&!r.allowOnDisabled||(n.menu.length>0&&e(n.box).find("#node_"+w2utils.escapeId(t)).w2menu({items:n.menu,contextMenu:!0,originalEvent:i,onSelect:function(e){n.menuClick(t,parseInt(e.index),e.originalEvent)}}),i.preventDefault&&i.preventDefault(),n.trigger(e.extend(r,{phase:"after"}))))},menuClick:function(t,i,n){var s=this,r=s.trigger({phase:"before",type:"menuClick",target:t,originalEvent:n,menuIndex:i,menuItem:s.menu[i]});r.isCancelled!==!0&&s.trigger(e.extend(r,{phase:"after"}))},goFlat:function(){var t=this.trigger({phase:"before",type:"flat",goFlat:!this.flat});t.isCancelled!==!0&&(this.flat=!this.flat,this.refresh(),this.trigger(e.extend(t,{phase:"after"})))},render:function(t){var i=(new Date).getTime(),n=this,s=this.trigger({phase:"before",type:"render",target:this.name,box:t});if(s.isCancelled!==!0&&(null!=t&&(e(this.box).find("> div > div.w2ui-sidebar-div").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=t),this.box)){e(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><input id="sidebar_'+this.name+'_focus" style="position: absolute; top: 0; right: 0; width: 1px; z-index: -1; opacity: 0"/><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),e(this.box).length>0&&(e(this.box)[0].style.cssText+=this.style);var r="";1==this.flatButton&&(r='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===r||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+r),e(this.box).find(".w2ui-sidebar-div").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-div").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px"));var o;return e(this.box).find("#sidebar_"+this.name+"_focus").on("focus",function(e){clearTimeout(o),n.hasFocus||n.focus(e)}).on("blur",function(e){o=setTimeout(function(){n.hasFocus&&n.blur(e)},100)}).on("keydown",function(e){9!=e.keyCode&&w2ui[n.name].keydown.call(w2ui[n.name],e)}),e(this.box).off("mousedown").on("mousedown",function(t){setTimeout(function(){if(["INPUT","TEXTAREA","SELECT"].indexOf(t.target.tagName.toUpperCase())==-1){var i=e(n.box).find("#sidebar_"+n.name+"_focus");if(!i.is(":focus")){if(e(t.target).hasClass("w2ui-node")){var s=e(t.target).position().top+e(n.box).find(".w2ui-sidebar-top").height()+t.offsetY;i.css({top:s+"px",left:"0px"})}i.focus()}}},1)}),this.trigger(e.extend(s,{phase:"after"})),this.refresh(),(new Date).getTime()-i}},refresh:function(t){function i(e){var t="",i=e.img;null==i&&(i=this.img);var n=e.icon;null==n&&(n=this.icon);for(var s=e.parent,r=0;s&&null!=s.parent;)s.group&&r--,s=s.parent,r++;if(null!=e.caption&&(e.text=e.caption),e.group)t='<div class="w2ui-node-group w2ui-level-'+r+'" id="node_'+e.id+'"   onclick="w2ui[\''+c.name+"'].toggle('"+e.id+"')\"   oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"   onmouseout=\"jQuery(this).find('span:nth-child(1)').css('color', 'transparent')\"    onmouseover=\"jQuery(this).find('span:nth-child(1)').css('color', 'inherit')\">"+(e.groupShowHide&&e.collapsible?"<span>"+(!e.hidden&&e.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+("function"==typeof e.text?e.text.call(c,e):"<span>"+e.text+"</span>")+'</div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',c.flat&&(t='<div class="w2ui-node-group" id="node_'+e.id+'"><span>&#160;</span></div><div id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>');else{e.selected&&!e.disabled&&(c.selected=e.id),s="",i&&(s='<div class="w2ui-node-image w2ui-icon '+i+(e.selected&&!e.disabled?" w2ui-icon-selected":"")+'"></div>'),n&&(s='<div class="w2ui-node-image"><span class="'+n+'"></span></div>');var o=e.text;"function"==typeof e.text&&(o=e.text.call(c,e)),t='<div class="w2ui-node w2ui-level-'+r+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+'"    ondblclick="w2ui[\''+c.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+c.name+"'].click('"+e.id+'\', event); "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*r+"px; padding-right:"+18*r+'px"><tbody><tr><td class="w2ui-node-dots" nowrap="nowrap" onclick="w2ui[\''+c.name+"'].toggle('"+e.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(e.nodes.length>0?e.expanded?"-":"+":e.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap="nowrap">'+s+(e.count||0===e.count?'<div class="w2ui-node-count">'+e.count+"</div>":"")+'<div class="w2ui-node-caption">'+o+'</div></td></tr></tbody></table></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>',c.flat&&(t='<div class="w2ui-node w2ui-level-'+r+" "+(e.selected?"w2ui-selected":"")+" "+(e.disabled?"w2ui-disabled":"")+'" id="node_'+e.id+'" style="'+(e.hidden?"display: none;":"")+"\"    onmouseover=\"jQuery(this).find('.w2ui-node-data').w2tag(w2utils.base64decode('"+w2utils.base64encode(o+(e.count||0===e.count?' - <span class="w2ui-node-count">'+e.count+"</span>":""))+"'),                { id: '"+e.id+"', left: -5 })\"    onmouseout=\"jQuery(this).find('.w2ui-node-data').w2tag(null, { id: '"+e.id+"' })\"    ondblclick=\"w2ui['"+c.name+"'].dblClick('"+e.id+"', event);\"    oncontextmenu=\"w2ui['"+c.name+"'].contextMenu('"+e.id+"', event);\"    onClick=\"w2ui['"+c.name+"'].click('"+e.id+'\', event); "><div class="w2ui-node-data w2ui-node-flat">'+s+'</div></div><div class="w2ui-node-sub" id="node_'+e.id+'_sub" style="'+e.style+";"+(!e.hidden&&e.expanded?"":"display: none;")+'"></div>')}return t}var n=(new Date).getTime(),s=this.trigger({phase:"before",type:"refresh",target:null!=t?t:this.name,fullRefresh:null==t});if(s.isCancelled!==!0){var r="";1==this.flatButton&&(r='<div class="w2ui-flat-'+(this.flat?"right":"left")+'" onclick="w2ui[\''+this.name+"'].goFlat()\"></div>"),""===this.topHTML&&""===r||(e(this.box).find(".w2ui-sidebar-top").html(this.topHTML+r),e(this.box).find(".w2ui-sidebar-div").css("top",e(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&(e(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),e(this.box).find(".w2ui-sidebar-div").css("bottom",e(this.box).find(".w2ui-sidebar-bottom").height()+"px")),e(this.box).find("> div").removeClass("w2ui-sidebar-flat").addClass(this.flat?"w2ui-sidebar-flat":"").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"});var o,a,l,c=this;if(null==t)o=this,l=".w2ui-sidebar-div";else{if(o=this.get(t),null==o)return;l="#node_"+w2utils.escapeId(o.id)+"_sub"}var d;if(o!==this){var u="#node_"+w2utils.escapeId(o.id);d=i(o),e(this.box).find(u).before('<div id="sidebar_'+this.name+'_tmp"></div>'),e(this.box).find(u).remove(),e(this.box).find(l).remove(),e("#sidebar_"+this.name+"_tmp").before(d),e("#sidebar_"+this.name+"_tmp").remove()}e(this.box).find(l).html("");for(var h=0;h<o.nodes.length;h++)if(a=o.nodes[h],d=i(a),e(this.box).find(l).append(d),0!==a.nodes.length)this.refresh(a.id);else{var p=this.trigger({phase:"before",type:"refresh",target:a.id});if(p.isCancelled===!0)return;this.trigger(e.extend(p,{phase:"after"}))}return this.trigger(e.extend(s,{phase:"after"})),(new Date).getTime()-n}},resize:function(){var t=(new Date).getTime(),i=this.trigger({phase:"before",type:"resize",target:this.name});if(i.isCancelled!==!0)return e(this.box).css("overflow","hidden"),e(this.box).find("> div").css({width:e(this.box).width()+"px",height:e(this.box).height()+"px"}),this.trigger(e.extend(i,{phase:"after"})),(new Date).getTime()-t},destroy:function(){var t=this.trigger({phase:"before",type:"destroy",target:this.name});t.isCancelled!==!0&&(e(this.box).find("> div > div.w2ui-sidebar-div").length>0&&e(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),w2utils.lock.apply(window,i)},unlock:function(e){w2utils.unlock(this.box,e)}},e.extend(t.prototype,w2utils.event),w2obj.sidebar=t}(jQuery),function(e){var t=function(t){this.el=null,this.helpers={},this.type=t.type||"text",this.options=e.extend(!0,{},t),this.onSearch=t.onSearch||null,this.onRequest=t.onRequest||null,this.onLoad=t.onLoad||null,this.onError=t.onError||null,this.onClick=t.onClick||null,this.onAdd=t.onAdd||null,this.onNew=t.onNew||null,this.onRemove=t.onRemove||null,this.onMouseOver=t.onMouseOver||null,this.onMouseOut=t.onMouseOut||null,this.onIconClick=t.onIconClick||null,this.onScroll=t.onScroll||null,this.tmp={},delete this.options.type,delete this.options.onSearch,delete this.options.onRequest,delete this.options.onLoad,delete this.options.onError,delete this.options.onClick,delete this.options.onMouseOver,delete this.options.onMouseOut,delete this.options.onIconClick,delete this.options.onScroll,e.extend(!0,this,w2obj.field)};e.fn.w2field=function(i,n){if(0!==this.length){if(0===arguments.length){var s=e(this).data("w2field");return s}return"string"==typeof i&&"object"==typeof n&&(i=e.extend(!0,{},n,{type:i})),"string"==typeof i&&null==n&&(i={type:i}),i.type=String(i.type).toLowerCase(),this.each(function(n,s){var r=e(s).data("w2field");if(null==r){var r=new t(i);return e.extend(r,{handlers:[]}),s&&(r.el=e(s)[0]),r.init(),e(s).data("w2field",r),r}if(r.clear(),"clear"!=i.type){var r=new t(i);return e.extend(r,{handlers:[]}),s&&(r.el=e(s)[0]),r.init(),e(s).data("w2field",r),r}})}var r=t.prototype;if(r[i])return r[i].apply(r,Array.prototype.slice.call(arguments,1))},t.prototype={custom:{},addType:function(e,t){return e=String(e).toLowerCase(),this.custom[e]=t,!0},removeType:function(e){return e=String(e).toLowerCase(),!!this.custom[e]&&(delete this.custom[e],!0)},init:function(){var t,i=this,n=this.options;if("function"==typeof this.custom[this.type])return void this.custom[this.type].call(this,n);if(["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())==-1)return void console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":t={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=e.extend(!0,{},t,n),n=this.options,n.numberRE=new RegExp("["+n.groupSymbol+"]","g"),n.moneyRE=new RegExp("["+n.currencyPrefix+n.currencySuffix+n.groupSymbol+"]","g"),n.percentRE=new RegExp("["+n.groupSymbol+"%]","g"),["text","alphanumeric","hex","bin"].indexOf(this.type)!=-1&&(n.arrows=!1,n.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":t={prefix:"#",suffix:'<div style="width: '+(parseInt(e(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,transparent:!0},e.extend(n,t),this.addPrefix(),this.addSuffix(),e(this.el).attr("maxlength",6),""!==e(this.el).val()&&setTimeout(function(){i.change()},1);break;case"date":t={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"time":t={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"datetime":t={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.placeholder||n.format);break;case"list":case"combo":if(t={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},n.items=this.normMenu(n.items),"list"==this.type){if(t.openOnFocus=!0,e(this.el).addClass("w2ui-select"),!e.isPlainObject(n.selected)&&n.items)for(var s=0;s<n.items.length;s++){var r=n.items[s];if(r&&r.id==n.selected){n.selected=e.extend(!0,{},r);break}}this.watchSize()}n=e.extend({},t,n,{align:"both",altRows:!0}),this.options=n,e.isPlainObject(n.selected)||(n.selected={}),e(this.el).data("selected",n.selected),n.url&&(n.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){i.refresh()},10),e(this.el).attr("autocomplete","off"),null!=n.selected.text&&e(this.el).val(n.selected.text);break;case"enum":t={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},n=e.extend({},t,n,{align:"both",suffix:"",altRows:!0}),n.items=this.normMenu(n.items),n.selected=this.normMenu(n.selected),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),n.url&&(n.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":t={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},n=e.extend({},t,n,{align:"both",altRows:!0}),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(e){i.change.call(i,e)},onClick:function(e){i.click.call(i,e)},onFocus:function(e){i.focus.call(i,e)},onBlur:function(e){i.blur.call(i,e)},onKeydown:function(e){i.keyDown.call(i,e)},onKeyup:function(e){i.keyUp.call(i,e)},onKeypress:function(e){i.keyPress.call(i,e)}},e(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(e.Event("change"))},watchSize:function(){var t=this,i=e(t.el).data("tmp")||{};i.sizeTimer=setInterval(function(){e(t.el).parents("body").length>0?t.resize():clearInterval(i.sizeTimer)},200),e(t.el).data("tmp",i)},get:function(){var t;return t=["list","enum","file"].indexOf(this.type)!=-1?e(this.el).data("selected"):e(this.el).val()},set:function(t,i){if(["list","enum","file"].indexOf(this.type)!=-1){if("list"!=this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(t),e(this.el).change();else{var n="enum"==this.type?[t]:t;e(this.el).data("selected",n).change()}this.refresh()}else e(this.el).val(t)},setIndex:function(t,i){if(["list","enum"].indexOf(this.type)!=-1){var n=this.options.items;if(n&&n[t]){if("list"!=this.type&&i)null==e(this.el).data("selected")&&e(this.el).data("selected",[]),e(this.el).data("selected").push(n[t]),e(this.el).change();else{var s="enum"==this.type?[n[t]]:n[t];e(this.el).data("selected",s).change()}return this.refresh(),!0}}return!1},clear:function(){var t=this.options;["money","currency"].indexOf(this.type)!=-1&&e(this.el).val(e(this.el).val().replace(t.moneyRE,"")),"percent"==this.type&&e(this.el).val(e(this.el).val().replace(/%/g,"")),"color"==this.type&&e(this.el).removeAttr("maxlength"),"list"==this.type&&e(this.el).removeClass("w2ui-select"),this.type="clear";var i=e(this.el).data("tmp");if(this.tmp){null!=i&&(e(this.el).height("auto"),i&&i["old-padding-left"]&&e(this.el).css("padding-left",i["old-padding-left"]),
i&&i["old-padding-right"]&&e(this.el).css("padding-right",i["old-padding-right"]),i&&i["old-background-color"]&&e(this.el).css("background-color",i["old-background-color"]),i&&i["old-border-color"]&&e(this.el).css("border-color",i["old-border-color"]),clearInterval(i.sizeTimer)),e(this.el).val(this.clean(e(this.el).val())).removeClass("w2field").removeData().off(".w2field");for(var n in this.helpers)e(this.helpers[n]).remove();this.helpers={}}},refresh:function(){var t=this,i=this.options,n=e(this.el).data("selected"),s=(new Date).getTime();if(["list"].indexOf(this.type)!=-1&&(e(t.el).parent().css("white-space","nowrap"),t.helpers.prefix&&t.helpers.prefix.hide(),setTimeout(function(){if(t.helpers.focus){!e.isEmptyObject(n)&&i.icon?(i.prefix='<span class="w2ui-icon '+i.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+i.iconStyle+'"></span>',t.addPrefix()):(i.prefix="",t.addPrefix());var s=t.helpers.focus.find("input");""===e(s).val()?(e(s).css("text-indent","-9999em").prev().css("opacity",0),e(t.el).val(n&&null!=n.text?w2utils.lang(n.text):"")):(e(s).css("text-indent",0).prev().css("opacity",1),e(t.el).val(""),setTimeout(function(){t.helpers.prefix&&t.helpers.prefix.hide();var n="position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;";i.icon?(e(s).css("margin-left","17px"),e(t.helpers.focus).find(".icon-search").attr("style",n+"width: 11px !important; opacity: 1; display: block")):(e(s).css("margin-left","0px"),e(t.helpers.focus).find(".icon-search").attr("style",n+"width: 0px !important; opacity: 0; display: none"))},1)),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout(function(){e(t.helpers.prefix).css("opacity","0.6"),e(t.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){e(t.helpers.prefix).css("opacity","1"),e(t.helpers.suffix).css("opacity","1")},1)}},1)),["enum","file"].indexOf(this.type)!=-1){var r="";if(n)for(var o=0;o<n.length;o++){var a=n[o],l="";l="function"==typeof i.renderItem?i.renderItem(a,o,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+o+'">&#160;&#160;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+o+'">&#160;&#160;</div>'+("enum"==t.type?a.text:a.name+'<span class="file-size"> - '+w2utils.formatSize(a.size)+"</span>"),r+='<li index="'+o+'" style="max-width: '+parseInt(i.maxWidth)+"px; "+(a.style?a.style:"")+'">'+l+"</li>"}var c=t.helpers.multi,d=c.find("ul");if(c.attr("style",c.attr("style")+";"+i.style),e(t.el).css("z-index","-1"),e(t.el).prop("readonly")||e(t.el).prop("disabled")?setTimeout(function(){c[0].scrollTop=0,c.addClass("w2ui-readonly").find("li").css("opacity","0.9").parent().find("li.nomouse").hide().find("input").prop("readonly",!0).parents("ul").find(".w2ui-list-remove").hide()},1):setTimeout(function(){c.removeClass("w2ui-readonly").find("li").css("opacity","1").parent().find("li.nomouse").show().find("input").prop("readonly",!1).parents("ul").find(".w2ui-list-remove").show()},1),c.find(".w2ui-enum-placeholder").remove(),d.find("li").not("li.nomouse").remove(),""!==r)d.prepend(r);else if(null!=e(t.el).attr("placeholder")&&""===c.find("input").val()){var u="padding-top: "+e(this.el).css("padding-top")+";padding-left: "+e(this.el).css("padding-left")+"; box-sizing: "+e(this.el).css("box-sizing")+"; line-height: "+e(this.el).css("line-height")+"; font-size: "+e(this.el).css("font-size")+"; font-family: "+e(this.el).css("font-family")+"; ";c.prepend('<div class="w2ui-enum-placeholder" style="'+u+'">'+e(t.el).attr("placeholder")+"</div>")}c.off("scroll.w2field").on("scroll.w2field",function(i){var n=t.trigger({phase:"before",type:"scroll",target:t.el,originalEvent:i});n.isCancelled!==!0&&t.trigger(e.extend(n,{phase:"after"}))}).find("li").data("mouse","out").on("click",function(i){var s="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI"),r=n[e(s).attr("index")];if(!e(s).hasClass("nomouse"))if(i.stopPropagation(),e(i.target).hasClass("w2ui-list-remove")){if(e(t.el).prop("readonly")||e(t.el).prop("disabled"))return;var o=t.trigger({phase:"before",type:"remove",target:t.el,originalEvent:i.originalEvent,item:r});if(o.isCancelled===!0)return;e().w2overlay(),n.splice(e(i.target).attr("index"),1),e(t.el).trigger("change"),e(i.target).parent().fadeOut("fast"),setTimeout(function(){t.refresh(),t.trigger(e.extend(o,{phase:"after"}))},300)}else{var o=t.trigger({phase:"before",type:"click",target:t.el,originalEvent:i.originalEvent,item:r});if(o.isCancelled===!0)return;if("file"==t.type){var a="";/image/i.test(r.type)&&(a='<div style="padding: 3px;">    <img src="'+(r.content?"data:"+r.type+";base64,"+r.content:"")+'" style="max-width: 300px;"         onload="var w = jQuery(this).width(); var h = jQuery(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) jQuery(this).width(300);            if (w < h && h > 300) jQuery(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');var l='style="padding: 3px; text-align: right; color: #777;"',c='style="padding: 3px"';a+='<div style="padding: 8px;">    <table cellpadding="2"><tbody>    <tr><td '+l+">"+w2utils.lang("Name")+":</td><td "+c+">"+r.name+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Size")+":</td><td "+c+">"+w2utils.formatSize(r.size)+"</td></tr>    <tr><td "+l+">"+w2utils.lang("Type")+":</td><td "+c+'>        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap="nowrap";">'+r.type+"</span>    </td></tr>    <tr><td "+l+">"+w2utils.lang("Modified")+":</td><td "+c+">"+w2utils.date(r.modified)+"</td></tr>    </tbody></table></div>",e("#w2ui-overlay").remove(),e(s).w2overlay(a)}t.trigger(e.extend(o,{phase:"after"}))}}).on("mouseover",function(i){var s="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");if(!e(s).hasClass("nomouse")){if("out"==e(s).data("mouse")){var r=n[e(i.target).attr("index")],o=t.trigger({phase:"before",type:"mouseOver",target:t.el,originalEvent:i.originalEvent,item:r});if(o.isCancelled===!0)return;t.trigger(e.extend(o,{phase:"after"}))}e(s).data("mouse","over")}}).on("mouseout",function(i){var s="LI"==i.target.tagName.toUpperCase()?i.target:e(i.target).parents("LI");e(s).hasClass("nomouse")||(e(s).data("mouse","leaving"),setTimeout(function(){if("leaving"==e(s).data("mouse")){e(s).data("mouse","out");var r=n[e(i.target).attr("index")],o=t.trigger({phase:"before",type:"mouseOut",target:t.el,originalEvent:i.originalEvent,item:r});if(o.isCancelled===!0)return;t.trigger(e.extend(o,{phase:"after"}))}},0))}),e(this.el).height("auto");var h=e(c).find("> div.w2ui-multi-items").height()+2*w2utils.getSize(c,"+height");h<26&&(h=26),h>i.maxHeight&&(h=i.maxHeight),c.length>0&&(c[0].scrollTop=1e3);var p=w2utils.getSize(e(this.el),"height")-2;if(p>h&&(h=p),e(c).css({height:h+"px",overflow:h==i.maxHeight?"auto":"hidden"}),h<i.maxHeight&&e(c).prop("scrollTop",0),e(this.el).css({height:h+2+"px"}),"enum"==t.type){var f=t.helpers.multi.find("input");f.width(8*(f.val().length+2)+"px")}}return(new Date).getTime()-s},reset:function(){var e=this.type;this.clear(),this.type=e,this.init()},resize:function(){var t=this,i=e(t.el).width(),n=e(t.el).height();if(!(t.tmp.current_width==i&&n>0)){var s=this.helpers.focus,r=this.helpers.multi,o=this.helpers.suffix,a=this.helpers.prefix;if(s&&s.width(e(t.el).width()),r){var l=w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10);e(r).width(l)}o&&(t.options.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(e(t.el).height())-6)/2+'px;"></div>',t.addSuffix()),a&&t.addPrefix(),t.tmp.current_width=i}},clean:function(t){if("number"==typeof t)return t;var i=this.options;return t=String(t).trim(),["int","float","money","currency","percent"].indexOf(this.type)!=-1&&("string"==typeof t&&(i.autoFormat&&["money","currency"].indexOf(this.type)!=-1&&(t=String(t).replace(i.moneyRE,"")),i.autoFormat&&"percent"==this.type&&(t=String(t).replace(i.percentRE,"")),i.autoFormat&&["int","float"].indexOf(this.type)!=-1&&(t=String(t).replace(i.numberRE,"")),t=t.replace(/\s+/g,"").replace(w2utils.settings.groupSymbol,"").replace(w2utils.settings.decimalSymbol,".")),parseFloat(t)==t&&(null!=i.min&&t<i.min&&(t=i.min,e(this.el).val(i.min)),null!=i.max&&t>i.max&&(t=i.max,e(this.el).val(i.max))),t=""!==t&&w2utils.isFloat(t)?Number(t):""),t},format:function(e){var t=this.options;if(t.autoFormat&&""!==e)switch(this.type){case"money":case"currency":e=w2utils.formatNumber(e,t.currencyPrecision,t.groupSymbol),""!==e&&(e=t.currencyPrefix+e+t.currencySuffix);break;case"percent":e=w2utils.formatNumber(e,t.precision,t.groupSymbol),""!==e&&(e+="%");break;case"float":e=w2utils.formatNumber(e,t.precision,t.groupSymbol);break;case"int":e=w2utils.formatNumber(e,0,t.groupSymbol)}return e},change:function(t){var i=this,n=i.options;if(["int","float","money","currency","percent"].indexOf(this.type)!=-1){var s=e(this.el).val(),r=this.format(this.clean(e(this.el).val()));if(""!==s&&s!=r)return e(this.el).val(r).change(),t.stopPropagation(),t.preventDefault(),!1}if("color"==this.type){var o="#"+e(this.el).val();6!=e(this.el).val().length&&3!=e(this.el).val().length&&(o=""),e(this.el).next().find("div").css("background-color",o),e(i.el).is(":focus")&&this.updateOverlay()}if(["list","enum","file"].indexOf(this.type)!=-1&&(i.refresh(),setTimeout(function(){i.refresh()},5)),["date","time","datetime"].indexOf(this.type)!=-1){var a=parseInt(i.el.value);w2utils.isInt(i.el.value)&&a>3e3&&("time"==this.type&&e(i.el).val(w2utils.formatTime(new Date(a),n.format)).change(),"date"==this.type&&e(i.el).val(w2utils.formatDate(new Date(a),n.format)).change(),"datetime"==this.type&&e(i.el).val(w2utils.formatDateTime(new Date(a),n.format)).change())}},click:function(t){t.stopPropagation(),["list","combo","enum"].indexOf(this.type)!=-1&&(e(this.el).is(":focus")||this.focus(t)),["date","time","color","datetime"].indexOf(this.type)!=-1&&this.updateOverlay()},focus:function(t){var i=this;this.options;if(["color","date","time","datetime"].indexOf(i.type)!==-1){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),setTimeout(function(){i.updateOverlay()},150)}if(["list","combo","enum"].indexOf(i.type)!=-1){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),i.resize(),setTimeout(function(){return"list"==i.type&&e(i.el).is(":focus")?void e(i.helpers.focus).find("input").focus():(i.search(),void setTimeout(function(){i.updateOverlay()},1))},1)}"file"==i.type&&e(i.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(t){var i=this,n=i.options,s=e(i.el).val().trim();["color","date","time","list","combo","enum","datetime"].indexOf(i.type)!=-1&&e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),["int","float","money","currency","percent"].indexOf(i.type)!=-1&&(""===s||i.checkType(s)||(e(i.el).val("").change(),n.silent===!1&&(e(i.el).w2tag("Not a valid number"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),["date","time","datetime"].indexOf(i.type)!=-1&&(""===s||i.inRange(i.el.value)?"date"!=i.type||""===s||w2utils.isDate(i.el.value,n.format)?"time"!=i.type||""===s||w2utils.isTime(i.el.value)?"datetime"!=i.type||""===s||w2utils.isDateTime(i.el.value,n.format)||(e(i.el).val("").removeData("selected").change(),n.silent===!1&&(e(i.el).w2tag("Not a valid date"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),n.silent===!1&&(e(i.el).w2tag("Not a valid time"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),n.silent===!1&&(e(i.el).w2tag("Not a valid date"),setTimeout(function(){e(i.el).w2tag("")},3e3))):(e(i.el).val("").removeData("selected").change(),n.silent===!1&&(e(i.el).w2tag("Not in range"),setTimeout(function(){e(i.el).w2tag("")},3e3)))),"enum"==i.type&&e(i.helpers.multi).find("input").val("").width(20),"file"==i.type&&e(i.helpers.multi).css({outline:"none"})},keyPress:function(e){var t=this;t.options;if(["int","float","money","currency","percent","hex","bin","color","alphanumeric"].indexOf(t.type)!=-1){if(e.metaKey||e.ctrlKey||e.altKey||e.charCode!=e.keyCode&&e.keyCode>0)return;var i=String.fromCharCode(e.charCode);if(!t.checkType(i,!0)&&13!=e.keyCode)return e.preventDefault(),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1}["date","time","datetime"].indexOf(t.type)!=-1&&9!==e.keyCode&&setTimeout(function(){t.updateOverlay()},1)},keyDown:function(t,i){var n=this,s=n.options,r=t.keyCode||i&&i.keyCode;if(["int","float","money","currency","percent"].indexOf(n.type)!=-1){if(!s.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var o=!1,a=parseFloat(e(n.el).val().replace(s.moneyRE,""))||0,l=s.step;switch((t.ctrlKey||t.metaKey)&&(l=10),r){case 38:if(t.shiftKey)break;e(n.el).val(a+l<=s.max||null==s.max?Number((a+l).toFixed(12)):s.max).change(),o=!0;break;case 40:if(t.shiftKey)break;e(n.el).val(a-l>=s.min||null==s.min?Number((a-l).toFixed(12)):s.min).change(),o=!0}o&&(t.preventDefault(),setTimeout(function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length)},0))}if("date"==n.type){if(!s.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var o=!1,c=864e5,l=1;(t.ctrlKey||t.metaKey)&&(l=10);var d=w2utils.isDate(e(n.el).val(),s.format,!0);switch(d||(d=new Date,c=0),r){case 38:if(t.shiftKey)break;var u=w2utils.formatDate(d.getTime()+c,s.format);10==l&&(u=w2utils.formatDate(new Date(d.getFullYear(),d.getMonth()+1,d.getDate()),s.format)),e(n.el).val(u).change(),o=!0;break;case 40:if(t.shiftKey)break;var u=w2utils.formatDate(d.getTime()-c,s.format);10==l&&(u=w2utils.formatDate(new Date(d.getFullYear(),d.getMonth()-1,d.getDate()),s.format)),e(n.el).val(u).change(),o=!0}o&&(t.preventDefault(),setTimeout(function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length),n.updateOverlay()},0))}if("time"==n.type){if(!s.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var o=!1,l=t.ctrlKey||t.metaKey?60:1,a=e(n.el).val(),h=n.toMin(a)||n.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(r){case 38:if(t.shiftKey)break;h+=l,o=!0;break;case 40:if(t.shiftKey)break;h-=l,o=!0}o&&(e(n.el).val(n.fromMin(h)).change(),t.preventDefault(),setTimeout(function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length)},0))}if("datetime"==n.type){if(!s.keyboard||e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var o=!1,c=864e5,l=1;(t.ctrlKey||t.metaKey)&&(l=10);var p=e(n.el).val(),d=w2utils.isDateTime(p,this.options.format,!0);switch(d||(d=new Date,c=0),r){case 38:if(t.shiftKey)break;var u=w2utils.formatDateTime(d.getTime()+c,s.format);10==l&&(u=w2utils.formatDateTime(new Date(d.getFullYear(),d.getMonth()+1,d.getDate()),s.format)),e(n.el).val(u).change(),o=!0;break;case 40:if(t.shiftKey)break;var u=w2utils.formatDateTime(d.getTime()-c,s.format);10==l&&(u=w2utils.formatDateTime(new Date(d.getFullYear(),d.getMonth()-1,d.getDate()),s.format)),e(n.el).val(u).change(),o=!0}o&&(t.preventDefault(),setTimeout(function(){n.el.setSelectionRange(n.el.value.length,n.el.value.length),n.updateOverlay()},0))}if("color"==n.type){if(e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;if(86==t.keyCode&&(t.ctrlKey||t.metaKey)&&(e(n.el).prop("maxlength",7),setTimeout(function(){var t=e(n).val();"#"==t.substr(0,1)&&(t=t.substr(1)),w2utils.isHex(t)||(t=""),e(n).val(t).prop("maxlength",6).change()},20)),(t.ctrlKey||t.metaKey)&&!t.shiftKey){var f=null,g=null;switch(r){case 38:f="up";break;case 40:f="down";break;case 39:f="right";break;case 37:f="left"}n.el.nav&&null!=f&&(g=n.el.nav(f),e(n.el).val(g).change(),t.preventDefault())}}if(["list","combo","enum"].indexOf(n.type)!=-1){if(e(n.el).prop("readonly")||e(n.el).prop("disabled"))return;var m=e(n.el).data("selected"),v=e(n.el),w=!1;switch(["list","enum"].indexOf(n.type)!=-1&&("list"==n.type&&(v=e(n.helpers.focus).find("input")),"enum"==n.type&&(v=e(n.helpers.multi).find("input")),[37,38,39,40].indexOf(r)==-1&&setTimeout(function(){n.refresh()},1),86==t.keyCode&&(t.ctrlKey||t.metaKey)&&setTimeout(function(){n.refresh(),n.search(),n.request()},50)),r){case 27:"list"==n.type&&(""!==v.val()&&v.val(""),t.stopPropagation());break;case 37:case 39:break;case 13:if(0===e("#w2ui-overlay").length)break;var y=s.items[s.index];if("enum"==n.type)if(null!=y){var b=n.trigger({phase:"before",type:"add",target:n.el,originalEvent:t.originalEvent,item:y});if(b.isCancelled===!0)return;y=b.item,m.length>=s.max&&s.max>0&&m.pop(),delete y.hidden,delete n.tmp.force_open,m.push(y),e(n.el).change(),v.val("").width(20),n.refresh(),n.trigger(e.extend(b,{phase:"after"}))}else{y={id:v.val(),text:v.val()};var b=n.trigger({phase:"before",type:"new",target:n.el,originalEvent:t.originalEvent,item:y});if(b.isCancelled===!0)return;y=b.item,"function"==typeof n.onNew&&(m.length>=s.max&&s.max>0&&m.pop(),delete n.tmp.force_open,m.push(y),e(n.el).change(),v.val("").width(20),n.refresh()),n.trigger(e.extend(b,{phase:"after"}))}else y&&e(n.el).data("selected",y).val(y.text).change(),""===e(n.el).val()&&e(n.el).data("selected")&&e(n.el).removeData("selected").val("").change(),"list"==n.type&&(v.val(""),n.refresh()),n.tmp.force_hide=!0;break;case 8:case 46:if("enum"==n.type&&8==r&&""===v.val()&&m.length>0){var y=m[m.length-1],b=n.trigger({phase:"before",type:"remove",target:n.el,originalEvent:t.originalEvent,item:y});if(b.isCancelled===!0)return;m.pop(),e(n.el).trigger("change"),n.refresh(),n.trigger(e.extend(b,{phase:"after"}))}"list"==n.type&&""===v.val()&&(e(n.el).data("selected",{}).change(),n.refresh());break;case 38:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):0,s.index--;s.index>0&&s.items[s.index].hidden;)s.index--;if(0===s.index&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index++;w=!0;break;case 40:for(s.index=w2utils.isInt(s.index)?parseInt(s.index):-1,s.index++;s.index<s.items.length-1&&s.items[s.index].hidden;)s.index++;if(s.index==s.items.length-1&&s.items[s.index].hidden)for(;s.items[s.index]&&s.items[s.index].hidden;)s.index--;""===v.val()&&0===e("#w2ui-overlay").length?n.tmp.force_open=!0:w=!0}if(w)return s.index<0&&(s.index=0),s.index>=s.items.length&&(s.index=s.items.length-1),n.updateOverlay(w),t.preventDefault(),void setTimeout(function(){if("enum"==n.type){var e=v.get(0);e.setSelectionRange(e.value.length,e.value.length)}else if("list"==n.type){var e=v.get(0);e.setSelectionRange(e.value.length,e.value.length)}else n.el.setSelectionRange(n.el.value.length,n.el.value.length)},0);"enum"==n.type&&v.width(8*(v.val().length+2)+"px")}},keyUp:function(t){var i=this;if("color"==this.type&&86==t.keyCode&&(t.ctrlKey||t.metaKey)&&e(this).prop("maxlength",6),["list","combo","enum"].indexOf(this.type)!=-1){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;if([16,17,18,20,37,39,91].indexOf(t.keyCode)==-1){var n=e(this.helpers.focus).find("input");0===n.length&&(n=e(this.el));var s=this.trigger({phase:"before",type:"search",originalEvent:t,target:n,search:n.val()});if(s.isCancelled===!0)return;this.tmp.force_hide||this.request(),1==n.val().length&&this.refresh(),0!==e("#w2ui-overlay").length&&[38,40].indexOf(t.keyCode)!=-1||this.search(),this.trigger(e.extend(s,{phase:"after"}))}}},clearCache:function(){var e=this.options;e.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1},request:function(t){var i=this,n=this.options,s=e(i.el).val()||"";if(n.url){if("enum"==i.type){var r=e(i.helpers.multi).find("input");s=0===r.length?"":r.val()}if("list"==i.type){var r=e(i.helpers.focus).find("input");s=0===r.length?"":r.val()}if(0!==n.minLength&&s.length<n.minLength)return n.items=[],void this.updateOverlay();null==t&&(t=n.interval),null==i.tmp.xhr_search&&(i.tmp.xhr_search=""),null==i.tmp.xhr_total&&(i.tmp.xhr_total=-1),n.url&&e(i.el).prop("readonly")!==!0&&e(i.el).prop("disabled")!==!0&&(0===n.items.length&&0!==i.tmp.xhr_total||i.tmp.xhr_total==n.cacheMax&&s.length>i.tmp.xhr_search.length||s.length>=i.tmp.xhr_search.length&&s.substr(0,i.tmp.xhr_search.length)!=i.tmp.xhr_search||s.length<i.tmp.xhr_search.length)&&(i.tmp.xhr&&i.tmp.xhr.abort(),i.tmp.xhr_loading=!0,i.search(),clearTimeout(i.tmp.timeout),i.tmp.timeout=setTimeout(function(){var t=n.url,r={search:s,max:n.cacheMax};e.extend(r,n.postData);var o=i.trigger({phase:"before",type:"request",search:s,target:i.el,url:t,postData:r});if(o.isCancelled!==!0){t=o.url,r=o.postData;var a={type:"GET",url:t,data:r,dataType:"JSON"};n.method&&(a.type=n.method),"JSON"==w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),a.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(a.data={request:JSON.stringify(a.data)}),null!=n.method&&(a.type=n.method),i.tmp.xhr=e.ajax(a).done(function(t,o,a){var l=i.trigger({phase:"before",type:"load",target:i.el,search:r.search,data:t,xhr:a});if(l.isCancelled!==!0){if(t=l.data,"string"==typeof t&&(t=JSON.parse(t)),null==t.records&&null!=t.items&&(t.records=t.items,delete t.items),"success"!=t.status||!Array.isArray(t.records))return void console.log("ERROR: server did not return proper structure. It should return",{status:"success",records:[{id:1,text:"item"}]});t.records.length>n.cacheMax&&t.records.splice(n.cacheMax,1e5),null==n.recId&&null!=n.recid&&(n.recId=n.recid),(n.recId||n.recText)&&t.records.forEach(function(e){"string"==typeof n.recId&&(e.id=e[n.recId]),"function"==typeof n.recId&&(e.id=n.recId(e)),"string"==typeof n.recText&&(e.text=e[n.recText]),"function"==typeof n.recText&&(e.text=n.recText(e))}),i.tmp.xhr_loading=!1,i.tmp.xhr_search=s,i.tmp.xhr_total=t.records.length,n.items=i.normMenu(t.records),""===s&&0===t.records.length?i.tmp.emptySet=!0:i.tmp.emptySet=!1,i.search(),i.trigger(e.extend(l,{phase:"after"}))}}).fail(function(t,n,r){var o={status:n,error:r,rawResponseText:t.responseText},a=i.trigger({phase:"before",type:"error",target:i.el,search:s,error:o,xhr:t});if(a.isCancelled!==!0){if("abort"!=n){var l;try{l=e.parseJSON(t.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",records:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof l?l:t.responseText)}i.clearCache(),i.search(),i.trigger(e.extend(a,{phase:"after"}))}}),i.trigger(e.extend(o,{phase:"after"}))}},t))}},search:function(){var t=this,i=this.options,n=e(t.el).val(),s=t.el,r=[],o=e(t.el).data("selected");if("enum"==t.type){s=e(t.helpers.multi).find("input"),n=s.val();for(var a in o)o[a]&&r.push(o[a].id)}else if("list"==t.type){s=e(t.helpers.focus).find("input"),n=s.val();for(var a in o)o[a]&&r.push(o[a].id)}if(t.tmp.xhr_loading!==!0){for(var l=0,c=0;c<i.items.length;c++){var d=i.items[c];if(null!=i.compare)"function"==typeof i.compare&&(d.hidden=i.compare.call(this,d,n)===!1);else{var u="",h="";["is","begins"].indexOf(i.match)!=-1&&(u="^"),["is","ends"].indexOf(i.match)!=-1&&(h="$");try{var p=new RegExp(u+n+h,"i");p.test(d.text)||"..."==d.text?d.hidden=!1:d.hidden=!0}catch(e){}}i.filter===!1&&(d.hidden=!1),"enum"==t.type&&e.inArray(d.id,r)!=-1&&(d.hidden=!0),d.hidden!==!0&&(l++,delete d.hidden)}for(i.index=-1;i.items[i.index]&&i.items[i.index].hidden;)i.index++;l<=0&&(i.index=-1),i.spinner=!1,t.updateOverlay(),setTimeout(function(){var t=e("#w2ui-overlay").html()||"";i.markSearch&&t.indexOf("$.fn.w2menuHandler")!=-1&&e("#w2ui-overlay").w2marker(n)},1)}else i.items.splice(0,i.cacheMax),i.spinner=!0,t.updateOverlay()},updateOverlay:function(t){var i=this,n=this.options;if("color"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e(this.el).w2color({color:e(this.el).val(),transparent:n.transparent},function(t){null!=t&&e(i.el).val(t).change()})}if("date"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}});var s,r,o=w2utils.isDate(e(i.el).val(),i.options.format,!0);o&&(s=o.getMonth()+1,r=o.getFullYear()),function t(n,s){e("#w2ui-overlay > div > div").html(i.getMonthHTML(n,s,e(i.el).val())),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(e(this).next().hasClass("w2ui-calendar-jump"))e(this).next().remove();else{var n,s;e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout(function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),s=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),null!=n&&null!=s&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){t(parseInt(s)+1,n)},100))}),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),e("#w2ui-overlay .w2ui-date").on("mousedown",function(){var t=e(this).attr("date");e(i.el).val(t).change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)}),e("#w2ui-overlay .previous").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])}),e("#w2ui-overlay .next").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])})}(s,r)}if("time"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var a="h24"==this.options.format;e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",function(t){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var n=e(this).attr("hour");e(i.el).val((n>12&&!a?n-12:n)+":00"+(a?"":n<12?" am":" pm")).change()}),null==this.options.noMinutes||this.options.noMinutes===!1?e("#w2ui-overlay .w2ui-time").on("mouseup",function(){var t=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(t)),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var n=e(this).attr("min");e(i.el).val((t>12&&!a?t-12:t)+":"+(n<10?0:"")+n+(a?"":t<12?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):e("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("datetime"==this.type){if(e(i.el).prop("readonly")||e(i.el).prop("disabled"))return;e("#w2ui-overlay .w2ui-time").length>0&&e("#w2ui-overlay")[0].hide(),0===e("#w2ui-overlay").length&&e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#f5f5f5"}});var s,r,o=w2utils.isDateTime(e(i.el).val(),i.options.format,!0);o&&(s=o.getMonth()+1,r=o.getFullYear());var l=null;!function t(s,r){e("#w2ui-overlay > div > div").html(i.getMonthHTML(s,r,e(i.el).val())+(n.btn_now?'<div class="w2ui-calendar-now now">'+w2utils.lang("Current Date & Time")+"</div>":"")),e("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(e(this).next().hasClass("w2ui-calendar-jump"))e(this).next().remove();else{var n,s;e(this).after('<div class="w2ui-calendar-jump" style=""></div>'),e(this).next().hide().html(i.getYearHTML()).fadeIn(200),setTimeout(function(){e("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",function(){e(this).hasClass("w2ui-jump-month")&&(e(this).parent().find(".w2ui-jump-month").removeClass("selected"),e(this).addClass("selected"),s=e(this).attr("name")),e(this).hasClass("w2ui-jump-year")&&(e(this).parent().find(".w2ui-jump-year").removeClass("selected"),e(this).addClass("selected"),n=e(this).attr("name")),null!=n&&null!=s&&(e("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){t(parseInt(s)+1,n)},100))}),e("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",2e3)},1)}}),e("#w2ui-overlay .w2ui-date").on("mousedown",function(){var t=e(this).attr("date");e(i.el).val(t).change(),e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),l=new Date(e(this).attr("data-date"))}).on("mouseup",function(){var t,n;e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});"h24"==i.options.format;e("#w2ui-overlay > div").html(i.getHourHTML()),e("#w2ui-overlay .w2ui-time").on("mousedown",function(n){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),t=e(this).attr("hour"),l.setHours(t);var s=w2utils.formatDateTime(l,i.options.format);e(i.el).val(s).change()}),null==i.options.noMinutes||i.options.noMinutes===!1?e("#w2ui-overlay .w2ui-time").on("mouseup",function(){var s=e(this).attr("hour");e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),e(i.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}}),e("#w2ui-overlay > div").html(i.getMinHTML(s)),e("#w2ui-overlay .w2ui-time").on("mousedown",function(){e(this).css({"background-color":"#B6D5FB","border-color":"#aaa"}),n=e(this).attr("min"),l.setHours(t,n);var s=w2utils.formatDateTime(l,i.options.format);e(i.el).val(s).change()}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}):e("#w2ui-overlay .w2ui-time").on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}),e("#w2ui-overlay .previous").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])-1,t(e[0],e[1])}),e("#w2ui-overlay .next").on("mousedown",function(){var e=i.options.current.split("/");e[0]=parseInt(e[0])+1,t(e[0],e[1])}),e("#w2ui-overlay .now").on("mousedown",function(){var t=w2utils.formatDateTime(new Date,i.options.format);return e(i.el).val(t).change(),!1}).on("mouseup",function(){setTimeout(function(){e("#w2ui-overlay").length>0&&e("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}(s,r)}if(["list","combo","enum"].indexOf(this.type)!=-1){var c=this.el,d=this.el;if("enum"==this.type&&(c=e(this.helpers.multi),d=e(c).find("input")),"list"==this.type){var u=e(d).data("selected");e.isPlainObject(u)&&!e.isEmptyObject(u)&&n.index==-1&&n.items.forEach(function(e,t){e.id==u.id&&(n.index=t)}),d=e(this.helpers.focus).find("input")}if(e(d).is(":focus")){if(n.openOnFocus===!1&&""===e(d).val()&&i.tmp.force_open!==!0)return void e().w2overlay();if(i.tmp.force_hide)return e().w2overlay(),void setTimeout(function(){delete i.tmp.force_hide},1);""!==e(d).val()&&delete i.tmp.force_open;var h=w2utils.lang("No matches");null!=n.url&&e(d).val().length<n.minLength&&i.tmp.emptySet!==!0&&(h=n.minLength+" "+w2utils.lang("letters or more...")),null!=n.url&&""===e(d).val()&&i.tmp.emptySet!==!0&&(h=w2utils.lang("Type to search...")),null==n.url&&0===n.items.length&&(h=w2utils.lang("Empty list")),null!=n.msgNoItems&&(h=n.msgNoItems),"function"==h&&(h=h(n)),e(c).w2menu(t?"refresh-index":"refresh",e.extend(!0,{},n,{search:!1,render:n.renderDrop,
maxHeight:n.maxDropHeight,maxWidth:n.maxDropWidth,msgNoItems:h,onSelect:function(t){if("enum"==i.type){var s=e(i.el).data("selected");if(t.item){var r=i.trigger({phase:"before",type:"add",target:i.el,originalEvent:t.originalEvent,item:t.item});if(r.isCancelled===!0)return;s.length>=n.max&&n.max>0&&s.pop(),delete t.item.hidden,s.push(t.item),e(i.el).data("selected",s).change(),e(i.helpers.multi).find("input").val("").width(20),i.refresh(),e("#w2ui-overlay").length>0&&e("#w2ui-overlay")[0].hide(),i.trigger(e.extend(r,{phase:"after"}))}}else e(i.el).data("selected",t.item).val(t.item.text).change(),i.helpers.focus&&i.helpers.focus.find("input").val("")}}))}}},inRange:function(t,i){var n=!1;if("date"==this.type){var s=w2utils.isDate(t,this.options.format,!0);if(s){if(this.options.start||this.options.end){var r="string"==typeof this.options.start?this.options.start:e(this.options.start).val(),o="string"==typeof this.options.end?this.options.end:e(this.options.end).val(),a=w2utils.isDate(r,this.options.format,!0),l=w2utils.isDate(o,this.options.format,!0),c=new Date(s);a||(a=c),l||(l=c),c>=a&&c<=l&&(n=!0)}else n=!0;if(this.options.blocked&&e.inArray(t,this.options.blocked)!=-1&&(n=!1),null!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays&&void 0!=this.options.blockWeekDays.length)for(var d=this.options.blockWeekDays.length,u=0;u<d;u++)s.getDay()==this.options.blockWeekDays[u]&&(n=!1)}}else if("time"==this.type)if(this.options.start||this.options.end){var h=this.toMin(t),p=this.toMin(this.options.start),f=this.toMin(this.options.end);p||(p=h),f||(f=h),h>=p&&h<=f&&(n=!0)}else n=!0;else if("datetime"==this.type){var s=w2utils.isDateTime(t,this.options.format,!0);if(s){if(this.options.start||this.options.end){var a,l;if("object"==typeof this.options.start&&this.options.start instanceof Date)a=this.options.start;else{var r="string"==typeof this.options.start?this.options.start:e(this.options.start).val();a=""!==r.trim()?w2utils.isDateTime(r,this.options.format,!0):""}if("object"==typeof this.options.end&&this.options.end instanceof Date)l=this.options.end;else{var o="string"==typeof this.options.end?this.options.end:e(this.options.end).val();l=""!==o.trim()?w2utils.isDateTime(o,this.options.format,!0):""}var c=s;a||(a=c),l||(l=c),i&&a instanceof Date&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0)),c>=a&&c<=l&&(n=!0)}else n=!0;if(n&&this.options.blocked)for(var u=0;u<this.options.blocked.length;u++){var g=this.options.blocked[u];if("string"==typeof g&&(g=w2utils.isDateTime(g,this.options.format,!0)),"object"==typeof g&&g instanceof Date&&g.getFullYear()==s.getFullYear()&&g.getMonth()==s.getMonth()&&g.getDate()==s.getDate()){n=!1;break}}}}return n},checkType:function(e,t){var i=this;switch(i.type){case"int":return!(!t||["-",i.options.groupSymbol].indexOf(e)==-1)||w2utils.isInt(e.replace(i.options.numberRE,""));case"percent":e=e.replace(/%/g,"");case"float":return!(!t||["-",w2utils.settings.decimalSymbol,i.options.groupSymbol].indexOf(e)==-1)||w2utils.isFloat(e.replace(i.options.numberRE,""));case"money":case"currency":return!(!t||["-",i.options.decimalSymbol,i.options.groupSymbol,i.options.currencyPrefix,i.options.currencySuffix].indexOf(e)==-1)||w2utils.isFloat(e.replace(i.options.moneyRE,""));case"bin":return w2utils.isBin(e);case"hex":case"color":return w2utils.isHex(e);case"alphanumeric":return w2utils.isAlphaNumeric(e)}return!0},addPrefix:function(){var t=this;setTimeout(function(){if("clear"!==t.type){var i,n=e(t.el).data("tmp")||{};n["old-padding-left"]&&e(t.el).css("padding-left",n["old-padding-left"]),n["old-padding-left"]=e(t.el).css("padding-left"),e(t.el).data("tmp",n),t.helpers.prefix&&e(t.helpers.prefix).remove(),""!==t.options.prefix&&(e(t.el).before('<div class="w2ui-field-helper">'+t.options.prefix+"</div>"),i=e(t.el).prev(),i.css({color:e(t.el).css("color"),"font-family":e(t.el).css("font-family"),"font-size":e(t.el).css("font-size"),"padding-top":e(t.el).css("padding-top"),"padding-bottom":e(t.el).css("padding-bottom"),"padding-left":e(t.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(e(t.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(t.el).css("margin-bottom"),10)+1+"px","margin-left":e(t.el).css("margin-left"),"margin-right":0}).on("click",function(i){if(t.options.icon&&"function"==typeof t.onIconClick){var n=t.trigger({phase:"before",type:"iconClick",target:t.el,el:e(this).find("span.w2ui-icon")[0]});if(n.isCancelled===!0)return;t.trigger(e.extend(n,{phase:"after"}))}else"list"==t.type?e(t.helpers.focus).find("input").focus():e(t.el).focus()}),e(t.el).css("padding-left",i.width()+parseInt(e(t.el).css("padding-left"),10)+"px"),t.helpers.prefix=i)}},1)},addSuffix:function(){var t,i,n=this;setTimeout(function(){if("clear"!==n.type){var s=e(n.el).data("tmp")||{};if(s["old-padding-right"]&&e(n.el).css("padding-right",s["old-padding-right"]),s["old-padding-right"]=e(n.el).css("padding-right"),e(n.el).data("tmp",s),i=parseInt(e(n.el).css("padding-right"),10),n.options.arrows){n.helpers.arrows&&e(n.helpers.arrows).remove(),e(n.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&#160;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>');w2utils.getSize(n.el,"height");t=e(n.el).next(),t.css({color:e(n.el).css("color"),"font-family":e(n.el).css("font-family"),"font-size":e(n.el).css("font-size"),height:e(n.el).height()+parseInt(e(n.el).css("padding-top"),10)+parseInt(e(n.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(e(n.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(t.width()+parseInt(e(n.el).css("margin-right"),10)+12)+"px").on("mousedown",function(t){function i(){clearTimeout(r.data("_field_update_timer")),r.off("mouseup",i)}function s(i){e(n.el).focus(),n.keyDown(e.Event("keydown"),{keyCode:"up"==e(t.target).attr("type")?38:40}),i!==!1&&e("body").data("_field_update_timer",setTimeout(s,60))}var r=e("body");r.on("mouseup",i),r.data("_field_update_timer",setTimeout(s,700)),s(!1)}),i+=t.width()+12,e(n.el).css("padding-right",i+"px"),n.helpers.arrows=t}""!==n.options.suffix&&(n.helpers.suffix&&e(n.helpers.suffix).remove(),e(n.el).after('<div class="w2ui-field-helper">'+n.options.suffix+"</div>"),t=e(n.el).next(),t.css({color:e(n.el).css("color"),"font-family":e(n.el).css("font-family"),"font-size":e(n.el).css("font-size"),"padding-top":e(n.el).css("padding-top"),"padding-bottom":e(n.el).css("padding-bottom"),"padding-left":"3px","padding-right":e(n.el).css("padding-right"),"margin-top":parseInt(e(n.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(e(n.el).css("margin-bottom"),10)+1+"px"}).on("click",function(t){"list"==n.type?e(n.helpers.focus).find("input").focus():e(n.el).focus()}),t.css("margin-left","-"+(w2utils.getSize(t,"width")+parseInt(e(n.el).css("margin-right"),10)+2)+"px"),i+=t.width()+3,e(n.el).css("padding-right",i+"px"),n.helpers.suffix=t)}},1)},addFocus:function(){var t,i=this,n=(this.options,0);e(i.helpers.focus).remove();var s=e(i.el).attr("tabIndex");s&&s!=-1&&(i.el._tabIndex=s),i.el._tabIndex&&(s=i.el._tabIndex),null==s&&(s=-1);var r='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search" style="opacity: 0; display: none"></div>    <input type="text" autocomplete="off" tabIndex="'+s+'"/></div>';e(i.el).attr("tabindex",-1).before(r);var o=e(i.el).prev();i.helpers.focus=o,o.css({width:e(i.el).width(),"margin-top":e(i.el).css("margin-top"),"margin-left":parseInt(e(i.el).css("margin-left"))+parseInt(e(i.el).css("padding-left"))+"px","margin-bottom":e(i.el).css("margin-bottom"),"margin-right":e(i.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:e(i.el).css("padding-top"),"padding-left":0,"margin-left":n>0?n+6:0,"background-color":"transparent"}),o.find("input").on("click",function(t){0===e("#w2ui-overlay").length&&i.focus(t),t.stopPropagation()}).on("focus",function(n){t=e(i.el).attr("placeholder"),e(i.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(this).val(""),e(i.el).triggerHandler("focus"),n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}).on("blur",function(n){e(i.el).css("outline","none"),e(this).val(""),i.refresh(),e(i.el).triggerHandler("blur"),n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,null!=t&&e(i.el).attr("placeholder",t)}).on("keydown",function(n){var s=this;i.keyDown(n),setTimeout(function(){""===s.value?e(i.el).attr("placeholder",t):e(i.el).attr("placeholder","")},10)}).on("keyup",function(e){i.keyUp(e)}).on("keypress",function(e){i.keyPress(e)}),o.on("click",function(t){e(this).find("input").focus()}),i.refresh()},addMulti:function(){var t=this;this.options;e(t.helpers.multi).remove();var i="",n="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+e(t.el).css("margin-left")+"; margin-right   : "+e(t.el).css("margin-right")+"; width          : "+(w2utils.getSize(t.el,"width")-parseInt(e(t.el).css("margin-left"),10)-parseInt(e(t.el).css("margin-right"),10))+"px;";if("enum"==t.type){var s=e(t.el).attr("tabIndex");s&&s!=-1&&(t.el._tabIndex=s),t.el._tabIndex&&(s=t.el._tabIndex),null==s&&(s=-1),i='<div class="w2ui-field-helper w2ui-list" style="'+n+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px; margin: -3px 0 0; padding: 2px 0; border-color: white" autocomplete="off"'+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+' tabindex="'+s+'"/>        </li>    </ul>    </div></div>'}"file"==t.type&&(i='<div class="w2ui-field-helper w2ui-list" style="'+n+'; box-sizing: border-box">   <div style="position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px;">       <input class="file-input" type="file" style="width: 100%; height: 100%; opacity: 0;" name="attachment" multiple tabindex="-1"'+(e(t.el).prop("readonly")?' readonly="readonly"':"")+(e(t.el).prop("disabled")?' disabled="disabled"':"")+(e(t.el).attr("accept")?' accept="'+e(t.el).attr("accept")+'"':"")+'/>   </div>    <div style="position: absolute; padding: 0px; margin: 0px; display: inline-block" class="w2ui-multi-items">        <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    </div></div>');var r=e(t.el).data("tmp")||{};r["old-background-color"]=e(t.el).css("background-color"),r["old-border-color"]=e(t.el).css("border-color"),e(t.el).data("tmp",r),e(t.el).before(i).css({"background-color":"transparent","border-color":"transparent"});var o=e(t.el).prev();t.helpers.multi=o,"enum"==t.type&&(e(t.el).attr("tabindex",-1),o.find("input").on("click",function(i){0===e("#w2ui-overlay").length&&t.focus(i),e(t.el).triggerHandler("click")}).on("focus",function(i){e(o).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"}),e(t.el).triggerHandler("focus"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("blur",function(i){e(o).css("outline","none"),e(t.el).triggerHandler("blur"),i.stopPropagation?i.stopPropagation():i.cancelBubble=!0}).on("keyup",function(e){t.keyUp(e)}).on("keydown",function(e){t.keyDown(e)}).on("keypress",function(e){t.keyPress(e)}),o.on("click",function(t){e(this).find("input").focus()})),"file"==t.type&&(e(t.el).css("outline","none"),o.on("click",function(i){e(t.el).focus(),e(t.el).prop("readonly")||e(t.el).prop("disabled")||(t.blur(i),t.resize(),setTimeout(function(){o.find("input").click()},10))}).on("dragenter",function(i){e(t.el).prop("readonly")||e(t.el).prop("disabled")||e(o).addClass("w2ui-file-dragover")}).on("dragleave",function(i){if(!e(t.el).prop("readonly")&&!e(t.el).prop("disabled")){var n=e(i.target).parents(".w2ui-field-helper");0===n.length&&e(o).removeClass("w2ui-file-dragover")}}).on("drop",function(i){if(!e(t.el).prop("readonly")&&!e(t.el).prop("disabled")){e(o).removeClass("w2ui-file-dragover");for(var n=i.originalEvent.dataTransfer.files,s=0,r=n.length;s<r;s++)t.addFile.call(t,n[s]);i.preventDefault(),i.stopPropagation()}}).on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),o.find("input").on("click",function(e){e.stopPropagation()}).on("change",function(){if("undefined"!=typeof this.files)for(var e=0,i=this.files.length;e<i;e++)t.addFile.call(t,this.files[e])})),t.refresh()},addFile:function(t){var i,n=this,s=this.options,r=e(n.el).data("selected"),o={name:t.name,type:t.type,modified:t.lastModifiedDate,size:t.size,content:null,file:t},a=0,l=0;if(r)for(var c=0;c<r.length;c++){if(r[c].name==t.name&&r[c].size==t.size)return;a+=r[c].size,l++}var d=n.trigger({phase:"before",type:"add",target:n.el,file:o,total:l,totalSize:a});if(d.isCancelled!==!0){if(0!==s.maxFileSize&&o.size>s.maxFileSize)return i="Maximum file size is "+w2utils.formatSize(s.maxFileSize),s.silent===!1&&e(n.el).w2tag(i),void console.log("ERROR: "+i);if(0!==s.maxSize&&a+o.size>s.maxSize)return i="Maximum total size is "+w2utils.formatSize(s.maxSize),s.silent===!1&&e(n.el).w2tag(i),void console.log("ERROR: "+i);if(0!==s.max&&l>=s.max)return i="Maximum number of files is "+s.max,s.silent===!1&&e(n.el).w2tag(i),void console.log("ERROR: "+i);if(r.push(o),"undefined"!=typeof FileReader&&s.readContent===!0){var u=new FileReader;u.onload=function(){return function(t){var i=t.target.result,s=i.indexOf(",");o.content=i.substr(s+1),n.refresh(),e(n.el).trigger("change"),n.trigger(e.extend(d,{phase:"after"}))}}(),u.readAsDataURL(t)}else n.refresh(),e(n.el).trigger("change")}},normMenu:function(t){if(e.isArray(t)){for(var i=0;i<t.length;i++)"string"==typeof t[i]?t[i]={id:t[i],text:t[i]}:(null!=t[i].text&&null==t[i].id&&(t[i].id=t[i].text),null==t[i].text&&null!=t[i].id&&(t[i].text=t[i].id),null!=t[i].caption&&(t[i].text=t[i].caption));return t}if("function"==typeof t)return this.normMenu(t());if("object"==typeof t){var n=[];for(var i in t)n.push({id:i,text:t[i]});return n}},getMonthHTML:function(e,t,i){var n=new Date,s=w2utils.settings.fullmonths,r=["31","28","31","30","31","30","31","31","30","31","30","31"],o=n.getFullYear()+"/"+(Number(n.getMonth())+1)+"/"+n.getDate(),a=w2utils.settings.fulldays.slice(),l=w2utils.settings.shortdays.slice();"M"!=w2utils.settings.weekStarts&&(a.unshift(a.pop()),l.unshift(l.pop()));var c=this.options;null==c&&(c={}),t=w2utils.isInt(t)?parseInt(t):n.getFullYear(),e=w2utils.isInt(e)?parseInt(e):n.getMonth()+1,e>12&&(e-=12,t++),(e<1||0===e)&&(e+=12,t--),t/4==Math.floor(t/4)?r[1]="29":r[1]="28",c.current=e+"/"+t,n=new Date(t,e-1,1);for(var d=n.getDay(),u="",h=0;h<l.length;h++)u+='<td title="'+a[h]+'">'+l[h]+"</td>";var p='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+s[e-1]+", "+t+'</div><table class="w2ui-calendar-days" cellspacing="0"><tbody>    <tr class="w2ui-day-title">'+u+"</tr>    <tr>",f=1;if("M"!=w2utils.settings.weekStarts&&d++,"datetime"===this.type){var g=w2utils.isDateTime(i,c.format,!0);i=w2utils.formatDate(g,w2utils.settings.dateFormat)}for(var m=1;m<43;m++){if(0===d&&1==m){for(var v=0;v<6;v++)p+='<td class="w2ui-day-empty">&#160;</td>';m+=6}else if(m<d||f>r[e-1]){p+='<td class="w2ui-day-empty">&#160;</td>',m%7===0&&(p+="</tr><tr>");continue}var w=t+"/"+e+"/"+f,y=new Date(w),b="";6===y.getDay()&&(b=" w2ui-saturday"),0===y.getDay()&&(b=" w2ui-sunday"),w==o&&(b+=" w2ui-today");var x,_,C=f,k="",T="";if("datetime"===this.type?(x=w2utils.formatDateTime(w,c.format),_=w2utils.formatDate(w,w2utils.settings.dateFormat)):(x=w2utils.formatDate(w,c.format),_=x),c.colored&&void 0!==c.colored[_]){var S=c.colored[_].split(":");T="background-color: "+S[0]+";",k="color: "+S[1]+";"}p+='<td class="'+(this.inRange(x,!0)?"w2ui-date "+(_==i?"w2ui-date-selected":""):"w2ui-blocked")+b+'"    style="'+k+T+'" date="'+x+'" data-date="'+y+'">'+C+"</td>",(m%7===0||0===d&&1==m)&&(p+="</tr><tr>"),f++}return p+="</tr></tbody></table>"},getYearHTML:function(){for(var e=w2utils.settings.shortmonths,t=w2utils.settings.dateStartYear,i=w2utils.settings.dateEndYear,n="",s="",r=0;r<e.length;r++)n+='<div class="w2ui-jump-month" name="'+r+'">'+e[r]+"</div>";for(var o=t;o<=i;o++)s+='<div class="w2ui-jump-year" name="'+o+'">'+o+"</div>";return"<div>"+n+"</div><div>"+s+"</div>"},getHourHTML:function(){var e=[],t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,n=0;n<24;n++){var s=(n>=12&&!i?n-12:n)+":00"+(i?"":n<12?" am":" pm");12!=n||i||(s="12:00 pm"),e[Math.floor(n/8)]||(e[Math.floor(n/8)]="");var r=this.fromMin(this.toMin(s)),o=this.fromMin(this.toMin(s)+59);if("datetime"===this.type){var a=w2utils.isDateTime(this.el.value,t.format,!0),l=t.format.split("|")[0].trim();r=w2utils.formatDate(a,l)+" "+r,o=w2utils.formatDate(a,l)+" "+o}e[Math.floor(n/8)]+='<div class="'+(this.inRange(r)||this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" hour="'+n+'">'+s+"</div>"}var c='<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Hour")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+e[0]+"</td>       <td>"+e[1]+"</td>       <td>"+e[2]+"</td>   </tr></tbody></table></div></div>";return c},getMinHTML:function(e){null==e&&(e=0);var t=this.options;null==t&&(t={format:w2utils.settings.timeFormat});for(var i=t.format.indexOf("h24")>-1,n=[],s=0;s<60;s+=5){var r=(e>12&&!i?e-12:e)+":"+(s<10?0:"")+s+" "+(i?"":e<12?"am":"pm"),o=r,a=s<20?0:s<40?1:2;if(n[a]||(n[a]=""),"datetime"===this.type){var l=w2utils.isDateTime(this.el.value,t.format,!0),c=t.format.split("|")[0].trim();o=w2utils.formatDate(l,c)+" "+o}n[a]+='<div class="'+(this.inRange(o)?"w2ui-time ":"w2ui-blocked")+'" min="'+s+'">'+r+"</div>"}var d='<div class="w2ui-calendar">   <div class="w2ui-calendar-title">'+w2utils.lang("Select Minute")+'</div>   <div class="w2ui-calendar-time"><table><tbody><tr>       <td>'+n[0]+"</td>       <td>"+n[1]+"</td>       <td>"+n[2]+"</td>   </tr></tbody></table></div></div>";return d},toMin:function(e){if("string"!=typeof e)return null;var t=e.split(":");return 2!==t.length?null:(t[0]=parseInt(t[0]),t[1]=parseInt(t[1]),e.indexOf("pm")!=-1&&12!=t[0]&&(t[0]+=12),60*t[0]+t[1])},fromMin:function(e){var t="";e>=1440&&(e%=1440),e<0&&(e=1440+e);var i=Math.floor(e/60),n=(e%60<10?"0":"")+e%60,s=this.options;return null==s&&(s={format:w2utils.settings.timeFormat}),t=s.format.indexOf("h24")!=-1?i+":"+n:(i<=12?i:i-12)+":"+n+" "+(i>=12?"pm":"am")}},e.extend(t.prototype,w2utils.event),w2obj.field=t}(jQuery),function($){var w2form=function(e){this.name=null,this.header="",this.box=null,this.url="",this.routeData={},this.formURL="",this.formHTML="",this.page=0,this.recid=0,this.fields=[],this.actions={},this.record={},this.original={},this.postData={},this.httpHeaders={},this.method=null,this.toolbar={},this.tabs={},this.style="",this.focus=0,this.isGenerated=!1,this.last={xhr:null},$.extend(!0,this,w2obj.form,e)};$.fn.w2form=function(e){if($.isPlainObject(e)){var t=this;if(!w2utils.checkName(e,"w2form"))return;var i=e.record,n=e.original,s=e.fields,r=e.toolbar,o=e.tabs,a=new w2form(e);if($.extend(a,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]}),$.isArray(o)){$.extend(!0,a.tabs,{tabs:[]});for(var l=0;l<o.length;l++){var c=o[l];"object"==typeof c?(a.tabs.tabs.push(c),c.active===!0&&(a.tabs.active=c.id)):a.tabs.tabs.push({id:c,caption:c})}}else $.extend(!0,a.tabs,o);if($.extend(!0,a.toolbar,r),s)for(var d=0;d<s.length;d++){var u=$.extend(!0,{},s[d]);null==u.name&&null!=u.field&&(u.name=u.field),null==u.field&&null!=u.name&&(u.field=u.name),a.fields[d]=u}for(var d in i)$.isPlainObject(i[d])?a.record[d]=$.extend(!0,{},i[d]):a.record[d]=i[d];for(var d in n)$.isPlainObject(n[d])?a.original[d]=$.extend(!0,{},n[d]):a.original[d]=n[d];return t.length>0&&(a.box=t[0]),""!==a.formURL?$.get(a.formURL,function(e){a.formHTML=e,a.isGenerated=!0,0===$(a.box).length&&0===e.length||($(a.box).html(e),a.render(a.box))}):""!==a.formHTML||(0!==$(this).length&&""!==$.trim($(this).html())?a.formHTML=$(this).html():a.formHTML=a.generateHTML()),w2ui[a.name]=a,""===a.formURL&&(String(a.formHTML).indexOf("w2ui-page")==-1&&(a.formHTML='<div class="w2ui-page page-0">'+a.formHTML+"</div>"),$(a.box).html(a.formHTML),a.isGenerated=!0,a.render(a.box)),a}var t=w2ui[$(this).attr("name")];return t?arguments.length>0?(t[e]&&t[e].apply(t,Array.prototype.slice.call(arguments,1)),this):t:null},w2form.prototype={onRequest:null,onLoad:null,onValidate:null,onSubmit:null,onProgress:null,onSave:null,onChange:null,onRender:null,onRefresh:null,onResize:null,onDestroy:null,onAction:null,onToolbar:null,onError:null,msgNotJSON:"Returned data is not in valid JSON format.",msgAJAXerror:"AJAX error. See console for more details.",msgRefresh:"Refreshing...",msgSaving:"Saving...",get:function(e,t){if(0===arguments.length){for(var i=[],n=0;n<this.fields.length;n++)null!=this.fields[n].name&&i.push(this.fields[n].name);return i}for(var s=0;s<this.fields.length;s++)if(this.fields[s].name==e)return t===!0?s:this.fields[s];return null},set:function(e,t){for(var i=0;i<this.fields.length;i++)if(this.fields[i].name==e)return $.extend(this.fields[i],t),this.refresh(),!0;return!1},show:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.hidden&&(i.hidden=!1,e++)}return e>0&&this.refresh(),e},hide:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.hidden&&(i.hidden=!0,e++)}return e>0&&this.refresh(),e},enable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&i.disabled&&(i.disabled=!1,e++)}return e>0&&this.refresh(),e},disable:function(){for(var e=0,t=0;t<arguments.length;t++){var i=this.get(arguments[t]);i&&!i.disabled&&(i.disabled=!0,e++)}return e>0&&this.refresh(),e},reload:function(e){var t="object"!=typeof this.url?this.url:this.url.get;t&&0!==this.recid&&null!=this.recid?this.request(e):"function"==typeof e&&e()},clear:function(){this.recid=0,this.record={},$().w2tag(),this.refresh()},error:function(e){var t=this,i=this.trigger({target:this.name,type:"error",message:e,xhr:this.last.xhr});return i.isCancelled===!0?void("function"==typeof callBack&&callBack()):(setTimeout(function(){t.message(e)},1),void this.trigger($.extend(i,{phase:"after"})))},message:function(e){"string"==typeof e&&(e={width:e.length<300?350:550,height:e.length<300?170:250,body:'<div class="w2ui-centered">'+e+"</div>",buttons:'<button class="w2ui-btn" onclick="w2ui[\''+this.name+"'].message()\">Ok</button>",onOpen:function(e){setTimeout(function(){$(e.box).find(".w2ui-btn").focus()},25)}}),w2utils.message.call(this,{box:this.box,path:"w2ui."+this.name,title:".w2ui-form-header:visible",body:".w2ui-form-box"},e)},validate:function(e){null==e&&(e=!0),$().w2tag();for(var t=[],i=0;i<this.fields.length;i++){var n=this.fields[i];switch(null==this.record[n.name]&&(this.record[n.name]=""),n.type){case"int":this.record[n.name]&&!w2utils.isInt(this.record[n.name])&&t.push({field:n,error:w2utils.lang("Not an integer")});break;case"float":this.record[n.name]&&!w2utils.isFloat(this.record[n.name])&&t.push({field:n,error:w2utils.lang("Not a float")});break;case"money":this.record[n.name]&&!w2utils.isMoney(this.record[n.name])&&t.push({field:n,error:w2utils.lang("Not in money format")});break;case"color":case"hex":this.record[n.name]&&!w2utils.isHex(this.record[n.name])&&t.push({field:n,error:w2utils.lang("Not a hex number")});break;case"email":this.record[n.name]&&!w2utils.isEmail(this.record[n.name])&&t.push({field:n,error:w2utils.lang("Not a valid email")});break;case"checkbox":1==this.record[n.name]?this.record[n.name]=1:this.record[n.name]=0;break;case"date":n.options.format||(n.options.format=w2utils.settings.dateFormat),this.record[n.name]&&!w2utils.isDate(this.record[n.name],n.options.format)&&t.push({field:n,error:w2utils.lang("Not a valid date")+": "+n.options.format});break;case"list":case"combo":break;case"enum":}var s=this.record[n.name];n.required&&(""===s||$.isArray(s)&&0===s.length||$.isPlainObject(s)&&$.isEmptyObject(s))&&t.push({field:n,error:w2utils.lang("Required field")}),n.equalto&&this.record[n.name]!=this.record[n.equalto]&&t.push({field:n,error:w2utils.lang("Field should be equal to ")+n.equalto})}var r=this.trigger({phase:"before",target:this.name,type:"validate",errors:t});if(r.isCancelled!==!0){if(e)for(var o=0;o<r.errors.length;o++){var a=r.errors[o];null!=a.field&&("radio"==a.field.type?$($(a.field.el).parents("div")[0]).w2tag(a.error,{class:"w2ui-error"}):["enum","file"].indexOf(a.field.type)!=-1?!function(e){setTimeout(function(){var t=$(e.field.el).data("w2field").helpers.multi;$(e.field.el).w2tag(e.error),$(t).addClass("w2ui-error")},1)}(a):$(a.field.el).w2tag(a.error,{class:"w2ui-error"}),this.goto(t[0].field.page))}return this.trigger($.extend(r,{phase:"after"})),t}},getChanges:function(){var e=function(t,i,n){for(var s in t)"object"==typeof t[s]?(n[s]=e(t[s],i[s]||{},{}),n[s]&&!$.isEmptyObject(n[s])||delete n[s]):t[s]!=i[s]&&(n[s]=t[s]);return n};return e(this.record,this.original,{})},request:function(postData,callBack){var obj=this;if("function"==typeof postData&&(callBack=postData,postData=null),null==postData&&(postData={}),this.url&&("object"!=typeof this.url||this.url.get)){null==this.recid&&(this.recid=0);var params={};params.cmd="get",params.recid=this.recid,params.name=this.name,$.extend(params,this.postData),$.extend(params,postData);var edata=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:params,httpHeaders:this.httpHeaders});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));this.record={},this.original={},this.lock(w2utils.lang(this.msgRefresh));var url=edata.url;if("object"==typeof edata.url&&edata.url.get&&(url=edata.url.get),this.last.xhr)try{this.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text"};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":ajaxOptions.type="GET",ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":ajaxOptions.type="GET",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),this.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"load",xhr:xhr});if(edata.isCancelled===!0)return void("function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}));var data,responseText=obj.last.xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):(obj.record=$.extend({},data.record),obj.original=$.extend({},data.record))}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"function"==typeof callBack&&callBack(data)}).fail(function(e,t,i){var n={status:t,error:i,rawResponseText:e.responseText},s=obj.trigger({phase:"before",type:"error",error:n,xhr:e});if(s.isCancelled!==!0){if("abort"!=t){var r;try{r=$.parseJSON(e.responseText)}catch(e){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof r?r:e.responseText)}obj.trigger($.extend(s,{phase:"after"}))}}),this.trigger($.extend(edata,{phase:"after"}))}},submit:function(e,t){return this.save(e,t)},save:function(postData,callBack){var obj=this;$(this.box).find(":focus").change(),"function"==typeof postData&&(callBack=postData,postData=null);var errors=obj.validate(!0);if(0===errors.length){if(null==postData&&(postData={}),!obj.url||"object"==typeof obj.url&&!obj.url.save)return void console.log("ERROR: Form cannot be saved because no url is defined.");obj.lock(w2utils.lang(obj.msgSaving)+' <span id="'+obj.name+'_progress"></span>'),setTimeout(function(){var params={};params.cmd="save",params.recid=obj.recid,params.name=obj.name,$.extend(params,obj.postData),$.extend(params,postData),obj.fields.forEach(function(e){"file"==e.type&&Array.isArray(obj.record[e.field])&&obj.record[e.field].forEach(function(e){delete e.file})}),params.record=$.extend(!0,{},obj.record);var edata=obj.trigger({phase:"before",type:"submit",target:obj.name,url:obj.url,postData:params,httpHeaders:obj.httpHeaders});if(edata.isCancelled!==!0){var url=edata.url;if("object"==typeof edata.url&&edata.url.save&&(url=edata.url.save),obj.last.xhr)try{obj.last.xhr.abort()}catch(e){}if(!$.isEmptyObject(obj.routeData)){var info=w2utils.parseRoute(url);if(info.keys.length>0)for(var k=0;k<info.keys.length;k++)null!=obj.routeData[info.keys[k].name]&&(url=url.replace(new RegExp(":"+info.keys[k].name,"g"),obj.routeData[info.keys[k].name]))}var ajaxOptions={type:"POST",url:url,data:edata.postData,headers:edata.httpHeaders,dataType:"text",xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=obj.trigger({phase:"before",type:"progress",total:e.total,loaded:e.loaded,originalEvent:e});if(t.isCancelled===!0)return;var i=Math.round(e.loaded/e.total*100);$("#"+obj.name+"_progress").text(""+i+"%"),obj.trigger($.extend(t,{phase:"after"}))}},!1),e}};switch(w2utils.settings.dataType){case"HTTP":ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"HTTPJSON":ajaxOptions.data={request:JSON.stringify(ajaxOptions.data)};break;case"RESTFULL":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=String($.param(ajaxOptions.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]");break;case"RESTFULLJSON":0!==obj.recid&&null!=obj.recid&&(ajaxOptions.type="PUT"),ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json";break;case"JSON":ajaxOptions.type="POST",ajaxOptions.data=JSON.stringify(ajaxOptions.data),ajaxOptions.contentType="application/json"}this.method&&(ajaxOptions.type=this.method),obj.last.xhr=$.ajax(ajaxOptions).done(function(data,status,xhr){obj.unlock();var edata=obj.trigger({phase:"before",target:obj.name,type:"save",xhr:xhr,status:status});if(edata.isCancelled!==!0){var data,responseText=xhr.responseText;if("error"!=status){if(null!=responseText&&""!==responseText){if("object"==typeof responseText)data=responseText;else try{eval("data = "+responseText)}catch(e){}null==data&&(data={status:"error",message:w2utils.lang(obj.msgNotJSON),responseText:responseText}),"error"==data.status?obj.error(w2utils.lang(data.message)):obj.original=$.extend({},obj.record)}}else obj.error("AJAX Error "+xhr.status+": "+xhr.statusText),data={status:"error",message:w2utils.lang(obj.msgAJAXerror),
responseText:responseText};obj.trigger($.extend(edata,{phase:"after"})),obj.refresh(),"success"==data.status&&"function"==typeof callBack&&callBack(data)}}).fail(function(e,t,i){var n={status:t,error:i,rawResponseText:e.responseText},s=obj.trigger({phase:"before",type:"error",error:n,xhr:e});s.isCancelled!==!0&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",n),obj.trigger($.extend(s,{phase:"after"})))}),obj.trigger($.extend(edata,{phase:"after"}))}},50)}},lock:function(e,t){var i=Array.prototype.slice.call(arguments,0);i.unshift(this.box),setTimeout(function(){w2utils.lock.apply(window,i)},10)},unlock:function(e){var t=this.box;setTimeout(function(){w2utils.unlock(t,e)},25)},goto:function(e){this.page!==e&&(null!=e&&(this.page=e),$(this.box).data("auto-size")===!0&&$(this.box).height(0),this.refresh())},generateHTML:function(){for(var e,t,i,n=[],s="",r=0;r<this.fields.length;r++){i="";var o=this.fields[r];null==o.html&&(o.html={}),null==o.options&&(o.options={}),o.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",style:"",page:0,column:0},o.html),null==e&&(e=o.html.page),null==t&&(t=o.html.column),""===o.html.caption&&(o.html.caption=o.name);var a='<input name="'+o.name+'" class="w2ui-input" type="text" '+o.html.attr+' tabindex="'+(r+1)+'"/>';switch(o.type){case"pass":case"password":a='<input name="'+o.name+'" class="w2ui-input" type = "password" '+o.html.attr+' tabindex="'+(r+1)+'"/>';break;case"checkbox":a='<input name="'+o.name+'" class="w2ui-input" type="checkbox" '+o.html.attr+' tabindex="'+(r+1)+'"/>';break;case"radio":a="";var l=o.options.items?o.options.items:o.html.items;$.isArray(l)||(l=[]),l.length>0&&(l=w2obj.field.prototype.normMenu(l));for(var c=0;c<l.length;c++)a+='<label><input name="'+o.name+'" class="w2ui-input" type = "radio" '+o.html.attr+' value="'+l[c].id+'"/>&#160;'+l[c].text+"</label><br/>";break;case"select":a='<select name="'+o.name+'" class="w2ui-input" '+o.html.attr+' tabindex="'+(r+1)+'">';var l=o.options.items?o.options.items:o.html.items;$.isArray(l)||(l=[]),l.length>0&&(l=w2obj.field.prototype.normMenu(l));for(var c=0;c<l.length;c++)a+='<option value="'+l[c].id+'">'+l[c].text+"</option>";a+="</select>";break;case"textarea":a='<textarea name="'+o.name+'" class="w2ui-input" '+o.html.attr+' tabindex="'+(r+1)+'"></textarea>';break;case"toggle":a='<input name="'+o.name+'" type="checkbox" '+o.html.attr+' class="w2ui-input w2ui-toggle" tabindex="'+(r+1)+'"/><div><div></div></div>';break;case"html":case"custom":case"empty":a=""}""!==s&&(e!=o.html.page||t!=o.html.column||o.html.group&&s!=o.html.group)&&(n[e][t]+="\n   </div>",s=""),o.html.group&&s!=o.html.group&&(i+='\n   <div class="w2ui-group-title">'+o.html.group+'</div>\n   <div class="w2ui-group">',s=o.html.group),i+='\n      <div class="w2ui-field '+(null!=o.html.span?"w2ui-span"+o.html.span:"")+'" style="'+o.html.style+'">\n         <label>'+w2utils.lang(o.html.caption)+"</label>\n         <div>"+a+w2utils.lang(o.html.text)+"</div>\n      </div>",null==n[o.html.page]&&(n[o.html.page]=[]),null==n[o.html.page][o.html.column]&&(n[o.html.page][o.html.column]=""),n[o.html.page][o.html.column]+=i,e=o.html.page,t=o.html.column}if(""!==s&&(n[e][t]+="\n   </div>"),this.tabs.tabs)for(var c=0;c<this.tabs.tabs.length;c++)null==n[c]&&(n[c]=[]);var d="";if(!$.isEmptyObject(this.actions)){d+='\n<div class="w2ui-buttons">';for(var u in this.actions){var h=this.actions[u],p={caption:"",style:"",class:""};$.isPlainObject(h)?(h.caption&&(p.caption=h.caption),h.style&&(p.style=h.style),h.class&&(p.class=h.class)):(p.caption=u,["save","update","create"].indexOf(u.toLowerCase())!=-1?p.class="w2ui-btn-blue":p.class=""),d+='\n    <button name="'+u+'" class="w2ui-btn '+p.class+'" style="'+p.style+'">'+w2utils.lang(p.caption)+"</button>"}d+="\n</div>"}i="";for(var f=0;f<n.length;f++){i+='<div class="w2ui-page page-'+f+'" '+(0===f?"":'style="display: none;"')+'><div class="w2ui-column-container" style="display: flex;">';for(var g=0;g<n[f].length;g++)i+='<div class="w2ui-column col-'+g+'">'+(n[f][g]||"")+"\n</div>";i+="\n</div></div>"}return i+=d},action:function(e,t){var i=this.actions[e],n=i;$.isPlainObject(i)&&i.onClick&&(n=i.onClick);var s=this.trigger({phase:"before",target:e,type:"action",click:n,originalEvent:t});s.isCancelled!==!0&&("function"==typeof n&&n.call(this,t),this.trigger($.extend(s,{phase:"after"})))},resize:function(){function e(){n.width($(t.box).width()).height($(t.box).height()),r.css("top",""!==t.header?w2utils.getSize(s,"height"):0),o.css("top",(""!==t.header?w2utils.getSize(s,"height"):0)+("object"==typeof t.toolbar&&$.isArray(t.toolbar.items)&&t.toolbar.items.length>0?w2utils.getSize(r,"height"):0)),a.css("top",(""!==t.header?w2utils.getSize(s,"height"):0)+("object"==typeof t.toolbar&&$.isArray(t.toolbar.items)&&t.toolbar.items.length>0?w2utils.getSize(r,"height")+5:0)+("object"==typeof t.tabs&&$.isArray(t.tabs.tabs)&&t.tabs.tabs.length>0?w2utils.getSize(o,"height")+5:0)),a.css("bottom",d.length>0?w2utils.getSize(d,"height"):0)}var t=this,i=this.trigger({phase:"before",target:this.name,type:"resize"});if(i.isCancelled!==!0){var n=$(this.box).find("> div.w2ui-form-box"),s=$(this.box).find("> div .w2ui-form-header"),r=$(this.box).find("> div .w2ui-form-toolbar"),o=$(this.box).find("> div .w2ui-form-tabs"),a=$(this.box).find("> div .w2ui-page"),l=$(this.box).find("> div .w2ui-page.page-"+this.page),c=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),d=$(this.box).find("> div .w2ui-buttons");e(),0!==parseInt($(this.box).height())&&$(this.box).data("auto-size")!==!0||($(this.box).height((s.length>0?w2utils.getSize(s,"height"):0)+("object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?w2utils.getSize(o,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?w2utils.getSize(r,"height"):0)+(a.length>0?w2utils.getSize(c,"height")+w2utils.getSize(l,"+height")+12:0)+(d.length>0?w2utils.getSize(d,"height"):0)),$(this.box).data("auto-size",!0)),e(),this.toolbar&&this.toolbar.resize&&this.toolbar.resize(),this.tabs&&this.tabs.resize&&this.tabs.resize(),t.trigger($.extend(i,{phase:"after"}))}},refresh:function(e){var t=(new Date).getTime(),i=this;if(this.box&&this.isGenerated&&null!=$(this.box).html()){var n=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page,field:e});if(n.isCancelled!==!0){if(null!=e)var s=i.get(e,!0),r=s+1;else{$(this.box).find("input, textarea, select").each(function(e,t){var n=null!=$(t).attr("name")?$(t).attr("name"):$(t).attr("id"),s=i.get(n);if(s){var r=$(t).parents(".w2ui-page");if(r.length>0)for(var o=0;o<100;o++)if(r.hasClass("page-"+o)){s.page=o;break}}}),$(this.box).find(".w2ui-page").hide(),$(this.box).find(".w2ui-page.page-"+this.page).show(),$(this.box).find(".w2ui-form-header").html(this.header),"object"==typeof this.tabs&&$.isArray(this.tabs.tabs)&&this.tabs.tabs.length>0?($("#form_"+this.name+"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide(),"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&this.toolbar.items.length>0?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();var s=0,r=this.fields.length}for(var o=s;o<r;o++){var e=this.fields[o];null==e.name&&null!=e.field&&(e.name=e.field),null==e.field&&null!=e.name&&(e.field=e.name),e.$el=$(this.box).find('[name="'+String(e.name).replace(/\\/g,"\\\\")+'"]'),e.el=e.$el[0],null==e.el&&console.log('ERROR: Cannot associate field "'+e.name+'" with html control. Make sure html control exists with the same name.'),e.el&&(e.el.id=e.name);var a=$(e).data("w2field");a&&a.clear(),$(e.$el).off("change").on("change",function(){var e=this.value,t=null!=i.record[this.name]?i.record[this.name]:"",n=i.get(this.name);if(["list","enum","file"].indexOf(n.type)!=-1&&$(this).data("selected")){var s=$(this).data("selected"),r=i.record[this.name];if($.isArray(s)){e=[];for(var o=0;o<s.length;o++)e[o]=$.extend(!0,{},s[o])}if($.isPlainObject(s)&&(e=$.extend(!0,{},s)),$.isArray(r)){t=[];for(var o=0;o<r.length;o++)t[o]=$.extend(!0,{},r[o])}$.isPlainObject(r)&&(t=$.extend(!0,{},r))}if(["toggle","checkbox"].indexOf(n.type)!=-1&&(e=!!$(this).prop("checked")&&("on"==$(this).prop("value")||$(this).prop("value"))),["int","float","percent","money","currency"].indexOf(n.type)!=-1&&(e=$(this).data("w2field").clean(e)),e!==t){var a=i.trigger({phase:"before",target:this.name,type:"change",value_new:e,value_previous:t});if(a.isCancelled===!0)return void $(this).val(i.record[this.name]);var l=this.value;if("select"==this.type&&(l=this.value),"checkbox"==this.type&&(l=!!this.checked),"radio"==this.type&&n.$el.each(function(e,t){t.checked&&(l=t.value)}),["int","float","percent","money","currency","list","combo","enum","file","toggle"].indexOf(n.type)!=-1&&(l=e),["enum","file"].indexOf(n.type)!=-1&&l.length>0){var c=$(n.el).data("w2field").helpers.multi;$(c).removeClass("w2ui-error")}(""===l||null==l||$.isArray(l)&&0===l.length||$.isPlainObject(l)&&$.isEmptyObject(l))&&(l=null),i.record[this.name]=l,i.trigger($.extend(a,{phase:"after"}))}}),e.required?$(e.el).parent().parent().addClass("w2ui-required"):$(e.el).parent().parent().removeClass("w2ui-required"),null!=e.disabled&&(e.disabled?$(e.el).prop("readonly",!0):$(e.el).prop("readonly",!1)),e.hidden?$(e.el).parent().parent().hide():$(e.el).parent().parent().show()}$(this.box).find("button, input[type=button]").each(function(e,t){$(t).off("click").on("click",function(e){var t=this.value;this.id&&(t=this.id),this.name&&(t=this.name),i.action(t,e)})});for(var o=s;o<r;o++){var e=this.fields[o],l=null!=this.record[e.name]?this.record[e.name]:"";if(e.el)switch($(e.el).hasClass("w2ui-input")||$(e.el).addClass("w2ui-input"),e.type=String(e.type).toLowerCase(),e.options||(e.options={}),e.type){case"text":case"textarea":case"email":case"pass":case"password":e.el.value=l;break;case"int":case"float":case"money":case"currency":case"percent":e.el.value=l,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"hex":case"alphanumeric":case"color":case"date":case"time":e.el.value=l,$(e.el).w2field($.extend({},e.options,{type:e.type}));break;case"toggle":w2utils.isFloat(l)&&(l=parseFloat(l)),$(e.el).prop("checked",!!l),this.record[e.name]=!!l&&l;break;case"list":case"combo":if("list"==e.type){var c=$.isPlainObject(l)?l.id:$.isPlainObject(e.options.selected)?e.options.selected.id:l;e.options.items||(e.options.items=[]);var d=e.options.items;$.isArray(d)&&d.length>0&&!$.isPlainObject(d[0])&&(e.options.items=w2obj.field.prototype.normMenu(d));for(var u=0;u<e.options.items.length;u++){var h=e.options.items[u];if(h.id==c){l=$.extend(!0,{},h),i.record[e.name]=l;break}}}else"combo"!=e.type||$.isPlainObject(l)?$.isPlainObject(l)&&null!=l.text?e.el.value=l.text:e.el.value="":e.el.value=l;$.isPlainObject(l)||(l={}),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:l}));break;case"enum":case"file":$.isArray(l)||(l=[]),$(e.el).w2field($.extend({},e.options,{type:e.type,selected:l}));break;case"select":var d=e.options.items;if(null!=d&&d.length>0){d=w2obj.field.prototype.normMenu(d),$(e.el).html("");for(var p=0;p<d.length;p++)$(e.el).append('<option value="'+d[p].id+'">'+d[p].text+"</option")}$(e.el).val(l);break;case"radio":$(e.$el).prop("checked",!1).each(function(e,t){$(t).val()==l&&$(t).prop("checked",!0)});break;case"checkbox":$(e.el).prop("checked",!!l);break;case"html":case"custom":case"empty":break;default:$(e.el).val(l),$(e.el).w2field($.extend({},e.options,{type:e.type}))}}for(var a=$(this.box).find(".w2ui-page"),u=0;u<a.length;u++)$(a[u]).find("> *").length>1&&$(a[u]).wrapInner("<div></div>");return this.trigger($.extend(n,{phase:"after"})),this.resize(),(new Date).getTime()-t}}},render:function(e){function t(){var e=$(n.box).find("div:not(.w2ui-field-helper) > input, select, textarea").not(".file-input");e.length>n.focus&&e[n.focus].focus()}var i=(new Date).getTime(),n=this;if("object"==typeof e&&($(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),this.box=e),this.isGenerated&&this.box){var s=this.trigger({phase:"before",target:this.name,type:"render",box:null!=e?e:this.box});if(s.isCancelled!==!0){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var r='<div class="w2ui-form-box">'+(""!==this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar" style="display: none"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs" style="display: none"></div>'+this.formHTML+"</div>";$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(r),$(this.box).length>0&&($(this.box)[0].style.cssText+=this.style),"function"!=typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(e){var t=n.trigger({phase:"before",type:"toolbar",target:e.target,originalEvent:e});t.isCancelled!==!0&&n.trigger($.extend(t,{phase:"after"}))})),"object"==typeof this.toolbar&&"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]),"function"!=typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this,active:this.tabs.active})),this.tabs.on("click",function(e){n.goto(this.get(e.target,!0))})),"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&(this.tabs.render($("#form_"+this.name+"_tabs")[0]),this.tabs.active&&this.tabs.click(this.tabs.active)),this.trigger($.extend(s,{phase:"after"})),this.resize();var o="object"!=typeof this.url?this.url:this.url.get;return o&&0!==this.recid&&null!=this.recid?this.request():this.refresh(),0===$(".w2ui-layout").length&&(this.tmp_resize=function(e){w2ui[n.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize)),this.focus>=0&&setTimeout(function(){0===$(n.box).find("input, select, textarea").length?setTimeout(t,500):t()},10),(new Date).getTime()-i}}},destroy:function(){var e=this.trigger({phase:"before",target:this.name,type:"destroy"});e.isCancelled!==!0&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),$(this.box).find("#form_"+this.name+"_tabs").length>0&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(e,{phase:"after"})),$(window).off("resize","body"))}},$.extend(w2form.prototype,w2utils.event),w2obj.form=w2form}(jQuery);var bkExtend=function(){var e=arguments;1==e.length&&(e=[this,e[0]]);for(var t in e[1])e[0][t]=e[1][t];return e[0]};bkClass.prototype.construct=function(){},bkClass.extend=function(e){var t=function(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)},i=new this(bkClass);return bkExtend(i,e),t.prototype=i,t.extend=this.extend,t};var bkElement=bkClass.extend({construct:function(e,t){return"string"==typeof e&&(e=(t||document).createElement(e)),e=$BK(e)},appendTo:function(e){return e.appendChild(this),this},appendBefore:function(e){return e.parentNode.insertBefore(this,e),this},addEvent:function(e,t){return bkLib.addEvent(this,e,t),this},setContent:function(e){return this.innerHTML=e,this},pos:function(){var e=curtop=0;obj=this;if(obj.offsetParent)do e+=obj.offsetLeft,curtop+=obj.offsetTop;while(obj=obj.offsetParent);var t=window.opera?0:parseInt(this.getStyle("border-width")||this.style.border)||0;return[e+t,curtop+t+this.offsetHeight]},noSelect:function(){return bkLib.noSelect(this),this},parentTag:function(e){var t=this;do{if(t&&t.nodeName&&t.nodeName.toUpperCase()==e)return t;t=t.parentNode}while(t);return!1},hasClass:function(e){return this.className.match(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)"))},addClass:function(e){return this.hasClass(e)||(this.className+=" nicEdit-"+e),this},removeClass:function(e){return this.hasClass(e)&&(this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)")," ")),this},inserthtml:function(e){return this.innerHTML=e,this},setStyle:function(e){var t=this.style;for(var i in e)switch(i){case"float":t.cssFloat=t.styleFloat=e[i];break;case"opacity":t.opacity=e[i],t.filter="alpha(opacity="+Math.round(100*e[i])+")";break;case"className":this.className=e[i];break;default:t[i]=e[i]}return this},getStyle:function(e,t){var i=t?t:document.defaultView;if(1==this.nodeType)return i&&i.getComputedStyle?i.getComputedStyle(this,null).getPropertyValue(e):this.currentStyle[bkLib.camelize(e)]},remove:function(){return this.parentNode.removeChild(this),this},setAttributes:function(e){for(var t in e)this[t]=e[t];return this}}),bkLib={isMSIE:navigator.appVersion.indexOf("MSIE")!=-1,addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},toArray:function(e){for(var t=e.length,i=new Array(t);t--;)i[t]=e[t];return i},noSelect:function(e){e.setAttribute&&"input"!=e.nodeName.toLowerCase()&&"textarea"!=e.nodeName.toLowerCase()&&e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)bkLib.noSelect(e.childNodes[t])},camelize:function(e){return e.replace(/\-(.)/g,function(e,t){return t.toUpperCase()})},inArray:function(e,t){return null!=bkLib.search(e,t)},search:function(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return null},cancelEvent:function(e){return e=e||window.event,e.preventDefault&&e.stopPropagation&&(e.preventDefault(),e.stopPropagation()),!1},domLoad:[],domLoaded:function(){if(!arguments.callee.done)for(arguments.callee.done=!0,i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(e){this.domLoad.push(e),document.addEventListener?document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null):bkLib.isMSIE&&(document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+("https:"==location.protocol?"src='javascript:void(0)'":"src=//0")+"></script>"),$BK("__ie_onload").onreadystatechange=function(){"complete"==this.readyState&&bkLib.domLoaded()}),window.onload=bkLib.domLoaded}},bkEvent={addEvent:function(e,t){return t&&(this.eventList=this.eventList||{},this.eventList[e]=this.eventList[e]||[],this.eventList[e].push(t)),this},fireEvent:function(){var e=bkLib.toArray(arguments),t=e.shift();if(this.eventList&&this.eventList[t])for(var i=0;i<this.eventList[t].length;i++)this.eventList[t][i].apply(this,e)}};Function.prototype.closure=function(){var e=this,t=bkLib.toArray(arguments),i=t.shift();return function(){if("undefined"!=typeof bkLib)return e.apply(i,t.concat(bkLib.toArray(arguments)))}},Function.prototype.closureListener=function(){var e=this,t=bkLib.toArray(arguments),i=t.shift();return function(n){if(n=n||window.event,n.target)var s=n.target;else var s=n.srcElement;return e.apply(i,[n,s].concat(t))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:!0},center:{name:__("Center Align"),command:"justifycenter",noActive:!0},right:{name:__("Right Align"),command:"justifyright",noActive:!0},justify:{name:__("Justify Align"),command:"justifyfull",noActive:!0},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:!0},indent:{name:__("Indent Text"),command:"indent",noActive:!0},outdent:{name:__("Remove Indent"),command:"outdent",noActive:!0},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:!0}},iconsPath:"../nicEditorIcons.gif",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor"],iconList:{bgcolor:"w2ui-icon-adn",forecolor:"w2ui-icon-font",bold:"w2ui-icon-bold",center:"w2ui-icon-align-center",hr:5,indent:"w2ui-icon-indent",italic:"w2ui-icon-italic",justify:"w2ui-icon-align-justify",left:"w2ui-icon-align-left",ol:"w2ui-icon-list-ol",outdent:"w2ui-icon-outdent",removeformat:"w2ui-icon-ban",right:"w2ui-icon-align-right",save:"w2ui-icon-save",strikethrough:15,subscript:"w2ui-icon-subscript",superscript:"w2ui-icon-superscript",ul:"w2ui-icon-list-ul",underline:"w2ui-icon-underline",image:"w2ui-icon-file-image-o",link:"w2ui-icon-link",unlink:22,close:"w2ui-icon-cross",arrow:"w2ui-icon-caret-down"}}),nicEditors={nicPlugins:[],editors:[],registerPlugin:function(e,t){this.nicPlugins.push({p:e,o:t})},findEditor:function(e){for(var t=nicEditors.editors,i=0;i<t.length;i++)if(t[i].instanceById(e))return t[i].instanceById(e)}},nicEditor=bkClass.extend({construct:function(e){this.options=new nicEditorConfig,bkExtend(this.options,e),this.nicInstances=new Array,this.loadedPlugins=new Array;for(var t=nicEditors.nicPlugins,i=0;i<t.length;i++)this.loadedPlugins.push(new t[i].p(this,t[i].o));nicEditors.editors.push(this),bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(e,t){if(e=this.checkReplace($BK(e))){var i=new bkElement("DIV").setStyle({width:(parseInt(e.getStyle("width"))||e.clientWidth)+"px"}).appendBefore(e);return this.setPanel(i),this.addInstance(e,t)}},checkReplace:function(e){var t=nicEditors.findEditor(e);return t&&(t.removeInstance(e),t.removePanel()),e},addInstance:function(e,t){if(e=this.checkReplace($BK(e)),e.contentEditable||window.opera)var i=new nicEditorInstance(e,t,this);else var i=new nicEditorIFrameInstance(e,t,this);return this.nicInstances.push(i),this},removeInstance:function(e){e=$BK(e);for(var t=this.nicInstances,i=0;i<t.length;i++)t[i].e==e&&(t[i].remove(),this.nicInstances.splice(i,1))},removePanel:function(e){this.nicPanel&&(this.nicPanel.remove(),this.nicPanel=null)},instanceById:function(e){e=$BK(e);for(var t=this.nicInstances,i=0;i<t.length;i++)if(t[i].e==e)return t[i]},setPanel:function(e){return this.nicPanel=new nicEditorPanel($BK(e),this.options,this),this.fireEvent("panel",this.nicPanel),this},nicCommand:function(e,t){this.selectedInstance&&this.selectedInstance.nicCommand(e,t)},getIcon:function(e,t){var i=this.options.iconList[e];return'<i class="'+i+'"></i>'},selectCheck:function(e,t){do if(t.className&&t.className.indexOf("nicEdit")!=-1)return!1;while(t=t.parentNode);return this.fireEvent("blur",this.selectedInstance,t),this.lastSelectedInstance=this.selectedInstance,this.selectedInstance=null,!1}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:!1,construct:function(e,t,i){this.ne=i,this.elm=this.e=e,this.options=t||{},newX=parseInt(e.getStyle("width"))||e.clientWidth,newY=parseInt(e.getStyle("height"))||e.clientHeight,this.initialHeight=newY-8;var n="textarea"==e.nodeName.toLowerCase();if(n||this.options.hasPanel){var s=bkLib.isMSIE&&!("undefined"!=typeof document.body.style.maxHeight&&"CSS1Compat"==document.compatMode),r={width:newX+"px",border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"};r[s?"height":"maxHeight"]=this.ne.options.maxHeight?this.ne.options.maxHeight+"px":null,this.editorContain=new bkElement("DIV").setStyle(r).appendBefore(e);var o=new bkElement("DIV").setStyle({width:newX-8+"px",margin:"4px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain);if(e.setStyle({display:"none"}),o.innerHTML=e.innerHTML,n){o.setContent(e.value),this.copyElm=e;var a=e.parentTag("FORM");a&&bkLib.addEvent(a,"submit",this.saveContent.closure(this))}o.setStyle(s?{height:newY+"px"}:{overflow:"hidden"}),this.elm=o}this.ne.addEvent("blur",this.blur.closure(this)),this.init(),this.blur()},init:function(){this.elm.setAttribute("contentEditable","true"),""==this.getContent()&&this.setContent("<br />"),this.instanceDoc=document.defaultView,this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},remove:function(){this.saveContent(),(this.copyElm||this.options.hasPanel)&&(this.editorContain.remove(),this.e.setStyle({display:"block"}),this.ne.removePanel()),this.disable(),this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(e&&0!==e.rangeCount)return e.rangeCount>0?e.getRangeAt(0):e.createRange()},selRng:function(e,t){window.getSelection?(t.removeAllRanges(),t.addRange(e)):e.select()},selElm:function(){var e=this.getRng();if(e){if(e.startContainer){var t=e.startContainer;if(1==e.cloneContents().childNodes.length)for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i].ownerDocument.createRange();if(n.selectNode(t.childNodes[i]),1!=e.compareBoundaryPoints(Range.START_TO_START,n)&&e.compareBoundaryPoints(Range.END_TO_END,n)!=-1)return $BK(t.childNodes[i])}return $BK(t)}return $BK("Control"==this.getSel().type?e.item(0):e.parentElement())}},saveRng:function(){this.savedRange=this.getRng(),this.savedSel=this.getSel()},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel)},keyDown:function(e,t){e.ctrlKey&&this.ne.fireEvent("key",this,e)},selected:function(e,t){if(t||(t=this.selElm)||(t=this.selElm()),!e.ctrlKey){var i=this.ne.selectedInstance;i!=this&&(i&&this.ne.fireEvent("blur",i,t),this.ne.selectedInstance=this,this.ne.fireEvent("focus",i,t)),this.ne.fireEvent("selected",i,t),this.isFocused=!0,this.elm.addClass("selected")}return!1},blur:function(){this.isFocused=!1,this.elm.removeClass("selected")},saveContent:function(){(this.copyElm||this.options.hasPanel)&&(this.ne.fireEvent("save",this),this.copyElm?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent())},getElm:function(){return this.elm},getContent:function(){return this.content=this.getElm().innerHTML,this.ne.fireEvent("get",this),this.content},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.elm.innerHTML=this.content},nicCommand:function(e,t){document.execCommand(e,!1,t)}}),nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var e=this.elm.innerHTML.replace(/^\s+|\s+$/g,"");this.elm.innerHTML="",e?e:e="<br />",this.initialContent=e,this.elmFrame=new bkElement("iframe").setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm),this.copyElm&&this.elmFrame.setStyle({width:this.elm.offsetWidth-4+"px"});var t=["font-size","font-family","font-weight","color"];for(itm in t)this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm);setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var e=$BK(this.elmFrame.contentWindow.document);e.designMode="on",e.open();var t=this.ne.options.externalCSS;e.write("<html><head>"+(t?'<link href="'+t+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"</body></html>"),e.close(),this.frameDoc=e,this.frameWin=$BK(this.elmFrame.contentWindow),this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles),this.instanceDoc=this.frameWin.document.defaultView,this.heightUpdate(),this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.frameContent.innerHTML=this.content,this.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(e,t){this.frameDoc.execCommand(e,!1,t),setTimeout(this.heightUpdate.closure(this),100)}}),nicEditorPanel=bkClass.extend({construct:function(e,t,i){this.elm=e,this.options=t,this.ne=i,this.panelButtons=new Array,this.buttonList=bkExtend([],this.ne.options.buttonList),this.panelContain=new bkElement("DIV").setStyle({overflow:"hidden",width:"100%",border:"1px solid #cccccc",backgroundColor:"#efefef"}).addClass("panelContain"),this.panelElm=new bkElement("DIV").setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(this.panelContain),this.panelContain.appendTo(e);var n=this.ne.options,s=n.buttons;for(button in s)this.addButton(button,n,!0);this.reorder(),e.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName],type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton,hasButton=bkLib.inArray(this.buttonList,buttonName);type&&(hasButton||this.ne.options.fullPanel)&&(this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne)),hasButton||this.buttonList.push(buttonName))},findButton:function(e){for(var t=0;t<this.panelButtons.length;t++)if(this.panelButtons[t].name==e)return this.panelButtons[t]},reorder:function(){for(var e=this.buttonList,t=0;t<e.length;t++){var i=this.findButton(e[t]);i&&this.panelElm.appendChild(i.margin)}},remove:function(){this.elm.remove()}}),nicEditorButton=bkClass.extend({construct:function(e,t,i,n){this.options=i.buttons[t],this.name=t,this.ne=n,this.elm=e,this.margin=new bkElement("DIV").setStyle({float:"left",marginTop:"2px"}).appendTo(e),this.contain=new bkElement("DIV").setStyle({width:"20px",height:"20px","text-align":"center"}).addClass("buttonContain").appendTo(this.margin),this.border=new bkElement("DIV").setStyle({backgroundColor:"#efefef",border:"1px solid #efefef"}).appendTo(this.contain),this.button=new bkElement("DIV").setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").inserthtml(this.ne.getIcon(t,i)).appendTo(this.border),this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect(),window.opera||(this.button.onmousedown=this.button.onclick=bkLib.cancelEvent),n.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this)),this.disable(),this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){this.isDisabled?this.setBg():this.isHover?this.setBg("hover"):this.isActive?this.setBg("active"):this.setBg()},setBg:function(e){switch(e){case"hover":var t={border:"1px solid #666",backgroundColor:"#ddd"};break;case"active":var t={border:"1px solid #666",backgroundColor:"#ccc"};break;default:var t={border:"1px solid #efefef",backgroundColor:"#efefef"}}this.border.setStyle(t).addClass("button-"+e);
},checkNodes:function(e){var t=e;do if(this.options.tags&&bkLib.inArray(this.options.tags,t.nodeName))return this.activate(),!0;while(t=t.parentNode&&"nicEdit"!=t.className);for(t=$BK(e);3==t.nodeType;)t=$BK(t.parentNode);if(this.options.css)for(itm in this.options.css)if(t.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm])return this.activate(),!0;return this.deactivate(),!1},activate:function(){this.isDisabled||(this.isActive=!0,this.updateState(),this.ne.fireEvent("buttonActivate",this))},deactivate:function(){this.isActive=!1,this.updateState(),this.isDisabled||this.ne.fireEvent("buttonDeactivate",this)},enable:function(e,t){this.isDisabled=!1,this.contain.setStyle({opacity:1}).addClass("buttonEnabled"),this.updateState(),this.checkNodes(t)},disable:function(e,t){this.isDisabled=!0,this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled"),this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){this.isDisabled||(this.isHover=!0,this.updateState(),this.ne.fireEvent("buttonOver",this))},hoverOff:function(){this.isHover=!1,this.updateState(),this.ne.fireEvent("buttonOut",this)},mouseClick:function(){this.options.command&&(this.ne.nicCommand(this.options.command,this.options.commandArgs),this.options.noActive||this.toggleActive()),this.ne.fireEvent("buttonClick",this)},key:function(e,t){this.options.key&&t.ctrlKey&&String.fromCharCode(t.keyCode||t.charCode).toLowerCase()==this.options.key&&(this.mouseClick(),t.preventDefault&&t.preventDefault())}}),nicPlugin=bkClass.extend({construct:function(e,t){this.options=t,this.ne=e,this.ne.addEvent("panel",this.loadPanel.closure(this)),this.init()},loadPanel:function(e){var t=this.options.buttons;for(var i in t)e.addButton(i,this.options);e.reorder()},init:function(){}}),nicPaneOptions={},nicEditorPane=bkClass.extend({construct:function(e,t,i,n){this.ne=t,this.elm=e,this.pos=e.pos(),this.contain=new bkElement("div").setStyle({zIndex:"99999",overflow:"hidden",position:"absolute",left:this.pos[0]+"px",top:this.pos[1]+"px"}),this.pane=new bkElement("div").setStyle({fontSize:"12px",border:"1px solid #ccc",overflow:"hidden",padding:"4px",textAlign:"left",backgroundColor:"#ffffc9"}).addClass("pane").setStyle(i).appendTo(this.contain),n&&!n.options.noClose&&(this.close=new bkElement("div").setStyle({float:"right",height:"16px",width:"16px",cursor:"pointer"}).inserthtml(this.ne.getIcon("close",nicPaneOptions)).addEvent("mousedown",n.removePane.closure(this)).appendTo(this.pane)),this.contain.noSelect().appendTo(document.body),this.position(),this.init()},init:function(){},position:function(){if(this.ne.nicPanel){var e=this.ne.nicPanel.elm,t=e.pos(),i=t[0]+parseInt(e.getStyle("width"))-(parseInt(this.pane.getStyle("width"))+8);i<this.pos[0]&&this.contain.setStyle({left:i+"px"})}},toggle:function(){this.isVisible=!this.isVisible,this.contain.setStyle({display:this.isVisible?"block":"none"})},remove:function(){this.contain&&(this.contain.remove(),this.contain=null)},append:function(e){e.appendTo(this.pane)},setContent:function(e){this.pane.setContent(e)}}),nicEditorAdvancedButton=nicEditorButton.extend({init:function(){this.ne.addEvent("selected",this.removePane.closure(this)).addEvent("blur",this.removePane.closure(this))},mouseClick:function(){this.isDisabled||(this.pane&&this.pane.pane?this.removePane():(this.pane=new nicEditorPane(this.contain,this.ne,{width:this.width||"270px",backgroundColor:"#fff"},this),this.addPane(),this.ne.selectedInstance.saveRng()))},addForm:function(e,t){this.form=new bkElement("form").addEvent("submit",this.submit.closureListener(this)),this.pane.append(this.form),this.inputs={};for(itm in e){var i=e[itm],n="";t&&(n=t.getAttribute(itm)),n||(n=i.value||"");var s=e[itm].type;if("title"==s)new bkElement("div").setContent(i.txt).setStyle({fontSize:"14px",fontWeight:"bold",padding:"0px",margin:"2px 0"}).appendTo(this.form);else{var r=new bkElement("div").setStyle({overflow:"hidden",clear:"both"}).appendTo(this.form);switch(i.txt&&new bkElement("label").setAttributes({for:itm}).setContent(i.txt).setStyle({margin:"2px 4px",fontSize:"13px",width:"50px",lineHeight:"20px",textAlign:"right",float:"left"}).appendTo(r),s){case"text":this.inputs[itm]=new bkElement("input").setAttributes({id:itm,value:n,type:"text"}).setStyle({margin:"2px 0",fontSize:"13px",float:"left",height:"20px",border:"1px solid #ccc",overflow:"hidden"}).setStyle(i.style).appendTo(r);break;case"select":this.inputs[itm]=new bkElement("select").setAttributes({id:itm}).setStyle({border:"1px solid #ccc",float:"left",margin:"2px 0"}).appendTo(r);for(opt in i.options)var o=new bkElement("option").setAttributes({value:opt,selected:opt==n?"selected":""}).setContent(i.options[opt]).appendTo(this.inputs[itm]);break;case"content":this.inputs[itm]=new bkElement("textarea").setAttributes({id:itm}).setStyle({border:"1px solid #ccc",float:"left"}).setStyle(i.style).appendTo(r),this.inputs[itm].value=n}}}new bkElement("input").setAttributes({type:"submit"}).setStyle({backgroundColor:"#efefef",border:"1px solid #ccc",margin:"3px 0",float:"left",clear:"both"}).appendTo(this.form),this.form.onsubmit=bkLib.cancelEvent},submit:function(){},findElm:function(e,t,i){for(var n=this.ne.selectedInstance.getElm().getElementsByTagName(e),s=0;s<n.length;s++)if(n[s].getAttribute(t)==i)return $BK(n[s])},removePane:function(){this.pane&&(this.pane.remove(),this.pane=null,this.ne.selectedInstance.restoreRng())}}),nicButtonTips=bkClass.extend({construct:function(e){this.ne=e,e.addEvent("buttonOver",this.show.closure(this)).addEvent("buttonOut",this.hide.closure(this))},show:function(e){this.timer=setTimeout(this.create.closure(this,e),400)},create:function(e){this.timer=null,this.pane||(this.pane=new nicEditorPane(e.button,this.ne,{fontSize:"12px",marginTop:"5px"}),this.pane.setContent(e.options.name))},hide:function(e){this.timer&&clearTimeout(this.timer),this.pane&&(this.pane=this.pane.remove())}});nicEditors.registerPlugin(nicButtonTips);var nicSelectOptions={buttons:{fontSize:{name:__("Select Font Size"),type:"nicEditorFontSizeSelect",command:"fontsize"},fontFamily:{name:__("Select Font Family"),type:"nicEditorFontFamilySelect",command:"fontname"},fontFormat:{name:__("Select Font Format"),type:"nicEditorFontFormatSelect",command:"formatBlock"}}},nicEditorSelect=bkClass.extend({construct:function(e,t,i,n){this.options=i.buttons[t],this.elm=e,this.ne=n,this.name=t,this.selOptions=new Array,this.margin=new bkElement("div").setStyle({float:"left",margin:"2px 1px 0 1px"}).appendTo(this.elm),this.contain=new bkElement("div").setStyle({width:"90px",height:"20px",cursor:"pointer",overflow:"hidden"}).addClass("selectContain").addEvent("click",this.toggle.closure(this)).appendTo(this.margin),this.items=new bkElement("div").setStyle({overflow:"hidden",zoom:1,border:"1px solid #ccc",paddingLeft:"3px",backgroundColor:"#fff"}).appendTo(this.contain),this.control=new bkElement("div").setStyle({overflow:"hidden",float:"right",height:"18px",width:"16px"}).addClass("selectControl").inserthtml(this.ne.getIcon("arrow",i)).appendTo(this.items),this.txt=new bkElement("div").setStyle({overflow:"hidden",float:"left",width:"66px",height:"14px",marginTop:"1px",fontFamily:"sans-serif",textAlign:"center",fontSize:"12px"}).addClass("selectTxt").appendTo(this.items),window.opera||(this.contain.onmousedown=this.control.onmousedown=this.txt.onmousedown=bkLib.cancelEvent),this.margin.noSelect(),this.ne.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)),this.disable(),this.init()},disable:function(){this.isDisabled=!0,this.close(),this.contain.setStyle({opacity:.6})},enable:function(e){this.isDisabled=!1,this.close(),this.contain.setStyle({opacity:1})},setDisplay:function(e){this.txt.setContent(e)},toggle:function(){this.isDisabled||(this.pane?this.close():this.open())},open:function(){this.pane=new nicEditorPane(this.items,this.ne,{width:"88px",padding:"0px",borderTop:0,borderLeft:"1px solid #ccc",borderRight:"1px solid #ccc",borderBottom:"0px",backgroundColor:"#fff"});for(var e=0;e<this.selOptions.length;e++){var t=this.selOptions[e],i=new bkElement("div").setStyle({overflow:"hidden",borderBottom:"1px solid #ccc",width:"88px",textAlign:"left",overflow:"hidden",cursor:"pointer"}),n=new bkElement("div").setStyle({padding:"0px 4px"}).setContent(t[1]).appendTo(i).noSelect();n.addEvent("click",this.update.closure(this,t[0])).addEvent("mouseover",this.over.closure(this,n)).addEvent("mouseout",this.out.closure(this,n)).setAttributes("id",t[0]),this.pane.append(i),window.opera||(n.onmousedown=bkLib.cancelEvent)}},close:function(){this.pane&&(this.pane=this.pane.remove())},over:function(e){e.setStyle({backgroundColor:"#ccc"})},out:function(e){e.setStyle({backgroundColor:"#fff"})},add:function(e,t){this.selOptions.push(new Array(e,t))},update:function(e){this.ne.nicCommand(this.options.command,e),this.close()}}),nicEditorFontSizeSelect=nicEditorSelect.extend({sel:{1:"1&nbsp;(8pt)",2:"2&nbsp;(10pt)",3:"3&nbsp;(12pt)",4:"4&nbsp;(14pt)",5:"5&nbsp;(18pt)",6:"6&nbsp;(24pt)"},init:function(){this.setDisplay("Font&nbsp;Size...");for(itm in this.sel)this.add(itm,'<font size="'+itm+'">'+this.sel[itm]+"</font>")}}),nicEditorFontFamilySelect=nicEditorSelect.extend({sel:{arial:"Arial","comic sans ms":"Comic Sans","courier new":"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact","times new roman":"Times","trebuchet ms":"Trebuchet",verdana:"Verdana"},init:function(){this.setDisplay("Font&nbsp;Family...");for(itm in this.sel)this.add(itm,'<font face="'+itm+'">'+this.sel[itm]+"</font>")}}),nicEditorFontFormatSelect=nicEditorSelect.extend({sel:{p:"Paragraph",pre:"Pre",h6:"Heading&nbsp;6",h5:"Heading&nbsp;5",h4:"Heading&nbsp;4",h3:"Heading&nbsp;3",h2:"Heading&nbsp;2",h1:"Heading&nbsp;1"},init:function(){this.setDisplay("Font&nbsp;Format...");for(itm in this.sel){var e=itm.toUpperCase();this.add("<"+e+">","<"+itm+' style="padding: 0px; margin: 0px;">'+this.sel[itm]+"</"+e+">")}}});nicEditors.registerPlugin(nicPlugin,nicSelectOptions);var nicLinkOptions={buttons:{link:{name:"Add Link",type:"nicLinkButton",tags:["A"]},unlink:{name:"Remove Link",command:"unlink",noActive:!0}}},nicLinkButton=nicEditorAdvancedButton.extend({addPane:function(){this.ln=this.ne.selectedInstance.selElm().parentTag("A"),this.addForm({"":{type:"title",txt:"Add/Edit Link"},href:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},title:{type:"text",txt:"Title"},target:{type:"select",txt:"Open In",options:{"":"Current Window",_blank:"New Window"},style:{width:"100px"}}},this.ln)},submit:function(e){var t=this.inputs.href.value;if("http://"==t||""==t)return alert("You must enter a URL to Create a Link"),!1;if(this.removePane(),!this.ln){var i="javascript:nicTemp();";this.ne.nicCommand("createlink",i),this.ln=this.findElm("A","href",i)}this.ln&&this.ln.setAttributes({href:this.inputs.href.value,title:this.inputs.title.value,target:this.inputs.target.options[this.inputs.target.selectedIndex].value})}});nicEditors.registerPlugin(nicPlugin,nicLinkOptions);var nicColorOptions={buttons:{forecolor:{name:__("Change Text Color"),type:"nicEditorColorButton",noClose:!0},bgcolor:{name:__("Change Background Color"),type:"nicEditorBgColorButton",noClose:!0}}},nicEditorColorButton=nicEditorAdvancedButton.extend({addPane:function(){var e={0:"00",1:"33",2:"66",3:"99",4:"CC",5:"FF"},t=new bkElement("DIV").setStyle({width:"270px"});for(var i in e)for(var n in e)for(var s in e){var r="#"+e[i]+e[s]+e[n],o=new bkElement("DIV").setStyle({cursor:"pointer",height:"15px",float:"left"}).appendTo(t),a=new bkElement("DIV").setStyle({border:"2px solid "+r}).appendTo(o),l=new bkElement("DIV").setStyle({backgroundColor:r,overflow:"hidden",width:"11px",height:"11px"}).addEvent("click",this.colorSelect.closure(this,r)).addEvent("mouseover",this.on.closure(this,a)).addEvent("mouseout",this.off.closure(this,a,r)).appendTo(a);window.opera||(o.onmousedown=l.onmousedown=bkLib.cancelEvent)}this.pane.append(t.noSelect())},colorSelect:function(e){this.ne.nicCommand("foreColor",e),this.removePane()},on:function(e){e.setStyle({border:"2px solid #000"})},off:function(e,t){e.setStyle({border:"2px solid "+t})}}),nicEditorBgColorButton=nicEditorColorButton.extend({colorSelect:function(e){this.ne.nicCommand("hiliteColor",e),this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicColorOptions);var nicImageOptions={buttons:{image:{name:"Add Image",type:"nicImageButton",tags:["IMG"]}}},nicImageButton=nicEditorAdvancedButton.extend({addPane:function(){this.im=this.ne.selectedInstance.selElm().parentTag("IMG"),this.addForm({"":{type:"title",txt:"Add/Edit Image"},src:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},alt:{type:"text",txt:"Alt Text",style:{width:"100px"}},align:{type:"select",txt:"Align",options:{none:"Default",left:"Left",right:"Right"}}},this.im)},submit:function(e){var t=this.inputs.src.value;if(""==t||"http://"==t)return alert("You must enter a Image URL to insert"),!1;if(this.removePane(),!this.im){var i="javascript:nicImTemp();";this.ne.nicCommand("insertImage",i),this.im=this.findElm("IMG","src",i)}this.im&&this.im.setAttributes({src:this.inputs.src.value,alt:this.inputs.alt.value,align:this.inputs.align.value})}});nicEditors.registerPlugin(nicPlugin,nicImageOptions);var nicSaveOptions={buttons:{save:{name:__("Save this content"),type:"nicEditorSaveButton"}}},nicEditorSaveButton=nicEditorButton.extend({init:function(){this.ne.options.onSave||this.margin.setStyle({display:"none"})},mouseClick:function(){var e=this.ne.options.onSave,t=this.ne.selectedInstance;e(t.getContent(),t.elm.id,t)}});nicEditors.registerPlugin(nicPlugin,nicSaveOptions),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.ui=e.ui||{},e.ui.version="1.12.1";var t=0,i=Array.prototype.slice;e.cleanData=function(t){return function(i){var n,s,r;for(r=0;null!=(s=i[r]);r++)try{n=e._data(s,"events"),n&&n.remove&&e(s).triggerHandler("remove")}catch(e){}t(i)}}(e.cleanData),e.widget=function(t,i,n){var s,r,o,a={},l=t.split(".")[0];t=t.split(".")[1];var c=l+"-"+t;return n||(n=i,i=e.Widget),e.isArray(n)&&(n=e.extend.apply(null,[{}].concat(n))),e.expr[":"][c.toLowerCase()]=function(t){return!!e.data(t,c)},e[l]=e[l]||{},s=e[l][t],r=e[l][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new r(e,t)},e.extend(r,s,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),o=new i,o.options=e.widget.extend({},o.options),e.each(n,function(t,n){return e.isFunction(n)?void(a[t]=function(){function e(){return i.prototype[t].apply(this,arguments)}function s(e){return i.prototype[t].apply(this,e)}return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=s,t=n.apply(this,arguments),this._super=i,this._superApply=r,t}}()):void(a[t]=n)}),r.prototype=e.widget.extend(o,{widgetEventPrefix:s?o.widgetEventPrefix||t:t},a,{constructor:r,namespace:l,widgetName:t,widgetFullName:c}),s?(e.each(s._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,r,i._proto)}),delete s._childConstructors):i._childConstructors.push(r),e.widget.bridge(t,r),r},e.widget.extend=function(t){for(var n,s,r=i.call(arguments,1),o=0,a=r.length;a>o;o++)for(n in r[o])s=r[o][n],r[o].hasOwnProperty(n)&&void 0!==s&&(t[n]=e.isPlainObject(s)?e.isPlainObject(t[n])?e.widget.extend({},t[n],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,n){var s=n.prototype.widgetFullName||t;e.fn[t]=function(r){var o="string"==typeof r,a=i.call(arguments,1),l=this;return o?this.length||"instance"!==r?this.each(function(){var i,n=e.data(this,s);return"instance"===r?(l=n,!1):n?e.isFunction(n[r])&&"_"!==r.charAt(0)?(i=n[r].apply(n,a),i!==n&&void 0!==i?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}):l=void 0:(a.length&&(r=e.widget.extend.apply(null,[r].concat(a))),this.each(function(){var t=e.data(this,s);t?(t.option(r||{}),t._init&&t._init()):e.data(this,s,new n(r,this))})),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(i,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,i){t._removeClass(i,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,s,r,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},n=t.split("."),t=n.shift(),n.length){for(s=o[t]=e.widget.extend({},this.options[t]),r=0;n.length-1>r;r++)s[n[r]]=s[n[r]]||{},s=s[n[r]];if(t=n.pop(),1===arguments.length)return void 0===s[t]?null:s[t];s[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,n,s;for(i in t)s=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&s&&s.length&&(n=e(s.get()),this._removeClass(s,i),n.addClass(this._classes({element:n,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function i(i,r){var o,a;for(a=0;i.length>a;a++)o=s.classesElementLookup[i[a]]||e(),o=e(t.add?e.unique(o.get().concat(t.element.get())):o.not(t.element).get()),s.classesElementLookup[i[a]]=o,n.push(i[a]),r&&t.classes[i[a]]&&n.push(t.classes[i[a]])}var n=[],s=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&i(t.keys.match(/\S+/g)||[],!0),t.extra&&i(t.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(t){var i=this;e.each(i.classesElementLookup,function(n,s){-1!==e.inArray(t.target,s)&&(i.classesElementLookup[n]=e(s.not(t.target).get()))})},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,n){n="boolean"==typeof n?n:i;var s="string"==typeof e||null===e,r={extra:s?t:i,keys:s?e:t,element:s?this.element:e,add:n};return r.element.toggleClass(this._classes(r),n),this},_on:function(t,i,n){var s,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=s=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,s=this.widget()),e.each(n,function(n,o){function a(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(a.guid=o.guid=o.guid||a.guid||e.guid++);var l=n.match(/^([\w:-]*)\s*(.*)$/),c=l[1]+r.eventNamespace,d=l[2];d?s.on(c,d,a):i.on(c,a)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(i).off(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,n){var s,r,o=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(s in r)s in i||(i[s]=r[s]);return this.element.trigger(i,n),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,s,r){"string"==typeof s&&(s={effect:s});var o,a=s?s===!0||"number"==typeof s?i:s.effect||i:t;s=s||{},"number"==typeof s&&(s={duration:s}),o=!e.isEmptyObject(s),s.complete=r,s.delay&&n.delay(s.delay),o&&e.effects&&e.effects.effect[a]?n[t](s):a!==t&&n[a]?n[a](s.duration,s.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}}),e.widget,e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])}}),e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}}),e.fn.scrollParent=function(t){var i=this.css("position"),n="absolute"===i,s=t?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var t=e(this);return(!n||"static"!==t.css("position"))&&s.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&r.length?r:e(this[0].ownerDocument||document)},e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var n=!1;e(document).on("mouseup",function(){n=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!n){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,r=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(s&&!r&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,n=!1,t.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.ui.plugin={add:function(t,i,n){var s,r=e.ui[t].prototype;for(s in n)r.plugins[s]=r.plugins[s]||[],r.plugins[s].push([i,n[s]])},call:function(e,t,i,n){var s,r=e.plugins[t];if(r&&(n||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(s=0;r.length>s;s++)e.options[r[s][0]]&&r[s][1].apply(e.element,i)}},e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(i){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t},e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")},e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(this._blurActiveElement(t),this._blockFrames(i.iframeFix===!0?"iframe":i.iframeFix),!0))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=e.ui.safeActiveElement(this.document[0]),n=e(t.target);n.closest(i).length||e.ui.safeBlur(i)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=n.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper),s=n?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n&&s[0]===this.element[0]&&this._setPositionRelative(),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top);
},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,s=this.options,r=this.document[0];return this.relativeContainer=null,s.containment?"window"===s.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===s.containment?void(this.containment=[0,0,e(r).width()-this.helperProportions.width-this.margins.left,(e(r).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):s.containment.constructor===Array?void(this.containment=s.containment):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),i=e(s.containment),n=i[0],void(n&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:n?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:n?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,n,s,r,o=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,c=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(n=this.relativeContainer.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),o.grid&&(s=o.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,c=i?s-this.offset.click.top>=i[1]||s-this.offset.click.top>i[3]?s:s-this.offset.click.top>=i[1]?s-o.grid[1]:s+o.grid[1]:s,r=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?r-this.offset.click.left>=i[0]||r-this.offset.click.left>i[2]?r:r-this.offset.click.left>=i[0]?r-o.grid[0]:r+o.grid[0]:r),"y"===o.axis&&(l=this.originalPageX),"x"===o.axis&&(c=this.originalPageY)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),n.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,n){var s=e.extend({},i,{item:n.element});n.sortables=[],e(n.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(n.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,s))})},stop:function(t,i,n){var s=e.extend({},i,{item:n.element});n.cancelHelperRemoval=!1,e.each(n.sortables,function(){var e=this;e.isOver?(e.isOver=0,n.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,s))})},drag:function(t,i,n){e.each(n.sortables,function(){var s=!1,r=this;r.positionAbs=n.positionAbs,r.helperProportions=n.helperProportions,r.offset.click=n.offset.click,r._intersectsWith(r.containerCache)&&(s=!0,e.each(n.sortables,function(){return this.positionAbs=n.positionAbs,this.helperProportions=n.helperProportions,this.offset.click=n.offset.click,this!==r&&this._intersectsWith(this.containerCache)&&e.contains(r.element[0],this.element[0])&&(s=!1),s})),s?(r.isOver||(r.isOver=1,n._parent=i.helper.parent(),r.currentItem=i.helper.appendTo(r.element).data("ui-sortable-item",!0),r.options._helper=r.options.helper,r.options.helper=function(){return i.helper[0]},t.target=r.currentItem[0],r._mouseCapture(t,!0),r._mouseStart(t,!0,!0),r.offset.click.top=n.offset.click.top,r.offset.click.left=n.offset.click.left,r.offset.parent.left-=n.offset.parent.left-r.offset.parent.left,r.offset.parent.top-=n.offset.parent.top-r.offset.parent.top,n._trigger("toSortable",t),n.dropped=r.element,e.each(n.sortables,function(){this.refreshPositions()}),n.currentItem=n.element,r.fromOutside=n),r.currentItem&&(r._mouseDrag(t),i.position=r.position)):r.isOver&&(r.isOver=0,r.cancelHelperRemoval=!0,r.options._revert=r.options.revert,r.options.revert=!1,r._trigger("out",t,r._uiHash(r)),r._mouseStop(t,!0),r.options.revert=r.options._revert,r.options.helper=r.options._helper,r.placeholder&&r.placeholder.remove(),i.helper.appendTo(n._parent),n._refreshOffsets(t),i.position=n._generatePosition(t,!0),n._trigger("fromSortable",t),n.dropped=!1,e.each(n.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,n){var s=e("body"),r=n.options;s.css("cursor")&&(r._cursor=s.css("cursor")),s.css("cursor",r.cursor)},stop:function(t,i,n){var s=n.options;s._cursor&&e("body").css("cursor",s._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,n){var s=e(i.helper),r=n.options;s.css("opacity")&&(r._opacity=s.css("opacity")),s.css("opacity",r.opacity)},stop:function(t,i,n){var s=n.options;s._opacity&&e(i.helper).css("opacity",s._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,n){var s=n.options,r=!1,o=n.scrollParentNotHidden[0],a=n.document[0];o!==a&&"HTML"!==o.tagName?(s.axis&&"x"===s.axis||(n.overflowOffset.top+o.offsetHeight-t.pageY<s.scrollSensitivity?o.scrollTop=r=o.scrollTop+s.scrollSpeed:t.pageY-n.overflowOffset.top<s.scrollSensitivity&&(o.scrollTop=r=o.scrollTop-s.scrollSpeed)),s.axis&&"y"===s.axis||(n.overflowOffset.left+o.offsetWidth-t.pageX<s.scrollSensitivity?o.scrollLeft=r=o.scrollLeft+s.scrollSpeed:t.pageX-n.overflowOffset.left<s.scrollSensitivity&&(o.scrollLeft=r=o.scrollLeft-s.scrollSpeed))):(s.axis&&"x"===s.axis||(t.pageY-e(a).scrollTop()<s.scrollSensitivity?r=e(a).scrollTop(e(a).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<s.scrollSensitivity&&(r=e(a).scrollTop(e(a).scrollTop()+s.scrollSpeed))),s.axis&&"y"===s.axis||(t.pageX-e(a).scrollLeft()<s.scrollSensitivity?r=e(a).scrollLeft(e(a).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<s.scrollSensitivity&&(r=e(a).scrollLeft(e(a).scrollLeft()+s.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,n){var s=n.options;n.snapElements=[],e(s.snap.constructor!==String?s.snap.items||":data(ui-draggable)":s.snap).each(function(){var t=e(this),i=t.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,n){var s,r,o,a,l,c,d,u,h,p,f=n.options,g=f.snapTolerance,m=i.offset.left,v=m+n.helperProportions.width,w=i.offset.top,y=w+n.helperProportions.height;for(h=n.snapElements.length-1;h>=0;h--)l=n.snapElements[h].left-n.margins.left,c=l+n.snapElements[h].width,d=n.snapElements[h].top-n.margins.top,u=d+n.snapElements[h].height,l-g>v||m>c+g||d-g>y||w>u+g||!e.contains(n.snapElements[h].item.ownerDocument,n.snapElements[h].item)?(n.snapElements[h].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[h].item})),n.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(s=g>=Math.abs(d-y),r=g>=Math.abs(u-w),o=g>=Math.abs(l-v),a=g>=Math.abs(c-m),s&&(i.position.top=n._convertPositionTo("relative",{top:d-n.helperProportions.height,left:0}).top),r&&(i.position.top=n._convertPositionTo("relative",{top:u,left:0}).top),o&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c}).left)),p=s||r||o||a,"outer"!==f.snapMode&&(s=g>=Math.abs(d-w),r=g>=Math.abs(u-y),o=g>=Math.abs(l-m),a=g>=Math.abs(c-v),s&&(i.position.top=n._convertPositionTo("relative",{top:d,left:0}).top),r&&(i.position.top=n._convertPositionTo("relative",{top:u-n.helperProportions.height,left:0}).top),o&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c-n.helperProportions.width}).left)),!n.snapElements[h].snapping&&(s||r||o||a||p)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[h].item})),n.snapElements[h].snapping=s||r||o||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,n){var s,r=n.options,o=e.makeArray(e(r.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(s=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",s+t)}),this.css("zIndex",s+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,n){var s=e(i.helper),r=n.options;s.css("zIndex")&&(r._zIndex=s.css("zIndex")),s.css("zIndex",r.zIndex)},stop:function(t,i,n){var s=n.options;s._zIndex&&e(i.helper).css("zIndex",s._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[n]>0||(t[n]=1,s=t[n]>0,t[n]=0,s)},_create:function(){var t,i=this.options,n=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),i.autoHide&&e(this.element).on("mouseenter",function(){i.disabled||(n._removeClass("ui-resizable-autohide"),n._handles.show())}).on("mouseleave",function(){i.disabled||n.resizing||(n._addClass("ui-resizable-autohide"),n._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,i,n,s,r,o=this.options,a=this;if(this.handles=o.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),n=this.handles.split(","),this.handles={},i=0;n.length>i;i++)t=e.trim(n[i]),s="ui-resizable-"+t,r=e("<div>"),this._addClass(r,"ui-resizable-handle "+s),r.css({zIndex:o.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(r);this._renderAxis=function(t){var i,n,s,r;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(n=e(this.handles[i],this.element),r=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),s=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(s,r),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=r&&r[1]?r[1]:"se")}),o.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var i,n,s=!1;for(i in this.handles)n=e(this.handles[i])[0],(n===t.target||e.contains(n,t.target))&&(s=!0);return!this.options.disabled&&s},_mouseStart:function(t){var i,n,s,r=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),n=this._num(this.helper.css("top")),r.containment&&(i+=e(r.containment).scrollLeft()||0,n+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:n},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof r.aspectRatio?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===s?this.axis+"-resize":s),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,n,s=this.originalMousePosition,r=this.axis,o=t.pageX-s.left||0,a=t.pageY-s.top||0,l=this._change[r];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[t,o,a]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),n=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(n)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,n,s,r,o,a,l,c=this.options,d=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),s=n&&this._hasScroll(i[0],"left")?0:d.sizeDiff.height,r=n?0:d.sizeDiff.width,o={width:d.helper.width()-r,height:d.helper.height()-s},a=parseFloat(d.element.css("left"))+(d.position.left-d.originalPosition.left)||null,l=parseFloat(d.element.css("top"))+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(e.extend(o,{top:l,left:a})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,n,s,r,o=this.options;r={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&&(t=r.minHeight*this.aspectRatio,n=r.minWidth/this.aspectRatio,i=r.maxHeight*this.aspectRatio,s=r.maxWidth/this.aspectRatio,t>r.minWidth&&(r.minWidth=t),n>r.minHeight&&(r.minHeight=n),r.maxWidth>i&&(r.maxWidth=i),r.maxHeight>s&&(r.maxHeight=s)),this._vBoundaries=r},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,n=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===n&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===n&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,n=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,r=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,o=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.originalPosition.top+this.originalSize.height,c=/sw|nw|w/.test(i),d=/nw|ne|n/.test(i);return r&&(e.width=t.minWidth),o&&(e.height=t.minHeight),n&&(e.width=t.maxWidth),s&&(e.height=t.maxHeight),r&&c&&(e.left=a-t.minWidth),n&&c&&(e.left=a-t.maxWidth),o&&d&&(e.top=l-t.minHeight),s&&d&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],n=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],s=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseFloat(n[t])||0,i[t]+=parseFloat(s[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,s=this.originalPosition;return{top:s.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),n=i.options,s=i._proportionallyResizeElements,r=s.length&&/textarea/i.test(s[0].nodeName),o=r&&i._hasScroll(s[0],"left")?0:i.sizeDiff.height,a=r?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-o},c=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,d=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,d&&c?{top:d,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};s&&s.length&&e(s[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,n,s,r,o,a,l=e(this).resizable("instance"),c=l.options,d=l.element,u=c.containment,h=u instanceof e?u.get(0):/parent/.test(u)?d.parent().get(0):u;h&&(l.containerElement=e(h),/document/.test(u)||u===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(h),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,n){i[e]=l._num(t.css("padding"+n))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},n=l.containerOffset,s=l.containerSize.height,r=l.containerSize.width,o=l._hasScroll(h,"left")?h.scrollWidth:r,a=l._hasScroll(h)?h.scrollHeight:s,l.parentData={element:h,left:n.left,top:n.top,width:o,height:a}))},resize:function(t){var i,n,s,r,o=e(this).resizable("instance"),a=o.options,l=o.containerOffset,c=o.position,d=o._aspectRatio||t.shiftKey,u={top:0,left:0},h=o.containerElement,p=!0;h[0]!==document&&/static/.test(h.css("position"))&&(u=l),c.left<(o._helper?l.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-l.left:o.position.left-u.left),d&&(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=a.helper?l.left:0),c.top<(o._helper?l.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-l.top:o.position.top),d&&(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?l.top:0),s=o.containerElement.get(0)===o.element.parent().get(0),r=/relative|absolute/.test(o.containerElement.css("position")),s&&r?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-u.left:o.offset.left-l.left)),n=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-u.top:o.offset.top-l.top)),i+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-i,d&&(o.size.height=o.size.width/o.aspectRatio,p=!1)),n+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-n,d&&(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,n=t.containerOffset,s=t.containerPosition,r=t.containerElement,o=e(t.helper),a=o.offset(),l=o.outerWidth()-t.sizeDiff.width,c=o.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(r.css("position"))&&e(this).css({left:a.left-s.left-n.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(r.css("position"))&&e(this).css({left:a.left-s.left-n.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,i){var n=e(this).resizable("instance"),s=n.options,r=n.originalSize,o=n.originalPosition,a={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-o.top||0,left:n.position.left-o.left||0};e(s.alsoResize).each(function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),s={},r=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(r,function(e,t){var i=(n[t]||0)+(a[t]||0);i&&i>=0&&(s[t]=i||null)}),t.css(s)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),e.uiBackCompat!==!1&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),n=i.options,s=i.size,r=i.originalSize,o=i.originalPosition,a=i.axis,l="number"==typeof n.grid?[n.grid,n.grid]:n.grid,c=l[0]||1,d=l[1]||1,u=Math.round((s.width-r.width)/c)*c,h=Math.round((s.height-r.height)/d)*d,p=r.width+u,f=r.height+h,g=n.maxWidth&&p>n.maxWidth,m=n.maxHeight&&f>n.maxHeight,v=n.minWidth&&n.minWidth>p,w=n.minHeight&&n.minHeight>f;n.grid=l,v&&(p+=c),w&&(f+=d),g&&(p-=c),m&&(f-=d),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.top=o.top-h):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.left=o.left-u):((0>=f-d||0>=p-c)&&(t=i._getPaddingPlusBorderDimensions(this)),f-d>0?(i.size.height=f,i.position.top=o.top-h):(f=d-t.height,i.size.height=f,i.position.top=o.top+r.height-f),p-c>0?(i.size.width=p,i.position.left=o.left-u):(p=c-t.width,i.size.width=p,i.position.left=o.left+r.width-p))}}),e.ui.resizable});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(void 0!==n&&null!==n){n=Object(n);for(var s=Object.keys(Object(n)),r=0,o=s.length;r<o;r++){var a=s[r],l=Object.getOwnPropertyDescriptor(n,a);void 0!==l&&l.enumerable&&(t[a]=n[a])}}}return t}}),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),n=i.length>>>0,s=arguments[1],r=0;r<n;r++)if(t=i[r],e.call(s,t,r,i))return t}),Array.prototype.findIndex||(Array.prototype.findIndex=function(e){if(null===this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),n=i.length>>>0,s=arguments[1],r=0;r<n;r++)if(t=i[r],e.call(s,t,r,i))return r;return-1}),Array.prototype.includes||(Array.prototype.includes=function(e){
var t=Object(this),i=parseInt(t.length)||0;if(0===i)return!1;var n,s=parseInt(arguments[1])||0;s>=0?n=s:(n=i+s,n<0&&(n=0));for(var r;n<i;){if(r=t[n],e===r||e!==e&&r!==r)return!0;n++}return!1}),String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});var jsPanel={version:"3.4.0",date:"2016-10-27 13:45",id:0,ziBase:100,zi:100,modalcount:0,autopositionSpacing:5,pbTreshold:.556,lastbeforeclose:!1,template:'<div class="jsPanel">\n                <div class="jsPanel-hdr">\n                    <div class="jsPanel-headerbar">\n                        <div class="jsPanel-headerlogo"></div>\n                        <div class="jsPanel-titlebar">\n                            <h3 class="jsPanel-title"></h3>\n                        </div>\n                        <div class="jsPanel-controlbar">\n                            <div class="jsPanel-btn jsPanel-btn-smallify"><span class="jsglyph jsglyph-chevron-up"></span></div>\n                            <div class="jsPanel-btn jsPanel-btn-smallifyrev"><span class="jsglyph jsglyph-chevron_down"></span></div>\n                            <div class="jsPanel-btn jsPanel-btn-minimize"><span class="jsglyph jsglyph-minimize"></span></div>\n                            <div class="jsPanel-btn jsPanel-btn-normalize"><span class="jsglyph jsglyph-normalize"></span></div>\n                            <div class="jsPanel-btn jsPanel-btn-maximize"><span class="jsglyph jsglyph-maximize"></span></div>\n                            <div class="jsPanel-btn jsPanel-btn-close"><span class="jsglyph jsglyph-close"></span></div>\n                        </div>\n                    </div>\n                    <div class="jsPanel-hdr-toolbar"></div>\n                </div>\n                <div class="jsPanel-content"></div>\n                <div class="jsPanel-minimized-box"></div>\n                <div class="jsPanel-ftr"></div>\n               </div>',replacementTemplate:'<div class="jsPanel-replacement">\n                            <div class="jsPanel-hdr">\n                                <div class="jsPanel-headerbar">\n                                    <div class="jsPanel-titlebar">\n                                        <h3 class="jsPanel-title"></h3>\n                                    </div>\n                                    <div class="jsPanel-controlbar">\n                                        <div class="jsPanel-btn jsPanel-btn-normalize"><span class="jsglyph jsglyph-normalize"></span></div>\n                                        <div class="jsPanel-btn jsPanel-btn-maximize"><span class="jsglyph jsglyph-maximize"></span></div>\n                                        <div class="jsPanel-btn jsPanel-btn-close"><span class="jsglyph jsglyph-close"></span></div>\n                                    </div>\n                                </div>\n                            </div>\n                          </div>',themes:["default","primary","info","success","warning","danger"],mdbthemes:["secondary","elegant","stylish","unique","special"],tplHeaderOnly:'<div class="jsPanel">\n                        <div class="jsPanel-hdr">\n                            <div class="jsPanel-headerbar">\n                                <div class="jsPanel-headerlogo"></div>\n                                <div class="jsPanel-titlebar">\n                                    <h3 class="jsPanel-title"></h3>\n                                </div>\n                                <div class="jsPanel-controlbar">\n                                    <div class="jsPanel-btn jsPanel-btn-close"><span class="jsglyph jsglyph-close"></span></div>\n                                </div>\n                            </div>\n                            <div class="jsPanel-hdr-toolbar"></div>\n                        </div>\n                    </div>',tplContentOnly:'<div class="jsPanel">\n                        <div class="jsPanel-content jsPanel-content-noheader jsPanel-content-nofooter"></div>\n                        <div class="jsPanel-minimized-box"></div>\n                     </div>',activePanels:{list:[],getPanel:function(e){return"string"==typeof e?document.getElementById(e).jspanel.noop():document.getElementById(this.list[e]).jspanel.noop()}},closeOnEscape:!1,isIE:function(){return navigator.appVersion.includes("Trident")}(),isEdge:function(){return navigator.appVersion.includes("Edge")}(),addConnector:function(e){var t=e.option.paneltype.connectorBG||null;e.hasClass("jsPanel-tooltip-top")?(e.append('<div class="jsPanel-connector jsPanel-connector-top">'),$(".jsPanel-connector-top",e).css("border-top-color",t||this.calcConnectorBg(e,"top")),e.option.position.offsetY=e.option.position.offsetY-10||-10):e.hasClass("jsPanel-tooltip-bottom")?(e.append('<div class="jsPanel-connector jsPanel-connector-bottom">'),$(".jsPanel-connector-bottom",e).css("border-bottom-color",t||this.calcConnectorBg(e,"bottom")),e.option.position.offsetY=e.option.position.offsetY+10||10):e.hasClass("jsPanel-tooltip-left")?(e.append('<div class="jsPanel-connector jsPanel-connector-left">'),$(".jsPanel-connector-left",e).css("border-left-color",t||this.calcConnectorBg(e,"left")),e.option.position.offsetX=e.option.position.offsetX-12||-12):e.hasClass("jsPanel-tooltip-right")?(e.append('<div class="jsPanel-connector jsPanel-connector-right">'),$(".jsPanel-connector-right",e).css("border-right-color",t||this.calcConnectorBg(e,"right")),e.option.position.offsetX=e.option.position.offsetX+12||12):e.hasClass("jsPanel-tooltip-lefttopcorner")?(e.append('<div class="jsPanel-connector jsPanel-connector-lefttopcorner">'),$(".jsPanel-connector-lefttopcorner",e).css("background-color",t||this.calcConnectorBg(e,"lefttopcorner"))):e.hasClass("jsPanel-tooltip-righttopcorner")?(e.append('<div class="jsPanel-connector jsPanel-connector-righttopcorner">'),$(".jsPanel-connector-righttopcorner",e).css("background-color",t||this.calcConnectorBg(e,"righttopcorner"))):e.hasClass("jsPanel-tooltip-rightbottomcorner")?(e.append('<div class="jsPanel-connector jsPanel-connector-rightbottomcorner">'),$(".jsPanel-connector-rightbottomcorner",e).css("background-color",t||this.calcConnectorBg(e,"rightbottomcorner"))):e.hasClass("jsPanel-tooltip-leftbottomcorner")?(e.append('<div class="jsPanel-connector jsPanel-connector-leftbottomcorner">'),$(".jsPanel-connector-leftbottomcorner",e).css("background-color",t||this.calcConnectorBg(e,"leftbottomcorner"))):e.hasClass("jsPanel-tooltip-lefttop")?(e.append('<div class="jsPanel-connector jsPanel-connector-lefttop">'),$(".jsPanel-connector-lefttop",e).css("border-left-color",t||this.calcConnectorBg(e,"lefttop")),e.option.position.offsetX=e.option.position.offsetX-12||-12):e.hasClass("jsPanel-tooltip-leftbottom")?(e.append('<div class="jsPanel-connector jsPanel-connector-leftbottom">'),$(".jsPanel-connector-leftbottom",e).css("border-left-color",t||this.calcConnectorBg(e,"leftbottom")),e.option.position.offsetX=e.option.position.offsetX-12||-12):e.hasClass("jsPanel-tooltip-topleft")?(e.append('<div class="jsPanel-connector jsPanel-connector-topleft">'),$(".jsPanel-connector-topleft",e).css("border-top-color",t||this.calcConnectorBg(e,"topleft")),e.option.position.offsetY=e.option.position.offsetY-10||-10):e.hasClass("jsPanel-tooltip-topright")?(e.append('<div class="jsPanel-connector jsPanel-connector-topright">'),$(".jsPanel-connector-topright",e).css("border-top-color",t||this.calcConnectorBg(e,"topright")),e.option.position.offsetY=e.option.position.offsetY-10||-10):e.hasClass("jsPanel-tooltip-righttop")?(e.append('<div class="jsPanel-connector jsPanel-connector-righttop">'),$(".jsPanel-connector-righttop",e).css("border-right-color",t||this.calcConnectorBg(e,"righttop")),e.option.position.offsetX=e.option.position.offsetX+12||12):e.hasClass("jsPanel-tooltip-rightbottom")?(e.append('<div class="jsPanel-connector jsPanel-connector-rightbottom">'),$(".jsPanel-connector-rightbottom",e).css("border-right-color",t||this.calcConnectorBg(e,"rightbottom")),e.option.position.offsetX=e.option.position.offsetX+12||12):e.hasClass("jsPanel-tooltip-bottomleft")?(e.append('<div class="jsPanel-connector jsPanel-connector-bottomleft">'),$(".jsPanel-connector-bottomleft",e).css("border-bottom-color",t||this.calcConnectorBg(e,"bottomleft")),e.option.position.offsetY=e.option.position.offsetY+10||10):e.hasClass("jsPanel-tooltip-bottomright")&&(e.append('<div class="jsPanel-connector jsPanel-connector-bottomright">'),$(".jsPanel-connector-bottomright",e).css("border-bottom-color",t||this.calcConnectorBg(e,"bottomright")),e.option.position.offsetY=e.option.position.offsetY+10||10)},addCustomTheme:function(e){this.themes.includes(e)||this.themes.push(e)},ajax:function(e){var t=e.option.contentAjax;t.then&&(t.then[0]&&(t.done=t.then[0]),t.then[1]&&(t.fail=t.then[1])),$.ajax(t).done(function(i,n,s){t.autoload&&e.content.append(i),$.isFunction(t.done)&&t.done.call(e,i,n,s,e)}).fail(function(i,n,s){$.isFunction(t.fail)&&t.fail.call(e,i,n,s,e)}).always(function(i,n,s){$.isFunction(t.always)&&t.always.call(e,i,n,s,e)}),e.data("ajaxURL",t.url)},applyBuiltInTheme:function(e,t){e.addClass("jsPanel-theme-"+t.color).header.addClass("jsPanel-theme-"+t.color),"filled"===t.filling?e.content.css("background","").addClass("jsPanel-content-filled"):"filledlight"===t.filling&&e.content.css("background","").addClass("jsPanel-content-filledlight"),e.option.headerToolbar||e.content.css({borderTop:"1px solid "+e.header.title.css("color")})},applyArbitraryTheme:function(e,t){e.header.css("background-color",t.colors[0]),$(".jsPanel-headerlogo, .jsPanel-title, .jsPanel-controlbar .jsPanel-btn .jsglyph, .jsPanel-hdr-toolbar",e).css({color:t.colors[3]}),e.option.headerToolbar?e.header.toolbar.css({boxShadow:"0 0 1px "+t.colors[3]+" inset",width:"calc(100% + 4px)",marginLeft:"-1px"}):e.content.css({borderTop:"1px solid "+t.colors[3]}),"filled"===t.filling?e.content.css({backgroundColor:t.colors[0],color:t.colors[3]}):"filledlight"===t.filling&&e.content.css({backgroundColor:t.colors[1]})},applyBootstrapTheme:function(e,t){var i=void 0;if(e.addClass("panel panel-"+t.bstheme+" card card-inverse card-"+t.bstheme).header.addClass("panel-heading").title.addClass("panel-title"),"mdb"===t.bs){var n=t.bstheme+"-color";t.mdbStyle&&(n+="-dark"),e.removeClass("panel panel-"+t.bstheme).addClass(n)}e.content.addClass("panel-body").css("border-top-color",function(){return e.header.css("border-top-color")}),e.footer.addClass("panel-footer card-footer"),i="transparent"===$(".panel-heading",e).css("background-color")?e.css("background-color").replace(/\s+/g,""):$(".panel-heading",e).css("background-color").replace(/\s+/g,"");var s=this.calcColors(i);$(".jsPanel-headerlogo, .jsPanel-title, .jsPanel-controlbar .jsPanel-btn, .jsPanel-hdr-toolbar",e.header).css("color",s[3]),e.option.headerToolbar?e.header.toolbar.css({boxShadow:"0 0 1px "+s[3]+" inset",width:"calc(100% + 4px)",marginLeft:"-1px"}):e.content.css({borderTop:"1px solid "+s[3]}),"filled"===t.filling?e.content.css({backgroundColor:i,color:s[3]}):"filledlight"===t.filling&&e.content.css({backgroundColor:s[1],color:"#000000"})},applyThemeBorder:function(e,t){var i=e.option.border.split(" ");if(e.css({"border-width":i[0],"border-style":i[1]}),e.header.css({"border-top-left-radius":0,"border-top-right-radius":0}),t.bs){var n=void 0;n="transparent"===$(".panel-heading",e).css("background-color")?e.css("background-color").replace(/\s+/g,""):$(".panel-heading",e).css("background-color").replace(/\s+/g,""),i[2]?e.css("border-color",i[2]):e.css("border-color",n)}else this.themes.includes(t.color)||(i[2]?e.css("border-color",i[2]):e.css("border-color",t.colors[0]))},calcColors:function(e){var t=this.color(e),i=this.lighten(e,.81),n=this.darken(e,.5),s=this.perceivedBrightness(e)<=this.pbTreshold?"#ffffff":"#000000",r=this.perceivedBrightness(i)<=this.pbTreshold?"#ffffff":"#000000",o=this.perceivedBrightness(n)<=this.pbTreshold?"#000000":"#ffffff";return[t.hsl.css,i,n,s,r,o]},calcConnectorBg:function(e,t){var i=e.content.css("background-color"),n=e.footer.css("background-color"),s=e.header.css("background-color");if(t.match(/^(top|topleft|topright|lefttopcorner|righttopcorner|leftbottom|rightbottom)$/))return"none"!==e.footer.css("display")?n:parseFloat(e.option.contentSize.height)>0?i:s;if(t.match(/^(bottom|bottomleft|bottomright|leftbottomcorner|rightbottomcorner)$/)){if(!e.option.headerRemove)return s;if(parseFloat(e.option.contentSize.height)>0)return i;if("none"!==e.footer.css("display"))return n}else{if(t.match(/^(lefttop|righttop)$/))return e.option.headerRemove?i:s;if(t.match(/^(left|right)$/)){if(parseFloat(e.option.contentSize.height)>0)return i;if(!e.option.headerRemove)return s;if("none"!==e.footer.css("display"))return n}}},clearTheme:function(e){this.themes.concat(this.mdbthemes).forEach(function(t){e.removeClass("panel card card-inverse jsPanel-theme-"+t+" panel-"+t+" card-"+t+" "+t+"-color"),e.header.removeClass("panel-heading jsPanel-theme-"+t)}),$(".jsPanel-content",e).removeClass("jsPanel-content-filled jsPanel-content-filledlight"),e.css({borderWidth:"",borderStyle:"",borderColor:""}),$(".jsPanel-hdr, .jsPanel-content",e).css({background:""}),$(".jsPanel-headerlogo, .jsPanel-title, .jsPanel-controlbar .jsPanel-btn .jsglyph, .jsPanel-hdr-toolbar, .jsPanel-content",e).css({color:""}),e.header.title.removeClass("panel-title"),e.header.toolbar.css({boxShadow:"",width:"",marginLeft:""}),e.content.removeClass("panel-body").css({borderTop:"",borderTopColor:""}),e.footer.removeClass("panel-footer card-footer")},close:function(e){function t(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i=l;var s=e.option.position;if(s.autoposition||"string"==typeof s&&s.match(/DOWN|RIGHT|UP|LEFT/)){var a=/left-top|center-top|right-top|left-center|center|right-center|left-bottom|center-bottom|right-bottom/,c=$(e).parent(),d=document.getElementById(r).className.match(a);d&&(jsPanel.lastbeforeclose={parent:c,class:d[0]})}e.closeChildpanels().remove(),$("#"+r).length||!function(){var t=jsPanel.activePanels.list.findIndex(function(e){return e===r});t>-1&&jsPanel.activePanels.list.splice(t,1),jsPanel.remMinReplacement(e),"modal"===e.option.paneltype&&jsPanel.removeModalBackdrop(e),e.option.paneltype.tooltip&&$(o).removeClass("hasTooltip"),$(document).trigger("jspanelclosed",r),$(document).trigger("jspanelstatuschange",r);var n=void 0,s=void 0,a=void 0;jsPanel.lastbeforeclose&&(n=jsPanel.lastbeforeclose.parent,s=$("."+jsPanel.lastbeforeclose.class,n),a=jsPanel.lastbeforeclose.class),s&&(s.each(function(e,t){$(t).removeClass(a)}),s.each(function(t,i){jsPanel.position(i,e.option.position)})),jsPanel.lastbeforeclose=!1,i[2]===!0?$.noop():$.isFunction(e.option.onclosed)&&e.option.onclosed.call(e,e),i[0]&&$.isFunction(i[0])&&i[0].call(e,e),jsPanel.resetZis()}()}for(var i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=e.attr("id"),o=this.setTrigger(e.option.position),a=e.option.delayClose,l=n;if($(document).trigger("jspanelbeforeclose",r),$.isFunction(e.option.onbeforeclose))if(n[1]===!0)$.noop();else if(e.option.onbeforeclose.call(e,e)===!1)return e;a&&"number"==typeof a&&a>0?window.setTimeout(function(){t(e,n[0],n[2])},a):t(e,n[0],n[2])},closeChildpanels:function(e){return $(".jsPanel",e).each(function(e,t){t.jspanel.close()}),e},closeTooltips:function(){$(".jsPanel-tooltip").each(function(e,t){t.jspanel&&t.jspanel.close()})},calcPositionFactors:function(e){"body"===e.option.container?(e.hf=parseInt(e.css("left"),10)/($(window).outerWidth()-e.outerWidth()),e.vf=parseInt(e.css("top"),10)/($(window).outerHeight()-e.outerHeight())):(e.hf=parseInt(e.css("left"),10)/(e.parent().outerWidth()-e.outerWidth()),e.vf=parseInt(e.css("top"),10)/(e.parent().outerHeight()-e.outerHeight()))},color:function e(t){var e=t.toLowerCase(),i=void 0,n=void 0,s=void 0,r=void 0,o=void 0,a=void 0,l=void 0,c=void 0,d=void 0,u={},h=/^#?([0-9a-f]{3}|[0-9a-f]{6})$/gi,p=/^rgba?\(([0-9]{1,3}),([0-9]{1,3}),([0-9]{1,3}),?(0|1|0\.[0-9]{1,2}|\.[0-9]{1,2})?\)$/gi,f=/^hsla?\(([0-9]{1,3}),([0-9]{1,3}\%),([0-9]{1,3}\%),?(0|1|0\.[0-9]{1,2}|\.[0-9]{1,2})?\)$/gi,g={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgrey:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",grey:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};return g[e]&&(e=g[e]),null!==e.match(h)?(e=e.replace("#",""),e.length%2===1?(i=String(e.substr(0,1))+e.substr(0,1),n=String(e.substr(1,1))+e.substr(1,1),s=String(e.substr(2,1))+e.substr(2,1),u.rgb={r:parseInt(i,16),g:parseInt(n,16),b:parseInt(s,16)},u.hex="#"+i+n+s):(u.rgb={r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16)},u.hex="#"+e),d=this.rgbToHsl(u.rgb.r,u.rgb.g,u.rgb.b),u.hsl=d,u.rgb.css="rgb("+u.rgb.r+","+u.rgb.g+","+u.rgb.b+")"):e.match(p)?(l=p.exec(e),u.rgb={css:e,r:l[1],g:l[2],b:l[3]},u.hex=this.rgbToHex(l[1],l[2],l[3]),d=this.rgbToHsl(l[1],l[2],l[3]),u.hsl=d):e.match(f)?(l=f.exec(e),r=l[1]/360,o=l[2].substr(0,l[2].length-1)/100,a=l[3].substr(0,l[3].length-1)/100,c=this.hslToRgb(r,o,a),u.rgb={css:"rgb("+c[0]+","+c[1]+","+c[2]+")",r:c[0],g:c[1],b:c[2]},u.hex=this.rgbToHex(u.rgb.r,u.rgb.g,u.rgb.b),u.hsl={css:"hsl("+l[1]+","+l[2]+","+l[3]+")",h:l[1],s:l[2],l:l[3]}):(u.hex="#f5f5f5",u.rgb={css:"rgb(245,245,245)",r:245,g:245,b:245},u.hsl={css:"hsl(0,0%,96.08%)",h:0,s:"0%",l:"96.08%"}),u},configIconfont:function(e){var t=["close","maximize","normalize","minimize","smallify","smallifyrev"],i=["remove","fullscreen","resize-full","minus","chevron-up","chevron-down"],n=["times fa-window-close","arrows-alt fa-window-maximize","expand fa-window-restore","minus fa-window-minimize","chevron-up","chevron-down"],s=["close","fullscreen","fullscreen_exit","call_received","expand_less","expand_more"],r=["w2ui-icon-window-close","w2ui-icon-window-maximize","w2ui-icon-window-restore","w2ui-icon-window-minimize","w2ui-icon-chevron_up","w2ui-icon-chevron_down"];optIconfont=e.option.headerControls.iconfont,controls=e.header.headerbar,"bootstrap"===optIconfont||"glyphicon"===optIconfont?t.forEach(function(e,t){$(".jsPanel-btn-"+e+" span",controls).removeClass().addClass("glyphicon glyphicon-"+i[t])}):"font-awesome"===optIconfont?t.forEach(function(e,t){$(".jsPanel-btn-"+e+" span",controls).removeClass().addClass("fa fa-"+n[t])}):"material-icons"===optIconfont?t.forEach(function(e,t){$(".jsPanel-btn-"+e+" span",controls).removeClass().addClass("material-icons").text(s[t])}):"w2ui-icons"===optIconfont&&t.forEach(function(e,t){$(".jsPanel-btn-"+e+" span",controls).removeClass().addClass(r[t])})},configToolbar:function(e,t,i){var n=void 0;e.forEach(function(e){if("object"===("undefined"==typeof e?"undefined":_typeof(e))&&(n=$(e.item),"string"==typeof e.btntext&&n.append(e.btntext),"string"==typeof e.btnclass&&n.addClass(e.btnclass),t.append(n),$.isFunction(e.callback))){var s=e.event||"click";n.on(s,i,e.callback)}})},contentReload:function(e,t){return e.option.content?e.content.empty().append(e.option.content):e.option.contentAjax?(e.content.empty(),this.ajax(e)):e.option.contentIframe&&(e.content.empty(),this.iframe(e)),t&&$.isFunction(t)&&t.call(e,e),e},contentResize:function(e,t){var i=e.footer.hasClass("active")?e.header.outerHeight()+e.footer.outerHeight():e.header.outerHeight(),n=parseInt(e.css("border-top-width"),10)+parseInt(e.css("border-bottom-width"),10);return e.content.css({height:e.outerHeight()-i-n}),t&&$.isFunction(t)&&t.call(e,e),e},createMinimizedReplacement:function(e){var t=$(this.replacementTemplate),i=e.header.title.css("color"),n=void 0;n="transparent"===e.header.css("background-color")?e.css("background-color"):e.header.css("background-color"),e.css("left","-9999px").data("status","minimized"),t.css({backgroundColor:n}).prop("id",e.prop("id")+"-min").find("h3").css({color:i}).prop("title",e.header.title[0].textContent).html(e.headerTitle()),e.header.logo.children().length&&$(".jsPanel-headerbar",t).prepend(e.header.logo.clone());var s=e.option.headerControls.iconfont;return"font-awesome"===s?($(".jsglyph.jsglyph-normalize",t).removeClass().addClass("fa fa-expand fa-window-restore"),$(".jsglyph.jsglyph-maximize",t).removeClass().addClass("fa fa-arrows-alt fa-window-maximize"),$(".jsglyph.jsglyph-close",t).removeClass().addClass("fa fa-times fa-window-close")):"bootstrap"===s||"glyphicon"===s?($(".jsglyph.jsglyph-normalize",t).removeClass().addClass("glyphicon glyphicon-resize-full"),$(".jsglyph.jsglyph-maximize",t).removeClass().addClass("glyphicon glyphicon-fullscreen"),$(".jsglyph.jsglyph-close",t).removeClass().addClass("glyphicon glyphicon-remove")):"material-icons"===s?($(".jsglyph.jsglyph-normalize",t).removeClass().addClass("material-icons").text("call_made"),$(".jsglyph.jsglyph-maximize",t).removeClass().addClass("material-icons").text("fullscreen"),$(".jsglyph.jsglyph-close",t).removeClass().addClass("material-icons").text("close")):"w2ui-icons"===s&&($(".jsglyph.jsglyph-normalize",t).removeClass().addClass("w2ui-icon-window-restore"),$(".jsglyph.jsglyph-maximize",t).removeClass().addClass("w2ui-icon-window-maximize"),$(".jsglyph.jsglyph-close",t).removeClass().addClass("w2ui-icon-window-close")),$(".jsPanel-btn span",t).css({color:i}),t},darken:function(e,t){var i=this.color(e).hsl,n=parseFloat(i.l),s=n-n*t+"%";return"hsl("+i.h+","+i.s+","+s+")"},dblclickhelper:function(e,t){"string"==typeof e&&("maximize"===e||"normalize"===e?"normalized"===t.data("status")?t.maximize():t.normalize():"minimize"!==e&&"smallify"!==e&&"close"!==e||t[e]())},exportPanels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:".jsPanel",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jspanels",i=[],n=$(".jsPanel").not(".jsPanel-tooltip, .jsPanel-hint, .jsPanel-modal").filter(e);return n.each(function(e,t){"normalized"!==$(t).data("status")&&$(".jsPanel-btn-normalize",t).trigger("click")}),n.each(function(e,t){var n=void 0,s=void 0,r=void 0,o=void 0,a=void 0,l=$(t).data("container"),c=$(t).offset(),d=$(t).position(),u=$(t).data("status");switch("minimized"===u?("body"===l.toLowerCase()?(n=$(t).data("paneltop")-$(window).scrollTop(),s=$(t).data("panelleft")-$(window).scrollLeft()):(n=$(t).data("paneltop"),s=$(t).data("panelleft")),r=$(t).data("panelwidth"),o=$(t).data("panelheight")):("body"===l.toLowerCase()?(n=Math.floor(c.top-$(window).scrollTop()),s=Math.floor(c.left-$(window).scrollLeft())):(n=Math.floor(d.top),s=Math.floor(d.left)),r=$(t).css("width"),o=$(".jsPanel-content",t).css("height")),a={status:$(t).data("status"),id:$(t).prop("id"),headerTitle:$(".jsPanel-title",t).html(),custom:$(t).data("custom"),content:$(t).data("content"),contentSize:{width:r,height:o},position:{my:"left-top",at:"left-top",offsetX:s,offsetY:n}},$(t).data("ajaxURL")&&(a.contentAjax={url:$(t).data("ajaxURL"),autoload:!0}),($(t).data("iframeDOC")||$(t).data("iframeSRC"))&&(a.contentIframe={src:$(t).data("iframeSRC")||"",srcdoc:$(t).data("iframeDOC")||""}),i.push(a),a.status){case"minimized":$(".jsPanel-btn-minimize",t).trigger("click");break;case"maximized":$(".jsPanel-btn-maximize",t).trigger("click");break;case"smallified":$(".jsPanel-btn-smallify",t).trigger("click");break;case"smallifiedMax":$(".jsPanel-btn-smallify",t).trigger("click")}}),window.localStorage.setItem(t,JSON.stringify(i)),i},front:function(e,t){if(e.css("z-index",this.setZi(e)),this.resetZis(),$(document).trigger("jspanelfronted",e.prop("id")),$.isFunction(e.option.onfronted)){if(e.option.onfronted.call(e,e)===!1)return e;e.option.onfronted.call(e,e)}return t&&$.isFunction(t)&&t.call(e,e),e},getThemeDetails:function(e){var t={color:!1,colors:!1,filling:!1,bs:!1,bstheme:!1};if("filled"===e.substr(-6,6)?(t.filling="filled",t.color=e.substr(0,e.length-6)):"filledlight"===e.substr(-11,11)?(t.filling="filledlight",t.color=e.substr(0,e.length-11)):(t.filling="",t.color=e),t.colors=this.calcColors(t.color),t.color.match("-")){var i=t.color.split("-");t.bs=i[0],t.bstheme=i[1],t.mdbStyle=i[2]||void 0}return t},getTopmostPanel:function(){var e=[],t=$(".jsPanel:not(.jsPanel-tooltip):not(.jsPanel-hint)");return t.each(function(t,i){e.push(i)}),e.sort(function(e,t){return $(t).css("z-index")-$(e).css("z-index")}),e[0].getAttribute("id")},headerTitle:function(e,t){return t?(e.header.title.empty().append(t),e):e.header.title.html()},headerControl:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"enable";return t?this.setControlStatus(e,t,i):["close","maximize","minimize","normalize","smallify"].forEach(function(t){jsPanel.setControlStatus(e,t)}),e},hslToRgb:function(e,t,i){var n,s,r;if(0===t)n=s=r=i;else{var o=function(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e},a=i<.5?i*(1+t):i+t-i*t,l=2*i-a;n=o(l,a,e+1/3),s=o(l,a,e),r=o(l,a,e-1/3)}return[Math.round(255*n),Math.round(255*s),Math.round(255*r)]},iframe:function(e){var t=$("<iframe></iframe>"),i=e.option.contentIframe;i.srcdoc&&(t.prop("srcdoc",i.srcdoc),e.data("iframeDOC",i.srcdoc)),i.src&&(t.prop("src",i.src),e.data("iframeSRC",i.src)),"auto"===e.option.contentSize.width||i.width?t.prop("width",i.width):t.css("width","100%"),"auto"===e.option.contentSize.height||i.height?t.prop("height",i.height):t.css("height","100%"),i.name&&t.prop("name",i.name),i.sandbox&&t.prop("sandox",i.sandbox),i.id&&t.prop("id",i.id),$.isPlainObject(i.style)&&t.css(i.style),"string"==typeof i.classname?t.addClass(i.classname):$.isFunction(i.classname)&&t.addClass(i.classname()),e.content.append(t)},importPanels:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jspanels",i=JSON.parse(localStorage[t]),n=e.default||{},s=void 0;i.forEach(function(t){s="string"==typeof t.custom.config?$.extend(!0,{},n,e[t.custom.config],t):$.extend(!0,{},n,t),$.jsPanel(s)})},insertModalBackdrop:function(e){var t=$(".jsPanel-modal-backdrop").length,i=0===t?"jsPanel-modal-backdrop":"jsPanel-modal-backdrop jsPanel-modal-backdrop-multi",n='<div id="jsPanel-modal-backdrop-'+e.attr("id")+'" class="'+i+'" style="z-index:'+(this.modalcount+9999)+'"></div>';$("body").append(n),this.modalcount+=1,$("#jsPanel-modal-backdrop-"+e.attr("id")).animate({opacity:.65},750)},lighten:function(e,t){var i=this.color(e).hsl,n=parseFloat(i.l),s=n+(100-n)*t+"%";return"hsl("+i.h+","+i.s+","+s+")"},maximize:function(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.option.maximizedMargin,s=e[0].parentNode,r=e.attr("id");return"normalized"===e.data("status")&&e.updateCachedData(),$(document).trigger("jspanelbeforemaximize",r),$.isFunction(e.option.onbeforemaximize)&&e.option.onbeforemaximize.call(e,e)===!1?e:(e.css("overflow","visible"),s===document.body?(e.css({width:document.documentElement.clientWidth-n.left-n.right+"px",height:document.documentElement.clientHeight-n.top-n.bottom+"px",left:n.left+"px",top:n.top+"px"}),e.option.position.fixed===!1&&e.css({left:window.pageXOffset+n.left+"px",top:window.pageYOffset+n.top+"px"})):e.css({width:s.clientWidth-n.left-n.right+"px",height:s.clientHeight-n.top-n.bottom+"px",left:n.left+"px",top:n.top+"px"}),e.contentResize().data("status","maximized"),i&&e.css("z-index",this.setZi(e)),e.hideControls(".jsPanel-btn-maximize, .jsPanel-btn-smallifyrev"),this.remMinReplacement(e),$(document).trigger("jspanelmaximized",r),$(document).trigger("jspanelstatuschange",r),$.isFunction(e.option.onmaximized)&&e.option.onmaximized.call(e,e),t&&$.isFunction(t)&&t.call(e,e),e)},minimize:function(e,t){var i=e.attr("id");if("minimized"===e.data("status"))return e;if($(document).trigger("jspanelbeforeminimize",i),$.isFunction(e.option.onbeforeminimize)&&e.option.onbeforeminimize.call(e,e)===!1)return e;var n=e.data("status");"normalized"===n?e.updateCachedData():"smallified"===n&&(e.cachedData.top=e.css("top"),e.cachedData.left=e.css("left"));var s=this.createMinimizedReplacement(e),r=$(e.option.container).closest(".jsPanel-content");if(r.length){var o=".jsPanel-minimized-box";e.option.minimizeTo&&("string"==typeof e.option.minimizeTo?(o=e.option.minimizeTo,$(o).append(s)):$(o,r.parent()).append(s))}else{var a="#jsPanel-replacement-container";e.option.minimizeTo&&("string"==typeof e.option.minimizeTo&&(a=e.option.minimizeTo),$(a).append(s))}return $(document).trigger("jspanelminimized",i),$(document).trigger("jspanelstatuschange",i),$.isFunction(e.option.onminimized)&&e.option.onminimized.call(e,e),t&&$.isFunction(t)&&t.call(e,e),$(".jsPanel-btn-normalize",s).css("display","block").on("click",function(){return e.normalize()}),"disabled"===e[0].dataset.btnnormalize?$(".jsPanel-btn-normalize",s).css({pointerEvents:"none",opacity:.5,cursor:"default"}):"removed"===e[0].dataset.btnnormalize&&$(".jsPanel-btn-normalize",s).remove(),$(".jsPanel-btn-maximize",s).on("click",function(){return e.maximize()}),"disabled"===e[0].dataset.btnmaximize?$(".jsPanel-btn-maximize",s).css({pointerEvents:"none",opacity:.5,cursor:"default"}):"removed"===e[0].dataset.btnmaximize&&$(".jsPanel-btn-maximize",s).remove(),$(".jsPanel-btn-close",s).on("click",function(){return e.close()}),"disabled"===e[0].dataset.btnclose&&$(".jsPanel-btn-close",s).css({pointerEvents:"none",opacity:.5,cursor:"default"}),e},normalize:function(e,t){var i=e.attr("id");return"normalized"===e.data("status")?e:($(document).trigger("jspanelbeforenormalize",i),$.isFunction(e.option.onbeforenormalize)&&e.option.onbeforenormalize.call(e,e)===!1?e:"smallified"===e.data("status")?(e.smallify(),
$(document).trigger("jspanelnormalized",i),$(document).trigger("jspanelstatuschange",i),$.isFunction(e.option.onnormalized)&&e.option.onnormalized.call(e,e),e):(e.css({left:e.cachedData.left,top:e.cachedData.top,width:e.cachedData.width,height:e.cachedData.height,zIndex:function(){jsPanel.setZi(e)},overflow:"visible"}).data("status","normalized").contentResize(),e.hideControls(".jsPanel-btn-normalize, .jsPanel-btn-smallifyrev"),this.remMinReplacement(e),$(document).trigger("jspanelnormalized",i),$(document).trigger("jspanelstatuschange",i),$.isFunction(e.option.onnormalized)&&e.option.onnormalized.call(e,e),t&&$.isFunction(t)&&t.call(e,e),e))},perceivedBrightness:function(e){var t=this.color(e).rgb;return t.r/255*.2627+t.g/255*.678+t.b/255*.0593},position:function e(t,i){function n(e){var t={};return w.includes(e)?t.left=window.pageXOffset:y.includes(e)?t.left=window.pageXOffset+document.documentElement.clientWidth/2:b.includes(e)?t.left=window.pageXOffset+document.documentElement.clientWidth:t.left=window.pageXOffset,x.includes(e)?t.top=window.pageYOffset:_.includes(e)?t.top=window.pageYOffset+window.innerHeight/2:C.includes(e)?t.top=window.pageYOffset+window.innerHeight:t.top=window.pageYOffset,t}function s(e){var t={},i=a(d.of);return w.includes(e)?t.left=i.left:y.includes(e)?t.left=i.left+i.width/2:b.includes(e)?t.left=i.left+i.width:t.left=i.left,x.includes(e)?t.top=i.top:_.includes(e)?t.top=i.top+i.height/2:C.includes(e)?t.top=i.top+i.height:t.top=i.top,t}function r(e){var t={},i=u.getBoundingClientRect();return w.includes(e)?t.left=0:y.includes(e)?t.left=i.width/2:b.includes(e)?t.left=i.width:t.left=0,x.includes(e)?t.top=0:_.includes(e)?t.top=i.height/2:C.includes(e)?t.top=i.height:t.top=0,t}function o(e){var t={},i=u.getBoundingClientRect(),n=document.querySelector(d.of).getBoundingClientRect(),s=n.left-i.left,r=n.top-i.top;return w.includes(e)?t.left=s:y.includes(e)?t.left=s+n.width/2:b.includes(e)?t.left=s+n.width:t.left=s,x.includes(e)?t.top=r:_.includes(e)?t.top=r+n.height/2:C.includes(e)?t.top=r+n.height:t.top=r,t}function a(e){var t=void 0;return t=e.jquery?e[0].getBoundingClientRect():"string"==typeof e?document.querySelector(e).getBoundingClientRect():e.getBoundingClientRect(),{width:Math.round(t.width),height:Math.round(t.height),left:Math.round(t.left+window.pageXOffset),top:Math.round(t.top+window.pageYOffset)}}var l=void 0,c=void 0,d=void 0,u=void 0,h=0,p=0,f=void 0,g=void 0,m=void 0,v={my:"center",at:"center",offsetX:0,offsetY:0,modify:!1,fixed:"true"},w=["left-top","left-center","left-bottom"],y=["center-top","center","center-bottom"],b=["right-top","right-center","right-bottom"],x=["left-top","center-top","right-top"],_=["left-center","center","right-center"],C=["left-bottom","center-bottom","right-bottom"];if("string"==typeof i){var k=/\b[a-z]{4,6}-{1}[a-z]{3,6}\b/,T=/DOWN|UP|RIGHT|LEFT/,S=/[+-]?\d+\.?\d*%?/g,E=i.match(k),j=i.match(T),z=i.match(S),e=void 0;e=$.isArray(E)?{my:E[0],at:E[0]}:{my:"center",at:"center"},$.isArray(j)&&(e.autoposition=j[0]),$.isArray(z)&&(e.offsetX=z[0],2===z.length&&(e.offsetY=z[1])),i=e}else{var D=!(0!==i.left&&!i.left),P=!(0!==i.top&&!i.top),I=!(0!==i.right&&!i.right),O=!(0!==i.bottom&&!i.bottom);D&&P?(i.my="left-top",i.at="left-top",i.offsetX=i.left,i.offsetY=i.top):D&&O?(i.my="left-bottom",i.at="left-bottom",i.offsetX=i.left,i.offsetY=-i.bottom):I&&P?(i.my="right-top",i.at="right-top",i.offsetX=-i.right,i.offsetY=i.top):I&&O&&(i.my="right-bottom",i.at="right-bottom",i.offsetX=-i.right,i.offsetY=-i.bottom)}d=Object.assign(v,i),l="string"==typeof t?document.querySelector(t):t.jquery?t[0]:t,u=l.parentElement||document.body,d.of||(u===document.body?d.of="window":d.of=u),c=a(l),"string"==typeof d.offsetX&&"%"===d.offsetX.slice(-1)?"window"===d.of?d.offsetX=window.innerWidth*(parseInt(d.offsetX,10)/100):d.offsetX=u.clientWidth*(parseInt(d.offsetX,10)/100):"string"==typeof d.offsetX?d.offsetX=parseFloat(d.offsetX):$.isFunction(d.offsetX)&&(d.offsetX=parseInt(d.offsetX.call(t,t),10)),"string"==typeof d.offsetY&&"%"===d.offsetY.slice(-1)?"window"===d.of?d.offsetY=window.innerHeight*(parseInt(d.offsetY,10)/100):d.offsetY=u.clientHeight*(parseInt(d.offsetY,10)/100):"string"==typeof d.offsetY?d.offsetY=parseFloat(d.offsetY):$.isFunction(d.offsetY)&&(d.offsetY=parseInt(d.offsetY.call(t,t),10));var R=parseInt(window.getComputedStyle(u)["border-left-width"],10)||0;w.includes(d.my)?h=R:y.includes(d.my)?h=c.width/2+R:b.includes(d.my)&&(h=c.width+R);var A=parseInt(window.getComputedStyle(u)["border-top-width"],10)||0;if(x.includes(d.my)?p=A:_.includes(d.my)?p=c.height/2+A:C.includes(d.my)&&(p=c.height+A),l.parentElement===document.body)if("window"===d.of){var F=n(d.at);d.fixed?(g=F.left-h+d.offsetX-window.pageXOffset,m=F.top-p+d.offsetY-window.pageYOffset):(g=F.left-h+d.offsetX,m=F.top-p+d.offsetY)}else{var M=s(d.at);g=M.left-h+d.offsetX,m=M.top-p+d.offsetY}else{var N=void 0,L=void 0;L="string"==typeof d.of?document.querySelector(d.of):d.of.jquery?d.of[0]:d.of,u===L?(N=r(d.at),g=N.left-h+d.offsetX,m=N.top-p+d.offsetY):(N=o(d.at),g=N.left-h+d.offsetX,m=N.top-p+d.offsetY)}if(d.autoposition){var H=void 0,B=[];d.my===d.at&&(H=d.my),l.classList.add(H);for(var V=document.getElementsByClassName(H),U=0;U<V.length;U++)V[U].parentElement===u&&B.push(V[U]);if("DOWN"===d.autoposition)for(var q=0;q<B.length-1;q++)m+=B[q].getBoundingClientRect().height+this.autopositionSpacing;else if("UP"===d.autoposition)for(var W=0;W<B.length-1;W++)m-=B[W].getBoundingClientRect().height+this.autopositionSpacing;else if("RIGHT"===d.autoposition)for(var Y=0;Y<B.length-1;Y++)g+=B[Y].getBoundingClientRect().width+this.autopositionSpacing;else if("LEFT"===d.autoposition)for(var G=0;G<B.length-1;G++)g-=B[G].getBoundingClientRect().width+this.autopositionSpacing}return f={left:g,top:m},"function"==typeof d.modify&&(f=d.modify.call(f,f)),l.style.position="absolute",l.style.left=f.left+"px",l.style.top=f.top+"px",l.style.opacity=1,"window"===d.of&&d.fixed&&u===document.body&&(l.style.position="fixed"),l},remMinReplacement:function(e){$('[id^="'+e.prop("id")+'-min"]').remove()},removeModalBackdrop:function(e){$("#jsPanel-modal-backdrop-"+e.attr("id")).animate({opacity:0},{duration:500,done:function(){$(this).remove()}})},reposition:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.option.position,i=arguments[2];if("minimized"!==e.data("status")){if(e.option.position=t,e.option.paneltype.tooltip){var n=e.attr("class").split(" ");$.each(n,function(t,i){0===i.indexOf("jsPanel-tooltip-")&&e.removeClass(i)}),this.setTooltipClass(e),$(".jsPanel-connector",e).remove(),e.option.paneltype.connector&&this.addConnector(e)}this.position(e,t)}return i&&$.isFunction(i)&&i.call(e,e),e},resetZis:function(){var e=[],t=$(".jsPanel:not(.jsPanel-modal):not(.jsPanel-hint)");t.each(function(t,i){e.push(i)}),e.sort(function(e,t){return $(e).css("z-index")-$(t).css("z-index")}).forEach(function(e,t){(jsPanel.zi+=1)>$(e).css("z-index")&&$(e).css("z-index",jsPanel.ziBase+t)}),this.zi=this.ziBase-1+e.length},resize:function(e,t){if("minimized"!==e.data("status")){if($.isFunction(e.option.onbeforeresize)&&e.option.onbeforeresize.call(e,e)===!1)return e;if($.isPlainObject(t)){var i=$.extend({},!1,$.jsPanel.resizedefaults,t),n=void 0,s=void 0;if(i.width&&"auto"===i.width?(e.content.css("width","auto"),e.css("width","auto"),e.css("width",e.outerWidth())):i.width&&e.css("width",i.width),i.height&&"auto"===i.height?(e.content.css("height","auto"),e.css("height","auto")):i.height&&e.css("height",i.height),n=e.outerWidth(),s=e.outerHeight(),i.minwidth&&n<i.minwidth&&e.css("width",i.minwidth),i.maxwidth&&n>i.maxwidth&&e.css("width",i.maxwidth),i.minheight&&s<i.minheight&&e.css("height",i.minheight),i.maxheight&&s>i.maxheight&&e.css("height",i.maxheight),this.contentResize(e),$.isFunction(e.option.onresized)&&e.option.onresized.call(e,e)===!1)return e;i.callback&&$.isFunction(i.callback)&&i.callback.call(e,e)}}return e},rgbToHsl:function(e,t,i){e/=255,t/=255,i/=255;var n,s,r=Math.max(e,t,i),o=Math.min(e,t,i),a=(r+o)/2;if(r===o)n=s=0;else{var l=r-o;switch(s=a>.5?l/(2-r-o):l/(r+o),r){case e:n=(t-i)/l+(t<i?6:0);break;case t:n=(i-e)/l+2;break;case i:n=(e-t)/l+4}n/=6}return n=360*n,s=100*s+"%",a=100*a+"%",{css:"hsl("+n+","+s+","+a+")",h:n,s:s,l:a}},rgbToHex:function(e,t,i){var n=Number(e).toString(16),s=Number(t).toString(16),r=Number(i).toString(16);return 1===n.length&&(n="0"+n),1===s.length&&(s="0"+s),1===r.length&&(r="0"+r),"#"+n+s+r},setControlStatus:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"enable",n=e.header.headerbar,s=e[0];"disable"===i?"removed"!==s.getAttribute("data-btn"+t)&&(s.setAttribute("data-btn"+t,"disabled"),$(".jsPanel-btn-"+t,n).css({pointerEvents:"none",opacity:.4,cursor:"default"})):"enable"===i?"removed"!==s.getAttribute("data-btn"+t)&&(s.setAttribute("data-btn"+t,"enabled"),$(".jsPanel-btn-"+t,n).css({pointerEvents:"auto",opacity:1,cursor:"pointer"})):"remove"===i&&($(".jsPanel-btn-"+t,n).remove(),s.setAttribute("data-btn"+t,"removed"))},setTooltipClass:function(e){var t=e.option.position.my+e.option.position.at;"center-bottomcenter-top"===t?e.addClass("jsPanel-tooltip-top"):"left-bottomright-top"===t?e.addClass("jsPanel-tooltip-righttopcorner"):"left-centerright-center"===t?e.addClass("jsPanel-tooltip-right"):"left-topright-bottom"===t?e.addClass("jsPanel-tooltip-rightbottomcorner"):"center-topcenter-bottom"===t?e.addClass("jsPanel-tooltip-bottom"):"right-topleft-bottom"===t?e.addClass("jsPanel-tooltip-leftbottomcorner"):"right-centerleft-center"===t?e.addClass("jsPanel-tooltip-left"):"right-bottomleft-top"===t?e.addClass("jsPanel-tooltip-lefttopcorner"):"centercenter"===t?e.addClass("jsPanel-tooltip-center"):"right-topleft-top"===t?e.addClass("jsPanel-tooltip-lefttop"):"right-bottomleft-bottom"===t?e.addClass("jsPanel-tooltip-leftbottom"):"left-bottomleft-top"===t?e.addClass("jsPanel-tooltip-topleft"):"right-bottomright-top"===t?e.addClass("jsPanel-tooltip-topright"):"left-topright-top"===t?e.addClass("jsPanel-tooltip-righttop"):"left-bottomright-bottom"===t?e.addClass("jsPanel-tooltip-rightbottom"):"left-topleft-bottom"===t?e.addClass("jsPanel-tooltip-bottomleft"):"right-topright-bottom"===t&&e.addClass("jsPanel-tooltip-bottomright")},setTooltipMode:function(e,t){"semisticky"===e.option.paneltype.mode?e.hover(function(){return $.noop()},function(){e.close(),$(t).removeClass("hasTooltip")}):"sticky"===e.option.paneltype.mode?$.noop():$(t).mouseout(function(){e.close(),$(t).removeClass("hasTooltip")})},setTrigger:function(e){var t=e.of||"window";return"string"==typeof t?document.querySelector(t):t.jquery?t[0]:t},setZi:function(e){e.hasClass("jsPanel-modal")||(this.zi+=1)>e.css("z-index")&&e.css("z-index",this.zi)},smallify:function(e,t){var i=e.attr("id");if("normalized"===e.data("status")||"maximized"===e.data("status")){if("smallified"!==e.data("status")&&"smallifiedMax"!==e.data("status")){if($(document).trigger("jspanelbeforesmallify",i),$.isFunction(e.option.onbeforesmallify)&&e.option.onbeforesmallify.call(e,e)===!1)return e;e.smallify.height=e.outerHeight(),e.css("overflow","hidden"),e.animate({height:e.header.headerbar.outerHeight()+"px"},{done:function(){"maximized"===e.data("status")?(e.hideControls(".jsPanel-btn-maximize, .jsPanel-btn-smallify"),e.data("status","smallifiedMax"),$(document).trigger("jspanelsmallifiedmax",i)):(e.hideControls(".jsPanel-btn-normalize, .jsPanel-btn-smallify"),e.data("status","smallified"),$(document).trigger("jspanelsmallified",i)),$.isFunction(e.option.onsmallified)&&e.option.onsmallified.call(e,e),$(document).trigger("jspanelstatuschange",i)}})}}else if("minimized"!==e.data("status")){if($(document).trigger("jspanelbeforeunsmallify",i),$.isFunction(e.option.onbeforeunsmallify)&&e.option.onbeforeunsmallify.call(e,e)===!1)return e;e.css("overflow","visible"),e.animate({height:e.smallify.height},{done:function(){"smallified"===e.data("status")?(e.hideControls(".jsPanel-btn-normalize, .jsPanel-btn-smallifyrev"),e.data("status","normalized"),$(document).trigger("jspanelnormalized",i)):(e.hideControls(".jsPanel-btn-maximize, .jsPanel-btn-smallifyrev"),e.data("status","maximized"),$(document).trigger("jspanelmaximized",i)),e.contentResize(),$(document).trigger("jspanelunsmallified",i),$(document).trigger("jspanelstatuschange",i),$.isFunction(e.option.onunsmallified)&&e.option.onunsmallified.call(e,e)}})}return e.css("z-index",this.setZi(e)),t&&$.isFunction(t)&&t.call(e,e),e},toolbarAdd:function(e,t,i,n){return"header"===t?(e.header.toolbar.addClass("active"),$.isArray(i)?this.configToolbar(i,e.header.toolbar,e):$.isFunction(i)?e.header.toolbar.append(i(e.header)):e.header.toolbar.append(i)):"footer"===t&&(e.content.removeClass("jsPanel-content-nofooter"),e.footer.addClass("active"),"none"===e.option.theme&&e.footer.css({background:"transparent",borderTop:"none"}),$.isArray(i)?this.configToolbar(i,e.footer,e):$.isFunction(i)?e.footer.append(i(e.footer)):e.footer.append(i)),this.contentResize(e),n&&$.isFunction(n)&&n.call(e,e),e}};!function(e){e.jsPanel=function(t){var i,n,s=t||{},r=s.config||{},o=e.extend(!0,{},r,s),a=e(s.template||jsPanel.template);o.position&&e.isFunction(o.position)&&(o.position=o.position()),"tooltip"===o.paneltype&&(o.paneltype={tooltip:!0}),o.paneltype?"modal"===o.paneltype?a.option=e.extend(!0,{},e.jsPanel.defaults,e.jsPanel.modaldefaults,o):o.paneltype.tooltip?a.option=e.extend(!0,{},e.jsPanel.defaults,e.jsPanel.tooltipdefaults,o):"hint"===o.paneltype&&(a.option=e.extend(!0,{},e.jsPanel.defaults,e.jsPanel.hintdefaults,o)):a.option=e.extend(!0,{},e.jsPanel.defaults,o);var l=a.option,c=l.autoclose,d=l.border,u=l.callback,h=l.container,p=l.content,f=l.contentAjax,g=l.contentIframe,m=l.contentOverflow,v=l.contentSize,w=l.custom,y=l.dblclicks,b=l.draggable,x=l.footerToolbar,_=l.headerControls,C=l.headerLogo,k=l.headerRemove,T=l.headerTitle,S=l.headerToolbar,E=l.id,$=l.onwindowresize,j=l.paneltype,z=l.position,D=l.resizable,P=l.rtl,I=l.setstatus,O=l.show,R=l.theme;if(j.tooltip&&(n=jsPanel.setTrigger(z),e(n).hasClass("hasTooltip")))return!1;if("string"==typeof E?i=E:e.isFunction(E)&&(i=E()),e("#"+i).length>0)return console.warn("jsPanel Error: No jsPanel created - id attribute passed with option.id already exists in document"),!1;if(a.attr("id",i),a.data("custom",w),a.header=e(".jsPanel-hdr",a),a.header.headerbar=e(".jsPanel-headerbar",a.header),a.header.logo=e(".jsPanel-headerlogo",a.header.headerbar),a.header.title=e(".jsPanel-title",a.header.headerbar),a.header.controls=e(".jsPanel-controlbar",a.header.headerbar),a.header.toolbar=e(".jsPanel-hdr-toolbar",a.header),a.content=e(".jsPanel-content",a),a.footer=e(".jsPanel-ftr",a),a.data("status","initialized"),a.cachedData={},a.close=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return jsPanel.close.apply(jsPanel,[a].concat(t))},a.closeChildpanels=function(){return jsPanel.closeChildpanels(a)},a.contentReload=function(e){return jsPanel.contentReload(a,e)},a.contentResize=function(e){return jsPanel.contentResize(a,e)},a.front=function(e){return jsPanel.front(a,e)},a.headerControl=function(e,t){return jsPanel.headerControl(a,e,t)},a.headerTitle=function(e){return jsPanel.headerTitle(a,e)},a.hideControls=function(t){var i=a.header.controls;e("div",i).css("display","block"),e(t,i).css("display","none")},a.maximize=function(e){return jsPanel.maximize(a,e)},a.minimize=function(e){return jsPanel.minimize(a,e)},a.normalize=function(e){return jsPanel.normalize(a,e)},a.reposition=function(e,t){return jsPanel.reposition(a,e,t)},a.resize=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.jsPanel.resizedefaults.width,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.jsPanel.resizedefaults.height,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.jsPanel.resizedefaults.callback,s={},r=t;return e.isPlainObject(r)||(s.width=t,s.height=i,s.callback=n,r=e.extend({},!1,e.jsPanel.resizedefaults,s)),jsPanel.resize(a,r),a},a.setTheme=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R.toLowerCase().replace(/ /g,""),i=arguments[1];if(t=t.toLowerCase().replace(/ /g,""),jsPanel.clearTheme(a),"none"===R)return a.css("background-color","white"),a;var n=jsPanel.getThemeDetails(t);return n.bs?jsPanel.applyBootstrapTheme(a,n):jsPanel.themes.includes(n.color)?jsPanel.applyBuiltInTheme(a,n):jsPanel.applyArbitraryTheme(a,n),d?jsPanel.applyThemeBorder(a,n):a.css({borderWidth:"",borderStyle:"",borderColor:""}),i&&e.isFunction(i)&&i.call(a,a),a},a.smallify=function(e){return jsPanel.smallify(a,e)},a.toolbarAdd=function(e,t,i){return jsPanel.toolbarAdd(a,e,t,i)},a.updateCachedData=function(){a.cachedData.top=a.css("top"),a.cachedData.left=a.css("left"),a.cachedData.width=a.css("width"),a.cachedData.height=a.css("height")},e(".jsPanel-btn-close",a).on("click",function(e){e.preventDefault(),jsPanel.close(a)}),e(".jsPanel-btn-minimize",a).on("click",function(e){e.preventDefault(),jsPanel.minimize(a)}),e(".jsPanel-btn-maximize",a).on("click",function(e){e.preventDefault(),jsPanel.maximize(a)}),e(".jsPanel-btn-normalize",a).on("click",function(e){e.preventDefault(),jsPanel.normalize(a)}),e(".jsPanel-btn-smallify, .jsPanel-btn-smallifyrev",a).on("click",function(e){e.preventDefault(),jsPanel.smallify(a)}),a.appendTo(e(h)[0]),jsPanel.activePanels.list.push(i),e(document).trigger("jspanelloaded",i),a.data("container",h),a.setTheme(),k)a.header.remove(),a.content.addClass("jsPanel-content-noheader"),["close","maximize","minimize","normalize","smallify","smallifyrev"].forEach(function(e){a[0].setAttribute("data-btn"+e,"removed")});else if("closeonly"===_.controls?["maximize","minimize","normalize","smallify"].forEach(function(e){jsPanel.setControlStatus(a,e,"remove")}):"none"===_.controls?["close","maximize","minimize","normalize","smallify","smallifyrev"].forEach(function(e){jsPanel.setControlStatus(a,e,"remove")}):["close","maximize","minimize","normalize","smallify"].forEach(function(e){"disable"===_[e]?jsPanel.setControlStatus(a,e,"disable"):"remove"===_[e]?jsPanel.setControlStatus(a,e,"remove"):a[0].setAttribute("data-btn"+e,"enabled")}),C){var A=C;"string"==typeof A&&"<"!==A.substring(0,1)?a.header.logo.append('<img src="'+A+'" height="38" alt="logo">'):a.header.logo.append(A)}if((k||e(".jsPanel-hdr").length<1)&&a.content.css("border","none"),jsPanel.configIconfont(a),"modal"===j?(jsPanel.insertModalBackdrop(a),a.addClass("jsPanel-modal").css("z-index",jsPanel.modalcount+9999)):"hint"===j?a.addClass("jsPanel-hint").css("z-index",1e4):j.tooltip&&(n=jsPanel.setTrigger(z),a.addClass("jsPanel-tooltip"),jsPanel.setTooltipClass(a),j.solo&&jsPanel.closeTooltips(),jsPanel.setTooltipMode(a,n)),j.tooltip&&e(n).addClass("hasTooltip"),S&&!k&&a.toolbarAdd("header",S),x&&a.toolbarAdd("footer",x),p&&(a.content.append(p),a.data("content",p)),f&&("string"==typeof f&&(a.option.contentAjax={url:f,autoload:!0}),jsPanel.ajax(a)),e.isPlainObject(g)&&(g.src||g.srcdoc)&&jsPanel.iframe(a),j.connector&&jsPanel.addConnector(a),"string"==typeof v){var F=v.trim().split(" "),M=F.length;v={width:F[0],height:F[M-1]}}return 0===v.height&&(v.height="0"),a.content.css({width:v.width||e.jsPanel.defaults.contentSize.width,height:v.height||e.jsPanel.defaults.contentSize.height}),a.css({width:function(){return e(".jsPanel-content",a).length>0?a.content.outerWidth()+"px":v.width||e.jsPanel.defaults.contentSize.width},zIndex:function(){jsPanel.setZi(a)}}),a.content.css("width","100%"),jsPanel.position(a,z),jsPanel.calcPositionFactors(a),a.data("status","normalized"),e(document).trigger("jspanelstatuschange",i),j||y&&(y.title&&a.header.headerbar.on("dblclick",function(e){e.preventDefault(),jsPanel.dblclickhelper(y.title,a)}),y.content&&a.content.on("dblclick",function(e){e.preventDefault(),jsPanel.dblclickhelper(y.content,a)}),y.footer&&a.footer.on("dblclick",function(e){e.preventDefault(),jsPanel.dblclickhelper(y.footer,a)})),"string"==typeof m?a.content.css("overflow",m):e.isPlainObject(m)&&a.content.css({"overflow-y":m.vertical||m["overflow-y"],"overflow-x":m.horizontal||m["overflow-x"]}),e.isPlainObject(b)?a.draggable(b):"disabled"===b?(e(".jsPanel-titlebar, .jsPanel-ftr",a).css("cursor","default"),a.draggable({disabled:!0})):e(".jsPanel-titlebar, .jsPanel-ftr",a).css("cursor","default"),a.on("dragstop",function(){return jsPanel.calcPositionFactors(a)}),e.isPlainObject(D)?a.resizable(D):"disabled"===D&&(a.resizable({disabled:!0}),e(".ui-icon-gripsmall-diagonal-se, .ui-resizable-handle.ui-resizable-sw",a).css({"background-image":"none","text-indent":-9999}),e(".ui-resizable-handle",a).css({cursor:"inherit"})),a.on("resize",function(){return jsPanel.contentResize(a)}),P.rtl===!0&&(e(".jsPanel-hdr, .jsPanel-headerbar, .jsPanel-titlebar, .jsPanel-controlbar, .jsPanel-hdr-toolbar, .jsPanel-ftr",a).addClass("jsPanel-rtl"),[a.header.title,a.content,e("*",a.header.toolbar),e("*",a.footer)].forEach(function(e){e.prop("dir","rtl"),P.lang&&e.prop("lang",P.lang)}),e(".ui-icon-gripsmall-diagonal-se",a).css({backgroundImage:"none",textIndent:-9999})),"string"==typeof O&&a.addClass(O).css("opacity",1),a.header.title.empty().prepend(T),a[0].addEventListener("mousedown",function(t){if(!e(t.target).hasClass("jsglyph-close")&&!e(t.target).hasClass("jsglyph-minimize")){var i=e(t.target).closest(".jsPanel").css("z-index");!a.hasClass("jsPanel-modal")&&i<=jsPanel.zi&&a.front()}},!1),a.updateCachedData(),"string"==typeof I&&("maximize smallify"===I?a.maximize().smallify():a[I]()),"number"==typeof c&&c>0&&window.setTimeout(function(){a&&a.close()},c),a.on("resizestop",function(t,n){("smallified"===a.data("status")||"smallifiedMax"===a.data("status"))&&a.outerHeight()>n.originalSize.height&&(a.hideControls(".jsPanel-btn-normalize, .jsPanel-btn-smallifyrev"),a.data("status","normalized"),e(document).trigger("jspanelnormalized",i),e(document).trigger("jspanelstatuschange",i)),jsPanel.calcPositionFactors(a)}),$&&e(window).resize(function(t){if(t.target===window){var i=$,n=a.data("status");"maximized"!==n||e.isFunction(i)?"normalized"!==n&&"smallified"!==n&&"maximized"!==n||(e.isFunction(i)?i.call(a,t,a):a.reposition({left:function(){var t=void 0;return t="body"===this.option.container?(e(window).outerWidth()-this.outerWidth())*this.hf:(this.parent().outerWidth()-this.outerWidth())*this.hf,t<=0?0:t},top:function(){var t=void 0;return t="body"===this.option.container?(e(window).outerHeight()-this.outerHeight())*this.vf:(this.parent().outerHeight()-this.outerHeight())*this.vf,t<=0?0:t}})):a.maximize(!1,!1)}}),a[0].jspanel={options:a.option,close:function(){var e=(arguments.length<=0?void 0:arguments[0])||!1,t=(arguments.length<=1?void 0:arguments[1])||!1,i=(arguments.length<=2?void 0:arguments[2])||!1;jsPanel.close(a,e,t,i)},normalize:function(e){return jsPanel.normalize(a,e)},maximize:function(e){return jsPanel.maximize(a,e)},minimize:function(e){return jsPanel.minimize(a,e)},smallify:function(e){return jsPanel.smallify(a,e)},front:function(e){return jsPanel.front(a,e)},closeChildpanels:function(){return jsPanel.closeChildpanels(a)},reposition:function(e,t){return jsPanel.reposition(a,e,t)},resize:function(e,t,i){return a.resize(e,t,i)},contentResize:function(e){return jsPanel.contentResize(a,e)},contentReload:function(e){return jsPanel.contentReload(a,e)},headerTitle:function(e){return jsPanel.headerTitle(a,e)},headerControl:function(e,t){return jsPanel.headerControl(a,e,t)},toolbarAdd:function(e,t,i){return jsPanel.toolbarAdd(a,e,t,i)},setTheme:function(e,t){return a.setTheme(e,t)},noop:function(){return a}},u&&e.isFunction(u)?u.call(a,a):e.isArray(u)&&u.forEach(function(t){e.isFunction(t)&&t.call(a,a)}),a},e.jsPanel.defaults={autoclose:!1,border:!1,callback:!1,container:"body",content:!1,contentAjax:!1,contentIframe:!1,contentOverflow:"hidden",contentSize:{width:400,height:200},custom:!1,dblclicks:!1,delayClose:0,draggable:{handle:"div.jsPanel-titlebar, div.jsPanel-ftr",opacity:.8},footerToolbar:!1,headerControls:{close:!1,maximize:!1,minimize:!1,normalize:!1,smallify:!1,controls:"all",iconfont:"jsglyph"},headerLogo:!1,headerRemove:!1,headerTitle:"jsPanel",headerToolbar:!1,id:function(){return"jsPanel-"+(jsPanel.id+=1)},maximizedMargin:{top:5,right:5,bottom:5,left:5},minimizeTo:!0,onbeforeclose:!1,onbeforemaximize:!1,onbeforeminimize:!1,onbeforenormalize:!1,onbeforesmallify:!1,onbeforeunsmallify:!1,onclosed:!1,onmaximized:!1,onminimized:!1,onnormalized:!1,onbeforeresize:!1,onresized:!1,onsmallified:!1,onunsmallified:!1,onfronted:!1,onwindowresize:!1,paneltype:!1,position:"center",resizable:{handles:"n, e, s, w, ne, se, sw, nw",autoHide:!1,minWidth:40,minHeight:40},rtl:!1,setstatus:!1,show:!1,template:!1,theme:"default"},e.jsPanel.modaldefaults={draggable:"disabled",headerControls:{controls:"closeonly"},position:"center",resizable:"disabled",onwindowresize:!0},e.jsPanel.tooltipdefaults={draggable:!1,headerControls:{controls:"closeonly"},position:{fixed:!1},resizable:!1},e.jsPanel.hintdefaults={autoclose:8e3,draggable:!1,headerControls:{controls:"closeonly"},resizable:!1},e.jsPanel.resizedefaults={width:null,height:null,minwidth:!1,maxwidth:!1,minheight:!1,maxheight:!1,callback:!1},e(document).ready(function(){document.body.addEventListener("click",function(t){var i=e(t.target).closest(".jsPanel").length;i<1&&!e(t.target).hasClass("hasTooltip")&&(jsPanel.closeTooltips(),e(".hasTooltip").removeClass("hasTooltip"))},!1),e("body").css("-ms-overflow-style","scrollbar").append('<div id="jsPanel-replacement-container">'),window.addEventListener("keydown",function(e){var t=e.key||e.code;"Escape"!==t&&"Esc"!==t||jsPanel.closeOnEscape&&jsPanel.activePanels.getPanel(jsPanel.getTopmostPanel()).close()},!1)})}(jQuery),function(e,t){"undefined"!=typeof exports?t(Backbone):"function"==typeof define&&define.amd?define(["backbone"],function(i){return t(i||e.Backbone)}):t(e.Backbone)}(this,function(e){"use strict";Number.prototype.pad=function(e){for(var t=String(this);t.length<(e||2);)t="0"+t;return t},window.isDirty||(window.isDirty=new Object),_.groupByMulti=function(e,t,i){if(!t.length)return e;var n=_.groupBy(e,t[0],i),s=t.slice(1);for(var r in n)n[r]=_.groupByMulti(n[r],s,i);return n},_.findDeep=function(e,t){function i(e){for(var i in t)if(!_.isUndefined(e)&&t[i]!==e[i])return!1;return!0}function n(e){var t;return $.each(e,function(e,s){return i(s)?(t=s,!1):((_.isObject(s)||_.isArray(s))&&(t=n(s)),!t&&void 0)}),t}return n(e)},e.Collection.prototype.save=function(t){return e.sync("create",this,t)};var t=e.history.loadUrl;return e.history.loadUrl=function(){var i=this,n=$.Deferred();if(n.promise().then(function(){return t.apply(i,arguments)}),window.isDirty.dirty){var s=window.location.hash,r=e.history.fragment;window.location.hash="#/"+r,w2confirm("Exista inregistrari nesalvate! Sigur iesiti?").yes(function(){return window.isDirty.dirty=!1,window.location.hash=s,n.resolve()}).no(function(){return n.promise()})}else n.resolve()},e.SModel=e.Model.extend({constructor:function(){this.listenTo(this,"change",function(){3===this.attributes.EntityState&&(this.attributes.EntityState=1)}),this.listenTo(this,"save",function(){this.attributes.EntityState=1}),e.Model.apply(this,arguments),this.attributes.recid=this.cid}}),e.SCollection=e.Collection.extend({constructor:function(){this.listenTo(this,"remove",function(e){e.set("EntityState",2)}),e.Collection.apply(this,arguments)}}),e.SGridCollection=e.SCollection.extend({gridRowProperty:void 0,constructor:function(){var t=this;this.listenTo(this,"remove",function(e){this.getGridRowProperty()?w2ui[t.getGridName()].remove(e.get(t.getGridRowProperty()).get("cid")):w2ui[t.getGridName()].remove(e.get("cid"))}),this.listenTo(this,"add",function(e){this.getGridRowProperty()?(e.get(this.getGridRowProperty()).set("recid",e.cid),w2ui[t.getGridName()].add(e.get(this.getGridRowProperty()).toJSON())):(e.set("recid",e.cid),w2ui[t.getGridName()].add(e.toJSON()))}),this.listenTo(this,"change",function(e){this.getGridRowProperty()?w2ui[t.getGridName()].set(e.get(this.getGridRowProperty()).cid,e.get(this.getGridRowProperty()).toJSON()):w2ui[t.getGridName()].set(e.cid,e.toJSON())}),e.Collection.apply(this,arguments)},setGridRowProperty:function(e){this.gridRowProperty=e},getGridRowProperty:function(){return this.gridRowProperty},getGridName:function(){return this.gridName},setGridName:function(e){this.gridName=e}}),e}),function(e,t){"undefined"!=typeof exports?t(Marionette,Backbone):"function"==typeof define&&define.amd?define(["marionette","backbone"],function(i,n){return t(i||e.Marionette,n||e.Backbone)}):t(e.Marionette,e.Backbone)}(this,function(e,t){"use strict";e.DirtyRouter=e.AppRouter.extend({navigate:function(t,i){var n=$.Deferred();n.promise().then(function(){return e.AppRouter.prototype.navigate(t,i)}),window.dirty?w2confirm("Exista inregistrari nesalvate! Sigur iesiti?").yes(function(){return window.dirty=!1,n.resolve()}).no(function(){return n.promise()}):n.resolve()}}),e.SlashRouter=e.AppRouter.extend({navigate:function(e){var i,n=t.history.options;return""===e||"/"===e?(t.history.stop(),t.history.start({pushState:n.pushState,root:"/"}),arguments[0]=n.root,i=t.Router.prototype.navigate.apply(this,arguments),t.history.stop(),t.history.start({pushState:n.pushState,root:n.root}),i):t.Router.prototype.navigate.apply(this,arguments)}}),e.FormView=e.View.extend({resetCombo:function(){var e=this,t=e.model.fields();for(var i in this.model.changed){var n=_.find(t,{name:i});n&&"list"===n.type&&($(n.el).data("selected",n.selected),$(n.el).w2field().refresh())}},getTemplate:function(){if(this.template)return this.template;var e,t="";e="function"==typeof this.model.fields?this.model.fields():this.model.fields;for(var i in e){var n=e[i],s=n.isMemo?'<textarea id="'+n.name+'"></textarea>':'<input type="text" id="'+n.name+'" />';t+='<div class="w2ui-field"><label>'+(n.displayName?n.displayName:this.normalizeName(n.name))+"</label><div>"+s+"</div></div>"}return t+='<hr /><div style="text-align:left"><button class="toolbar-button" title="Salveaza modificarile" id="btnSave"><i class="w2ui-icon-save"></i></button><button class="toolbar-button" title="Renunta la modificare" id="btnCancel"><i class="w2ui-icon-ban"></i></button></div>'},bindings:{},constructor:function(t){e.View.prototype.constructor.call(this,t)},ensureElement:function(e){var t=this,i=setInterval(function(){return $.contains(document.body,t.el)&&(clearInterval(i),t.hasElement=!0,e&&t.setupView(),"function"==typeof t.onViewRendered&&t.onViewRendered.apply(t,arguments)),!1},10)},setupView:function(){if(this.hasElement||this.ensureElement(!0)){var e,t=this;e="function"==typeof this.model.fields?this.model.fields():this.model.fields;for(var i in e){var n=e[i];if("collection"!==n.type){if(n.selected&&(n.options.selected=n.selected),n.options&&"string"==typeof n.options.items){var s=n.options.items;n.options.items=t.model.get(s)}$(n.el).w2field(n.type,n.options),"list"==n.type&&n.options&&n.options.cascadeTo&&t.listenTo(t.model,"change:"+n.name,function(t){console.log(Object.keys(t.changed)[0]);var i=_.findWhere(e,{name:Object.keys(t.changed)[0]});$(i.el).w2field().cascadeTo(i.options.cascadeTo)}),t.bindings[n.el]=n.name}}$.extend(t.bindings,t.bindingOverrides),t.stickit()}},resetView:function(){var e=this.model.fields();for(var t in e){var i=e[t];$(i.el).w2field().refresh()}},normalizeName:function(e){return e=e.replace("_"," "),e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}}),e.SubAppRouter=e.AppRouter.extend({constructor:function(t,i){var n,s,r={};this.prefix=t=t||"",this.separator="/"===t.slice(-1)?"":"/";var o=i&&i.createTrailingSlashRoutes;this.appRoutes&&(s=this.appRoutes,n=this.controller,i&&i.controller&&(n=i.controller),_.each(s,function(e,i){i?("/"===i.substr(0)&&(i=i.substr(1,i.length)),r[t+this.separator+i]=e,o&&(r[t+this.separator+i+"/"]=e)):(r[t]=e,o&&(r[t+"/"]=e))},this),this.appRoutes=r),e.AppRouter.prototype.constructor.call(this,i);
}}),e.BossView=e.View.extend({template:function(){return""},constructor:function(){e.ItemView.prototype.constructor.apply(this,arguments),this._initializeSubViews(),this._afterInitializeSubViews(),this.listenTo(this,"render",this._onParentRendered)},getParentEl:function(){return this.$el},_afterInitializeSubViews:function(){this._initializeChildViewEvents(),this._initializeSubViewEventBubbling()},_initializeSubViews:function(){this.initializedSubViews={},this._eachSubView(_.bind(this._initializeSubView,this))},_initializeSubView:function(e,t){var i=this._getInitializedSubView(t);this._checkSubViewForRender(i,e),this[e]=i,this.initializedSubViews[e]=i},initializeSubView:function(e,t){this._initializeSubView(e,t),this._afterInitializeSubViews()},_getInitializedSubView:function(e){var t,i=_.isFunction(e.prototype.render);return t=i?this._initializeRenderableSubView(e):e.call(this)},_initializeRenderableSubView:function(e){return new e({model:this.model,collection:this.collection})},_checkSubViewForRender:function(e,t){if(_.isUndefined(e)||!_.isFunction(e.render))throw new Error("The subview named "+t+" does not have a render function.")},_initializeChildViewEvents:function(){this._eachSubViewEvent(_.bind(function(e,t,i){i=this._getSubViewEventCallbackFunction(i,t),"*"===e?this._listenToEventOnAllSubViews(i,t):e&&this.listenTo(e,t,i)},this))},_getSubViewEventCallbackFunction:function(e,t){return _.isString(e)&&(this._checkForSubViewEventCallback(e,t),e=this[e]),e},_listenToEventOnAllSubViews:function(e,t){this._eachSubView(_.bind(function(i){var n=this[i];this.listenTo(n,t,e)},this))},_checkForSubViewEventCallback:function(e,t){if(_.isUndefined(this[e]))throw new Error("This view has no function named "+e+" to use as a callback for the event "+t)},_initializeSubViewEventBubbling:function(){this._eachSubView(_.bind(function(e){var t=this[e];this.listenTo(t,"all",function(){this.trigger(e+":"+arguments[0],arguments[1])})},this))},_onParentRendered:function(){this.trigger("subviews:before:render"),this._renderSubViews(),this.trigger("subviews:after:render")},_renderSubViews:function(){this._eachSubView(_.bind(this.renderSubView,this))},renderSubView:function(e){var t=this._getOption("mainSubViewContainer"),i=this.getParentEl();this._hasSubViewContainer(e)?i=this._getSubViewContainer(e):t&&(i=this.$(t)),this._renderSubView(e,i)},_renderSubView:function(e,t){this._shouldRenderSubView(e)&&(this[e].render().$el.appendTo(t),this[e].delegateEvents(),this[e].viewShown&&this[e].viewShown.apply(this[e],arguments))},_shouldRenderSubView:function(e){var t=this._getSubViewRenderConditions()[e],i=_.isFunction(t);return!i||t.call(this)},_eachSubView:function(e){if(this._getSubViews())for(var t in this._getSubViews())e(t,this._getSubViews()[t])},_eachSubViewEvent:function(e){var t=this._getOption("subViewEvents");if(t)for(var i in t){var n=this._splitSubViewEventKey(i),s="*"===n.subViewName?"*":this[n.subViewName];e(s,n.subViewEventName,t[i])}},_splitSubViewEventKey:function(e){var t=e.split(" ");return{subViewName:t[0],subViewEventName:t[1]}},_hasSubViewContainer:function(e){var t=this._getOption("subViewContainers");return!_.isUndefined(t)&&!_.isUndefined(t[e])},_getSubViewContainer:function(e){if(!this._hasSubViewContainer(e))throw new Error("No subview container for subView: "+e);return this.$(this._getOption("subViewContainers")[e])},remove:function(){t.Marionette.ItemView.prototype.remove.apply(this,arguments),console.log("view removed"),this._removeSubViews()},_removeSubViews:function(){_.each(this.initializedSubViews,function(e){e.remove()})},_getSubViews:function(){var e=_.result(this,"subViews");return this.options.subViews&&(e=_.result(this.options,"subViews")),e},_getOption:function(e){return this[e]||this.options[e]},_getSubViewRenderConditions:function(){return this._getOption("subViewRenderConditions")||{}}});return _.extend(t.Marionette.Application.prototype,{stop:function(){_.each(this._regionManager._regions,function(e){e.reset()}),this.onStop&&"function"==typeof this.onStop&&this.onStop()}}),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var i=this[e],n=i,s=function(){return n},r=function(s){return i=n,n=t.call(this,e,i,s)};delete this[e]&&Object.defineProperty(this,e,{get:s,set:r,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),e}),function(e){w2obj.field.prototype.init=function(){var t,i=this,n=this.options;if("function"==typeof this.custom[this.type])return void this.custom[this.type].call(this,n);if(["INPUT","TEXTAREA"].indexOf(this.el.tagName.toUpperCase())==-1)return void console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);switch(this.type){case"text":case"int":case"float":case"money":case"currency":case"percent":case"alphanumeric":case"bin":case"hex":t={min:null,max:null,step:1,autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""},this.options=e.extend(!0,{},t,n),n=this.options,n.numberRE=new RegExp("["+n.groupSymbol+"]","g"),n.moneyRE=new RegExp("["+n.currencyPrefix+n.currencySuffix+n.groupSymbol+"]","g"),n.percentRE=new RegExp("["+n.groupSymbol+"%]","g"),["text","alphanumeric","hex","bin"].indexOf(this.type)!=-1&&(n.arrows=!1,n.keyboard=!1),this.addPrefix(),this.addSuffix();break;case"color":t={prefix:"#",suffix:'<div style="width: '+(parseInt(e(this.el).css("font-size"))||12)+'px">&#160;</div>',arrows:!1,keyboard:!1,transparent:!0},e.extend(n,t),this.addPrefix(),this.addSuffix(),e(this.el).attr("maxlength",6),""!==e(this.el).val()&&setTimeout(function(){i.change()},1);break;case"date":t={format:w2utils.settings.dateFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{},blockWeekDays:null},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"time":t={format:w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.format);break;case"datetime":t={format:w2utils.settings.dateFormat+" | "+w2utils.settings.timeFormat,keyboard:!0,silent:!0,start:"",end:"",blocked:[],colored:{},placeholder:null,btn_now:!0,noMinutes:!1},this.options=e.extend(!0,{},t,n),n=this.options,null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",n.placeholder||n.format);break;case"list":case"combo":if(t={items:[],selected:{},url:null,recId:null,recText:null,method:null,interval:350,postData:{},minLength:1,cacheMax:250,maxDropHeight:350,maxDropWidth:null,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,compare:null,filter:!0,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1},n.items=this.normMenu(n.items),"list"==this.type){if(t.openOnFocus=!0,e(this.el).addClass("w2ui-select"),!e.isPlainObject(n.selected)&&n.items)for(var s=0;s<n.items.length;s++){var r=n.items[s];if(r&&r.id==n.selected){n.selected=e.extend(!0,{},r);break}}this.watchSize()}n.cascadeData&&"function"==typeof n.cascadeData&&(n.postData=e.extend(n.postData||{},n.cascadeData())),n=e.extend({},t,n,{align:"both",altRows:!0});var o=!0;this.options=n,e.isPlainObject(n.selected)||(n.selected={}),e(this.el).data("selected",n.selected),n.url&&o&&(n.items=[],this.request(0)),"list"==this.type&&this.addFocus(),this.addPrefix(),this.addSuffix(),setTimeout(function(){i.refresh()},10),e(this.el).attr("autocomplete","off"),null!=n.selected.text&&e(this.el).val(n.selected.text);break;case"enum":t={items:[],selected:[],max:0,url:null,recId:null,recText:null,interval:350,method:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,compare:null,filter:!0,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null,onScroll:null},n=e.extend({},t,n,{align:"both",suffix:"",altRows:!0}),n.items=this.normMenu(n.items),n.selected=this.normMenu(n.selected),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),n.url&&(n.items=[],this.request(0)),this.addSuffix(),this.addMulti(),this.watchSize();break;case"file":t={selected:[],max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,maxDropWidth:null,readContent:!0,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},n=e.extend({},t,n,{align:"both",altRows:!0}),this.options=n,e.isArray(n.selected)||(n.selected=[]),e(this.el).data("selected",n.selected),null==e(this.el).attr("placeholder")&&e(this.el).attr("placeholder",w2utils.lang("Attach files by dragging and dropping or Click to Select")),this.addMulti(),this.watchSize()}this.tmp={onChange:function(e){i.change.call(i,e)},onClick:function(e){i.click.call(i,e)},onFocus:function(e){i.focus.call(i,e)},onBlur:function(e){i.blur.call(i,e)},onKeydown:function(e){i.keyDown.call(i,e)},onKeyup:function(e){i.keyUp.call(i,e)},onKeypress:function(e){i.keyPress.call(i,e)}},e(this.el).addClass("w2field w2ui-input").data("w2field",this).on("change.w2field",this.tmp.onChange).on("click.w2field",this.tmp.onClick).on("focus.w2field",this.tmp.onFocus).on("blur.w2field",this.tmp.onBlur).on("keydown.w2field",this.tmp.onKeydown).on("keyup.w2field",this.tmp.onKeyup).on("keypress.w2field",this.tmp.onKeypress).css(w2utils.cssPrefix("box-sizing","border-box")),this.change(e.Event("change"))},w2obj.field.prototype.setItemById=function(t,i){if(["list","enum"].indexOf(this.type)!=-1){var n=this,s=this.options.items;if(s&&s.length>0){var r=e.grep(s,function(e){return e.id==t})[0];if(r)e(this.el).data("selected",r).change();else if(this.options.url){var o=e.extend({},this.options.postData,{id:t}),a={type:"GET",url:this.options.url,data:o,dataType:"JSON"};this.options.method&&(a.type=this.options.method),"JSON"==w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),a.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(a.data={request:JSON.stringify(a.data)}),a.success=function(t){e(n.el).data("selected",t.items[0]),n.clearCache(),n.refresh()},e.ajax(a)}}else if(this.options.url&&this.options.url){var o=e.extend({},this.options.postData,{id:t}),a={type:"GET",url:this.options.url,data:o,dataType:"JSON"};this.options.method&&(a.type=this.options.method),"JSON"==w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),a.contentType="application/json"),"HTTPJSON"==w2utils.settings.dataType&&(a.data={request:JSON.stringify(a.data)}),a.success=function(t){e(n.el).data("selected",t.items[0]),n.clearCache(),n.refresh()},e.ajax(a)}this.refresh()}w2obj.field.prototype.cascadeTo=function(t){for(var i in t){var n=t[i];try{e(n).w2field().reinit()}catch(e){console.warn("There is no w2filed definition for el "+n+'!\\nPlease define the field before call "cascadeTo"!')}}},w2obj.field.prototype.reinit=function(){if(this.options.cascadeData&&"function"==typeof this.options.cascadeData&&e.extend(this.options.postData||{},this.options.cascadeData()),this.options.items=[],this.tmp.xhr_loading=!1,this.tmp.xhr_search="",this.tmp.xhr_total=-1,this.options.selected={},this.minLength=this.options.minLength,e(this.el).data("selected",[]),e(this.el).val(""),"enum"===this.type){var t=this.helpers.multi;t&&t.find("ul").find("li:not(.nomouse)").remove()}this.request()}}}(jQuery),function(e){var t=function(t){this.name=null,this.mainGrid=null,this.expandedGrids=[],this.origOptions={},this.origGetRecordHtml=w2obj.grid.prototype.getRecordHTML,this.origRefresh=w2obj.grid.prototype.refresh,this.origGetCellHTML=w2obj.grid.prototype.getCellHTML,this.origGetSummaryHTML=w2obj.grid.prototype.getSummaryHTML,this.origToggleColumn=w2obj.grid.prototype.toggleColumn,this.origHideColumn=w2obj.grid.prototype.hideColumn,this.origShowColumn=w2obj.grid.prototype.showColumn,this.origInitColumnDrag=w2obj.grid.prototype.initColumnDrag,this.activeGrid=null,this.last={field:"",caption:"",logic:"OR",search:"",searchIds:[],selection:{indexes:[],columns:{}},multi:!1,scrollTop:0,scrollLeft:0,colStart:0,colEnd:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null,isSafari:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.extend(!0,this,w2obj.groupedgrid,t)};e.fn.w2groupedgrid=function(i){if(e(this).parent().prepend('<div style="height:30px;" class="w2ui-groups"></div>'),e.isPlainObject(i)){if(!w2utils.checkName(i,"w2groupedgrid"))return;var n={name:"grp"+i.name},s=new t(n);s.origOptions=e.extend({},i),s.onSelect=i.onSelect;var r={show:{}};e.extend(!0,r,i),0!==e(this).length&&s.configGroup({box_id:e(this)[0]},r);var o=e(s.mainGrid.box).first(".w2ui-grid-box");return o.css({height:o.height()-30}),w2ui[i.name]=s.mainGrid,w2ui[s.name]=s,s}var a=w2ui[e(this).attr("name")];return a?arguments.length>0?(a[i]&&a[i].apply(a,Array.prototype.slice.call(arguments,1)),this):a:null},t.prototype={click:function(){},getExpandedGrid:function(t){var i=this,n=[],s=t?t:this.mainGrid;return n.push(s),e.each(s.expandedGrids,function(e,t){n.push(t),t.expandedGrids.length>0&&(n=n.concat(i.getExpandedGrid(t)))}),n},configGroup:function(t,i){var n=this,s=e.extend({},i);if("string"==typeof t.box_id)var r=e("#"+t.box_id);else var r=t.box_id;var o;if(s.expandedGrids=[],this.mainGrid){var a=w2ui[t.target];r.css({height:"300px"}),s.show.toolbar=!1,s.show.footer=!1,s.show.columnHeaders=!1,s.name=t.box_id;var l=a.groupOn,c=s.groupData.indexOf(l)+1;s.groupData[c]?(s.groupOn=s.groupData[c],s.show.expandColumn=!0,s.isDetailGrid=!1):(delete s.groupOn,s.isDetailGrid=!0,s.show.expandColumn=!1);var d=a.get(t.recid),u=d[a.groupOn];console.log(u);var h={groupColumn:s.groupOn,parentGroup:l,parentGroupValue:u};s.postData=e.extend(!0,{},a.postData),s.postData.group_data=s.postData.group_data||[];var p=e.grep(s.postData.group_data,function(e){return e.groupColumn===h.groupColumn})[0];if(p?e.extend(!0,p,h):s.postData.group_data.push(h),s.postData.summaryData=s.summaryData,!s.url){var f=e.extend(this.origOptions.records,[]);e.each(a.postData.group_data,function(e,t){t.parentGroup&&(f=f.filter(function(e){return e[t.parentGroup]===t.parentGroupValue}))}),console.log(f),s.isDetailGrid?s.records=f:s.records=this.groupBy(f,s.groupOn),s.summaryData&&(s.summary=s.summary||[],s.summary.push(this.calculateSummary(s.summaryData,s.postData.group_data)))}o=new w2obj.grid(s);var g=27;a||(a=this.mainGrid);for(var m=0;m<a.columns.length;m++)if(0===m&&s.show.expandColumn){var v=parseInt(a.columns[m].size.replace("px",""));fcolwidth=v-g+"px",o.columns[m].size=fcolwidth}else o.columns[m].size=a.columns[m].size;o.el=t.box_id,a.expandedGrids.push(o),o.onDestroy=function(){console.log("destroy"),n.activeGrid&&n.activeGrid.name===o.name&&(n.activeGrid=null),o.expandedGrids=o.expandedGrids.map(function(e){n.activeGrid&&n.activeGrid.name===e.name&&(n.activeGrid=null),e.destroy()}),a.expandedGrids.splice(a.expandedGrids.indexOf(o),1)},w2ui[o.name]=o}else{if(s.groupData&&s.groupData.length>0){var w=e(".w2ui-groups");e.each(s.groupData,function(t,i){var r=e.grep(s.columns,function(e){return e.field==i})[0];r.hidden=!0,w.append('<div class="w2ui-group-header">'+r.caption+'<i data-field="'+r.field+'" class="w2ui-icon-cross" onclick="w2ui[\''+n.name+"'].removegroup(this);\"></i></div>")}),s.groupOn=s.groupData[0],s.show.expandColumn=!0,s.postData=e.extend(!0,{},s.postData),s.postData.groupOn=s.groupOn,s.postData.group_data=[{groupColumn:s.groupOn,parentGroup:null,parentGroupValue:null}],s.url||(s.records=this.groupBy(this.origOptions.records,s.groupOn,function(e){return[e[s.groupOn]]}),s.summaryData&&(s.summary=s.summary||[],s.summary.push(this.calculateSummary(s.summaryData,s.postData.group_data))),console.log(s.records))}else s.isDetailGrid=!0,s.postData=e.extend(!0,{},s.postData),s.postData.group_data=[],s.summaryData&&(s.summary=s.summary||[],s.summary.push(this.calculateSummary(s.summaryData,s.postData.group_data)));s.url&&(s.postData.summaryData=s.summaryData),o=new w2obj.grid(s),this.mainGrid=o,o.getRecordHTML=this.getRecordHtml,o.getCellHTML=this.getCellHTML,o.getSummaryHTML=this.getSummaryHTML,o.toggleColumn=this.toggleColumn.bind(this),o.hideColumn=this.hideColumn.bind(this),o.showColumn=this.showColumn.bind(this),o.initColumnDrag=this.initColumnDrag.bind(this)}o.refresh=this.refresh.bind(this,o),o.initResize=this.initResize.bind(this,o),o.isDetailGrid?(o.onSelect=this.select.bind(this),o.onUnselect=this.unselect.bind(this)):(o.onExpand=this.expand.bind(this),o.onCollapse=this.collapse.bind(this)),this.onResizeColumns=this.mainGrid.onResizeColumns,this.onAdd=this.mainGrid.onAdd,this.mainGrid.reorderColumns=!0,o.render(r),o.refresh()},resize:function(){this.mainGrid.resize()},reinitialize:function(){var t=this.origOptions,i=this.mainGrid;t.groupData&&t.groupData.length>0?(i.groupOn=t.groupData[0],i.show.expandColumn=!0,i.isDetailGrid=!1,i.postData=e.extend(!0,{},t.postData),i.postData.groupOn=i.groupOn,i.postData.group_data=[{groupColumn:i.groupOn,parentGroup:null,parentGroupValue:null}],i.postData.summaryData=t.summaryData,t.url||(i.records=this.groupBy(this.origOptions.records,i.groupOn,function(e){return[e[i.groupOn]]}),t.summaryData&&(i.summary=i.summary||[],i.summary.push(this.calculateSummary(t.summaryData,i.postData.group_data))))):(i.isDetailGrid=!0,i.show.expandColumn=!1,i.postData=e.extend(!0,{},t.postData),i.postData.group_data=[],t.summaryData&&(i.summary=i.summary||[],i.summary.push(this.calculateSummary(t.summaryData,i.postData.group_data)))),i.isDetailGrid?(i.onSelect=this.select.bind(this),i.onUnselect=this.unselect.bind(this)):(i.onExpand=this.expand.bind(this),i.onCollapse=this.collapse.bind(this)),i.url&&(i.postData.summaryData=t.summaryData),i.render(i.box)},removegroup:function(t){console.log(t);for(var i=this,n=e(t).data("field"),s=0;s<i.origOptions.columns.length;s++)i.origOptions.columns[s].field===n&&(i.origOptions.columns[s].hidden=!1,i.mainGrid.columns[s].hidden=!1);this.origOptions.groupData.splice(this.origOptions.groupData.indexOf(n),1),e(t).parent().remove(),this.reinitialize()},getGroupRecords:function(t){var i=this.origOptions.records;return e.each(t,function(e,t){t.parentGroup&&(i=i.filter(function(e){return e[t.parentGroup]===t.parentGroupValue}))}),i},arrayFromObject:function(e,t){var i=[],n=0;for(var s in e){var r={};r[t]=s,r.grpcnt=e[s].length,r.recid="column"+n,i.push(r),n++}return i},groupBy:function(e,t,i){var n=e.reduce(function(e,i){return e[i[t]]=e[i[t]]||[],e[i[t]].push(i),e},{});return this.arrayFromObject(n,t)},calculateSummary:function(e,t){for(var i={},n=this.getGroupRecords(t),s=0;s<e.length;s++){var r=e[s];switch(r.summary){case"count":i[r.field]=n.length;break;case"sum":var o=0;n.map(function(e){o+=Number(e[r.field])}),i[r.field]=o}}return i},refresh:function(e){e.groupOn&&(w2obj.grid.prototype.getRecordHTML=this.getRecordHtml),e.expandedGrids.map(function(e){e.destroy()}),this.origRefresh.apply(e,arguments)},expand:function(e){this.configGroup(e,this.origOptions)},collapse:function(t){var i=w2ui[t.target],n=e.grep(i.expandedGrids,function(e){return e.name===t.box_id})[0];n.destroy()},select:function(t){e.each(this.getExpandedGrid(),function(e,i){i.isDetailGrid&&i.name!==t.target&&i.selectNone()}),this.activeGrid=w2ui[t.target],this.trigger(t)},unselect:function(e){this.activeGrid&&this.activeGrid.name===e.target&&this.trigger(e)},get:function(e,t){return this.activeGrid?this.activeGrid.get(e,t):null},getSelection:function(e){return this.activeGrid?this.activeGrid.getSelection(e):null},initResize:function(t){var i=this;e(this.mainGrid.box).find(".w2ui-resizer").off("click").on("click",function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault&&e.preventDefault()}).off("mousedown").on("mousedown",function(t){var n=this;t||(t=window.event),e.each(i.getExpandedGrid(),function(i,s){s.resizing=!0,s.last.tmp={x:t.screenX,y:t.screenY,gx:t.screenX,gy:t.screenY,col:parseInt(e(n).attr("name"))};for(var r=0;r<s.columns.length;r++)s.columns[r].hidden||(null==s.columns[r].sizeOriginal&&(s.columns[r].sizeOriginal=s.columns[r].size),s.columns[r].size=s.columns[r].sizeCalculated)}),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault&&t.preventDefault();var s={phase:"before",type:"columnResize",target:i.mainGrid.name,column:i.mainGrid.last.tmp.col,field:i.mainGrid.columns[i.mainGrid.last.tmp.col].field};s=i.mainGrid.trigger(e.extend(s,{resizeBy:0,originalEvent:t}));var r=function(t){if(e.each(i.getExpandedGrid(),function(e,i){1==i.resizing&&(i.last.tmp.x=t.screenX-i.last.tmp.x,i.last.tmp.y=t.screenY-i.last.tmp.y,i.columns[i.last.tmp.col].size=parseInt(i.columns[i.last.tmp.col].size)+i.last.tmp.x+"px",i.resizeRecords(),i.scroll(),i.last.tmp.x=t.screenX,i.last.tmp.y=t.screenY)}),t||(t=window.event),s=i.mainGrid.trigger(e.extend(s,{resizeBy:t.screenX-i.mainGrid.last.tmp.gx,originalEvent:t})),s.isCancelled===!0)return void(s.isCancelled=!1)},o=function(t){e.each(i.getExpandedGrid(),function(e,t){delete t.resizing,t.resizeRecords(),t.scroll()}),i.mainGrid.trigger(e.extend(s,{phase:"after",originalEvent:t})),e(document).off("mousemove","body"),e(document).off("mouseup","body")};e(document).on("mousemove","body",r),e(document).on("mouseup","body",o)}).each(function(t,i){var n=e(i).parent();e(i).css({height:"25px","margin-left":n.width()-3+"px"})})},resizeColumn:function(e){var t=this;e.columns[e.last.tmp.col].size=parseInt(e.columns[e.last.tmp.col].size)+e.last.tmp.x+"px",e.expandedGrids.map(function(e){t.resizeColumn(e)})},getRecordHtml:function(e,t,i){var n,s="",r="",o="",a=this.last.selection;if(e==-1){r+='<tr line="0">',o+='<tr line="0">',this.show.lineNumbers&&(r+='<td class="w2ui-col-number" style="height: 0px;"></td>'),this.show.selectColumn&&(r+='<td class="w2ui-col-select" style="height: 0px;"></td>'),this.show.expandColumn&&(r+='<td class="w2ui-col-expand" style="height: 0px;"></td>'),o+='<td class="w2ui-grid-data w2ui-grid-data-spacer" col="start" style="height: 0px; width: 0px;"></td>';for(var l=0;l<this.columns.length;l++){var c=this.columns[l];if(s='<td class="w2ui-grid-data" col="'+l+'" style="height: 0px;"></td>',c.frozen&&!c.hidden)r+=s;else{if(c.hidden||l<this.last.colStart||l>this.last.colEnd)continue;o+=s}}return r+='<td class="w2ui-grid-data-last" style="height: 0px"></td>',o+='<td class="w2ui-grid-data-last" col="end" style="height: 0px"></td>',r+="</tr>",o+="</tr>",[r,o]}var d="object"!=typeof this.url?this.url:this.url.get;if(i!==!0)if(this.searchData.length>0&&!d){if(e>=this.last.searchIds.length)return"";e=this.last.searchIds[e],n=this.records[e]}else{if(e>=this.records.length)return"";n=this.records[e]}else{if(e>=this.summary.length)return"";n=this.summary[e]}if(!n)return"";null==n.recid&&null!=this.recid&&null!=n[this.recid]&&(n.recid=n[this.recid]);var u=(w2utils.escapeId(n.recid),!1);a.indexes.indexOf(e)!=-1&&(u=!0);var h=n.w2ui?n.w2ui.style:"";null!=h&&"string"==typeof h||(h="");var p=n.w2ui?n.w2ui.class:"";if(null!=p&&"string"==typeof p||(p=""),r+='<tr id="grid_'+this.name+"_frec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2===0?"w2ui-even":"w2ui-odd")+" "+p+(u&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&n.w2ui.editable===!1?" w2ui-no-edit":"")+(n.w2ui&&n.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0&&this.isDetailGrid?w2utils.isIOS?"    onclick  = \"w2ui['"+this.name+"'].dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"w2ui['"+this.name+"'].click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType&&this.isDetailGrid?" onmouseover=\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_rec_'+ w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",o+='<tr id="grid_'+this.name+"_rec_"+n.recid+'" recid="'+n.recid+'" line="'+t+'" index="'+e+'"  class="'+(t%2===0?"w2ui-even":"w2ui-odd")+" "+p+(u&&"row"==this.selectType?" w2ui-selected":"")+(n.w2ui&&n.w2ui.editable===!1?" w2ui-no-edit":"")+(n.w2ui&&n.w2ui.expanded===!0?" w2ui-expanded":"")+'" '+(i!==!0&&this.isDetailGrid?w2utils.isIOS?"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.dblClick(jQuery(this).attr('recid'), event);\"":"    onclick  = \"var obj = w2ui['"+this.name+"']; obj.click(jQuery(this).attr('recid'), event);\"    oncontextmenu = \"var obj = w2ui['"+this.name+"']; obj.contextMenu(jQuery(this).attr('recid'), null, event);\"":"")+("row"==this.selectType&&this.isDetailGrid?" onmouseover=\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).addClass('w2ui-record-hover')\" onmouseout =\"jQuery('#grid_"+this.name+"_frec_' + w2utils.escapeId(jQuery(this).attr('recid'))).removeClass('w2ui-record-hover')\"":"")+' style="height: '+this.recordHeight+"px; "+(u||""==h?h.replace("background-color","none"):h)+'" '+(""!=h?'custom_style="'+h+'"':"")+">",this.show.lineNumbers&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_number"+(i?"_s":"")+'"    class="w2ui-col-number '+(u?" w2ui-row-selected":"")+'"'+(this.reorderRows?' style="cursor: move"':"")+">"+(i!==!0?this.getLineHTML(t,n):"")+"</td>"),this.show.selectColumn&&(r+='<td id="grid_'+this.name+"_cell_"+e+"_select"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-select">'+(i!==!0?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabindex="-1" '+(u?'checked="checked"':"")+' style="pointer-events: none"/>    </div>':"")+"</td>"),this.show.expandColumn){var f="";f=n.w2ui&&n.w2ui.expanded===!0?"-":"+",n.w2ui&&"none"==n.w2ui.expanded&&(f=""),n.w2ui&&"spinner"==n.w2ui.expanded&&(f='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),r+='<td id="grid_'+this.name+"_cell_"+e+"_expand"+(i?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(i!==!0?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'));                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+f+" </div>":"")+"</td>"}o+='<td class="w2ui-grid-data-spacer" col="start" style="border-right: 0"></td>';var g=0,m=!1,v=0;if(i||this.isDetailGrid)for(;;){var w=1,c=this.columns[v];if(null==c)break;if(c.hidden)v++,g>0&&g--;else if(g>0){if(v++,null==this.columns[v])break;n.w2ui.colspan[this.columns[v-1].field]=0,g--}else{if(n.w2ui){var y=n.w2ui.colspan,b=this.columns[v].field;y&&0===y[b]&&delete y[b]}if(!(v<this.last.colStart||v>this.last.colEnd)||c.frozen){if(n.w2ui&&"object"==typeof n.w2ui.colspan){var x=parseInt(n.w2ui.colspan[c.field])||null;if(x>1){for(var _=0,l=v;l<v+x&&!(l>=this.columns.length);l++)this.columns[l].hidden&&_++;w=x-_,g=x-1}}var C=this.getCellHTML(e,v,i,w);c.frozen?r+=C:o+=C,v++}else v++}}else{for(;!m;)this.columns[v].field==this.groupOn||v>=this.columns.length-1?m=!0:v++;var C=this.getCellHTML(e,v,i,1e3);o+=C}return r+='<td class="w2ui-grid-data-last"></td>',o+='<td class="w2ui-grid-data-last" col="end"></td>',r+="</tr>",o+="</tr>",[r,o]},getCellHTML:function(t,i,n,s){var r=this.columns[i];if(null==r)return"";var o=n!==!0?this.records[t]:this.summary[t],a=this.getCellValue(t,i,n),l="max-height: "+parseInt(this.recordHeight)+"px;",c=!1,d="",u="",h=this.last.selection,p=!1,f="";if(h.indexes.indexOf(t)!=-1&&(p=!0),0===i&&o&&o.w2ui&&Array.isArray(o.w2ui.children)){for(var g=0,m=this.get(o.w2ui.parent_recid,!0);;){if(null==m)break;g++;var v=this.records[m].w2ui;if(null==v||null==v.parent_recid)break;m=this.get(v.parent_recid,!0)}if(o.w2ui.parent_recid)for(var w=0;w<g;w++)f+='<span class="w2ui-show-children w2ui-icon-empty"></span>';f+='<span class="w2ui-show-children '+(o.w2ui.children.length>0?o.w2ui.expanded?"w2ui-icon-collapse":"w2ui-icon-expand":"w2ui-icon-empty")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].toggle(jQuery(this).parents('tr').attr('recid'))\"></span>"}r.info===!0&&(r.info={}),null!=r.info&&(r.info.icon||(r.info.icon="w2ui-icon-info"),f+='<span class="w2ui-info '+r.info.icon+'" style="'+(r.info.style||"")+'"  onclick="event.stopPropagation(); w2ui[\''+this.name+"'].showBubble("+t+", "+i+')"></span>');var y=r.render;if(!this.groupTemplates||n||this.isDetailGrid){if(n&&this.summaryTemplates&&!this.isDetailGrid){var b=e.grep(this.summaryTemplates,function(e){return e.field===r.field})[0];b&&(y=b.render)}else if(n&&this.isDetailGrid){var b=e.grep(this.summaryTemplates,function(e){return e.field===r.field})[0];b&&(y=b.render)}}else{var x=e.grep(this.groupTemplates,function(e){return e.field===r.field})[0];x&&(y=x.render)}if(null!=y){if("function"==typeof y&&(a=e.trim(y.call(this,o,t,i,a)),(a.length<4||"<div"!=a.substr(0,4).toLowerCase())&&(a='<div style="'+l+'">'+f+String(a)+"</div>")),"object"==typeof y&&(a='<div style="'+l+'">'+f+(y[a]||"")+"</div>"),"string"==typeof y){var _=y.toLowerCase().indexOf(":"),v=[];_==-1?(v[0]=y.toLowerCase(),v[1]=""):(v[0]=y.toLowerCase().substr(0,_),v[1]=y.toLowerCase().substr(_+1));var C=w2utils.formatters[v[0]];a='<div style="'+l+'">'+f+("function"==typeof C?C(a,v[1]):"")+"</div>"}}else{if(this.show.recordTitles){var k=w2utils.stripTags(String(a).replace(/"/g,"''"));null!=r.title&&("function"==typeof r.title&&(k=r.title.call(this,o,t,i)),"string"==typeof r.title&&(k=r.title))}a='<div style="'+l+'" title="'+(k||"")+'">'+f+String(a)+"</div>"}if(null==a&&(a=""),"string"==typeof y){var v=y.toLowerCase().split(":");["number","int","float","money","currency","percent","size"].indexOf(v[0])!=-1&&(d+="text-align: right;")}o&&o.w2ui&&("object"==typeof o.w2ui.style&&("string"==typeof o.w2ui.style[i]&&(d+=o.w2ui.style[i]+";"),"string"==typeof o.w2ui.style[r.field]&&(d+=o.w2ui.style[r.field]+";")),"object"==typeof o.w2ui.class&&("string"==typeof o.w2ui.class[i]&&(u+=o.w2ui.class[i]+" "),"string"==typeof o.w2ui.class[r.field]&&(u+=o.w2ui.class[r.field]+" ")));var T=!1;return p&&e.inArray(i,h.columns[t])!=-1&&(T=!0),a='<td class="w2ui-grid-data'+(T?" w2ui-selected":"")+" "+u+(c?" w2ui-changed":"")+'"    id="grid_'+this.name+"_data_"+t+"_"+i+'" col="'+i+'"    style="'+d+(null!=r.style?r.style:"")+'" '+(null!=r.attr?r.attr:"")+(s>1?'colspan="'+s+'"':"")+">"+a+"</td>"},getSummaryHTML:function(){if(0!==this.summary.length){for(var e=this.getRecordHTML(-1,0),t="<table><tbody>"+e[0],i="<table><tbody>"+e[1],n=0;n<this.summary.length;n++)e=this.getRecordHTML(n,n+1,!0),t+=e[0],i+=e[1];return t+="</tbody></table>",i+="</tbody></table>",[t,i]}},initColumnDrag:function(t){function i(){p.pressed=!1,clearTimeout(p.timeout)}function n(t){p.timeout&&clearTimeout(p.timeout);var i=this;p.pressed=!0,p.timeout=setTimeout(function(){if(p.pressed){var n,r,a,l,c,d=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"],u=["w2ui-head-last"],f=d.concat(u),g=".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select",m=".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select";if(e(t.originalEvent.target).parents().hasClass("w2ui-head")){for(var v=0,w=f.length;v<w;v++)if(e(t.originalEvent.target).parents().hasClass(f[v]))return;
if(p.numberPreColumnsPresent=e(h.box).find(m).length,p.columnHead=l=e(t.originalEvent.target).parents(".w2ui-head"),c=parseInt(l.attr("col"),10),n=h.trigger({type:"columnDragStart",phase:"before",originalEvent:t,origColumnNumber:c,target:l[0]}),n.isCancelled===!0)return!1;r=p.columns=e(h.box).find(".w2ui-head:not(.w2ui-head-last)"),e(document).on("mouseup",o),e(document).on("mousemove",s),p.originalPos=parseInt(e(t.originalEvent.target).parent(".w2ui-head").attr("col"),10),p.ghost=e(i).clone(!0),e(p.ghost).find('[col]:not([col="'+p.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove(),e(p.ghost).find(g).remove(),e(p.ghost).find(".w2ui-grid-body").css({top:0}),a=e(p.ghost).find('[col="'+p.originalPos+'"]'),e(document.body).append(p.ghost),e(p.ghost).css({width:0,height:0,margin:0,position:"fixed",zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:a.width(),height:e(h.box).find(".w2ui-grid-body:first").height(),left:t.pageX,top:t.pageY,opacity:.8},0),p.offsets=[];for(var v=0,w=r.length;v<w;v++)p.offsets.push(e(r[v]).offset().left);h.trigger(e.extend(n,{phase:"after"}))}}},150)}function s(t){if(p.pressed){var i=t.originalEvent.pageX,n=t.originalEvent.pageY,s=p.offsets,o=e(".w2ui-head:not(.w2ui-head-last)").width();p.targetInt=Math.max(p.numberPreColumnsPresent,l(i,s,o)),r(i,n),a(p.targetInt),c(i,n)}}function r(t,i){var n=e(".w2ui-groups").offset();t>n.left&&i>n.top&&i<n.top+30?(u=!0,e(".w2ui-groups").addClass("w2ui-group-droptarget")):(u=!1,e(".w2ui-groups").removeClass("w2ui-group-droptarget"))}function o(t){p.pressed=!1;var i,n,r,a,l,c=!1,f=e(".w2ui-grid-ghost");if(i=h.trigger({type:"columnDragEnd",phase:"before",originalEvent:t,target:p.columnHead[0]}),i.isCancelled===!0)return!1;if(console.log(p),r=h.columns[p.originalPos],a=h.columns=d.origOptions.columns,l=e(p.columns[Math.min(p.lastInt,p.columns.length-1)]),u){n=e(".w2ui-groups"),e(p.ghost).animate({top:e(h.box).offset().top,left:l.offset().left,width:0,height:0,opacity:.2},300,function(){e(this).remove(),f.remove()}),d.origOptions.groupData||(d.origOptions.groupData=[]),0===d.origOptions.groupData.length&&(c=!0),d.origOptions.groupData.indexOf(r.field)===-1&&(d.origOptions.groupData.push(r.field),n.append('<div class="w2ui-group-header">'+r.caption+'<i data-field="'+r.field+'" class="w2ui-icon-cross" onclick="w2ui[\''+d.name+"'].removegroup(this);\"></i></div>"));for(var g=0;g<d.origOptions.columns.length;g++)d.origOptions.columns[g].field===r.field&&(d.origOptions.columns[g].hidden=!0,d.mainGrid.columns[g].hidden=!0);n.removeClass("w2ui-group-droptarget"),u=!1}else n=p.lastInt<p.columns.length?parseInt(l.attr("col")):a.length,n!==p.originalPos+1&&n!==p.originalPos&&l&&l.length?(e(p.ghost).animate({top:e(h.box).offset().top,left:l.offset().left,width:0,height:0,opacity:.2},300,function(){e(this).remove(),f.remove()}),a.splice(n,0,e.extend({},r)),a.splice(a.indexOf(r),1)):(e(p.ghost).remove(),f.remove());e(document).off("mouseup",o),e(document).off("mousemove",s),p.marker&&p.marker.remove(),p={},c&&d.reinitialize(),h.refresh(),h.trigger(e.extend(i,{phase:"after",targetColumnNumber:n-1}))}function a(t){p.marker||p.markerLeft||(p.marker=e('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),p.markerLeft=e('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>')),p.lastInt&&p.lastInt===t||(p.lastInt=t,p.marker.remove(),p.markerLeft.remove(),e(".w2ui-head").removeClass("w2ui-col-intersection"),t>=p.columns.length?(e(p.columns[p.columns.length-1]).children("div:last").append(p.marker.addClass("right").removeClass("left")),e(p.columns[p.columns.length-1]).addClass("w2ui-col-intersection")):t<=p.numberPreColumnsPresent?(e(p.columns[p.numberPreColumnsPresent]).prepend(p.marker.addClass("left").removeClass("right")).css({position:"relative"}),e(p.columns[p.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):(e(p.columns[t]).children("div:last").prepend(p.marker.addClass("left").removeClass("right")),e(p.columns[t]).prev().children("div:last").append(p.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),e(p.columns[t-1]).addClass("w2ui-col-intersection")))}function l(e,t,i){if(e<=t[0])return 0;if(e>=t[t.length-1]+i)return t.length;for(var n=0,s=t.length;n<s;n++){var r=t[n],o=t[n+1]||t[n]+i,a=(o-t[n])/2+t[n];if(e>r&&e<=a)return n;if(e>a&&e<=o)return n+1}return intersection}function c(t,i){e(p.ghost).css({left:t-10,top:i-10})}var d=this;if(this.mainGrid.columnGroups&&this.mainGrid.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var u,h=this.mainGrid,p={};return p.lastInt=null,p.pressed=!1,p.timeout=null,p.columnHead=null,e(h.box).on("mousedown",n),e(h.box).on("mouseup",i),{remove:function(){e(h.box).off("mousedown",n),e(h.box).off("mouseup",i),e(h.box).find(".w2ui-head").removeAttr("draggable"),h.last.columnDrag=!1,u=!1}}},toggleColumn:function(){for(var e=0,t=this.mainGrid,i=0;i<arguments.length;i++)for(var n=t.columns.length-1;n>=0;n--){var s=t.columns[n]=this.origOptions.columns[n];s.field==arguments[i]&&(s.hidden=!s.hidden,e++)}return t.refreshBody(),t.resizeRecords(),e},showColumn:function(){for(var e=0,t=this.mainGrid,i=0;i<arguments.length;i++)for(var n=t.columns.length-1;n>=0;n--){var s=t.columns[n]=this.origOptions.columns[n];s.gridMinWidth&&delete s.gridMinWidth,s.field==arguments[i]&&s.hidden!==!1&&(s.hidden=!1,e++)}return t.refreshBody(),t.resizeRecords(),e},hideColumn:function(){for(var e=0,t=this.mainGrid,i=0;i<arguments.length;i++)for(var n=t.columns.length-1;n>=0;n--){var s=t.columns[n]=this.origOptions.columns[n];s.field==arguments[i]&&s.hidden!==!0&&(s.hidden=!0,e++)}return t.refreshBody(),t.resizeRecords(),e},destroy:function(){w2obj.grid.prototype.getRecordHTML=this.origGetRecordHtml,w2obj.grid.prototype.getCellHTML=this.origGetCellHTML,w2obj.grid.prototype.getSummaryHTML=this.origGetSummaryHTML,w2obj.grid.prototype.toggleColumn=this.origToggleColumn,w2obj.grid.prototype.hideColumn=this.origHideColumn,w2obj.grid.prototype.showColumn=this.origShowColumn,w2obj.grid.prototype.initColumnDrag=this.originItColumnDrag,w2obj.grid.prototype.refresh=this.origRefresh,this.mainGrid.destroy();var t=this.trigger({phase:"before",target:this.name,type:"destroy"});t.isCancelled!==!0&&(e(window).off("resize.w2ui-"+this.name),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),e(this.mainGrid.box).parent().find(".w2ui-groups").remove(),delete w2ui[this.name],this.trigger(e.extend(t,{phase:"after"})))}},e.extend(t.prototype,w2utils.event),w2obj.groupedgrid=t}(jQuery),function(e){w2utils.validateRaw=function(t,i){for(var n in i){var s=i[n],r="",o=e(t.find("#"+s.name)).w2field(),a="#"+s.name,l=e(a).parent(),c=e(t.find("#"+s.name));if(r=o?o.type:"",o)if("radio"==r)e(o.el).parents("div")[0].w2tag(s.message,{class:"w2ui-error",parentEl:l});else if(["enum","file"].indexOf(r)!=-1){var d=o.helpers.multi;e(o.el).w2tag(s.message,{parentEl:l,onHide:function(t){e(d).removeClass("w2ui-error")}}),e(d).addClass("w2ui-error")}else e(o.el).w2tag(s.message,{class:"w2ui-error",parentEl:l});else c.w2tag(s.message,{class:"w2ui-error",parentEl:l})}},w2utils.validate=function(e,t){var i=w2utils.modelErrors(e);return!(i.length>0)||(w2utils.validateRaw(t,i),!1)},w2utils.modelErrors=function(t){var i=[];e().w2tag();var n;n="function"==typeof t.fields?t.fields():t.fields;for(var s in n){var r=n[s];switch(null===t.get(r.name)&&t.set(r.name,"",{silent:!0}),r.type){case"int":t.get(r.name)&&!w2utils.isInt(t.get(r.name))&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not an integer")});break;case"float":t.get(r.name)&&!w2utils.isFloat(t.get(r.name))&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not a float")});break;case"money":this.record[r.name]&&!w2utils.isMoney(this.record[r.name])&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not in money format")});break;case"color":case"hex":t.get(r.name)&&!w2utils.isHex(t.get(r.name))&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not a hex number")});break;case"email":t.get(r.name)&&!w2utils.isEmail(t.get(r.name))&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not a valid email")});break;case"checkbox":t.get(r.name)===!0?t.set(r.name,1):t.set(r.name,0);break;case"date":t.get(r.name)&&!w2utils.isDate(t.get(r.name),w2utils.settings.date_format)&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Not a valid date")});break;case"list":case"combo":break;case"enum":break;case"model":var o=t.get(r.name),a=w2utils.modelErrors(o);i=_.union(i,a);break;case"collection":;e.each(t.get(r.name).models,function(e,t){var n=w2utils.modelErrors(t);i=_.union(i,n)})}var l=t.get(r.name);r.required&&(""===l||0!==l&&!l||e.isArray(l)&&0===l.length||e.isPlainObject(l)&&e.isEmptyObject(l))&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Required field")}),r.equalto&&t.get(r.name)!=t.get(r.name)&&i.push({name:r.el.replace("#",""),message:w2utils.lang("Field should be equal to ")+r.equalto})}eventData={phase:"before",target:t.id,type:"validate",errors:i};return t.trigger(e.extend(eventData,{phase:"after"})),i}}(jQuery);